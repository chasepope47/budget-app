var Q0=c=>{throw TypeError(c)};var bd=(c,t,e)=>t.has(c)||Q0("Cannot "+e);var ne=(c,t,e)=>(bd(c,t,"read from private field"),e?e.call(c):t.get(c)),Ks=(c,t,e)=>t.has(c)?Q0("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(c):t.set(c,e),ns=(c,t,e,n)=>(bd(c,t,"write to private field"),n?n.call(c,e):t.set(c,e),e),Ws=(c,t,e)=>(bd(c,t,"access private method"),e);var J0=(c,t,e,n)=>({set _(r){ns(c,t,r,e)},get _(){return ne(c,t,n)}});function kA(c,t){for(var e=0;e<t.length;e++){const n=t[e];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in c)){const a=Object.getOwnPropertyDescriptor(n,r);a&&Object.defineProperty(c,r,a.get?a:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=e(r);fetch(r.href,a)}})();function my(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}function Ro(c){if(Object.prototype.hasOwnProperty.call(c,"__esModule"))return c;var t=c.default;if(typeof t=="function"){var e=function n(){var r=!1;try{r=this instanceof n}catch{}return r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(c).forEach(function(n){var r=Object.getOwnPropertyDescriptor(c,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return c[n]}})}),e}var yd={exports:{}},Qa={};var Z0;function DA(){if(Z0)return Qa;Z0=1;var c=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(n,r,a){var o=null;if(a!==void 0&&(o=""+a),r.key!==void 0&&(o=""+r.key),"key"in r){a={};for(var u in r)u!=="key"&&(a[u]=r[u])}else a=r;return r=a.ref,{$$typeof:c,type:n,key:o,ref:r!==void 0?r:null,props:a}}return Qa.Fragment=t,Qa.jsx=e,Qa.jsxs=e,Qa}var tb;function MA(){return tb||(tb=1,yd.exports=DA()),yd.exports}var x=MA(),vd={exports:{}},St={};var eb;function jA(){if(eb)return St;eb=1;var c=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),o=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),m=Symbol.for("react.activity"),y=Symbol.iterator;function v(j){return j===null||typeof j!="object"?null:(j=y&&j[y]||j["@@iterator"],typeof j=="function"?j:null)}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w=Object.assign,S={};function E(j,G,J){this.props=j,this.context=G,this.refs=S,this.updater=J||_}E.prototype.isReactComponent={},E.prototype.setState=function(j,G){if(typeof j!="object"&&typeof j!="function"&&j!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,j,G,"setState")},E.prototype.forceUpdate=function(j){this.updater.enqueueForceUpdate(this,j,"forceUpdate")};function R(){}R.prototype=E.prototype;function T(j,G,J){this.props=j,this.context=G,this.refs=S,this.updater=J||_}var O=T.prototype=new R;O.constructor=T,w(O,E.prototype),O.isPureReactComponent=!0;var N=Array.isArray;function k(){}var M={H:null,A:null,T:null,S:null},I=Object.prototype.hasOwnProperty;function X(j,G,J){var et=J.ref;return{$$typeof:c,type:j,key:G,ref:et!==void 0?et:null,props:J}}function Q(j,G){return X(j.type,G,j.props)}function Z(j){return typeof j=="object"&&j!==null&&j.$$typeof===c}function st(j){var G={"=":"=0",":":"=2"};return"$"+j.replace(/[=:]/g,function(J){return G[J]})}var ht=/\/+/g;function wt(j,G){return typeof j=="object"&&j!==null&&j.key!=null?st(""+j.key):G.toString(36)}function _t(j){switch(j.status){case"fulfilled":return j.value;case"rejected":throw j.reason;default:switch(typeof j.status=="string"?j.then(k,k):(j.status="pending",j.then(function(G){j.status==="pending"&&(j.status="fulfilled",j.value=G)},function(G){j.status==="pending"&&(j.status="rejected",j.reason=G)})),j.status){case"fulfilled":return j.value;case"rejected":throw j.reason}}throw j}function P(j,G,J,et,mt){var bt=typeof j;(bt==="undefined"||bt==="boolean")&&(j=null);var ft=!1;if(j===null)ft=!0;else switch(bt){case"bigint":case"string":case"number":ft=!0;break;case"object":switch(j.$$typeof){case c:case t:ft=!0;break;case p:return ft=j._init,P(ft(j._payload),G,J,et,mt)}}if(ft)return mt=mt(j),ft=et===""?"."+wt(j,0):et,N(mt)?(J="",ft!=null&&(J=ft.replace(ht,"$&/")+"/"),P(mt,G,J,"",function(nn){return nn})):mt!=null&&(Z(mt)&&(mt=Q(mt,J+(mt.key==null||j&&j.key===mt.key?"":(""+mt.key).replace(ht,"$&/")+"/")+ft)),G.push(mt)),1;ft=0;var Jt=et===""?".":et+":";if(N(j))for(var $t=0;$t<j.length;$t++)et=j[$t],bt=Jt+wt(et,$t),ft+=P(et,G,J,bt,mt);else if($t=v(j),typeof $t=="function")for(j=$t.call(j),$t=0;!(et=j.next()).done;)et=et.value,bt=Jt+wt(et,$t++),ft+=P(et,G,J,bt,mt);else if(bt==="object"){if(typeof j.then=="function")return P(_t(j),G,J,et,mt);throw G=String(j),Error("Objects are not valid as a React child (found: "+(G==="[object Object]"?"object with keys {"+Object.keys(j).join(", ")+"}":G)+"). If you meant to render a collection of children, use an array instead.")}return ft}function $(j,G,J){if(j==null)return j;var et=[],mt=0;return P(j,et,"","",function(bt){return G.call(J,bt,mt++)}),et}function tt(j){if(j._status===-1){var G=j._result;G=G(),G.then(function(J){(j._status===0||j._status===-1)&&(j._status=1,j._result=J)},function(J){(j._status===0||j._status===-1)&&(j._status=2,j._result=J)}),j._status===-1&&(j._status=0,j._result=G)}if(j._status===1)return j._result.default;throw j._result}var At=typeof reportError=="function"?reportError:function(j){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var G=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof j=="object"&&j!==null&&typeof j.message=="string"?String(j.message):String(j),error:j});if(!window.dispatchEvent(G))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",j);return}console.error(j)},Ot={map:$,forEach:function(j,G,J){$(j,function(){G.apply(this,arguments)},J)},count:function(j){var G=0;return $(j,function(){G++}),G},toArray:function(j){return $(j,function(G){return G})||[]},only:function(j){if(!Z(j))throw Error("React.Children.only expected to receive a single React element child.");return j}};return St.Activity=m,St.Children=Ot,St.Component=E,St.Fragment=e,St.Profiler=r,St.PureComponent=T,St.StrictMode=n,St.Suspense=d,St.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=M,St.__COMPILER_RUNTIME={__proto__:null,c:function(j){return M.H.useMemoCache(j)}},St.cache=function(j){return function(){return j.apply(null,arguments)}},St.cacheSignal=function(){return null},St.cloneElement=function(j,G,J){if(j==null)throw Error("The argument must be a React element, but you passed "+j+".");var et=w({},j.props),mt=j.key;if(G!=null)for(bt in G.key!==void 0&&(mt=""+G.key),G)!I.call(G,bt)||bt==="key"||bt==="__self"||bt==="__source"||bt==="ref"&&G.ref===void 0||(et[bt]=G[bt]);var bt=arguments.length-2;if(bt===1)et.children=J;else if(1<bt){for(var ft=Array(bt),Jt=0;Jt<bt;Jt++)ft[Jt]=arguments[Jt+2];et.children=ft}return X(j.type,mt,et)},St.createContext=function(j){return j={$$typeof:o,_currentValue:j,_currentValue2:j,_threadCount:0,Provider:null,Consumer:null},j.Provider=j,j.Consumer={$$typeof:a,_context:j},j},St.createElement=function(j,G,J){var et,mt={},bt=null;if(G!=null)for(et in G.key!==void 0&&(bt=""+G.key),G)I.call(G,et)&&et!=="key"&&et!=="__self"&&et!=="__source"&&(mt[et]=G[et]);var ft=arguments.length-2;if(ft===1)mt.children=J;else if(1<ft){for(var Jt=Array(ft),$t=0;$t<ft;$t++)Jt[$t]=arguments[$t+2];mt.children=Jt}if(j&&j.defaultProps)for(et in ft=j.defaultProps,ft)mt[et]===void 0&&(mt[et]=ft[et]);return X(j,bt,mt)},St.createRef=function(){return{current:null}},St.forwardRef=function(j){return{$$typeof:u,render:j}},St.isValidElement=Z,St.lazy=function(j){return{$$typeof:p,_payload:{_status:-1,_result:j},_init:tt}},St.memo=function(j,G){return{$$typeof:f,type:j,compare:G===void 0?null:G}},St.startTransition=function(j){var G=M.T,J={};M.T=J;try{var et=j(),mt=M.S;mt!==null&&mt(J,et),typeof et=="object"&&et!==null&&typeof et.then=="function"&&et.then(k,At)}catch(bt){At(bt)}finally{G!==null&&J.types!==null&&(G.types=J.types),M.T=G}},St.unstable_useCacheRefresh=function(){return M.H.useCacheRefresh()},St.use=function(j){return M.H.use(j)},St.useActionState=function(j,G,J){return M.H.useActionState(j,G,J)},St.useCallback=function(j,G){return M.H.useCallback(j,G)},St.useContext=function(j){return M.H.useContext(j)},St.useDebugValue=function(){},St.useDeferredValue=function(j,G){return M.H.useDeferredValue(j,G)},St.useEffect=function(j,G){return M.H.useEffect(j,G)},St.useEffectEvent=function(j){return M.H.useEffectEvent(j)},St.useId=function(){return M.H.useId()},St.useImperativeHandle=function(j,G,J){return M.H.useImperativeHandle(j,G,J)},St.useInsertionEffect=function(j,G){return M.H.useInsertionEffect(j,G)},St.useLayoutEffect=function(j,G){return M.H.useLayoutEffect(j,G)},St.useMemo=function(j,G){return M.H.useMemo(j,G)},St.useOptimistic=function(j,G){return M.H.useOptimistic(j,G)},St.useReducer=function(j,G,J){return M.H.useReducer(j,G,J)},St.useRef=function(j){return M.H.useRef(j)},St.useState=function(j){return M.H.useState(j)},St.useSyncExternalStore=function(j,G,J){return M.H.useSyncExternalStore(j,G,J)},St.useTransition=function(){return M.H.useTransition()},St.version="19.2.1",St}var sb;function Cf(){return sb||(sb=1,vd.exports=jA()),vd.exports}var ut=Cf();const Pe=my(ut);var wd={exports:{}},Ja={},_d={exports:{}},Ad={};var nb;function LA(){return nb||(nb=1,(function(c){function t(P,$){var tt=P.length;P.push($);t:for(;0<tt;){var At=tt-1>>>1,Ot=P[At];if(0<r(Ot,$))P[At]=$,P[tt]=Ot,tt=At;else break t}}function e(P){return P.length===0?null:P[0]}function n(P){if(P.length===0)return null;var $=P[0],tt=P.pop();if(tt!==$){P[0]=tt;t:for(var At=0,Ot=P.length,j=Ot>>>1;At<j;){var G=2*(At+1)-1,J=P[G],et=G+1,mt=P[et];if(0>r(J,tt))et<Ot&&0>r(mt,J)?(P[At]=mt,P[et]=tt,At=et):(P[At]=J,P[G]=tt,At=G);else if(et<Ot&&0>r(mt,tt))P[At]=mt,P[et]=tt,At=et;else break t}}return $}function r(P,$){var tt=P.sortIndex-$.sortIndex;return tt!==0?tt:P.id-$.id}if(c.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;c.unstable_now=function(){return a.now()}}else{var o=Date,u=o.now();c.unstable_now=function(){return o.now()-u}}var d=[],f=[],p=1,m=null,y=3,v=!1,_=!1,w=!1,S=!1,E=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;function O(P){for(var $=e(f);$!==null;){if($.callback===null)n(f);else if($.startTime<=P)n(f),$.sortIndex=$.expirationTime,t(d,$);else break;$=e(f)}}function N(P){if(w=!1,O(P),!_)if(e(d)!==null)_=!0,k||(k=!0,st());else{var $=e(f);$!==null&&_t(N,$.startTime-P)}}var k=!1,M=-1,I=5,X=-1;function Q(){return S?!0:!(c.unstable_now()-X<I)}function Z(){if(S=!1,k){var P=c.unstable_now();X=P;var $=!0;try{t:{_=!1,w&&(w=!1,R(M),M=-1),v=!0;var tt=y;try{e:{for(O(P),m=e(d);m!==null&&!(m.expirationTime>P&&Q());){var At=m.callback;if(typeof At=="function"){m.callback=null,y=m.priorityLevel;var Ot=At(m.expirationTime<=P);if(P=c.unstable_now(),typeof Ot=="function"){m.callback=Ot,O(P),$=!0;break e}m===e(d)&&n(d),O(P)}else n(d);m=e(d)}if(m!==null)$=!0;else{var j=e(f);j!==null&&_t(N,j.startTime-P),$=!1}}break t}finally{m=null,y=tt,v=!1}$=void 0}}finally{$?st():k=!1}}}var st;if(typeof T=="function")st=function(){T(Z)};else if(typeof MessageChannel<"u"){var ht=new MessageChannel,wt=ht.port2;ht.port1.onmessage=Z,st=function(){wt.postMessage(null)}}else st=function(){E(Z,0)};function _t(P,$){M=E(function(){P(c.unstable_now())},$)}c.unstable_IdlePriority=5,c.unstable_ImmediatePriority=1,c.unstable_LowPriority=4,c.unstable_NormalPriority=3,c.unstable_Profiling=null,c.unstable_UserBlockingPriority=2,c.unstable_cancelCallback=function(P){P.callback=null},c.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<P?Math.floor(1e3/P):5},c.unstable_getCurrentPriorityLevel=function(){return y},c.unstable_next=function(P){switch(y){case 1:case 2:case 3:var $=3;break;default:$=y}var tt=y;y=$;try{return P()}finally{y=tt}},c.unstable_requestPaint=function(){S=!0},c.unstable_runWithPriority=function(P,$){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var tt=y;y=P;try{return $()}finally{y=tt}},c.unstable_scheduleCallback=function(P,$,tt){var At=c.unstable_now();switch(typeof tt=="object"&&tt!==null?(tt=tt.delay,tt=typeof tt=="number"&&0<tt?At+tt:At):tt=At,P){case 1:var Ot=-1;break;case 2:Ot=250;break;case 5:Ot=1073741823;break;case 4:Ot=1e4;break;default:Ot=5e3}return Ot=tt+Ot,P={id:p++,callback:$,priorityLevel:P,startTime:tt,expirationTime:Ot,sortIndex:-1},tt>At?(P.sortIndex=tt,t(f,P),e(d)===null&&P===e(f)&&(w?(R(M),M=-1):w=!0,_t(N,tt-At))):(P.sortIndex=Ot,t(d,P),_||v||(_=!0,k||(k=!0,st()))),P},c.unstable_shouldYield=Q,c.unstable_wrapCallback=function(P){var $=y;return function(){var tt=y;y=$;try{return P.apply(this,arguments)}finally{y=tt}}}})(Ad)),Ad}var ib;function PA(){return ib||(ib=1,_d.exports=LA()),_d.exports}var Sd={exports:{}},ze={};var rb;function BA(){if(rb)return ze;rb=1;var c=Cf();function t(d){var f="https://react.dev/errors/"+d;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)f+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+d+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var n={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},r=Symbol.for("react.portal");function a(d,f,p){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:m==null?null:""+m,children:d,containerInfo:f,implementation:p}}var o=c.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(d,f){if(d==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return ze.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,ze.createPortal=function(d,f){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(t(299));return a(d,f,null,p)},ze.flushSync=function(d){var f=o.T,p=n.p;try{if(o.T=null,n.p=2,d)return d()}finally{o.T=f,n.p=p,n.d.f()}},ze.preconnect=function(d,f){typeof d=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,n.d.C(d,f))},ze.prefetchDNS=function(d){typeof d=="string"&&n.d.D(d)},ze.preinit=function(d,f){if(typeof d=="string"&&f&&typeof f.as=="string"){var p=f.as,m=u(p,f.crossOrigin),y=typeof f.integrity=="string"?f.integrity:void 0,v=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;p==="style"?n.d.S(d,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:m,integrity:y,fetchPriority:v}):p==="script"&&n.d.X(d,{crossOrigin:m,integrity:y,fetchPriority:v,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},ze.preinitModule=function(d,f){if(typeof d=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var p=u(f.as,f.crossOrigin);n.d.M(d,{crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&n.d.M(d)},ze.preload=function(d,f){if(typeof d=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var p=f.as,m=u(p,f.crossOrigin);n.d.L(d,p,{crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},ze.preloadModule=function(d,f){if(typeof d=="string")if(f){var p=u(f.as,f.crossOrigin);n.d.m(d,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else n.d.m(d)},ze.requestFormReset=function(d){n.d.r(d)},ze.unstable_batchedUpdates=function(d,f){return d(f)},ze.useFormState=function(d,f,p){return o.H.useFormState(d,f,p)},ze.useFormStatus=function(){return o.H.useHostTransitionStatus()},ze.version="19.2.1",ze}var ab;function IA(){if(ab)return Sd.exports;ab=1;function c(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c)}catch(t){console.error(t)}}return c(),Sd.exports=BA(),Sd.exports}var ob;function UA(){if(ob)return Ja;ob=1;var c=PA(),t=Cf(),e=IA();function n(s){var i="https://react.dev/errors/"+s;if(1<arguments.length){i+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)i+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+s+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function a(s){var i=s,l=s;if(s.alternate)for(;i.return;)i=i.return;else{s=i;do i=s,(i.flags&4098)!==0&&(l=i.return),s=i.return;while(s)}return i.tag===3?l:null}function o(s){if(s.tag===13){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function u(s){if(s.tag===31){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function d(s){if(a(s)!==s)throw Error(n(188))}function f(s){var i=s.alternate;if(!i){if(i=a(s),i===null)throw Error(n(188));return i!==s?null:s}for(var l=s,h=i;;){var g=l.return;if(g===null)break;var b=g.alternate;if(b===null){if(h=g.return,h!==null){l=h;continue}break}if(g.child===b.child){for(b=g.child;b;){if(b===l)return d(g),s;if(b===h)return d(g),i;b=b.sibling}throw Error(n(188))}if(l.return!==h.return)l=g,h=b;else{for(var A=!1,C=g.child;C;){if(C===l){A=!0,l=g,h=b;break}if(C===h){A=!0,h=g,l=b;break}C=C.sibling}if(!A){for(C=b.child;C;){if(C===l){A=!0,l=b,h=g;break}if(C===h){A=!0,h=b,l=g;break}C=C.sibling}if(!A)throw Error(n(189))}}if(l.alternate!==h)throw Error(n(190))}if(l.tag!==3)throw Error(n(188));return l.stateNode.current===l?s:i}function p(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s;for(s=s.child;s!==null;){if(i=p(s),i!==null)return i;s=s.sibling}return null}var m=Object.assign,y=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),R=Symbol.for("react.consumer"),T=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),k=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),X=Symbol.for("react.activity"),Q=Symbol.for("react.memo_cache_sentinel"),Z=Symbol.iterator;function st(s){return s===null||typeof s!="object"?null:(s=Z&&s[Z]||s["@@iterator"],typeof s=="function"?s:null)}var ht=Symbol.for("react.client.reference");function wt(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===ht?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case w:return"Fragment";case E:return"Profiler";case S:return"StrictMode";case N:return"Suspense";case k:return"SuspenseList";case X:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case _:return"Portal";case T:return s.displayName||"Context";case R:return(s._context.displayName||"Context")+".Consumer";case O:var i=s.render;return s=s.displayName,s||(s=i.displayName||i.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case M:return i=s.displayName||null,i!==null?i:wt(s.type)||"Memo";case I:i=s._payload,s=s._init;try{return wt(s(i))}catch{}}return null}var _t=Array.isArray,P=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,tt={pending:!1,data:null,method:null,action:null},At=[],Ot=-1;function j(s){return{current:s}}function G(s){0>Ot||(s.current=At[Ot],At[Ot]=null,Ot--)}function J(s,i){Ot++,At[Ot]=s.current,s.current=i}var et=j(null),mt=j(null),bt=j(null),ft=j(null);function Jt(s,i){switch(J(bt,i),J(mt,s),J(et,null),i.nodeType){case 9:case 11:s=(s=i.documentElement)&&(s=s.namespaceURI)?w0(s):0;break;default:if(s=i.tagName,i=i.namespaceURI)i=w0(i),s=_0(i,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}G(et),J(et,s)}function $t(){G(et),G(mt),G(bt)}function nn(s){s.memoizedState!==null&&J(ft,s);var i=et.current,l=_0(i,s.type);i!==l&&(J(mt,s),J(et,l))}function ys(s){mt.current===s&&(G(et),G(mt)),ft.current===s&&(G(ft),Xa._currentValue=tt)}var Ms,rn;function js(s){if(Ms===void 0)try{throw Error()}catch(l){var i=l.stack.trim().match(/\n( *(at )?)/);Ms=i&&i[1]||"",rn=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ms+s+rn}var oi=!1;function li(s,i){if(!s||oi)return"";oi=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var h={DetermineComponentFrameRoot:function(){try{if(i){var K=function(){throw Error()};if(Object.defineProperty(K.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(K,[])}catch(q){var z=q}Reflect.construct(s,[],K)}else{try{K.call()}catch(q){z=q}s.call(K.prototype)}}else{try{throw Error()}catch(q){z=q}(K=s())&&typeof K.catch=="function"&&K.catch(function(){})}}catch(q){if(q&&z&&typeof q.stack=="string")return[q.stack,z.stack]}return[null,null]}};h.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(h.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(h.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=h.DetermineComponentFrameRoot(),A=b[0],C=b[1];if(A&&C){var D=A.split(`
`),F=C.split(`
`);for(g=h=0;h<D.length&&!D[h].includes("DetermineComponentFrameRoot");)h++;for(;g<F.length&&!F[g].includes("DetermineComponentFrameRoot");)g++;if(h===D.length||g===F.length)for(h=D.length-1,g=F.length-1;1<=h&&0<=g&&D[h]!==F[g];)g--;for(;1<=h&&0<=g;h--,g--)if(D[h]!==F[g]){if(h!==1||g!==1)do if(h--,g--,0>g||D[h]!==F[g]){var V=`
`+D[h].replace(" at new "," at ");return s.displayName&&V.includes("<anonymous>")&&(V=V.replace("<anonymous>",s.displayName)),V}while(1<=h&&0<=g);break}}}finally{oi=!1,Error.prepareStackTrace=l}return(l=s?s.displayName||s.name:"")?js(l):""}function Io(s,i){switch(s.tag){case 26:case 27:case 5:return js(s.type);case 16:return js("Lazy");case 13:return s.child!==i&&i!==null?js("Suspense Fallback"):js("Suspense");case 19:return js("SuspenseList");case 0:case 15:return li(s.type,!1);case 11:return li(s.type.render,!1);case 1:return li(s.type,!0);case 31:return js("Activity");default:return""}}function aa(s){try{var i="",l=null;do i+=Io(s,l),l=s,s=s.return;while(s);return i}catch(h){return`
Error generating stack: `+h.message+`
`+h.stack}}var oa=Object.prototype.hasOwnProperty,Vi=c.unstable_scheduleCallback,ci=c.unstable_cancelCallback,Uo=c.unstable_shouldYield,eu=c.unstable_requestPaint,Fe=c.unstable_now,su=c.unstable_getCurrentPriorityLevel,Fo=c.unstable_ImmediatePriority,zo=c.unstable_UserBlockingPriority,Xi=c.unstable_NormalPriority,nu=c.unstable_LowPriority,Ho=c.unstable_IdlePriority,$o=c.log,qo=c.unstable_setDisableYieldValue,ui=null,$e=null;function Ls(s){if(typeof $o=="function"&&qo(s),$e&&typeof $e.setStrictMode=="function")try{$e.setStrictMode(ui,s)}catch{}}var qe=Math.clz32?Math.clz32:ru,Go=Math.log,iu=Math.LN2;function ru(s){return s>>>=0,s===0?32:31-(Go(s)/iu|0)|0}var Yi=256,Ki=262144,Wi=4194304;function an(s){var i=s&42;if(i!==0)return i;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function Qi(s,i,l){var h=s.pendingLanes;if(h===0)return 0;var g=0,b=s.suspendedLanes,A=s.pingedLanes;s=s.warmLanes;var C=h&134217727;return C!==0?(h=C&~b,h!==0?g=an(h):(A&=C,A!==0?g=an(A):l||(l=C&~s,l!==0&&(g=an(l))))):(C=h&~b,C!==0?g=an(C):A!==0?g=an(A):l||(l=h&~s,l!==0&&(g=an(l)))),g===0?0:i!==0&&i!==g&&(i&b)===0&&(b=g&-g,l=i&-i,b>=l||b===32&&(l&4194048)!==0)?i:g}function H(s,i){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&i)===0}function W(s,i){switch(s){case 1:case 2:case 4:case 8:case 64:return i+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function dt(){var s=Wi;return Wi<<=1,(Wi&62914560)===0&&(Wi=4194304),s}function ct(s){for(var i=[],l=0;31>l;l++)i.push(s);return i}function Bt(s,i){s.pendingLanes|=i,i!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Ps(s,i,l,h,g,b){var A=s.pendingLanes;s.pendingLanes=l,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=l,s.entangledLanes&=l,s.errorRecoveryDisabledLanes&=l,s.shellSuspendCounter=0;var C=s.entanglements,D=s.expirationTimes,F=s.hiddenUpdates;for(l=A&~l;0<l;){var V=31-qe(l),K=1<<V;C[V]=0,D[V]=-1;var z=F[V];if(z!==null)for(F[V]=null,V=0;V<z.length;V++){var q=z[V];q!==null&&(q.lane&=-536870913)}l&=~K}h!==0&&hi(s,h,0),b!==0&&g===0&&s.tag!==0&&(s.suspendedLanes|=b&~(A&~i))}function hi(s,i,l){s.pendingLanes|=i,s.suspendedLanes&=~i;var h=31-qe(i);s.entangledLanes|=i,s.entanglements[h]=s.entanglements[h]|1073741824|l&261930}function Vo(s,i){var l=s.entangledLanes|=i;for(s=s.entanglements;l;){var h=31-qe(l),g=1<<h;g&i|s[h]&i&&(s[h]|=i),l&=~g}}function ip(s,i){var l=i&-i;return l=(l&42)!==0?1:au(l),(l&(s.suspendedLanes|i))!==0?0:l}function au(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function ou(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function rp(){var s=$.p;return s!==0?s:(s=window.event,s===void 0?32:q0(s.type))}function ap(s,i){var l=$.p;try{return $.p=s,i()}finally{$.p=l}}var kn=Math.random().toString(36).slice(2),Ce="__reactFiber$"+kn,We="__reactProps$"+kn,Ji="__reactContainer$"+kn,lu="__reactEvents$"+kn,ww="__reactListeners$"+kn,_w="__reactHandles$"+kn,op="__reactResources$"+kn,la="__reactMarker$"+kn;function cu(s){delete s[Ce],delete s[We],delete s[lu],delete s[ww],delete s[_w]}function Zi(s){var i=s[Ce];if(i)return i;for(var l=s.parentNode;l;){if(i=l[Ji]||l[Ce]){if(l=i.alternate,i.child!==null||l!==null&&l.child!==null)for(s=R0(s);s!==null;){if(l=s[Ce])return l;s=R0(s)}return i}s=l,l=s.parentNode}return null}function tr(s){if(s=s[Ce]||s[Ji]){var i=s.tag;if(i===5||i===6||i===13||i===31||i===26||i===27||i===3)return s}return null}function ca(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s.stateNode;throw Error(n(33))}function er(s){var i=s[op];return i||(i=s[op]={hoistableStyles:new Map,hoistableScripts:new Map}),i}function Se(s){s[la]=!0}var lp=new Set,cp={};function di(s,i){sr(s,i),sr(s+"Capture",i)}function sr(s,i){for(cp[s]=i,s=0;s<i.length;s++)lp.add(i[s])}var Aw=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),up={},hp={};function Sw(s){return oa.call(hp,s)?!0:oa.call(up,s)?!1:Aw.test(s)?hp[s]=!0:(up[s]=!0,!1)}function Xo(s,i,l){if(Sw(i))if(l===null)s.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":s.removeAttribute(i);return;case"boolean":var h=i.toLowerCase().slice(0,5);if(h!=="data-"&&h!=="aria-"){s.removeAttribute(i);return}}s.setAttribute(i,""+l)}}function Yo(s,i,l){if(l===null)s.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(i);return}s.setAttribute(i,""+l)}}function on(s,i,l,h){if(h===null)s.removeAttribute(l);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(l);return}s.setAttributeNS(i,l,""+h)}}function vs(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function dp(s){var i=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function xw(s,i,l){var h=Object.getOwnPropertyDescriptor(s.constructor.prototype,i);if(!s.hasOwnProperty(i)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var g=h.get,b=h.set;return Object.defineProperty(s,i,{configurable:!0,get:function(){return g.call(this)},set:function(A){l=""+A,b.call(this,A)}}),Object.defineProperty(s,i,{enumerable:h.enumerable}),{getValue:function(){return l},setValue:function(A){l=""+A},stopTracking:function(){s._valueTracker=null,delete s[i]}}}}function uu(s){if(!s._valueTracker){var i=dp(s)?"checked":"value";s._valueTracker=xw(s,i,""+s[i])}}function fp(s){if(!s)return!1;var i=s._valueTracker;if(!i)return!0;var l=i.getValue(),h="";return s&&(h=dp(s)?s.checked?"true":"false":s.value),s=h,s!==l?(i.setValue(s),!0):!1}function Ko(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var Ew=/[\n"\\]/g;function ws(s){return s.replace(Ew,function(i){return"\\"+i.charCodeAt(0).toString(16)+" "})}function hu(s,i,l,h,g,b,A,C){s.name="",A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"?s.type=A:s.removeAttribute("type"),i!=null?A==="number"?(i===0&&s.value===""||s.value!=i)&&(s.value=""+vs(i)):s.value!==""+vs(i)&&(s.value=""+vs(i)):A!=="submit"&&A!=="reset"||s.removeAttribute("value"),i!=null?du(s,A,vs(i)):l!=null?du(s,A,vs(l)):h!=null&&s.removeAttribute("value"),g==null&&b!=null&&(s.defaultChecked=!!b),g!=null&&(s.checked=g&&typeof g!="function"&&typeof g!="symbol"),C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"?s.name=""+vs(C):s.removeAttribute("name")}function pp(s,i,l,h,g,b,A,C){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(s.type=b),i!=null||l!=null){if(!(b!=="submit"&&b!=="reset"||i!=null)){uu(s);return}l=l!=null?""+vs(l):"",i=i!=null?""+vs(i):l,C||i===s.value||(s.value=i),s.defaultValue=i}h=h??g,h=typeof h!="function"&&typeof h!="symbol"&&!!h,s.checked=C?s.checked:!!h,s.defaultChecked=!!h,A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"&&(s.name=A),uu(s)}function du(s,i,l){i==="number"&&Ko(s.ownerDocument)===s||s.defaultValue===""+l||(s.defaultValue=""+l)}function nr(s,i,l,h){if(s=s.options,i){i={};for(var g=0;g<l.length;g++)i["$"+l[g]]=!0;for(l=0;l<s.length;l++)g=i.hasOwnProperty("$"+s[l].value),s[l].selected!==g&&(s[l].selected=g),g&&h&&(s[l].defaultSelected=!0)}else{for(l=""+vs(l),i=null,g=0;g<s.length;g++){if(s[g].value===l){s[g].selected=!0,h&&(s[g].defaultSelected=!0);return}i!==null||s[g].disabled||(i=s[g])}i!==null&&(i.selected=!0)}}function gp(s,i,l){if(i!=null&&(i=""+vs(i),i!==s.value&&(s.value=i),l==null)){s.defaultValue!==i&&(s.defaultValue=i);return}s.defaultValue=l!=null?""+vs(l):""}function mp(s,i,l,h){if(i==null){if(h!=null){if(l!=null)throw Error(n(92));if(_t(h)){if(1<h.length)throw Error(n(93));h=h[0]}l=h}l==null&&(l=""),i=l}l=vs(i),s.defaultValue=l,h=s.textContent,h===l&&h!==""&&h!==null&&(s.value=h),uu(s)}function ir(s,i){if(i){var l=s.firstChild;if(l&&l===s.lastChild&&l.nodeType===3){l.nodeValue=i;return}}s.textContent=i}var Tw=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function bp(s,i,l){var h=i.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?h?s.setProperty(i,""):i==="float"?s.cssFloat="":s[i]="":h?s.setProperty(i,l):typeof l!="number"||l===0||Tw.has(i)?i==="float"?s.cssFloat=l:s[i]=(""+l).trim():s[i]=l+"px"}function yp(s,i,l){if(i!=null&&typeof i!="object")throw Error(n(62));if(s=s.style,l!=null){for(var h in l)!l.hasOwnProperty(h)||i!=null&&i.hasOwnProperty(h)||(h.indexOf("--")===0?s.setProperty(h,""):h==="float"?s.cssFloat="":s[h]="");for(var g in i)h=i[g],i.hasOwnProperty(g)&&l[g]!==h&&bp(s,g,h)}else for(var b in i)i.hasOwnProperty(b)&&bp(s,b,i[b])}function fu(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Cw=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Rw=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Wo(s){return Rw.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function ln(){}var pu=null;function gu(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var rr=null,ar=null;function vp(s){var i=tr(s);if(i&&(s=i.stateNode)){var l=s[We]||null;t:switch(s=i.stateNode,i.type){case"input":if(hu(s,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),i=l.name,l.type==="radio"&&i!=null){for(l=s;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+ws(""+i)+'"][type="radio"]'),i=0;i<l.length;i++){var h=l[i];if(h!==s&&h.form===s.form){var g=h[We]||null;if(!g)throw Error(n(90));hu(h,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(i=0;i<l.length;i++)h=l[i],h.form===s.form&&fp(h)}break t;case"textarea":gp(s,l.value,l.defaultValue);break t;case"select":i=l.value,i!=null&&nr(s,!!l.multiple,i,!1)}}}var mu=!1;function wp(s,i,l){if(mu)return s(i,l);mu=!0;try{var h=s(i);return h}finally{if(mu=!1,(rr!==null||ar!==null)&&(Bl(),rr&&(i=rr,s=ar,ar=rr=null,vp(i),s)))for(i=0;i<s.length;i++)vp(s[i])}}function ua(s,i){var l=s.stateNode;if(l===null)return null;var h=l[We]||null;if(h===null)return null;l=h[i];t:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(s=s.type,h=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!h;break t;default:s=!1}if(s)return null;if(l&&typeof l!="function")throw Error(n(231,i,typeof l));return l}var cn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),bu=!1;if(cn)try{var ha={};Object.defineProperty(ha,"passive",{get:function(){bu=!0}}),window.addEventListener("test",ha,ha),window.removeEventListener("test",ha,ha)}catch{bu=!1}var Dn=null,yu=null,Qo=null;function _p(){if(Qo)return Qo;var s,i=yu,l=i.length,h,g="value"in Dn?Dn.value:Dn.textContent,b=g.length;for(s=0;s<l&&i[s]===g[s];s++);var A=l-s;for(h=1;h<=A&&i[l-h]===g[b-h];h++);return Qo=g.slice(s,1<h?1-h:void 0)}function Jo(s){var i=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&i===13&&(s=13)):s=i,s===10&&(s=13),32<=s||s===13?s:0}function Zo(){return!0}function Ap(){return!1}function Qe(s){function i(l,h,g,b,A){this._reactName=l,this._targetInst=g,this.type=h,this.nativeEvent=b,this.target=A,this.currentTarget=null;for(var C in s)s.hasOwnProperty(C)&&(l=s[C],this[C]=l?l(b):b[C]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?Zo:Ap,this.isPropagationStopped=Ap,this}return m(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Zo)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Zo)},persist:function(){},isPersistent:Zo}),i}var fi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},tl=Qe(fi),da=m({},fi,{view:0,detail:0}),Ow=Qe(da),vu,wu,fa,el=m({},da,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Au,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==fa&&(fa&&s.type==="mousemove"?(vu=s.screenX-fa.screenX,wu=s.screenY-fa.screenY):wu=vu=0,fa=s),vu)},movementY:function(s){return"movementY"in s?s.movementY:wu}}),Sp=Qe(el),Nw=m({},el,{dataTransfer:0}),kw=Qe(Nw),Dw=m({},da,{relatedTarget:0}),_u=Qe(Dw),Mw=m({},fi,{animationName:0,elapsedTime:0,pseudoElement:0}),jw=Qe(Mw),Lw=m({},fi,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Pw=Qe(Lw),Bw=m({},fi,{data:0}),xp=Qe(Bw),Iw={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Uw={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Fw={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zw(s){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(s):(s=Fw[s])?!!i[s]:!1}function Au(){return zw}var Hw=m({},da,{key:function(s){if(s.key){var i=Iw[s.key]||s.key;if(i!=="Unidentified")return i}return s.type==="keypress"?(s=Jo(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Uw[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Au,charCode:function(s){return s.type==="keypress"?Jo(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Jo(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),$w=Qe(Hw),qw=m({},el,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ep=Qe(qw),Gw=m({},da,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Au}),Vw=Qe(Gw),Xw=m({},fi,{propertyName:0,elapsedTime:0,pseudoElement:0}),Yw=Qe(Xw),Kw=m({},el,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),Ww=Qe(Kw),Qw=m({},fi,{newState:0,oldState:0}),Jw=Qe(Qw),Zw=[9,13,27,32],Su=cn&&"CompositionEvent"in window,pa=null;cn&&"documentMode"in document&&(pa=document.documentMode);var t_=cn&&"TextEvent"in window&&!pa,Tp=cn&&(!Su||pa&&8<pa&&11>=pa),Cp=" ",Rp=!1;function Op(s,i){switch(s){case"keyup":return Zw.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Np(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var or=!1;function e_(s,i){switch(s){case"compositionend":return Np(i);case"keypress":return i.which!==32?null:(Rp=!0,Cp);case"textInput":return s=i.data,s===Cp&&Rp?null:s;default:return null}}function s_(s,i){if(or)return s==="compositionend"||!Su&&Op(s,i)?(s=_p(),Qo=yu=Dn=null,or=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return Tp&&i.locale!=="ko"?null:i.data;default:return null}}var n_={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function kp(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i==="input"?!!n_[s.type]:i==="textarea"}function Dp(s,i,l,h){rr?ar?ar.push(h):ar=[h]:rr=h,i=ql(i,"onChange"),0<i.length&&(l=new tl("onChange","change",null,l,h),s.push({event:l,listeners:i}))}var ga=null,ma=null;function i_(s){p0(s,0)}function sl(s){var i=ca(s);if(fp(i))return s}function Mp(s,i){if(s==="change")return i}var jp=!1;if(cn){var xu;if(cn){var Eu="oninput"in document;if(!Eu){var Lp=document.createElement("div");Lp.setAttribute("oninput","return;"),Eu=typeof Lp.oninput=="function"}xu=Eu}else xu=!1;jp=xu&&(!document.documentMode||9<document.documentMode)}function Pp(){ga&&(ga.detachEvent("onpropertychange",Bp),ma=ga=null)}function Bp(s){if(s.propertyName==="value"&&sl(ma)){var i=[];Dp(i,ma,s,gu(s)),wp(i_,i)}}function r_(s,i,l){s==="focusin"?(Pp(),ga=i,ma=l,ga.attachEvent("onpropertychange",Bp)):s==="focusout"&&Pp()}function a_(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return sl(ma)}function o_(s,i){if(s==="click")return sl(i)}function l_(s,i){if(s==="input"||s==="change")return sl(i)}function c_(s,i){return s===i&&(s!==0||1/s===1/i)||s!==s&&i!==i}var ls=typeof Object.is=="function"?Object.is:c_;function ba(s,i){if(ls(s,i))return!0;if(typeof s!="object"||s===null||typeof i!="object"||i===null)return!1;var l=Object.keys(s),h=Object.keys(i);if(l.length!==h.length)return!1;for(h=0;h<l.length;h++){var g=l[h];if(!oa.call(i,g)||!ls(s[g],i[g]))return!1}return!0}function Ip(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Up(s,i){var l=Ip(s);s=0;for(var h;l;){if(l.nodeType===3){if(h=s+l.textContent.length,s<=i&&h>=i)return{node:l,offset:i-s};s=h}t:{for(;l;){if(l.nextSibling){l=l.nextSibling;break t}l=l.parentNode}l=void 0}l=Ip(l)}}function Fp(s,i){return s&&i?s===i?!0:s&&s.nodeType===3?!1:i&&i.nodeType===3?Fp(s,i.parentNode):"contains"in s?s.contains(i):s.compareDocumentPosition?!!(s.compareDocumentPosition(i)&16):!1:!1}function zp(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var i=Ko(s.document);i instanceof s.HTMLIFrameElement;){try{var l=typeof i.contentWindow.location.href=="string"}catch{l=!1}if(l)s=i.contentWindow;else break;i=Ko(s.document)}return i}function Tu(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i&&(i==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||i==="textarea"||s.contentEditable==="true")}var u_=cn&&"documentMode"in document&&11>=document.documentMode,lr=null,Cu=null,ya=null,Ru=!1;function Hp(s,i,l){var h=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Ru||lr==null||lr!==Ko(h)||(h=lr,"selectionStart"in h&&Tu(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),ya&&ba(ya,h)||(ya=h,h=ql(Cu,"onSelect"),0<h.length&&(i=new tl("onSelect","select",null,i,l),s.push({event:i,listeners:h}),i.target=lr)))}function pi(s,i){var l={};return l[s.toLowerCase()]=i.toLowerCase(),l["Webkit"+s]="webkit"+i,l["Moz"+s]="moz"+i,l}var cr={animationend:pi("Animation","AnimationEnd"),animationiteration:pi("Animation","AnimationIteration"),animationstart:pi("Animation","AnimationStart"),transitionrun:pi("Transition","TransitionRun"),transitionstart:pi("Transition","TransitionStart"),transitioncancel:pi("Transition","TransitionCancel"),transitionend:pi("Transition","TransitionEnd")},Ou={},$p={};cn&&($p=document.createElement("div").style,"AnimationEvent"in window||(delete cr.animationend.animation,delete cr.animationiteration.animation,delete cr.animationstart.animation),"TransitionEvent"in window||delete cr.transitionend.transition);function gi(s){if(Ou[s])return Ou[s];if(!cr[s])return s;var i=cr[s],l;for(l in i)if(i.hasOwnProperty(l)&&l in $p)return Ou[s]=i[l];return s}var qp=gi("animationend"),Gp=gi("animationiteration"),Vp=gi("animationstart"),h_=gi("transitionrun"),d_=gi("transitionstart"),f_=gi("transitioncancel"),Xp=gi("transitionend"),Yp=new Map,Nu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Nu.push("scrollEnd");function Bs(s,i){Yp.set(s,i),di(i,[s])}var nl=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var i=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(i))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},_s=[],ur=0,ku=0;function il(){for(var s=ur,i=ku=ur=0;i<s;){var l=_s[i];_s[i++]=null;var h=_s[i];_s[i++]=null;var g=_s[i];_s[i++]=null;var b=_s[i];if(_s[i++]=null,h!==null&&g!==null){var A=h.pending;A===null?g.next=g:(g.next=A.next,A.next=g),h.pending=g}b!==0&&Kp(l,g,b)}}function rl(s,i,l,h){_s[ur++]=s,_s[ur++]=i,_s[ur++]=l,_s[ur++]=h,ku|=h,s.lanes|=h,s=s.alternate,s!==null&&(s.lanes|=h)}function Du(s,i,l,h){return rl(s,i,l,h),al(s)}function mi(s,i){return rl(s,null,null,i),al(s)}function Kp(s,i,l){s.lanes|=l;var h=s.alternate;h!==null&&(h.lanes|=l);for(var g=!1,b=s.return;b!==null;)b.childLanes|=l,h=b.alternate,h!==null&&(h.childLanes|=l),b.tag===22&&(s=b.stateNode,s===null||s._visibility&1||(g=!0)),s=b,b=b.return;return s.tag===3?(b=s.stateNode,g&&i!==null&&(g=31-qe(l),s=b.hiddenUpdates,h=s[g],h===null?s[g]=[i]:h.push(i),i.lane=l|536870912),b):null}function al(s){if(50<Fa)throw Fa=0,zh=null,Error(n(185));for(var i=s.return;i!==null;)s=i,i=s.return;return s.tag===3?s.stateNode:null}var hr={};function p_(s,i,l,h){this.tag=s,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function cs(s,i,l,h){return new p_(s,i,l,h)}function Mu(s){return s=s.prototype,!(!s||!s.isReactComponent)}function un(s,i){var l=s.alternate;return l===null?(l=cs(s.tag,i,s.key,s.mode),l.elementType=s.elementType,l.type=s.type,l.stateNode=s.stateNode,l.alternate=s,s.alternate=l):(l.pendingProps=i,l.type=s.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=s.flags&65011712,l.childLanes=s.childLanes,l.lanes=s.lanes,l.child=s.child,l.memoizedProps=s.memoizedProps,l.memoizedState=s.memoizedState,l.updateQueue=s.updateQueue,i=s.dependencies,l.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},l.sibling=s.sibling,l.index=s.index,l.ref=s.ref,l.refCleanup=s.refCleanup,l}function Wp(s,i){s.flags&=65011714;var l=s.alternate;return l===null?(s.childLanes=0,s.lanes=i,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,i=l.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),s}function ol(s,i,l,h,g,b){var A=0;if(h=s,typeof s=="function")Mu(s)&&(A=1);else if(typeof s=="string")A=vA(s,l,et.current)?26:s==="html"||s==="head"||s==="body"?27:5;else t:switch(s){case X:return s=cs(31,l,i,g),s.elementType=X,s.lanes=b,s;case w:return bi(l.children,g,b,i);case S:A=8,g|=24;break;case E:return s=cs(12,l,i,g|2),s.elementType=E,s.lanes=b,s;case N:return s=cs(13,l,i,g),s.elementType=N,s.lanes=b,s;case k:return s=cs(19,l,i,g),s.elementType=k,s.lanes=b,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case T:A=10;break t;case R:A=9;break t;case O:A=11;break t;case M:A=14;break t;case I:A=16,h=null;break t}A=29,l=Error(n(130,s===null?"null":typeof s,"")),h=null}return i=cs(A,l,i,g),i.elementType=s,i.type=h,i.lanes=b,i}function bi(s,i,l,h){return s=cs(7,s,h,i),s.lanes=l,s}function ju(s,i,l){return s=cs(6,s,null,i),s.lanes=l,s}function Qp(s){var i=cs(18,null,null,0);return i.stateNode=s,i}function Lu(s,i,l){return i=cs(4,s.children!==null?s.children:[],s.key,i),i.lanes=l,i.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},i}var Jp=new WeakMap;function As(s,i){if(typeof s=="object"&&s!==null){var l=Jp.get(s);return l!==void 0?l:(i={value:s,source:i,stack:aa(i)},Jp.set(s,i),i)}return{value:s,source:i,stack:aa(i)}}var dr=[],fr=0,ll=null,va=0,Ss=[],xs=0,Mn=null,Gs=1,Vs="";function hn(s,i){dr[fr++]=va,dr[fr++]=ll,ll=s,va=i}function Zp(s,i,l){Ss[xs++]=Gs,Ss[xs++]=Vs,Ss[xs++]=Mn,Mn=s;var h=Gs;s=Vs;var g=32-qe(h)-1;h&=~(1<<g),l+=1;var b=32-qe(i)+g;if(30<b){var A=g-g%5;b=(h&(1<<A)-1).toString(32),h>>=A,g-=A,Gs=1<<32-qe(i)+g|l<<g|h,Vs=b+s}else Gs=1<<b|l<<g|h,Vs=s}function Pu(s){s.return!==null&&(hn(s,1),Zp(s,1,0))}function Bu(s){for(;s===ll;)ll=dr[--fr],dr[fr]=null,va=dr[--fr],dr[fr]=null;for(;s===Mn;)Mn=Ss[--xs],Ss[xs]=null,Vs=Ss[--xs],Ss[xs]=null,Gs=Ss[--xs],Ss[xs]=null}function tg(s,i){Ss[xs++]=Gs,Ss[xs++]=Vs,Ss[xs++]=Mn,Gs=i.id,Vs=i.overflow,Mn=s}var Re=null,te=null,jt=!1,jn=null,Es=!1,Iu=Error(n(519));function Ln(s){var i=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw wa(As(i,s)),Iu}function eg(s){var i=s.stateNode,l=s.type,h=s.memoizedProps;switch(i[Ce]=s,i[We]=h,l){case"dialog":kt("cancel",i),kt("close",i);break;case"iframe":case"object":case"embed":kt("load",i);break;case"video":case"audio":for(l=0;l<Ha.length;l++)kt(Ha[l],i);break;case"source":kt("error",i);break;case"img":case"image":case"link":kt("error",i),kt("load",i);break;case"details":kt("toggle",i);break;case"input":kt("invalid",i),pp(i,h.value,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name,!0);break;case"select":kt("invalid",i);break;case"textarea":kt("invalid",i),mp(i,h.value,h.defaultValue,h.children)}l=h.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||i.textContent===""+l||h.suppressHydrationWarning===!0||y0(i.textContent,l)?(h.popover!=null&&(kt("beforetoggle",i),kt("toggle",i)),h.onScroll!=null&&kt("scroll",i),h.onScrollEnd!=null&&kt("scrollend",i),h.onClick!=null&&(i.onclick=ln),i=!0):i=!1,i||Ln(s,!0)}function sg(s){for(Re=s.return;Re;)switch(Re.tag){case 5:case 31:case 13:Es=!1;return;case 27:case 3:Es=!0;return;default:Re=Re.return}}function pr(s){if(s!==Re)return!1;if(!jt)return sg(s),jt=!0,!1;var i=s.tag,l;if((l=i!==3&&i!==27)&&((l=i===5)&&(l=s.type,l=!(l!=="form"&&l!=="button")||sd(s.type,s.memoizedProps)),l=!l),l&&te&&Ln(s),sg(s),i===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(n(317));te=C0(s)}else if(i===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(n(317));te=C0(s)}else i===27?(i=te,Kn(s.type)?(s=od,od=null,te=s):te=i):te=Re?Cs(s.stateNode.nextSibling):null;return!0}function yi(){te=Re=null,jt=!1}function Uu(){var s=jn;return s!==null&&(es===null?es=s:es.push.apply(es,s),jn=null),s}function wa(s){jn===null?jn=[s]:jn.push(s)}var Fu=j(null),vi=null,dn=null;function Pn(s,i,l){J(Fu,i._currentValue),i._currentValue=l}function fn(s){s._currentValue=Fu.current,G(Fu)}function zu(s,i,l){for(;s!==null;){var h=s.alternate;if((s.childLanes&i)!==i?(s.childLanes|=i,h!==null&&(h.childLanes|=i)):h!==null&&(h.childLanes&i)!==i&&(h.childLanes|=i),s===l)break;s=s.return}}function Hu(s,i,l,h){var g=s.child;for(g!==null&&(g.return=s);g!==null;){var b=g.dependencies;if(b!==null){var A=g.child;b=b.firstContext;t:for(;b!==null;){var C=b;b=g;for(var D=0;D<i.length;D++)if(C.context===i[D]){b.lanes|=l,C=b.alternate,C!==null&&(C.lanes|=l),zu(b.return,l,s),h||(A=null);break t}b=C.next}}else if(g.tag===18){if(A=g.return,A===null)throw Error(n(341));A.lanes|=l,b=A.alternate,b!==null&&(b.lanes|=l),zu(A,l,s),A=null}else A=g.child;if(A!==null)A.return=g;else for(A=g;A!==null;){if(A===s){A=null;break}if(g=A.sibling,g!==null){g.return=A.return,A=g;break}A=A.return}g=A}}function gr(s,i,l,h){s=null;for(var g=i,b=!1;g!==null;){if(!b){if((g.flags&524288)!==0)b=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var A=g.alternate;if(A===null)throw Error(n(387));if(A=A.memoizedProps,A!==null){var C=g.type;ls(g.pendingProps.value,A.value)||(s!==null?s.push(C):s=[C])}}else if(g===ft.current){if(A=g.alternate,A===null)throw Error(n(387));A.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(s!==null?s.push(Xa):s=[Xa])}g=g.return}s!==null&&Hu(i,s,l,h),i.flags|=262144}function cl(s){for(s=s.firstContext;s!==null;){if(!ls(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function wi(s){vi=s,dn=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Oe(s){return ng(vi,s)}function ul(s,i){return vi===null&&wi(s),ng(s,i)}function ng(s,i){var l=i._currentValue;if(i={context:i,memoizedValue:l,next:null},dn===null){if(s===null)throw Error(n(308));dn=i,s.dependencies={lanes:0,firstContext:i},s.flags|=524288}else dn=dn.next=i;return l}var g_=typeof AbortController<"u"?AbortController:function(){var s=[],i=this.signal={aborted:!1,addEventListener:function(l,h){s.push(h)}};this.abort=function(){i.aborted=!0,s.forEach(function(l){return l()})}},m_=c.unstable_scheduleCallback,b_=c.unstable_NormalPriority,pe={$$typeof:T,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function $u(){return{controller:new g_,data:new Map,refCount:0}}function _a(s){s.refCount--,s.refCount===0&&m_(b_,function(){s.controller.abort()})}var Aa=null,qu=0,mr=0,br=null;function y_(s,i){if(Aa===null){var l=Aa=[];qu=0,mr=Xh(),br={status:"pending",value:void 0,then:function(h){l.push(h)}}}return qu++,i.then(ig,ig),i}function ig(){if(--qu===0&&Aa!==null){br!==null&&(br.status="fulfilled");var s=Aa;Aa=null,mr=0,br=null;for(var i=0;i<s.length;i++)(0,s[i])()}}function v_(s,i){var l=[],h={status:"pending",value:null,reason:null,then:function(g){l.push(g)}};return s.then(function(){h.status="fulfilled",h.value=i;for(var g=0;g<l.length;g++)(0,l[g])(i)},function(g){for(h.status="rejected",h.reason=g,g=0;g<l.length;g++)(0,l[g])(void 0)}),h}var rg=P.S;P.S=function(s,i){Hm=Fe(),typeof i=="object"&&i!==null&&typeof i.then=="function"&&y_(s,i),rg!==null&&rg(s,i)};var _i=j(null);function Gu(){var s=_i.current;return s!==null?s:Wt.pooledCache}function hl(s,i){i===null?J(_i,_i.current):J(_i,i.pool)}function ag(){var s=Gu();return s===null?null:{parent:pe._currentValue,pool:s}}var yr=Error(n(460)),Vu=Error(n(474)),dl=Error(n(542)),fl={then:function(){}};function og(s){return s=s.status,s==="fulfilled"||s==="rejected"}function lg(s,i,l){switch(l=s[l],l===void 0?s.push(i):l!==i&&(i.then(ln,ln),i=l),i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,ug(s),s;default:if(typeof i.status=="string")i.then(ln,ln);else{if(s=Wt,s!==null&&100<s.shellSuspendCounter)throw Error(n(482));s=i,s.status="pending",s.then(function(h){if(i.status==="pending"){var g=i;g.status="fulfilled",g.value=h}},function(h){if(i.status==="pending"){var g=i;g.status="rejected",g.reason=h}})}switch(i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,ug(s),s}throw Si=i,yr}}function Ai(s){try{var i=s._init;return i(s._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(Si=l,yr):l}}var Si=null;function cg(){if(Si===null)throw Error(n(459));var s=Si;return Si=null,s}function ug(s){if(s===yr||s===dl)throw Error(n(483))}var vr=null,Sa=0;function pl(s){var i=Sa;return Sa+=1,vr===null&&(vr=[]),lg(vr,s,i)}function xa(s,i){i=i.props.ref,s.ref=i!==void 0?i:null}function gl(s,i){throw i.$$typeof===y?Error(n(525)):(s=Object.prototype.toString.call(i),Error(n(31,s==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":s)))}function hg(s){function i(B,L){if(s){var U=B.deletions;U===null?(B.deletions=[L],B.flags|=16):U.push(L)}}function l(B,L){if(!s)return null;for(;L!==null;)i(B,L),L=L.sibling;return null}function h(B){for(var L=new Map;B!==null;)B.key!==null?L.set(B.key,B):L.set(B.index,B),B=B.sibling;return L}function g(B,L){return B=un(B,L),B.index=0,B.sibling=null,B}function b(B,L,U){return B.index=U,s?(U=B.alternate,U!==null?(U=U.index,U<L?(B.flags|=67108866,L):U):(B.flags|=67108866,L)):(B.flags|=1048576,L)}function A(B){return s&&B.alternate===null&&(B.flags|=67108866),B}function C(B,L,U,Y){return L===null||L.tag!==6?(L=ju(U,B.mode,Y),L.return=B,L):(L=g(L,U),L.return=B,L)}function D(B,L,U,Y){var pt=U.type;return pt===w?V(B,L,U.props.children,Y,U.key):L!==null&&(L.elementType===pt||typeof pt=="object"&&pt!==null&&pt.$$typeof===I&&Ai(pt)===L.type)?(L=g(L,U.props),xa(L,U),L.return=B,L):(L=ol(U.type,U.key,U.props,null,B.mode,Y),xa(L,U),L.return=B,L)}function F(B,L,U,Y){return L===null||L.tag!==4||L.stateNode.containerInfo!==U.containerInfo||L.stateNode.implementation!==U.implementation?(L=Lu(U,B.mode,Y),L.return=B,L):(L=g(L,U.children||[]),L.return=B,L)}function V(B,L,U,Y,pt){return L===null||L.tag!==7?(L=bi(U,B.mode,Y,pt),L.return=B,L):(L=g(L,U),L.return=B,L)}function K(B,L,U){if(typeof L=="string"&&L!==""||typeof L=="number"||typeof L=="bigint")return L=ju(""+L,B.mode,U),L.return=B,L;if(typeof L=="object"&&L!==null){switch(L.$$typeof){case v:return U=ol(L.type,L.key,L.props,null,B.mode,U),xa(U,L),U.return=B,U;case _:return L=Lu(L,B.mode,U),L.return=B,L;case I:return L=Ai(L),K(B,L,U)}if(_t(L)||st(L))return L=bi(L,B.mode,U,null),L.return=B,L;if(typeof L.then=="function")return K(B,pl(L),U);if(L.$$typeof===T)return K(B,ul(B,L),U);gl(B,L)}return null}function z(B,L,U,Y){var pt=L!==null?L.key:null;if(typeof U=="string"&&U!==""||typeof U=="number"||typeof U=="bigint")return pt!==null?null:C(B,L,""+U,Y);if(typeof U=="object"&&U!==null){switch(U.$$typeof){case v:return U.key===pt?D(B,L,U,Y):null;case _:return U.key===pt?F(B,L,U,Y):null;case I:return U=Ai(U),z(B,L,U,Y)}if(_t(U)||st(U))return pt!==null?null:V(B,L,U,Y,null);if(typeof U.then=="function")return z(B,L,pl(U),Y);if(U.$$typeof===T)return z(B,L,ul(B,U),Y);gl(B,U)}return null}function q(B,L,U,Y,pt){if(typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint")return B=B.get(U)||null,C(L,B,""+Y,pt);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case v:return B=B.get(Y.key===null?U:Y.key)||null,D(L,B,Y,pt);case _:return B=B.get(Y.key===null?U:Y.key)||null,F(L,B,Y,pt);case I:return Y=Ai(Y),q(B,L,U,Y,pt)}if(_t(Y)||st(Y))return B=B.get(U)||null,V(L,B,Y,pt,null);if(typeof Y.then=="function")return q(B,L,U,pl(Y),pt);if(Y.$$typeof===T)return q(B,L,U,ul(L,Y),pt);gl(L,Y)}return null}function rt(B,L,U,Y){for(var pt=null,It=null,ot=L,Rt=L=0,Mt=null;ot!==null&&Rt<U.length;Rt++){ot.index>Rt?(Mt=ot,ot=null):Mt=ot.sibling;var Ut=z(B,ot,U[Rt],Y);if(Ut===null){ot===null&&(ot=Mt);break}s&&ot&&Ut.alternate===null&&i(B,ot),L=b(Ut,L,Rt),It===null?pt=Ut:It.sibling=Ut,It=Ut,ot=Mt}if(Rt===U.length)return l(B,ot),jt&&hn(B,Rt),pt;if(ot===null){for(;Rt<U.length;Rt++)ot=K(B,U[Rt],Y),ot!==null&&(L=b(ot,L,Rt),It===null?pt=ot:It.sibling=ot,It=ot);return jt&&hn(B,Rt),pt}for(ot=h(ot);Rt<U.length;Rt++)Mt=q(ot,B,Rt,U[Rt],Y),Mt!==null&&(s&&Mt.alternate!==null&&ot.delete(Mt.key===null?Rt:Mt.key),L=b(Mt,L,Rt),It===null?pt=Mt:It.sibling=Mt,It=Mt);return s&&ot.forEach(function(ti){return i(B,ti)}),jt&&hn(B,Rt),pt}function yt(B,L,U,Y){if(U==null)throw Error(n(151));for(var pt=null,It=null,ot=L,Rt=L=0,Mt=null,Ut=U.next();ot!==null&&!Ut.done;Rt++,Ut=U.next()){ot.index>Rt?(Mt=ot,ot=null):Mt=ot.sibling;var ti=z(B,ot,Ut.value,Y);if(ti===null){ot===null&&(ot=Mt);break}s&&ot&&ti.alternate===null&&i(B,ot),L=b(ti,L,Rt),It===null?pt=ti:It.sibling=ti,It=ti,ot=Mt}if(Ut.done)return l(B,ot),jt&&hn(B,Rt),pt;if(ot===null){for(;!Ut.done;Rt++,Ut=U.next())Ut=K(B,Ut.value,Y),Ut!==null&&(L=b(Ut,L,Rt),It===null?pt=Ut:It.sibling=Ut,It=Ut);return jt&&hn(B,Rt),pt}for(ot=h(ot);!Ut.done;Rt++,Ut=U.next())Ut=q(ot,B,Rt,Ut.value,Y),Ut!==null&&(s&&Ut.alternate!==null&&ot.delete(Ut.key===null?Rt:Ut.key),L=b(Ut,L,Rt),It===null?pt=Ut:It.sibling=Ut,It=Ut);return s&&ot.forEach(function(NA){return i(B,NA)}),jt&&hn(B,Rt),pt}function Yt(B,L,U,Y){if(typeof U=="object"&&U!==null&&U.type===w&&U.key===null&&(U=U.props.children),typeof U=="object"&&U!==null){switch(U.$$typeof){case v:t:{for(var pt=U.key;L!==null;){if(L.key===pt){if(pt=U.type,pt===w){if(L.tag===7){l(B,L.sibling),Y=g(L,U.props.children),Y.return=B,B=Y;break t}}else if(L.elementType===pt||typeof pt=="object"&&pt!==null&&pt.$$typeof===I&&Ai(pt)===L.type){l(B,L.sibling),Y=g(L,U.props),xa(Y,U),Y.return=B,B=Y;break t}l(B,L);break}else i(B,L);L=L.sibling}U.type===w?(Y=bi(U.props.children,B.mode,Y,U.key),Y.return=B,B=Y):(Y=ol(U.type,U.key,U.props,null,B.mode,Y),xa(Y,U),Y.return=B,B=Y)}return A(B);case _:t:{for(pt=U.key;L!==null;){if(L.key===pt)if(L.tag===4&&L.stateNode.containerInfo===U.containerInfo&&L.stateNode.implementation===U.implementation){l(B,L.sibling),Y=g(L,U.children||[]),Y.return=B,B=Y;break t}else{l(B,L);break}else i(B,L);L=L.sibling}Y=Lu(U,B.mode,Y),Y.return=B,B=Y}return A(B);case I:return U=Ai(U),Yt(B,L,U,Y)}if(_t(U))return rt(B,L,U,Y);if(st(U)){if(pt=st(U),typeof pt!="function")throw Error(n(150));return U=pt.call(U),yt(B,L,U,Y)}if(typeof U.then=="function")return Yt(B,L,pl(U),Y);if(U.$$typeof===T)return Yt(B,L,ul(B,U),Y);gl(B,U)}return typeof U=="string"&&U!==""||typeof U=="number"||typeof U=="bigint"?(U=""+U,L!==null&&L.tag===6?(l(B,L.sibling),Y=g(L,U),Y.return=B,B=Y):(l(B,L),Y=ju(U,B.mode,Y),Y.return=B,B=Y),A(B)):l(B,L)}return function(B,L,U,Y){try{Sa=0;var pt=Yt(B,L,U,Y);return vr=null,pt}catch(ot){if(ot===yr||ot===dl)throw ot;var It=cs(29,ot,null,B.mode);return It.lanes=Y,It.return=B,It}finally{}}}var xi=hg(!0),dg=hg(!1),Bn=!1;function Xu(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Yu(s,i){s=s.updateQueue,i.updateQueue===s&&(i.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function In(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Un(s,i,l){var h=s.updateQueue;if(h===null)return null;if(h=h.shared,(Ft&2)!==0){var g=h.pending;return g===null?i.next=i:(i.next=g.next,g.next=i),h.pending=i,i=al(s),Kp(s,null,l),i}return rl(s,h,i,l),al(s)}function Ea(s,i,l){if(i=i.updateQueue,i!==null&&(i=i.shared,(l&4194048)!==0)){var h=i.lanes;h&=s.pendingLanes,l|=h,i.lanes=l,Vo(s,l)}}function Ku(s,i){var l=s.updateQueue,h=s.alternate;if(h!==null&&(h=h.updateQueue,l===h)){var g=null,b=null;if(l=l.firstBaseUpdate,l!==null){do{var A={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};b===null?g=b=A:b=b.next=A,l=l.next}while(l!==null);b===null?g=b=i:b=b.next=i}else g=b=i;l={baseState:h.baseState,firstBaseUpdate:g,lastBaseUpdate:b,shared:h.shared,callbacks:h.callbacks},s.updateQueue=l;return}s=l.lastBaseUpdate,s===null?l.firstBaseUpdate=i:s.next=i,l.lastBaseUpdate=i}var Wu=!1;function Ta(){if(Wu){var s=br;if(s!==null)throw s}}function Ca(s,i,l,h){Wu=!1;var g=s.updateQueue;Bn=!1;var b=g.firstBaseUpdate,A=g.lastBaseUpdate,C=g.shared.pending;if(C!==null){g.shared.pending=null;var D=C,F=D.next;D.next=null,A===null?b=F:A.next=F,A=D;var V=s.alternate;V!==null&&(V=V.updateQueue,C=V.lastBaseUpdate,C!==A&&(C===null?V.firstBaseUpdate=F:C.next=F,V.lastBaseUpdate=D))}if(b!==null){var K=g.baseState;A=0,V=F=D=null,C=b;do{var z=C.lane&-536870913,q=z!==C.lane;if(q?(Dt&z)===z:(h&z)===z){z!==0&&z===mr&&(Wu=!0),V!==null&&(V=V.next={lane:0,tag:C.tag,payload:C.payload,callback:null,next:null});t:{var rt=s,yt=C;z=i;var Yt=l;switch(yt.tag){case 1:if(rt=yt.payload,typeof rt=="function"){K=rt.call(Yt,K,z);break t}K=rt;break t;case 3:rt.flags=rt.flags&-65537|128;case 0:if(rt=yt.payload,z=typeof rt=="function"?rt.call(Yt,K,z):rt,z==null)break t;K=m({},K,z);break t;case 2:Bn=!0}}z=C.callback,z!==null&&(s.flags|=64,q&&(s.flags|=8192),q=g.callbacks,q===null?g.callbacks=[z]:q.push(z))}else q={lane:z,tag:C.tag,payload:C.payload,callback:C.callback,next:null},V===null?(F=V=q,D=K):V=V.next=q,A|=z;if(C=C.next,C===null){if(C=g.shared.pending,C===null)break;q=C,C=q.next,q.next=null,g.lastBaseUpdate=q,g.shared.pending=null}}while(!0);V===null&&(D=K),g.baseState=D,g.firstBaseUpdate=F,g.lastBaseUpdate=V,b===null&&(g.shared.lanes=0),qn|=A,s.lanes=A,s.memoizedState=K}}function fg(s,i){if(typeof s!="function")throw Error(n(191,s));s.call(i)}function pg(s,i){var l=s.callbacks;if(l!==null)for(s.callbacks=null,s=0;s<l.length;s++)fg(l[s],i)}var wr=j(null),ml=j(0);function gg(s,i){s=An,J(ml,s),J(wr,i),An=s|i.baseLanes}function Qu(){J(ml,An),J(wr,wr.current)}function Ju(){An=ml.current,G(wr),G(ml)}var us=j(null),Ts=null;function Fn(s){var i=s.alternate;J(he,he.current&1),J(us,s),Ts===null&&(i===null||wr.current!==null||i.memoizedState!==null)&&(Ts=s)}function Zu(s){J(he,he.current),J(us,s),Ts===null&&(Ts=s)}function mg(s){s.tag===22?(J(he,he.current),J(us,s),Ts===null&&(Ts=s)):zn()}function zn(){J(he,he.current),J(us,us.current)}function hs(s){G(us),Ts===s&&(Ts=null),G(he)}var he=j(0);function bl(s){for(var i=s;i!==null;){if(i.tag===13){var l=i.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||rd(l)||ad(l)))return i}else if(i.tag===19&&(i.memoizedProps.revealOrder==="forwards"||i.memoizedProps.revealOrder==="backwards"||i.memoizedProps.revealOrder==="unstable_legacy-backwards"||i.memoizedProps.revealOrder==="together")){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var pn=0,Ct=null,Vt=null,ge=null,yl=!1,_r=!1,Ei=!1,vl=0,Ra=0,Ar=null,w_=0;function le(){throw Error(n(321))}function th(s,i){if(i===null)return!1;for(var l=0;l<i.length&&l<s.length;l++)if(!ls(s[l],i[l]))return!1;return!0}function eh(s,i,l,h,g,b){return pn=b,Ct=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,P.H=s===null||s.memoizedState===null?Zg:mh,Ei=!1,b=l(h,g),Ei=!1,_r&&(b=yg(i,l,h,g)),bg(s),b}function bg(s){P.H=ka;var i=Vt!==null&&Vt.next!==null;if(pn=0,ge=Vt=Ct=null,yl=!1,Ra=0,Ar=null,i)throw Error(n(300));s===null||me||(s=s.dependencies,s!==null&&cl(s)&&(me=!0))}function yg(s,i,l,h){Ct=s;var g=0;do{if(_r&&(Ar=null),Ra=0,_r=!1,25<=g)throw Error(n(301));if(g+=1,ge=Vt=null,s.updateQueue!=null){var b=s.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}P.H=tm,b=i(l,h)}while(_r);return b}function __(){var s=P.H,i=s.useState()[0];return i=typeof i.then=="function"?Oa(i):i,s=s.useState()[0],(Vt!==null?Vt.memoizedState:null)!==s&&(Ct.flags|=1024),i}function sh(){var s=vl!==0;return vl=0,s}function nh(s,i,l){i.updateQueue=s.updateQueue,i.flags&=-2053,s.lanes&=~l}function ih(s){if(yl){for(s=s.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}yl=!1}pn=0,ge=Vt=Ct=null,_r=!1,Ra=vl=0,Ar=null}function Ge(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ge===null?Ct.memoizedState=ge=s:ge=ge.next=s,ge}function de(){if(Vt===null){var s=Ct.alternate;s=s!==null?s.memoizedState:null}else s=Vt.next;var i=ge===null?Ct.memoizedState:ge.next;if(i!==null)ge=i,Vt=s;else{if(s===null)throw Ct.alternate===null?Error(n(467)):Error(n(310));Vt=s,s={memoizedState:Vt.memoizedState,baseState:Vt.baseState,baseQueue:Vt.baseQueue,queue:Vt.queue,next:null},ge===null?Ct.memoizedState=ge=s:ge=ge.next=s}return ge}function wl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Oa(s){var i=Ra;return Ra+=1,Ar===null&&(Ar=[]),s=lg(Ar,s,i),i=Ct,(ge===null?i.memoizedState:ge.next)===null&&(i=i.alternate,P.H=i===null||i.memoizedState===null?Zg:mh),s}function _l(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Oa(s);if(s.$$typeof===T)return Oe(s)}throw Error(n(438,String(s)))}function rh(s){var i=null,l=Ct.updateQueue;if(l!==null&&(i=l.memoCache),i==null){var h=Ct.alternate;h!==null&&(h=h.updateQueue,h!==null&&(h=h.memoCache,h!=null&&(i={data:h.data.map(function(g){return g.slice()}),index:0})))}if(i==null&&(i={data:[],index:0}),l===null&&(l=wl(),Ct.updateQueue=l),l.memoCache=i,l=i.data[i.index],l===void 0)for(l=i.data[i.index]=Array(s),h=0;h<s;h++)l[h]=Q;return i.index++,l}function gn(s,i){return typeof i=="function"?i(s):i}function Al(s){var i=de();return ah(i,Vt,s)}function ah(s,i,l){var h=s.queue;if(h===null)throw Error(n(311));h.lastRenderedReducer=l;var g=s.baseQueue,b=h.pending;if(b!==null){if(g!==null){var A=g.next;g.next=b.next,b.next=A}i.baseQueue=g=b,h.pending=null}if(b=s.baseState,g===null)s.memoizedState=b;else{i=g.next;var C=A=null,D=null,F=i,V=!1;do{var K=F.lane&-536870913;if(K!==F.lane?(Dt&K)===K:(pn&K)===K){var z=F.revertLane;if(z===0)D!==null&&(D=D.next={lane:0,revertLane:0,gesture:null,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null}),K===mr&&(V=!0);else if((pn&z)===z){F=F.next,z===mr&&(V=!0);continue}else K={lane:0,revertLane:F.revertLane,gesture:null,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null},D===null?(C=D=K,A=b):D=D.next=K,Ct.lanes|=z,qn|=z;K=F.action,Ei&&l(b,K),b=F.hasEagerState?F.eagerState:l(b,K)}else z={lane:K,revertLane:F.revertLane,gesture:F.gesture,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null},D===null?(C=D=z,A=b):D=D.next=z,Ct.lanes|=K,qn|=K;F=F.next}while(F!==null&&F!==i);if(D===null?A=b:D.next=C,!ls(b,s.memoizedState)&&(me=!0,V&&(l=br,l!==null)))throw l;s.memoizedState=b,s.baseState=A,s.baseQueue=D,h.lastRenderedState=b}return g===null&&(h.lanes=0),[s.memoizedState,h.dispatch]}function oh(s){var i=de(),l=i.queue;if(l===null)throw Error(n(311));l.lastRenderedReducer=s;var h=l.dispatch,g=l.pending,b=i.memoizedState;if(g!==null){l.pending=null;var A=g=g.next;do b=s(b,A.action),A=A.next;while(A!==g);ls(b,i.memoizedState)||(me=!0),i.memoizedState=b,i.baseQueue===null&&(i.baseState=b),l.lastRenderedState=b}return[b,h]}function vg(s,i,l){var h=Ct,g=de(),b=jt;if(b){if(l===void 0)throw Error(n(407));l=l()}else l=i();var A=!ls((Vt||g).memoizedState,l);if(A&&(g.memoizedState=l,me=!0),g=g.queue,uh(Ag.bind(null,h,g,s),[s]),g.getSnapshot!==i||A||ge!==null&&ge.memoizedState.tag&1){if(h.flags|=2048,Sr(9,{destroy:void 0},_g.bind(null,h,g,l,i),null),Wt===null)throw Error(n(349));b||(pn&127)!==0||wg(h,i,l)}return l}function wg(s,i,l){s.flags|=16384,s={getSnapshot:i,value:l},i=Ct.updateQueue,i===null?(i=wl(),Ct.updateQueue=i,i.stores=[s]):(l=i.stores,l===null?i.stores=[s]:l.push(s))}function _g(s,i,l,h){i.value=l,i.getSnapshot=h,Sg(i)&&xg(s)}function Ag(s,i,l){return l(function(){Sg(i)&&xg(s)})}function Sg(s){var i=s.getSnapshot;s=s.value;try{var l=i();return!ls(s,l)}catch{return!0}}function xg(s){var i=mi(s,2);i!==null&&ss(i,s,2)}function lh(s){var i=Ge();if(typeof s=="function"){var l=s;if(s=l(),Ei){Ls(!0);try{l()}finally{Ls(!1)}}}return i.memoizedState=i.baseState=s,i.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:gn,lastRenderedState:s},i}function Eg(s,i,l,h){return s.baseState=l,ah(s,Vt,typeof h=="function"?h:gn)}function A_(s,i,l,h,g){if(El(s))throw Error(n(485));if(s=i.action,s!==null){var b={payload:g,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(A){b.listeners.push(A)}};P.T!==null?l(!0):b.isTransition=!1,h(b),l=i.pending,l===null?(b.next=i.pending=b,Tg(i,b)):(b.next=l.next,i.pending=l.next=b)}}function Tg(s,i){var l=i.action,h=i.payload,g=s.state;if(i.isTransition){var b=P.T,A={};P.T=A;try{var C=l(g,h),D=P.S;D!==null&&D(A,C),Cg(s,i,C)}catch(F){ch(s,i,F)}finally{b!==null&&A.types!==null&&(b.types=A.types),P.T=b}}else try{b=l(g,h),Cg(s,i,b)}catch(F){ch(s,i,F)}}function Cg(s,i,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(h){Rg(s,i,h)},function(h){return ch(s,i,h)}):Rg(s,i,l)}function Rg(s,i,l){i.status="fulfilled",i.value=l,Og(i),s.state=l,i=s.pending,i!==null&&(l=i.next,l===i?s.pending=null:(l=l.next,i.next=l,Tg(s,l)))}function ch(s,i,l){var h=s.pending;if(s.pending=null,h!==null){h=h.next;do i.status="rejected",i.reason=l,Og(i),i=i.next;while(i!==h)}s.action=null}function Og(s){s=s.listeners;for(var i=0;i<s.length;i++)(0,s[i])()}function Ng(s,i){return i}function kg(s,i){if(jt){var l=Wt.formState;if(l!==null){t:{var h=Ct;if(jt){if(te){e:{for(var g=te,b=Es;g.nodeType!==8;){if(!b){g=null;break e}if(g=Cs(g.nextSibling),g===null){g=null;break e}}b=g.data,g=b==="F!"||b==="F"?g:null}if(g){te=Cs(g.nextSibling),h=g.data==="F!";break t}}Ln(h)}h=!1}h&&(i=l[0])}}return l=Ge(),l.memoizedState=l.baseState=i,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ng,lastRenderedState:i},l.queue=h,l=Wg.bind(null,Ct,h),h.dispatch=l,h=lh(!1),b=gh.bind(null,Ct,!1,h.queue),h=Ge(),g={state:i,dispatch:null,action:s,pending:null},h.queue=g,l=A_.bind(null,Ct,g,b,l),g.dispatch=l,h.memoizedState=s,[i,l,!1]}function Dg(s){var i=de();return Mg(i,Vt,s)}function Mg(s,i,l){if(i=ah(s,i,Ng)[0],s=Al(gn)[0],typeof i=="object"&&i!==null&&typeof i.then=="function")try{var h=Oa(i)}catch(A){throw A===yr?dl:A}else h=i;i=de();var g=i.queue,b=g.dispatch;return l!==i.memoizedState&&(Ct.flags|=2048,Sr(9,{destroy:void 0},S_.bind(null,g,l),null)),[h,b,s]}function S_(s,i){s.action=i}function jg(s){var i=de(),l=Vt;if(l!==null)return Mg(i,l,s);de(),i=i.memoizedState,l=de();var h=l.queue.dispatch;return l.memoizedState=s,[i,h,!1]}function Sr(s,i,l,h){return s={tag:s,create:l,deps:h,inst:i,next:null},i=Ct.updateQueue,i===null&&(i=wl(),Ct.updateQueue=i),l=i.lastEffect,l===null?i.lastEffect=s.next=s:(h=l.next,l.next=s,s.next=h,i.lastEffect=s),s}function Lg(){return de().memoizedState}function Sl(s,i,l,h){var g=Ge();Ct.flags|=s,g.memoizedState=Sr(1|i,{destroy:void 0},l,h===void 0?null:h)}function xl(s,i,l,h){var g=de();h=h===void 0?null:h;var b=g.memoizedState.inst;Vt!==null&&h!==null&&th(h,Vt.memoizedState.deps)?g.memoizedState=Sr(i,b,l,h):(Ct.flags|=s,g.memoizedState=Sr(1|i,b,l,h))}function Pg(s,i){Sl(8390656,8,s,i)}function uh(s,i){xl(2048,8,s,i)}function x_(s){Ct.flags|=4;var i=Ct.updateQueue;if(i===null)i=wl(),Ct.updateQueue=i,i.events=[s];else{var l=i.events;l===null?i.events=[s]:l.push(s)}}function Bg(s){var i=de().memoizedState;return x_({ref:i,nextImpl:s}),function(){if((Ft&2)!==0)throw Error(n(440));return i.impl.apply(void 0,arguments)}}function Ig(s,i){return xl(4,2,s,i)}function Ug(s,i){return xl(4,4,s,i)}function Fg(s,i){if(typeof i=="function"){s=s();var l=i(s);return function(){typeof l=="function"?l():i(null)}}if(i!=null)return s=s(),i.current=s,function(){i.current=null}}function zg(s,i,l){l=l!=null?l.concat([s]):null,xl(4,4,Fg.bind(null,i,s),l)}function hh(){}function Hg(s,i){var l=de();i=i===void 0?null:i;var h=l.memoizedState;return i!==null&&th(i,h[1])?h[0]:(l.memoizedState=[s,i],s)}function $g(s,i){var l=de();i=i===void 0?null:i;var h=l.memoizedState;if(i!==null&&th(i,h[1]))return h[0];if(h=s(),Ei){Ls(!0);try{s()}finally{Ls(!1)}}return l.memoizedState=[h,i],h}function dh(s,i,l){return l===void 0||(pn&1073741824)!==0&&(Dt&261930)===0?s.memoizedState=i:(s.memoizedState=l,s=qm(),Ct.lanes|=s,qn|=s,l)}function qg(s,i,l,h){return ls(l,i)?l:wr.current!==null?(s=dh(s,l,h),ls(s,i)||(me=!0),s):(pn&42)===0||(pn&1073741824)!==0&&(Dt&261930)===0?(me=!0,s.memoizedState=l):(s=qm(),Ct.lanes|=s,qn|=s,i)}function Gg(s,i,l,h,g){var b=$.p;$.p=b!==0&&8>b?b:8;var A=P.T,C={};P.T=C,gh(s,!1,i,l);try{var D=g(),F=P.S;if(F!==null&&F(C,D),D!==null&&typeof D=="object"&&typeof D.then=="function"){var V=v_(D,h);Na(s,i,V,ps(s))}else Na(s,i,h,ps(s))}catch(K){Na(s,i,{then:function(){},status:"rejected",reason:K},ps())}finally{$.p=b,A!==null&&C.types!==null&&(A.types=C.types),P.T=A}}function E_(){}function fh(s,i,l,h){if(s.tag!==5)throw Error(n(476));var g=Vg(s).queue;Gg(s,g,i,tt,l===null?E_:function(){return Xg(s),l(h)})}function Vg(s){var i=s.memoizedState;if(i!==null)return i;i={memoizedState:tt,baseState:tt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gn,lastRenderedState:tt},next:null};var l={};return i.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gn,lastRenderedState:l},next:null},s.memoizedState=i,s=s.alternate,s!==null&&(s.memoizedState=i),i}function Xg(s){var i=Vg(s);i.next===null&&(i=s.alternate.memoizedState),Na(s,i.next.queue,{},ps())}function ph(){return Oe(Xa)}function Yg(){return de().memoizedState}function Kg(){return de().memoizedState}function T_(s){for(var i=s.return;i!==null;){switch(i.tag){case 24:case 3:var l=ps();s=In(l);var h=Un(i,s,l);h!==null&&(ss(h,i,l),Ea(h,i,l)),i={cache:$u()},s.payload=i;return}i=i.return}}function C_(s,i,l){var h=ps();l={lane:h,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},El(s)?Qg(i,l):(l=Du(s,i,l,h),l!==null&&(ss(l,s,h),Jg(l,i,h)))}function Wg(s,i,l){var h=ps();Na(s,i,l,h)}function Na(s,i,l,h){var g={lane:h,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(El(s))Qg(i,g);else{var b=s.alternate;if(s.lanes===0&&(b===null||b.lanes===0)&&(b=i.lastRenderedReducer,b!==null))try{var A=i.lastRenderedState,C=b(A,l);if(g.hasEagerState=!0,g.eagerState=C,ls(C,A))return rl(s,i,g,0),Wt===null&&il(),!1}catch{}finally{}if(l=Du(s,i,g,h),l!==null)return ss(l,s,h),Jg(l,i,h),!0}return!1}function gh(s,i,l,h){if(h={lane:2,revertLane:Xh(),gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null},El(s)){if(i)throw Error(n(479))}else i=Du(s,l,h,2),i!==null&&ss(i,s,2)}function El(s){var i=s.alternate;return s===Ct||i!==null&&i===Ct}function Qg(s,i){_r=yl=!0;var l=s.pending;l===null?i.next=i:(i.next=l.next,l.next=i),s.pending=i}function Jg(s,i,l){if((l&4194048)!==0){var h=i.lanes;h&=s.pendingLanes,l|=h,i.lanes=l,Vo(s,l)}}var ka={readContext:Oe,use:_l,useCallback:le,useContext:le,useEffect:le,useImperativeHandle:le,useLayoutEffect:le,useInsertionEffect:le,useMemo:le,useReducer:le,useRef:le,useState:le,useDebugValue:le,useDeferredValue:le,useTransition:le,useSyncExternalStore:le,useId:le,useHostTransitionStatus:le,useFormState:le,useActionState:le,useOptimistic:le,useMemoCache:le,useCacheRefresh:le};ka.useEffectEvent=le;var Zg={readContext:Oe,use:_l,useCallback:function(s,i){return Ge().memoizedState=[s,i===void 0?null:i],s},useContext:Oe,useEffect:Pg,useImperativeHandle:function(s,i,l){l=l!=null?l.concat([s]):null,Sl(4194308,4,Fg.bind(null,i,s),l)},useLayoutEffect:function(s,i){return Sl(4194308,4,s,i)},useInsertionEffect:function(s,i){Sl(4,2,s,i)},useMemo:function(s,i){var l=Ge();i=i===void 0?null:i;var h=s();if(Ei){Ls(!0);try{s()}finally{Ls(!1)}}return l.memoizedState=[h,i],h},useReducer:function(s,i,l){var h=Ge();if(l!==void 0){var g=l(i);if(Ei){Ls(!0);try{l(i)}finally{Ls(!1)}}}else g=i;return h.memoizedState=h.baseState=g,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:g},h.queue=s,s=s.dispatch=C_.bind(null,Ct,s),[h.memoizedState,s]},useRef:function(s){var i=Ge();return s={current:s},i.memoizedState=s},useState:function(s){s=lh(s);var i=s.queue,l=Wg.bind(null,Ct,i);return i.dispatch=l,[s.memoizedState,l]},useDebugValue:hh,useDeferredValue:function(s,i){var l=Ge();return dh(l,s,i)},useTransition:function(){var s=lh(!1);return s=Gg.bind(null,Ct,s.queue,!0,!1),Ge().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,i,l){var h=Ct,g=Ge();if(jt){if(l===void 0)throw Error(n(407));l=l()}else{if(l=i(),Wt===null)throw Error(n(349));(Dt&127)!==0||wg(h,i,l)}g.memoizedState=l;var b={value:l,getSnapshot:i};return g.queue=b,Pg(Ag.bind(null,h,b,s),[s]),h.flags|=2048,Sr(9,{destroy:void 0},_g.bind(null,h,b,l,i),null),l},useId:function(){var s=Ge(),i=Wt.identifierPrefix;if(jt){var l=Vs,h=Gs;l=(h&~(1<<32-qe(h)-1)).toString(32)+l,i="_"+i+"R_"+l,l=vl++,0<l&&(i+="H"+l.toString(32)),i+="_"}else l=w_++,i="_"+i+"r_"+l.toString(32)+"_";return s.memoizedState=i},useHostTransitionStatus:ph,useFormState:kg,useActionState:kg,useOptimistic:function(s){var i=Ge();i.memoizedState=i.baseState=s;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return i.queue=l,i=gh.bind(null,Ct,!0,l),l.dispatch=i,[s,i]},useMemoCache:rh,useCacheRefresh:function(){return Ge().memoizedState=T_.bind(null,Ct)},useEffectEvent:function(s){var i=Ge(),l={impl:s};return i.memoizedState=l,function(){if((Ft&2)!==0)throw Error(n(440));return l.impl.apply(void 0,arguments)}}},mh={readContext:Oe,use:_l,useCallback:Hg,useContext:Oe,useEffect:uh,useImperativeHandle:zg,useInsertionEffect:Ig,useLayoutEffect:Ug,useMemo:$g,useReducer:Al,useRef:Lg,useState:function(){return Al(gn)},useDebugValue:hh,useDeferredValue:function(s,i){var l=de();return qg(l,Vt.memoizedState,s,i)},useTransition:function(){var s=Al(gn)[0],i=de().memoizedState;return[typeof s=="boolean"?s:Oa(s),i]},useSyncExternalStore:vg,useId:Yg,useHostTransitionStatus:ph,useFormState:Dg,useActionState:Dg,useOptimistic:function(s,i){var l=de();return Eg(l,Vt,s,i)},useMemoCache:rh,useCacheRefresh:Kg};mh.useEffectEvent=Bg;var tm={readContext:Oe,use:_l,useCallback:Hg,useContext:Oe,useEffect:uh,useImperativeHandle:zg,useInsertionEffect:Ig,useLayoutEffect:Ug,useMemo:$g,useReducer:oh,useRef:Lg,useState:function(){return oh(gn)},useDebugValue:hh,useDeferredValue:function(s,i){var l=de();return Vt===null?dh(l,s,i):qg(l,Vt.memoizedState,s,i)},useTransition:function(){var s=oh(gn)[0],i=de().memoizedState;return[typeof s=="boolean"?s:Oa(s),i]},useSyncExternalStore:vg,useId:Yg,useHostTransitionStatus:ph,useFormState:jg,useActionState:jg,useOptimistic:function(s,i){var l=de();return Vt!==null?Eg(l,Vt,s,i):(l.baseState=s,[s,l.queue.dispatch])},useMemoCache:rh,useCacheRefresh:Kg};tm.useEffectEvent=Bg;function bh(s,i,l,h){i=s.memoizedState,l=l(h,i),l=l==null?i:m({},i,l),s.memoizedState=l,s.lanes===0&&(s.updateQueue.baseState=l)}var yh={enqueueSetState:function(s,i,l){s=s._reactInternals;var h=ps(),g=In(h);g.payload=i,l!=null&&(g.callback=l),i=Un(s,g,h),i!==null&&(ss(i,s,h),Ea(i,s,h))},enqueueReplaceState:function(s,i,l){s=s._reactInternals;var h=ps(),g=In(h);g.tag=1,g.payload=i,l!=null&&(g.callback=l),i=Un(s,g,h),i!==null&&(ss(i,s,h),Ea(i,s,h))},enqueueForceUpdate:function(s,i){s=s._reactInternals;var l=ps(),h=In(l);h.tag=2,i!=null&&(h.callback=i),i=Un(s,h,l),i!==null&&(ss(i,s,l),Ea(i,s,l))}};function em(s,i,l,h,g,b,A){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(h,b,A):i.prototype&&i.prototype.isPureReactComponent?!ba(l,h)||!ba(g,b):!0}function sm(s,i,l,h){s=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(l,h),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(l,h),i.state!==s&&yh.enqueueReplaceState(i,i.state,null)}function Ti(s,i){var l=i;if("ref"in i){l={};for(var h in i)h!=="ref"&&(l[h]=i[h])}if(s=s.defaultProps){l===i&&(l=m({},l));for(var g in s)l[g]===void 0&&(l[g]=s[g])}return l}function nm(s){nl(s)}function im(s){console.error(s)}function rm(s){nl(s)}function Tl(s,i){try{var l=s.onUncaughtError;l(i.value,{componentStack:i.stack})}catch(h){setTimeout(function(){throw h})}}function am(s,i,l){try{var h=s.onCaughtError;h(l.value,{componentStack:l.stack,errorBoundary:i.tag===1?i.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function vh(s,i,l){return l=In(l),l.tag=3,l.payload={element:null},l.callback=function(){Tl(s,i)},l}function om(s){return s=In(s),s.tag=3,s}function lm(s,i,l,h){var g=l.type.getDerivedStateFromError;if(typeof g=="function"){var b=h.value;s.payload=function(){return g(b)},s.callback=function(){am(i,l,h)}}var A=l.stateNode;A!==null&&typeof A.componentDidCatch=="function"&&(s.callback=function(){am(i,l,h),typeof g!="function"&&(Gn===null?Gn=new Set([this]):Gn.add(this));var C=h.stack;this.componentDidCatch(h.value,{componentStack:C!==null?C:""})})}function R_(s,i,l,h,g){if(l.flags|=32768,h!==null&&typeof h=="object"&&typeof h.then=="function"){if(i=l.alternate,i!==null&&gr(i,l,g,!0),l=us.current,l!==null){switch(l.tag){case 31:case 13:return Ts===null?Il():l.alternate===null&&ce===0&&(ce=3),l.flags&=-257,l.flags|=65536,l.lanes=g,h===fl?l.flags|=16384:(i=l.updateQueue,i===null?l.updateQueue=new Set([h]):i.add(h),qh(s,h,g)),!1;case 22:return l.flags|=65536,h===fl?l.flags|=16384:(i=l.updateQueue,i===null?(i={transitions:null,markerInstances:null,retryQueue:new Set([h])},l.updateQueue=i):(l=i.retryQueue,l===null?i.retryQueue=new Set([h]):l.add(h)),qh(s,h,g)),!1}throw Error(n(435,l.tag))}return qh(s,h,g),Il(),!1}if(jt)return i=us.current,i!==null?((i.flags&65536)===0&&(i.flags|=256),i.flags|=65536,i.lanes=g,h!==Iu&&(s=Error(n(422),{cause:h}),wa(As(s,l)))):(h!==Iu&&(i=Error(n(423),{cause:h}),wa(As(i,l))),s=s.current.alternate,s.flags|=65536,g&=-g,s.lanes|=g,h=As(h,l),g=vh(s.stateNode,h,g),Ku(s,g),ce!==4&&(ce=2)),!1;var b=Error(n(520),{cause:h});if(b=As(b,l),Ua===null?Ua=[b]:Ua.push(b),ce!==4&&(ce=2),i===null)return!0;h=As(h,l),l=i;do{switch(l.tag){case 3:return l.flags|=65536,s=g&-g,l.lanes|=s,s=vh(l.stateNode,h,s),Ku(l,s),!1;case 1:if(i=l.type,b=l.stateNode,(l.flags&128)===0&&(typeof i.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Gn===null||!Gn.has(b))))return l.flags|=65536,g&=-g,l.lanes|=g,g=om(g),lm(g,s,l,h),Ku(l,g),!1}l=l.return}while(l!==null);return!1}var wh=Error(n(461)),me=!1;function Ne(s,i,l,h){i.child=s===null?dg(i,null,l,h):xi(i,s.child,l,h)}function cm(s,i,l,h,g){l=l.render;var b=i.ref;if("ref"in h){var A={};for(var C in h)C!=="ref"&&(A[C]=h[C])}else A=h;return wi(i),h=eh(s,i,l,A,b,g),C=sh(),s!==null&&!me?(nh(s,i,g),mn(s,i,g)):(jt&&C&&Pu(i),i.flags|=1,Ne(s,i,h,g),i.child)}function um(s,i,l,h,g){if(s===null){var b=l.type;return typeof b=="function"&&!Mu(b)&&b.defaultProps===void 0&&l.compare===null?(i.tag=15,i.type=b,hm(s,i,b,h,g)):(s=ol(l.type,null,h,i,i.mode,g),s.ref=i.ref,s.return=i,i.child=s)}if(b=s.child,!Rh(s,g)){var A=b.memoizedProps;if(l=l.compare,l=l!==null?l:ba,l(A,h)&&s.ref===i.ref)return mn(s,i,g)}return i.flags|=1,s=un(b,h),s.ref=i.ref,s.return=i,i.child=s}function hm(s,i,l,h,g){if(s!==null){var b=s.memoizedProps;if(ba(b,h)&&s.ref===i.ref)if(me=!1,i.pendingProps=h=b,Rh(s,g))(s.flags&131072)!==0&&(me=!0);else return i.lanes=s.lanes,mn(s,i,g)}return _h(s,i,l,h,g)}function dm(s,i,l,h){var g=h.children,b=s!==null?s.memoizedState:null;if(s===null&&i.stateNode===null&&(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),h.mode==="hidden"){if((i.flags&128)!==0){if(b=b!==null?b.baseLanes|l:l,s!==null){for(h=i.child=s.child,g=0;h!==null;)g=g|h.lanes|h.childLanes,h=h.sibling;h=g&~b}else h=0,i.child=null;return fm(s,i,b,l,h)}if((l&536870912)!==0)i.memoizedState={baseLanes:0,cachePool:null},s!==null&&hl(i,b!==null?b.cachePool:null),b!==null?gg(i,b):Qu(),mg(i);else return h=i.lanes=536870912,fm(s,i,b!==null?b.baseLanes|l:l,l,h)}else b!==null?(hl(i,b.cachePool),gg(i,b),zn(),i.memoizedState=null):(s!==null&&hl(i,null),Qu(),zn());return Ne(s,i,g,l),i.child}function Da(s,i){return s!==null&&s.tag===22||i.stateNode!==null||(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.sibling}function fm(s,i,l,h,g){var b=Gu();return b=b===null?null:{parent:pe._currentValue,pool:b},i.memoizedState={baseLanes:l,cachePool:b},s!==null&&hl(i,null),Qu(),mg(i),s!==null&&gr(s,i,h,!0),i.childLanes=g,null}function Cl(s,i){return i=Ol({mode:i.mode,children:i.children},s.mode),i.ref=s.ref,s.child=i,i.return=s,i}function pm(s,i,l){return xi(i,s.child,null,l),s=Cl(i,i.pendingProps),s.flags|=2,hs(i),i.memoizedState=null,s}function O_(s,i,l){var h=i.pendingProps,g=(i.flags&128)!==0;if(i.flags&=-129,s===null){if(jt){if(h.mode==="hidden")return s=Cl(i,h),i.lanes=536870912,Da(null,s);if(Zu(i),(s=te)?(s=T0(s,Es),s=s!==null&&s.data==="&"?s:null,s!==null&&(i.memoizedState={dehydrated:s,treeContext:Mn!==null?{id:Gs,overflow:Vs}:null,retryLane:536870912,hydrationErrors:null},l=Qp(s),l.return=i,i.child=l,Re=i,te=null)):s=null,s===null)throw Ln(i);return i.lanes=536870912,null}return Cl(i,h)}var b=s.memoizedState;if(b!==null){var A=b.dehydrated;if(Zu(i),g)if(i.flags&256)i.flags&=-257,i=pm(s,i,l);else if(i.memoizedState!==null)i.child=s.child,i.flags|=128,i=null;else throw Error(n(558));else if(me||gr(s,i,l,!1),g=(l&s.childLanes)!==0,me||g){if(h=Wt,h!==null&&(A=ip(h,l),A!==0&&A!==b.retryLane))throw b.retryLane=A,mi(s,A),ss(h,s,A),wh;Il(),i=pm(s,i,l)}else s=b.treeContext,te=Cs(A.nextSibling),Re=i,jt=!0,jn=null,Es=!1,s!==null&&tg(i,s),i=Cl(i,h),i.flags|=4096;return i}return s=un(s.child,{mode:h.mode,children:h.children}),s.ref=i.ref,i.child=s,s.return=i,s}function Rl(s,i){var l=i.ref;if(l===null)s!==null&&s.ref!==null&&(i.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(n(284));(s===null||s.ref!==l)&&(i.flags|=4194816)}}function _h(s,i,l,h,g){return wi(i),l=eh(s,i,l,h,void 0,g),h=sh(),s!==null&&!me?(nh(s,i,g),mn(s,i,g)):(jt&&h&&Pu(i),i.flags|=1,Ne(s,i,l,g),i.child)}function gm(s,i,l,h,g,b){return wi(i),i.updateQueue=null,l=yg(i,h,l,g),bg(s),h=sh(),s!==null&&!me?(nh(s,i,b),mn(s,i,b)):(jt&&h&&Pu(i),i.flags|=1,Ne(s,i,l,b),i.child)}function mm(s,i,l,h,g){if(wi(i),i.stateNode===null){var b=hr,A=l.contextType;typeof A=="object"&&A!==null&&(b=Oe(A)),b=new l(h,b),i.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=yh,i.stateNode=b,b._reactInternals=i,b=i.stateNode,b.props=h,b.state=i.memoizedState,b.refs={},Xu(i),A=l.contextType,b.context=typeof A=="object"&&A!==null?Oe(A):hr,b.state=i.memoizedState,A=l.getDerivedStateFromProps,typeof A=="function"&&(bh(i,l,A,h),b.state=i.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(A=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),A!==b.state&&yh.enqueueReplaceState(b,b.state,null),Ca(i,h,b,g),Ta(),b.state=i.memoizedState),typeof b.componentDidMount=="function"&&(i.flags|=4194308),h=!0}else if(s===null){b=i.stateNode;var C=i.memoizedProps,D=Ti(l,C);b.props=D;var F=b.context,V=l.contextType;A=hr,typeof V=="object"&&V!==null&&(A=Oe(V));var K=l.getDerivedStateFromProps;V=typeof K=="function"||typeof b.getSnapshotBeforeUpdate=="function",C=i.pendingProps!==C,V||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(C||F!==A)&&sm(i,b,h,A),Bn=!1;var z=i.memoizedState;b.state=z,Ca(i,h,b,g),Ta(),F=i.memoizedState,C||z!==F||Bn?(typeof K=="function"&&(bh(i,l,K,h),F=i.memoizedState),(D=Bn||em(i,l,D,h,z,F,A))?(V||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(i.flags|=4194308)):(typeof b.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=h,i.memoizedState=F),b.props=h,b.state=F,b.context=A,h=D):(typeof b.componentDidMount=="function"&&(i.flags|=4194308),h=!1)}else{b=i.stateNode,Yu(s,i),A=i.memoizedProps,V=Ti(l,A),b.props=V,K=i.pendingProps,z=b.context,F=l.contextType,D=hr,typeof F=="object"&&F!==null&&(D=Oe(F)),C=l.getDerivedStateFromProps,(F=typeof C=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(A!==K||z!==D)&&sm(i,b,h,D),Bn=!1,z=i.memoizedState,b.state=z,Ca(i,h,b,g),Ta();var q=i.memoizedState;A!==K||z!==q||Bn||s!==null&&s.dependencies!==null&&cl(s.dependencies)?(typeof C=="function"&&(bh(i,l,C,h),q=i.memoizedState),(V=Bn||em(i,l,V,h,z,q,D)||s!==null&&s.dependencies!==null&&cl(s.dependencies))?(F||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(h,q,D),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(h,q,D)),typeof b.componentDidUpdate=="function"&&(i.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof b.componentDidUpdate!="function"||A===s.memoizedProps&&z===s.memoizedState||(i.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||A===s.memoizedProps&&z===s.memoizedState||(i.flags|=1024),i.memoizedProps=h,i.memoizedState=q),b.props=h,b.state=q,b.context=D,h=V):(typeof b.componentDidUpdate!="function"||A===s.memoizedProps&&z===s.memoizedState||(i.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||A===s.memoizedProps&&z===s.memoizedState||(i.flags|=1024),h=!1)}return b=h,Rl(s,i),h=(i.flags&128)!==0,b||h?(b=i.stateNode,l=h&&typeof l.getDerivedStateFromError!="function"?null:b.render(),i.flags|=1,s!==null&&h?(i.child=xi(i,s.child,null,g),i.child=xi(i,null,l,g)):Ne(s,i,l,g),i.memoizedState=b.state,s=i.child):s=mn(s,i,g),s}function bm(s,i,l,h){return yi(),i.flags|=256,Ne(s,i,l,h),i.child}var Ah={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Sh(s){return{baseLanes:s,cachePool:ag()}}function xh(s,i,l){return s=s!==null?s.childLanes&~l:0,i&&(s|=fs),s}function ym(s,i,l){var h=i.pendingProps,g=!1,b=(i.flags&128)!==0,A;if((A=b)||(A=s!==null&&s.memoizedState===null?!1:(he.current&2)!==0),A&&(g=!0,i.flags&=-129),A=(i.flags&32)!==0,i.flags&=-33,s===null){if(jt){if(g?Fn(i):zn(),(s=te)?(s=T0(s,Es),s=s!==null&&s.data!=="&"?s:null,s!==null&&(i.memoizedState={dehydrated:s,treeContext:Mn!==null?{id:Gs,overflow:Vs}:null,retryLane:536870912,hydrationErrors:null},l=Qp(s),l.return=i,i.child=l,Re=i,te=null)):s=null,s===null)throw Ln(i);return ad(s)?i.lanes=32:i.lanes=536870912,null}var C=h.children;return h=h.fallback,g?(zn(),g=i.mode,C=Ol({mode:"hidden",children:C},g),h=bi(h,g,l,null),C.return=i,h.return=i,C.sibling=h,i.child=C,h=i.child,h.memoizedState=Sh(l),h.childLanes=xh(s,A,l),i.memoizedState=Ah,Da(null,h)):(Fn(i),Eh(i,C))}var D=s.memoizedState;if(D!==null&&(C=D.dehydrated,C!==null)){if(b)i.flags&256?(Fn(i),i.flags&=-257,i=Th(s,i,l)):i.memoizedState!==null?(zn(),i.child=s.child,i.flags|=128,i=null):(zn(),C=h.fallback,g=i.mode,h=Ol({mode:"visible",children:h.children},g),C=bi(C,g,l,null),C.flags|=2,h.return=i,C.return=i,h.sibling=C,i.child=h,xi(i,s.child,null,l),h=i.child,h.memoizedState=Sh(l),h.childLanes=xh(s,A,l),i.memoizedState=Ah,i=Da(null,h));else if(Fn(i),ad(C)){if(A=C.nextSibling&&C.nextSibling.dataset,A)var F=A.dgst;A=F,h=Error(n(419)),h.stack="",h.digest=A,wa({value:h,source:null,stack:null}),i=Th(s,i,l)}else if(me||gr(s,i,l,!1),A=(l&s.childLanes)!==0,me||A){if(A=Wt,A!==null&&(h=ip(A,l),h!==0&&h!==D.retryLane))throw D.retryLane=h,mi(s,h),ss(A,s,h),wh;rd(C)||Il(),i=Th(s,i,l)}else rd(C)?(i.flags|=192,i.child=s.child,i=null):(s=D.treeContext,te=Cs(C.nextSibling),Re=i,jt=!0,jn=null,Es=!1,s!==null&&tg(i,s),i=Eh(i,h.children),i.flags|=4096);return i}return g?(zn(),C=h.fallback,g=i.mode,D=s.child,F=D.sibling,h=un(D,{mode:"hidden",children:h.children}),h.subtreeFlags=D.subtreeFlags&65011712,F!==null?C=un(F,C):(C=bi(C,g,l,null),C.flags|=2),C.return=i,h.return=i,h.sibling=C,i.child=h,Da(null,h),h=i.child,C=s.child.memoizedState,C===null?C=Sh(l):(g=C.cachePool,g!==null?(D=pe._currentValue,g=g.parent!==D?{parent:D,pool:D}:g):g=ag(),C={baseLanes:C.baseLanes|l,cachePool:g}),h.memoizedState=C,h.childLanes=xh(s,A,l),i.memoizedState=Ah,Da(s.child,h)):(Fn(i),l=s.child,s=l.sibling,l=un(l,{mode:"visible",children:h.children}),l.return=i,l.sibling=null,s!==null&&(A=i.deletions,A===null?(i.deletions=[s],i.flags|=16):A.push(s)),i.child=l,i.memoizedState=null,l)}function Eh(s,i){return i=Ol({mode:"visible",children:i},s.mode),i.return=s,s.child=i}function Ol(s,i){return s=cs(22,s,null,i),s.lanes=0,s}function Th(s,i,l){return xi(i,s.child,null,l),s=Eh(i,i.pendingProps.children),s.flags|=2,i.memoizedState=null,s}function vm(s,i,l){s.lanes|=i;var h=s.alternate;h!==null&&(h.lanes|=i),zu(s.return,i,l)}function Ch(s,i,l,h,g,b){var A=s.memoizedState;A===null?s.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:h,tail:l,tailMode:g,treeForkCount:b}:(A.isBackwards=i,A.rendering=null,A.renderingStartTime=0,A.last=h,A.tail=l,A.tailMode=g,A.treeForkCount=b)}function wm(s,i,l){var h=i.pendingProps,g=h.revealOrder,b=h.tail;h=h.children;var A=he.current,C=(A&2)!==0;if(C?(A=A&1|2,i.flags|=128):A&=1,J(he,A),Ne(s,i,h,l),h=jt?va:0,!C&&s!==null&&(s.flags&128)!==0)t:for(s=i.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&vm(s,l,i);else if(s.tag===19)vm(s,l,i);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break t;for(;s.sibling===null;){if(s.return===null||s.return===i)break t;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(g){case"forwards":for(l=i.child,g=null;l!==null;)s=l.alternate,s!==null&&bl(s)===null&&(g=l),l=l.sibling;l=g,l===null?(g=i.child,i.child=null):(g=l.sibling,l.sibling=null),Ch(i,!1,g,l,b,h);break;case"backwards":case"unstable_legacy-backwards":for(l=null,g=i.child,i.child=null;g!==null;){if(s=g.alternate,s!==null&&bl(s)===null){i.child=g;break}s=g.sibling,g.sibling=l,l=g,g=s}Ch(i,!0,l,null,b,h);break;case"together":Ch(i,!1,null,null,void 0,h);break;default:i.memoizedState=null}return i.child}function mn(s,i,l){if(s!==null&&(i.dependencies=s.dependencies),qn|=i.lanes,(l&i.childLanes)===0)if(s!==null){if(gr(s,i,l,!1),(l&i.childLanes)===0)return null}else return null;if(s!==null&&i.child!==s.child)throw Error(n(153));if(i.child!==null){for(s=i.child,l=un(s,s.pendingProps),i.child=l,l.return=i;s.sibling!==null;)s=s.sibling,l=l.sibling=un(s,s.pendingProps),l.return=i;l.sibling=null}return i.child}function Rh(s,i){return(s.lanes&i)!==0?!0:(s=s.dependencies,!!(s!==null&&cl(s)))}function N_(s,i,l){switch(i.tag){case 3:Jt(i,i.stateNode.containerInfo),Pn(i,pe,s.memoizedState.cache),yi();break;case 27:case 5:nn(i);break;case 4:Jt(i,i.stateNode.containerInfo);break;case 10:Pn(i,i.type,i.memoizedProps.value);break;case 31:if(i.memoizedState!==null)return i.flags|=128,Zu(i),null;break;case 13:var h=i.memoizedState;if(h!==null)return h.dehydrated!==null?(Fn(i),i.flags|=128,null):(l&i.child.childLanes)!==0?ym(s,i,l):(Fn(i),s=mn(s,i,l),s!==null?s.sibling:null);Fn(i);break;case 19:var g=(s.flags&128)!==0;if(h=(l&i.childLanes)!==0,h||(gr(s,i,l,!1),h=(l&i.childLanes)!==0),g){if(h)return wm(s,i,l);i.flags|=128}if(g=i.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),J(he,he.current),h)break;return null;case 22:return i.lanes=0,dm(s,i,l,i.pendingProps);case 24:Pn(i,pe,s.memoizedState.cache)}return mn(s,i,l)}function _m(s,i,l){if(s!==null)if(s.memoizedProps!==i.pendingProps)me=!0;else{if(!Rh(s,l)&&(i.flags&128)===0)return me=!1,N_(s,i,l);me=(s.flags&131072)!==0}else me=!1,jt&&(i.flags&1048576)!==0&&Zp(i,va,i.index);switch(i.lanes=0,i.tag){case 16:t:{var h=i.pendingProps;if(s=Ai(i.elementType),i.type=s,typeof s=="function")Mu(s)?(h=Ti(s,h),i.tag=1,i=mm(null,i,s,h,l)):(i.tag=0,i=_h(null,i,s,h,l));else{if(s!=null){var g=s.$$typeof;if(g===O){i.tag=11,i=cm(null,i,s,h,l);break t}else if(g===M){i.tag=14,i=um(null,i,s,h,l);break t}}throw i=wt(s)||s,Error(n(306,i,""))}}return i;case 0:return _h(s,i,i.type,i.pendingProps,l);case 1:return h=i.type,g=Ti(h,i.pendingProps),mm(s,i,h,g,l);case 3:t:{if(Jt(i,i.stateNode.containerInfo),s===null)throw Error(n(387));h=i.pendingProps;var b=i.memoizedState;g=b.element,Yu(s,i),Ca(i,h,null,l);var A=i.memoizedState;if(h=A.cache,Pn(i,pe,h),h!==b.cache&&Hu(i,[pe],l,!0),Ta(),h=A.element,b.isDehydrated)if(b={element:h,isDehydrated:!1,cache:A.cache},i.updateQueue.baseState=b,i.memoizedState=b,i.flags&256){i=bm(s,i,h,l);break t}else if(h!==g){g=As(Error(n(424)),i),wa(g),i=bm(s,i,h,l);break t}else{switch(s=i.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(te=Cs(s.firstChild),Re=i,jt=!0,jn=null,Es=!0,l=dg(i,null,h,l),i.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(yi(),h===g){i=mn(s,i,l);break t}Ne(s,i,h,l)}i=i.child}return i;case 26:return Rl(s,i),s===null?(l=D0(i.type,null,i.pendingProps,null))?i.memoizedState=l:jt||(l=i.type,s=i.pendingProps,h=Gl(bt.current).createElement(l),h[Ce]=i,h[We]=s,ke(h,l,s),Se(h),i.stateNode=h):i.memoizedState=D0(i.type,s.memoizedProps,i.pendingProps,s.memoizedState),null;case 27:return nn(i),s===null&&jt&&(h=i.stateNode=O0(i.type,i.pendingProps,bt.current),Re=i,Es=!0,g=te,Kn(i.type)?(od=g,te=Cs(h.firstChild)):te=g),Ne(s,i,i.pendingProps.children,l),Rl(s,i),s===null&&(i.flags|=4194304),i.child;case 5:return s===null&&jt&&((g=h=te)&&(h=aA(h,i.type,i.pendingProps,Es),h!==null?(i.stateNode=h,Re=i,te=Cs(h.firstChild),Es=!1,g=!0):g=!1),g||Ln(i)),nn(i),g=i.type,b=i.pendingProps,A=s!==null?s.memoizedProps:null,h=b.children,sd(g,b)?h=null:A!==null&&sd(g,A)&&(i.flags|=32),i.memoizedState!==null&&(g=eh(s,i,__,null,null,l),Xa._currentValue=g),Rl(s,i),Ne(s,i,h,l),i.child;case 6:return s===null&&jt&&((s=l=te)&&(l=oA(l,i.pendingProps,Es),l!==null?(i.stateNode=l,Re=i,te=null,s=!0):s=!1),s||Ln(i)),null;case 13:return ym(s,i,l);case 4:return Jt(i,i.stateNode.containerInfo),h=i.pendingProps,s===null?i.child=xi(i,null,h,l):Ne(s,i,h,l),i.child;case 11:return cm(s,i,i.type,i.pendingProps,l);case 7:return Ne(s,i,i.pendingProps,l),i.child;case 8:return Ne(s,i,i.pendingProps.children,l),i.child;case 12:return Ne(s,i,i.pendingProps.children,l),i.child;case 10:return h=i.pendingProps,Pn(i,i.type,h.value),Ne(s,i,h.children,l),i.child;case 9:return g=i.type._context,h=i.pendingProps.children,wi(i),g=Oe(g),h=h(g),i.flags|=1,Ne(s,i,h,l),i.child;case 14:return um(s,i,i.type,i.pendingProps,l);case 15:return hm(s,i,i.type,i.pendingProps,l);case 19:return wm(s,i,l);case 31:return O_(s,i,l);case 22:return dm(s,i,l,i.pendingProps);case 24:return wi(i),h=Oe(pe),s===null?(g=Gu(),g===null&&(g=Wt,b=$u(),g.pooledCache=b,b.refCount++,b!==null&&(g.pooledCacheLanes|=l),g=b),i.memoizedState={parent:h,cache:g},Xu(i),Pn(i,pe,g)):((s.lanes&l)!==0&&(Yu(s,i),Ca(i,null,null,l),Ta()),g=s.memoizedState,b=i.memoizedState,g.parent!==h?(g={parent:h,cache:h},i.memoizedState=g,i.lanes===0&&(i.memoizedState=i.updateQueue.baseState=g),Pn(i,pe,h)):(h=b.cache,Pn(i,pe,h),h!==g.cache&&Hu(i,[pe],l,!0))),Ne(s,i,i.pendingProps.children,l),i.child;case 29:throw i.pendingProps}throw Error(n(156,i.tag))}function bn(s){s.flags|=4}function Oh(s,i,l,h,g){if((i=(s.mode&32)!==0)&&(i=!1),i){if(s.flags|=16777216,(g&335544128)===g)if(s.stateNode.complete)s.flags|=8192;else if(Ym())s.flags|=8192;else throw Si=fl,Vu}else s.flags&=-16777217}function Am(s,i){if(i.type!=="stylesheet"||(i.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!B0(i))if(Ym())s.flags|=8192;else throw Si=fl,Vu}function Nl(s,i){i!==null&&(s.flags|=4),s.flags&16384&&(i=s.tag!==22?dt():536870912,s.lanes|=i,Cr|=i)}function Ma(s,i){if(!jt)switch(s.tailMode){case"hidden":i=s.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?s.tail=null:l.sibling=null;break;case"collapsed":l=s.tail;for(var h=null;l!==null;)l.alternate!==null&&(h=l),l=l.sibling;h===null?i||s.tail===null?s.tail=null:s.tail.sibling=null:h.sibling=null}}function ee(s){var i=s.alternate!==null&&s.alternate.child===s.child,l=0,h=0;if(i)for(var g=s.child;g!==null;)l|=g.lanes|g.childLanes,h|=g.subtreeFlags&65011712,h|=g.flags&65011712,g.return=s,g=g.sibling;else for(g=s.child;g!==null;)l|=g.lanes|g.childLanes,h|=g.subtreeFlags,h|=g.flags,g.return=s,g=g.sibling;return s.subtreeFlags|=h,s.childLanes=l,i}function k_(s,i,l){var h=i.pendingProps;switch(Bu(i),i.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ee(i),null;case 1:return ee(i),null;case 3:return l=i.stateNode,h=null,s!==null&&(h=s.memoizedState.cache),i.memoizedState.cache!==h&&(i.flags|=2048),fn(pe),$t(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(s===null||s.child===null)&&(pr(i)?bn(i):s===null||s.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,Uu())),ee(i),null;case 26:var g=i.type,b=i.memoizedState;return s===null?(bn(i),b!==null?(ee(i),Am(i,b)):(ee(i),Oh(i,g,null,h,l))):b?b!==s.memoizedState?(bn(i),ee(i),Am(i,b)):(ee(i),i.flags&=-16777217):(s=s.memoizedProps,s!==h&&bn(i),ee(i),Oh(i,g,s,h,l)),null;case 27:if(ys(i),l=bt.current,g=i.type,s!==null&&i.stateNode!=null)s.memoizedProps!==h&&bn(i);else{if(!h){if(i.stateNode===null)throw Error(n(166));return ee(i),null}s=et.current,pr(i)?eg(i):(s=O0(g,h,l),i.stateNode=s,bn(i))}return ee(i),null;case 5:if(ys(i),g=i.type,s!==null&&i.stateNode!=null)s.memoizedProps!==h&&bn(i);else{if(!h){if(i.stateNode===null)throw Error(n(166));return ee(i),null}if(b=et.current,pr(i))eg(i);else{var A=Gl(bt.current);switch(b){case 1:b=A.createElementNS("http://www.w3.org/2000/svg",g);break;case 2:b=A.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;default:switch(g){case"svg":b=A.createElementNS("http://www.w3.org/2000/svg",g);break;case"math":b=A.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;case"script":b=A.createElement("div"),b.innerHTML="<script><\/script>",b=b.removeChild(b.firstChild);break;case"select":b=typeof h.is=="string"?A.createElement("select",{is:h.is}):A.createElement("select"),h.multiple?b.multiple=!0:h.size&&(b.size=h.size);break;default:b=typeof h.is=="string"?A.createElement(g,{is:h.is}):A.createElement(g)}}b[Ce]=i,b[We]=h;t:for(A=i.child;A!==null;){if(A.tag===5||A.tag===6)b.appendChild(A.stateNode);else if(A.tag!==4&&A.tag!==27&&A.child!==null){A.child.return=A,A=A.child;continue}if(A===i)break t;for(;A.sibling===null;){if(A.return===null||A.return===i)break t;A=A.return}A.sibling.return=A.return,A=A.sibling}i.stateNode=b;t:switch(ke(b,g,h),g){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break t;case"img":h=!0;break t;default:h=!1}h&&bn(i)}}return ee(i),Oh(i,i.type,s===null?null:s.memoizedProps,i.pendingProps,l),null;case 6:if(s&&i.stateNode!=null)s.memoizedProps!==h&&bn(i);else{if(typeof h!="string"&&i.stateNode===null)throw Error(n(166));if(s=bt.current,pr(i)){if(s=i.stateNode,l=i.memoizedProps,h=null,g=Re,g!==null)switch(g.tag){case 27:case 5:h=g.memoizedProps}s[Ce]=i,s=!!(s.nodeValue===l||h!==null&&h.suppressHydrationWarning===!0||y0(s.nodeValue,l)),s||Ln(i,!0)}else s=Gl(s).createTextNode(h),s[Ce]=i,i.stateNode=s}return ee(i),null;case 31:if(l=i.memoizedState,s===null||s.memoizedState!==null){if(h=pr(i),l!==null){if(s===null){if(!h)throw Error(n(318));if(s=i.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(n(557));s[Ce]=i}else yi(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;ee(i),s=!1}else l=Uu(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=l),s=!0;if(!s)return i.flags&256?(hs(i),i):(hs(i),null);if((i.flags&128)!==0)throw Error(n(558))}return ee(i),null;case 13:if(h=i.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(g=pr(i),h!==null&&h.dehydrated!==null){if(s===null){if(!g)throw Error(n(318));if(g=i.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(n(317));g[Ce]=i}else yi(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;ee(i),g=!1}else g=Uu(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=g),g=!0;if(!g)return i.flags&256?(hs(i),i):(hs(i),null)}return hs(i),(i.flags&128)!==0?(i.lanes=l,i):(l=h!==null,s=s!==null&&s.memoizedState!==null,l&&(h=i.child,g=null,h.alternate!==null&&h.alternate.memoizedState!==null&&h.alternate.memoizedState.cachePool!==null&&(g=h.alternate.memoizedState.cachePool.pool),b=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(b=h.memoizedState.cachePool.pool),b!==g&&(h.flags|=2048)),l!==s&&l&&(i.child.flags|=8192),Nl(i,i.updateQueue),ee(i),null);case 4:return $t(),s===null&&Qh(i.stateNode.containerInfo),ee(i),null;case 10:return fn(i.type),ee(i),null;case 19:if(G(he),h=i.memoizedState,h===null)return ee(i),null;if(g=(i.flags&128)!==0,b=h.rendering,b===null)if(g)Ma(h,!1);else{if(ce!==0||s!==null&&(s.flags&128)!==0)for(s=i.child;s!==null;){if(b=bl(s),b!==null){for(i.flags|=128,Ma(h,!1),s=b.updateQueue,i.updateQueue=s,Nl(i,s),i.subtreeFlags=0,s=l,l=i.child;l!==null;)Wp(l,s),l=l.sibling;return J(he,he.current&1|2),jt&&hn(i,h.treeForkCount),i.child}s=s.sibling}h.tail!==null&&Fe()>Ll&&(i.flags|=128,g=!0,Ma(h,!1),i.lanes=4194304)}else{if(!g)if(s=bl(b),s!==null){if(i.flags|=128,g=!0,s=s.updateQueue,i.updateQueue=s,Nl(i,s),Ma(h,!0),h.tail===null&&h.tailMode==="hidden"&&!b.alternate&&!jt)return ee(i),null}else 2*Fe()-h.renderingStartTime>Ll&&l!==536870912&&(i.flags|=128,g=!0,Ma(h,!1),i.lanes=4194304);h.isBackwards?(b.sibling=i.child,i.child=b):(s=h.last,s!==null?s.sibling=b:i.child=b,h.last=b)}return h.tail!==null?(s=h.tail,h.rendering=s,h.tail=s.sibling,h.renderingStartTime=Fe(),s.sibling=null,l=he.current,J(he,g?l&1|2:l&1),jt&&hn(i,h.treeForkCount),s):(ee(i),null);case 22:case 23:return hs(i),Ju(),h=i.memoizedState!==null,s!==null?s.memoizedState!==null!==h&&(i.flags|=8192):h&&(i.flags|=8192),h?(l&536870912)!==0&&(i.flags&128)===0&&(ee(i),i.subtreeFlags&6&&(i.flags|=8192)):ee(i),l=i.updateQueue,l!==null&&Nl(i,l.retryQueue),l=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),h=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(h=i.memoizedState.cachePool.pool),h!==l&&(i.flags|=2048),s!==null&&G(_i),null;case 24:return l=null,s!==null&&(l=s.memoizedState.cache),i.memoizedState.cache!==l&&(i.flags|=2048),fn(pe),ee(i),null;case 25:return null;case 30:return null}throw Error(n(156,i.tag))}function D_(s,i){switch(Bu(i),i.tag){case 1:return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 3:return fn(pe),$t(),s=i.flags,(s&65536)!==0&&(s&128)===0?(i.flags=s&-65537|128,i):null;case 26:case 27:case 5:return ys(i),null;case 31:if(i.memoizedState!==null){if(hs(i),i.alternate===null)throw Error(n(340));yi()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 13:if(hs(i),s=i.memoizedState,s!==null&&s.dehydrated!==null){if(i.alternate===null)throw Error(n(340));yi()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 19:return G(he),null;case 4:return $t(),null;case 10:return fn(i.type),null;case 22:case 23:return hs(i),Ju(),s!==null&&G(_i),s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 24:return fn(pe),null;case 25:return null;default:return null}}function Sm(s,i){switch(Bu(i),i.tag){case 3:fn(pe),$t();break;case 26:case 27:case 5:ys(i);break;case 4:$t();break;case 31:i.memoizedState!==null&&hs(i);break;case 13:hs(i);break;case 19:G(he);break;case 10:fn(i.type);break;case 22:case 23:hs(i),Ju(),s!==null&&G(_i);break;case 24:fn(pe)}}function ja(s,i){try{var l=i.updateQueue,h=l!==null?l.lastEffect:null;if(h!==null){var g=h.next;l=g;do{if((l.tag&s)===s){h=void 0;var b=l.create,A=l.inst;h=b(),A.destroy=h}l=l.next}while(l!==g)}}catch(C){Gt(i,i.return,C)}}function Hn(s,i,l){try{var h=i.updateQueue,g=h!==null?h.lastEffect:null;if(g!==null){var b=g.next;h=b;do{if((h.tag&s)===s){var A=h.inst,C=A.destroy;if(C!==void 0){A.destroy=void 0,g=i;var D=l,F=C;try{F()}catch(V){Gt(g,D,V)}}}h=h.next}while(h!==b)}}catch(V){Gt(i,i.return,V)}}function xm(s){var i=s.updateQueue;if(i!==null){var l=s.stateNode;try{pg(i,l)}catch(h){Gt(s,s.return,h)}}}function Em(s,i,l){l.props=Ti(s.type,s.memoizedProps),l.state=s.memoizedState;try{l.componentWillUnmount()}catch(h){Gt(s,i,h)}}function La(s,i){try{var l=s.ref;if(l!==null){switch(s.tag){case 26:case 27:case 5:var h=s.stateNode;break;case 30:h=s.stateNode;break;default:h=s.stateNode}typeof l=="function"?s.refCleanup=l(h):l.current=h}}catch(g){Gt(s,i,g)}}function Xs(s,i){var l=s.ref,h=s.refCleanup;if(l!==null)if(typeof h=="function")try{h()}catch(g){Gt(s,i,g)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(g){Gt(s,i,g)}else l.current=null}function Tm(s){var i=s.type,l=s.memoizedProps,h=s.stateNode;try{t:switch(i){case"button":case"input":case"select":case"textarea":l.autoFocus&&h.focus();break t;case"img":l.src?h.src=l.src:l.srcSet&&(h.srcset=l.srcSet)}}catch(g){Gt(s,s.return,g)}}function Nh(s,i,l){try{var h=s.stateNode;tA(h,s.type,l,i),h[We]=i}catch(g){Gt(s,s.return,g)}}function Cm(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Kn(s.type)||s.tag===4}function kh(s){t:for(;;){for(;s.sibling===null;){if(s.return===null||Cm(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Kn(s.type)||s.flags&2||s.child===null||s.tag===4)continue t;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Dh(s,i,l){var h=s.tag;if(h===5||h===6)s=s.stateNode,i?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(s,i):(i=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,i.appendChild(s),l=l._reactRootContainer,l!=null||i.onclick!==null||(i.onclick=ln));else if(h!==4&&(h===27&&Kn(s.type)&&(l=s.stateNode,i=null),s=s.child,s!==null))for(Dh(s,i,l),s=s.sibling;s!==null;)Dh(s,i,l),s=s.sibling}function kl(s,i,l){var h=s.tag;if(h===5||h===6)s=s.stateNode,i?l.insertBefore(s,i):l.appendChild(s);else if(h!==4&&(h===27&&Kn(s.type)&&(l=s.stateNode),s=s.child,s!==null))for(kl(s,i,l),s=s.sibling;s!==null;)kl(s,i,l),s=s.sibling}function Rm(s){var i=s.stateNode,l=s.memoizedProps;try{for(var h=s.type,g=i.attributes;g.length;)i.removeAttributeNode(g[0]);ke(i,h,l),i[Ce]=s,i[We]=l}catch(b){Gt(s,s.return,b)}}var yn=!1,be=!1,Mh=!1,Om=typeof WeakSet=="function"?WeakSet:Set,xe=null;function M_(s,i){if(s=s.containerInfo,td=Jl,s=zp(s),Tu(s)){if("selectionStart"in s)var l={start:s.selectionStart,end:s.selectionEnd};else t:{l=(l=s.ownerDocument)&&l.defaultView||window;var h=l.getSelection&&l.getSelection();if(h&&h.rangeCount!==0){l=h.anchorNode;var g=h.anchorOffset,b=h.focusNode;h=h.focusOffset;try{l.nodeType,b.nodeType}catch{l=null;break t}var A=0,C=-1,D=-1,F=0,V=0,K=s,z=null;e:for(;;){for(var q;K!==l||g!==0&&K.nodeType!==3||(C=A+g),K!==b||h!==0&&K.nodeType!==3||(D=A+h),K.nodeType===3&&(A+=K.nodeValue.length),(q=K.firstChild)!==null;)z=K,K=q;for(;;){if(K===s)break e;if(z===l&&++F===g&&(C=A),z===b&&++V===h&&(D=A),(q=K.nextSibling)!==null)break;K=z,z=K.parentNode}K=q}l=C===-1||D===-1?null:{start:C,end:D}}else l=null}l=l||{start:0,end:0}}else l=null;for(ed={focusedElem:s,selectionRange:l},Jl=!1,xe=i;xe!==null;)if(i=xe,s=i.child,(i.subtreeFlags&1028)!==0&&s!==null)s.return=i,xe=s;else for(;xe!==null;){switch(i=xe,b=i.alternate,s=i.flags,i.tag){case 0:if((s&4)!==0&&(s=i.updateQueue,s=s!==null?s.events:null,s!==null))for(l=0;l<s.length;l++)g=s[l],g.ref.impl=g.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&b!==null){s=void 0,l=i,g=b.memoizedProps,b=b.memoizedState,h=l.stateNode;try{var rt=Ti(l.type,g);s=h.getSnapshotBeforeUpdate(rt,b),h.__reactInternalSnapshotBeforeUpdate=s}catch(yt){Gt(l,l.return,yt)}}break;case 3:if((s&1024)!==0){if(s=i.stateNode.containerInfo,l=s.nodeType,l===9)id(s);else if(l===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":id(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(n(163))}if(s=i.sibling,s!==null){s.return=i.return,xe=s;break}xe=i.return}}function Nm(s,i,l){var h=l.flags;switch(l.tag){case 0:case 11:case 15:wn(s,l),h&4&&ja(5,l);break;case 1:if(wn(s,l),h&4)if(s=l.stateNode,i===null)try{s.componentDidMount()}catch(A){Gt(l,l.return,A)}else{var g=Ti(l.type,i.memoizedProps);i=i.memoizedState;try{s.componentDidUpdate(g,i,s.__reactInternalSnapshotBeforeUpdate)}catch(A){Gt(l,l.return,A)}}h&64&&xm(l),h&512&&La(l,l.return);break;case 3:if(wn(s,l),h&64&&(s=l.updateQueue,s!==null)){if(i=null,l.child!==null)switch(l.child.tag){case 27:case 5:i=l.child.stateNode;break;case 1:i=l.child.stateNode}try{pg(s,i)}catch(A){Gt(l,l.return,A)}}break;case 27:i===null&&h&4&&Rm(l);case 26:case 5:wn(s,l),i===null&&h&4&&Tm(l),h&512&&La(l,l.return);break;case 12:wn(s,l);break;case 31:wn(s,l),h&4&&Mm(s,l);break;case 13:wn(s,l),h&4&&jm(s,l),h&64&&(s=l.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(l=H_.bind(null,l),lA(s,l))));break;case 22:if(h=l.memoizedState!==null||yn,!h){i=i!==null&&i.memoizedState!==null||be,g=yn;var b=be;yn=h,(be=i)&&!b?_n(s,l,(l.subtreeFlags&8772)!==0):wn(s,l),yn=g,be=b}break;case 30:break;default:wn(s,l)}}function km(s){var i=s.alternate;i!==null&&(s.alternate=null,km(i)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(i=s.stateNode,i!==null&&cu(i)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var se=null,Je=!1;function vn(s,i,l){for(l=l.child;l!==null;)Dm(s,i,l),l=l.sibling}function Dm(s,i,l){if($e&&typeof $e.onCommitFiberUnmount=="function")try{$e.onCommitFiberUnmount(ui,l)}catch{}switch(l.tag){case 26:be||Xs(l,i),vn(s,i,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:be||Xs(l,i);var h=se,g=Je;Kn(l.type)&&(se=l.stateNode,Je=!1),vn(s,i,l),qa(l.stateNode),se=h,Je=g;break;case 5:be||Xs(l,i);case 6:if(h=se,g=Je,se=null,vn(s,i,l),se=h,Je=g,se!==null)if(Je)try{(se.nodeType===9?se.body:se.nodeName==="HTML"?se.ownerDocument.body:se).removeChild(l.stateNode)}catch(b){Gt(l,i,b)}else try{se.removeChild(l.stateNode)}catch(b){Gt(l,i,b)}break;case 18:se!==null&&(Je?(s=se,x0(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,l.stateNode),Lr(s)):x0(se,l.stateNode));break;case 4:h=se,g=Je,se=l.stateNode.containerInfo,Je=!0,vn(s,i,l),se=h,Je=g;break;case 0:case 11:case 14:case 15:Hn(2,l,i),be||Hn(4,l,i),vn(s,i,l);break;case 1:be||(Xs(l,i),h=l.stateNode,typeof h.componentWillUnmount=="function"&&Em(l,i,h)),vn(s,i,l);break;case 21:vn(s,i,l);break;case 22:be=(h=be)||l.memoizedState!==null,vn(s,i,l),be=h;break;default:vn(s,i,l)}}function Mm(s,i){if(i.memoizedState===null&&(s=i.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{Lr(s)}catch(l){Gt(i,i.return,l)}}}function jm(s,i){if(i.memoizedState===null&&(s=i.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Lr(s)}catch(l){Gt(i,i.return,l)}}function j_(s){switch(s.tag){case 31:case 13:case 19:var i=s.stateNode;return i===null&&(i=s.stateNode=new Om),i;case 22:return s=s.stateNode,i=s._retryCache,i===null&&(i=s._retryCache=new Om),i;default:throw Error(n(435,s.tag))}}function Dl(s,i){var l=j_(s);i.forEach(function(h){if(!l.has(h)){l.add(h);var g=$_.bind(null,s,h);h.then(g,g)}})}function Ze(s,i){var l=i.deletions;if(l!==null)for(var h=0;h<l.length;h++){var g=l[h],b=s,A=i,C=A;t:for(;C!==null;){switch(C.tag){case 27:if(Kn(C.type)){se=C.stateNode,Je=!1;break t}break;case 5:se=C.stateNode,Je=!1;break t;case 3:case 4:se=C.stateNode.containerInfo,Je=!0;break t}C=C.return}if(se===null)throw Error(n(160));Dm(b,A,g),se=null,Je=!1,b=g.alternate,b!==null&&(b.return=null),g.return=null}if(i.subtreeFlags&13886)for(i=i.child;i!==null;)Lm(i,s),i=i.sibling}var Is=null;function Lm(s,i){var l=s.alternate,h=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:Ze(i,s),ts(s),h&4&&(Hn(3,s,s.return),ja(3,s),Hn(5,s,s.return));break;case 1:Ze(i,s),ts(s),h&512&&(be||l===null||Xs(l,l.return)),h&64&&yn&&(s=s.updateQueue,s!==null&&(h=s.callbacks,h!==null&&(l=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=l===null?h:l.concat(h))));break;case 26:var g=Is;if(Ze(i,s),ts(s),h&512&&(be||l===null||Xs(l,l.return)),h&4){var b=l!==null?l.memoizedState:null;if(h=s.memoizedState,l===null)if(h===null)if(s.stateNode===null){t:{h=s.type,l=s.memoizedProps,g=g.ownerDocument||g;e:switch(h){case"title":b=g.getElementsByTagName("title")[0],(!b||b[la]||b[Ce]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=g.createElement(h),g.head.insertBefore(b,g.querySelector("head > title"))),ke(b,h,l),b[Ce]=s,Se(b),h=b;break t;case"link":var A=L0("link","href",g).get(h+(l.href||""));if(A){for(var C=0;C<A.length;C++)if(b=A[C],b.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&b.getAttribute("rel")===(l.rel==null?null:l.rel)&&b.getAttribute("title")===(l.title==null?null:l.title)&&b.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){A.splice(C,1);break e}}b=g.createElement(h),ke(b,h,l),g.head.appendChild(b);break;case"meta":if(A=L0("meta","content",g).get(h+(l.content||""))){for(C=0;C<A.length;C++)if(b=A[C],b.getAttribute("content")===(l.content==null?null:""+l.content)&&b.getAttribute("name")===(l.name==null?null:l.name)&&b.getAttribute("property")===(l.property==null?null:l.property)&&b.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&b.getAttribute("charset")===(l.charSet==null?null:l.charSet)){A.splice(C,1);break e}}b=g.createElement(h),ke(b,h,l),g.head.appendChild(b);break;default:throw Error(n(468,h))}b[Ce]=s,Se(b),h=b}s.stateNode=h}else P0(g,s.type,s.stateNode);else s.stateNode=j0(g,h,s.memoizedProps);else b!==h?(b===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):b.count--,h===null?P0(g,s.type,s.stateNode):j0(g,h,s.memoizedProps)):h===null&&s.stateNode!==null&&Nh(s,s.memoizedProps,l.memoizedProps)}break;case 27:Ze(i,s),ts(s),h&512&&(be||l===null||Xs(l,l.return)),l!==null&&h&4&&Nh(s,s.memoizedProps,l.memoizedProps);break;case 5:if(Ze(i,s),ts(s),h&512&&(be||l===null||Xs(l,l.return)),s.flags&32){g=s.stateNode;try{ir(g,"")}catch(rt){Gt(s,s.return,rt)}}h&4&&s.stateNode!=null&&(g=s.memoizedProps,Nh(s,g,l!==null?l.memoizedProps:g)),h&1024&&(Mh=!0);break;case 6:if(Ze(i,s),ts(s),h&4){if(s.stateNode===null)throw Error(n(162));h=s.memoizedProps,l=s.stateNode;try{l.nodeValue=h}catch(rt){Gt(s,s.return,rt)}}break;case 3:if(Yl=null,g=Is,Is=Vl(i.containerInfo),Ze(i,s),Is=g,ts(s),h&4&&l!==null&&l.memoizedState.isDehydrated)try{Lr(i.containerInfo)}catch(rt){Gt(s,s.return,rt)}Mh&&(Mh=!1,Pm(s));break;case 4:h=Is,Is=Vl(s.stateNode.containerInfo),Ze(i,s),ts(s),Is=h;break;case 12:Ze(i,s),ts(s);break;case 31:Ze(i,s),ts(s),h&4&&(h=s.updateQueue,h!==null&&(s.updateQueue=null,Dl(s,h)));break;case 13:Ze(i,s),ts(s),s.child.flags&8192&&s.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(jl=Fe()),h&4&&(h=s.updateQueue,h!==null&&(s.updateQueue=null,Dl(s,h)));break;case 22:g=s.memoizedState!==null;var D=l!==null&&l.memoizedState!==null,F=yn,V=be;if(yn=F||g,be=V||D,Ze(i,s),be=V,yn=F,ts(s),h&8192)t:for(i=s.stateNode,i._visibility=g?i._visibility&-2:i._visibility|1,g&&(l===null||D||yn||be||Ci(s)),l=null,i=s;;){if(i.tag===5||i.tag===26){if(l===null){D=l=i;try{if(b=D.stateNode,g)A=b.style,typeof A.setProperty=="function"?A.setProperty("display","none","important"):A.display="none";else{C=D.stateNode;var K=D.memoizedProps.style,z=K!=null&&K.hasOwnProperty("display")?K.display:null;C.style.display=z==null||typeof z=="boolean"?"":(""+z).trim()}}catch(rt){Gt(D,D.return,rt)}}}else if(i.tag===6){if(l===null){D=i;try{D.stateNode.nodeValue=g?"":D.memoizedProps}catch(rt){Gt(D,D.return,rt)}}}else if(i.tag===18){if(l===null){D=i;try{var q=D.stateNode;g?E0(q,!0):E0(D.stateNode,!1)}catch(rt){Gt(D,D.return,rt)}}}else if((i.tag!==22&&i.tag!==23||i.memoizedState===null||i===s)&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break t;for(;i.sibling===null;){if(i.return===null||i.return===s)break t;l===i&&(l=null),i=i.return}l===i&&(l=null),i.sibling.return=i.return,i=i.sibling}h&4&&(h=s.updateQueue,h!==null&&(l=h.retryQueue,l!==null&&(h.retryQueue=null,Dl(s,l))));break;case 19:Ze(i,s),ts(s),h&4&&(h=s.updateQueue,h!==null&&(s.updateQueue=null,Dl(s,h)));break;case 30:break;case 21:break;default:Ze(i,s),ts(s)}}function ts(s){var i=s.flags;if(i&2){try{for(var l,h=s.return;h!==null;){if(Cm(h)){l=h;break}h=h.return}if(l==null)throw Error(n(160));switch(l.tag){case 27:var g=l.stateNode,b=kh(s);kl(s,b,g);break;case 5:var A=l.stateNode;l.flags&32&&(ir(A,""),l.flags&=-33);var C=kh(s);kl(s,C,A);break;case 3:case 4:var D=l.stateNode.containerInfo,F=kh(s);Dh(s,F,D);break;default:throw Error(n(161))}}catch(V){Gt(s,s.return,V)}s.flags&=-3}i&4096&&(s.flags&=-4097)}function Pm(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var i=s;Pm(i),i.tag===5&&i.flags&1024&&i.stateNode.reset(),s=s.sibling}}function wn(s,i){if(i.subtreeFlags&8772)for(i=i.child;i!==null;)Nm(s,i.alternate,i),i=i.sibling}function Ci(s){for(s=s.child;s!==null;){var i=s;switch(i.tag){case 0:case 11:case 14:case 15:Hn(4,i,i.return),Ci(i);break;case 1:Xs(i,i.return);var l=i.stateNode;typeof l.componentWillUnmount=="function"&&Em(i,i.return,l),Ci(i);break;case 27:qa(i.stateNode);case 26:case 5:Xs(i,i.return),Ci(i);break;case 22:i.memoizedState===null&&Ci(i);break;case 30:Ci(i);break;default:Ci(i)}s=s.sibling}}function _n(s,i,l){for(l=l&&(i.subtreeFlags&8772)!==0,i=i.child;i!==null;){var h=i.alternate,g=s,b=i,A=b.flags;switch(b.tag){case 0:case 11:case 15:_n(g,b,l),ja(4,b);break;case 1:if(_n(g,b,l),h=b,g=h.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(F){Gt(h,h.return,F)}if(h=b,g=h.updateQueue,g!==null){var C=h.stateNode;try{var D=g.shared.hiddenCallbacks;if(D!==null)for(g.shared.hiddenCallbacks=null,g=0;g<D.length;g++)fg(D[g],C)}catch(F){Gt(h,h.return,F)}}l&&A&64&&xm(b),La(b,b.return);break;case 27:Rm(b);case 26:case 5:_n(g,b,l),l&&h===null&&A&4&&Tm(b),La(b,b.return);break;case 12:_n(g,b,l);break;case 31:_n(g,b,l),l&&A&4&&Mm(g,b);break;case 13:_n(g,b,l),l&&A&4&&jm(g,b);break;case 22:b.memoizedState===null&&_n(g,b,l),La(b,b.return);break;case 30:break;default:_n(g,b,l)}i=i.sibling}}function jh(s,i){var l=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),s=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(s=i.memoizedState.cachePool.pool),s!==l&&(s!=null&&s.refCount++,l!=null&&_a(l))}function Lh(s,i){s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&_a(s))}function Us(s,i,l,h){if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Bm(s,i,l,h),i=i.sibling}function Bm(s,i,l,h){var g=i.flags;switch(i.tag){case 0:case 11:case 15:Us(s,i,l,h),g&2048&&ja(9,i);break;case 1:Us(s,i,l,h);break;case 3:Us(s,i,l,h),g&2048&&(s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&_a(s)));break;case 12:if(g&2048){Us(s,i,l,h),s=i.stateNode;try{var b=i.memoizedProps,A=b.id,C=b.onPostCommit;typeof C=="function"&&C(A,i.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(D){Gt(i,i.return,D)}}else Us(s,i,l,h);break;case 31:Us(s,i,l,h);break;case 13:Us(s,i,l,h);break;case 23:break;case 22:b=i.stateNode,A=i.alternate,i.memoizedState!==null?b._visibility&2?Us(s,i,l,h):Pa(s,i):b._visibility&2?Us(s,i,l,h):(b._visibility|=2,xr(s,i,l,h,(i.subtreeFlags&10256)!==0||!1)),g&2048&&jh(A,i);break;case 24:Us(s,i,l,h),g&2048&&Lh(i.alternate,i);break;default:Us(s,i,l,h)}}function xr(s,i,l,h,g){for(g=g&&((i.subtreeFlags&10256)!==0||!1),i=i.child;i!==null;){var b=s,A=i,C=l,D=h,F=A.flags;switch(A.tag){case 0:case 11:case 15:xr(b,A,C,D,g),ja(8,A);break;case 23:break;case 22:var V=A.stateNode;A.memoizedState!==null?V._visibility&2?xr(b,A,C,D,g):Pa(b,A):(V._visibility|=2,xr(b,A,C,D,g)),g&&F&2048&&jh(A.alternate,A);break;case 24:xr(b,A,C,D,g),g&&F&2048&&Lh(A.alternate,A);break;default:xr(b,A,C,D,g)}i=i.sibling}}function Pa(s,i){if(i.subtreeFlags&10256)for(i=i.child;i!==null;){var l=s,h=i,g=h.flags;switch(h.tag){case 22:Pa(l,h),g&2048&&jh(h.alternate,h);break;case 24:Pa(l,h),g&2048&&Lh(h.alternate,h);break;default:Pa(l,h)}i=i.sibling}}var Ba=8192;function Er(s,i,l){if(s.subtreeFlags&Ba)for(s=s.child;s!==null;)Im(s,i,l),s=s.sibling}function Im(s,i,l){switch(s.tag){case 26:Er(s,i,l),s.flags&Ba&&s.memoizedState!==null&&wA(l,Is,s.memoizedState,s.memoizedProps);break;case 5:Er(s,i,l);break;case 3:case 4:var h=Is;Is=Vl(s.stateNode.containerInfo),Er(s,i,l),Is=h;break;case 22:s.memoizedState===null&&(h=s.alternate,h!==null&&h.memoizedState!==null?(h=Ba,Ba=16777216,Er(s,i,l),Ba=h):Er(s,i,l));break;default:Er(s,i,l)}}function Um(s){var i=s.alternate;if(i!==null&&(s=i.child,s!==null)){i.child=null;do i=s.sibling,s.sibling=null,s=i;while(s!==null)}}function Ia(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var l=0;l<i.length;l++){var h=i[l];xe=h,zm(h,s)}Um(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Fm(s),s=s.sibling}function Fm(s){switch(s.tag){case 0:case 11:case 15:Ia(s),s.flags&2048&&Hn(9,s,s.return);break;case 3:Ia(s);break;case 12:Ia(s);break;case 22:var i=s.stateNode;s.memoizedState!==null&&i._visibility&2&&(s.return===null||s.return.tag!==13)?(i._visibility&=-3,Ml(s)):Ia(s);break;default:Ia(s)}}function Ml(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var l=0;l<i.length;l++){var h=i[l];xe=h,zm(h,s)}Um(s)}for(s=s.child;s!==null;){switch(i=s,i.tag){case 0:case 11:case 15:Hn(8,i,i.return),Ml(i);break;case 22:l=i.stateNode,l._visibility&2&&(l._visibility&=-3,Ml(i));break;default:Ml(i)}s=s.sibling}}function zm(s,i){for(;xe!==null;){var l=xe;switch(l.tag){case 0:case 11:case 15:Hn(8,l,i);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var h=l.memoizedState.cachePool.pool;h!=null&&h.refCount++}break;case 24:_a(l.memoizedState.cache)}if(h=l.child,h!==null)h.return=l,xe=h;else t:for(l=s;xe!==null;){h=xe;var g=h.sibling,b=h.return;if(km(h),h===l){xe=null;break t}if(g!==null){g.return=b,xe=g;break t}xe=b}}}var L_={getCacheForType:function(s){var i=Oe(pe),l=i.data.get(s);return l===void 0&&(l=s(),i.data.set(s,l)),l},cacheSignal:function(){return Oe(pe).controller.signal}},P_=typeof WeakMap=="function"?WeakMap:Map,Ft=0,Wt=null,Nt=null,Dt=0,qt=0,ds=null,$n=!1,Tr=!1,Ph=!1,An=0,ce=0,qn=0,Ri=0,Bh=0,fs=0,Cr=0,Ua=null,es=null,Ih=!1,jl=0,Hm=0,Ll=1/0,Pl=null,Gn=null,Ae=0,Vn=null,Rr=null,Sn=0,Uh=0,Fh=null,$m=null,Fa=0,zh=null;function ps(){return(Ft&2)!==0&&Dt!==0?Dt&-Dt:P.T!==null?Xh():rp()}function qm(){if(fs===0)if((Dt&536870912)===0||jt){var s=Ki;Ki<<=1,(Ki&3932160)===0&&(Ki=262144),fs=s}else fs=536870912;return s=us.current,s!==null&&(s.flags|=32),fs}function ss(s,i,l){(s===Wt&&(qt===2||qt===9)||s.cancelPendingCommit!==null)&&(Or(s,0),Xn(s,Dt,fs,!1)),Bt(s,l),((Ft&2)===0||s!==Wt)&&(s===Wt&&((Ft&2)===0&&(Ri|=l),ce===4&&Xn(s,Dt,fs,!1)),Ys(s))}function Gm(s,i,l){if((Ft&6)!==0)throw Error(n(327));var h=!l&&(i&127)===0&&(i&s.expiredLanes)===0||H(s,i),g=h?U_(s,i):$h(s,i,!0),b=h;do{if(g===0){Tr&&!h&&Xn(s,i,0,!1);break}else{if(l=s.current.alternate,b&&!B_(l)){g=$h(s,i,!1),b=!1;continue}if(g===2){if(b=i,s.errorRecoveryDisabledLanes&b)var A=0;else A=s.pendingLanes&-536870913,A=A!==0?A:A&536870912?536870912:0;if(A!==0){i=A;t:{var C=s;g=Ua;var D=C.current.memoizedState.isDehydrated;if(D&&(Or(C,A).flags|=256),A=$h(C,A,!1),A!==2){if(Ph&&!D){C.errorRecoveryDisabledLanes|=b,Ri|=b,g=4;break t}b=es,es=g,b!==null&&(es===null?es=b:es.push.apply(es,b))}g=A}if(b=!1,g!==2)continue}}if(g===1){Or(s,0),Xn(s,i,0,!0);break}t:{switch(h=s,b=g,b){case 0:case 1:throw Error(n(345));case 4:if((i&4194048)!==i)break;case 6:Xn(h,i,fs,!$n);break t;case 2:es=null;break;case 3:case 5:break;default:throw Error(n(329))}if((i&62914560)===i&&(g=jl+300-Fe(),10<g)){if(Xn(h,i,fs,!$n),Qi(h,0,!0)!==0)break t;Sn=i,h.timeoutHandle=A0(Vm.bind(null,h,l,es,Pl,Ih,i,fs,Ri,Cr,$n,b,"Throttled",-0,0),g);break t}Vm(h,l,es,Pl,Ih,i,fs,Ri,Cr,$n,b,null,-0,0)}}break}while(!0);Ys(s)}function Vm(s,i,l,h,g,b,A,C,D,F,V,K,z,q){if(s.timeoutHandle=-1,K=i.subtreeFlags,K&8192||(K&16785408)===16785408){K={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ln},Im(i,b,K);var rt=(b&62914560)===b?jl-Fe():(b&4194048)===b?Hm-Fe():0;if(rt=_A(K,rt),rt!==null){Sn=b,s.cancelPendingCommit=rt(t0.bind(null,s,i,b,l,h,g,A,C,D,V,K,null,z,q)),Xn(s,b,A,!F);return}}t0(s,i,b,l,h,g,A,C,D)}function B_(s){for(var i=s;;){var l=i.tag;if((l===0||l===11||l===15)&&i.flags&16384&&(l=i.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var h=0;h<l.length;h++){var g=l[h],b=g.getSnapshot;g=g.value;try{if(!ls(b(),g))return!1}catch{return!1}}if(l=i.child,i.subtreeFlags&16384&&l!==null)l.return=i,i=l;else{if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Xn(s,i,l,h){i&=~Bh,i&=~Ri,s.suspendedLanes|=i,s.pingedLanes&=~i,h&&(s.warmLanes|=i),h=s.expirationTimes;for(var g=i;0<g;){var b=31-qe(g),A=1<<b;h[b]=-1,g&=~A}l!==0&&hi(s,l,i)}function Bl(){return(Ft&6)===0?(za(0),!1):!0}function Hh(){if(Nt!==null){if(qt===0)var s=Nt.return;else s=Nt,dn=vi=null,ih(s),vr=null,Sa=0,s=Nt;for(;s!==null;)Sm(s.alternate,s),s=s.return;Nt=null}}function Or(s,i){var l=s.timeoutHandle;l!==-1&&(s.timeoutHandle=-1,nA(l)),l=s.cancelPendingCommit,l!==null&&(s.cancelPendingCommit=null,l()),Sn=0,Hh(),Wt=s,Nt=l=un(s.current,null),Dt=i,qt=0,ds=null,$n=!1,Tr=H(s,i),Ph=!1,Cr=fs=Bh=Ri=qn=ce=0,es=Ua=null,Ih=!1,(i&8)!==0&&(i|=i&32);var h=s.entangledLanes;if(h!==0)for(s=s.entanglements,h&=i;0<h;){var g=31-qe(h),b=1<<g;i|=s[g],h&=~b}return An=i,il(),l}function Xm(s,i){Ct=null,P.H=ka,i===yr||i===dl?(i=cg(),qt=3):i===Vu?(i=cg(),qt=4):qt=i===wh?8:i!==null&&typeof i=="object"&&typeof i.then=="function"?6:1,ds=i,Nt===null&&(ce=1,Tl(s,As(i,s.current)))}function Ym(){var s=us.current;return s===null?!0:(Dt&4194048)===Dt?Ts===null:(Dt&62914560)===Dt||(Dt&536870912)!==0?s===Ts:!1}function Km(){var s=P.H;return P.H=ka,s===null?ka:s}function Wm(){var s=P.A;return P.A=L_,s}function Il(){ce=4,$n||(Dt&4194048)!==Dt&&us.current!==null||(Tr=!0),(qn&134217727)===0&&(Ri&134217727)===0||Wt===null||Xn(Wt,Dt,fs,!1)}function $h(s,i,l){var h=Ft;Ft|=2;var g=Km(),b=Wm();(Wt!==s||Dt!==i)&&(Pl=null,Or(s,i)),i=!1;var A=ce;t:do try{if(qt!==0&&Nt!==null){var C=Nt,D=ds;switch(qt){case 8:Hh(),A=6;break t;case 3:case 2:case 9:case 6:us.current===null&&(i=!0);var F=qt;if(qt=0,ds=null,Nr(s,C,D,F),l&&Tr){A=0;break t}break;default:F=qt,qt=0,ds=null,Nr(s,C,D,F)}}I_(),A=ce;break}catch(V){Xm(s,V)}while(!0);return i&&s.shellSuspendCounter++,dn=vi=null,Ft=h,P.H=g,P.A=b,Nt===null&&(Wt=null,Dt=0,il()),A}function I_(){for(;Nt!==null;)Qm(Nt)}function U_(s,i){var l=Ft;Ft|=2;var h=Km(),g=Wm();Wt!==s||Dt!==i?(Pl=null,Ll=Fe()+500,Or(s,i)):Tr=H(s,i);t:do try{if(qt!==0&&Nt!==null){i=Nt;var b=ds;e:switch(qt){case 1:qt=0,ds=null,Nr(s,i,b,1);break;case 2:case 9:if(og(b)){qt=0,ds=null,Jm(i);break}i=function(){qt!==2&&qt!==9||Wt!==s||(qt=7),Ys(s)},b.then(i,i);break t;case 3:qt=7;break t;case 4:qt=5;break t;case 7:og(b)?(qt=0,ds=null,Jm(i)):(qt=0,ds=null,Nr(s,i,b,7));break;case 5:var A=null;switch(Nt.tag){case 26:A=Nt.memoizedState;case 5:case 27:var C=Nt;if(A?B0(A):C.stateNode.complete){qt=0,ds=null;var D=C.sibling;if(D!==null)Nt=D;else{var F=C.return;F!==null?(Nt=F,Ul(F)):Nt=null}break e}}qt=0,ds=null,Nr(s,i,b,5);break;case 6:qt=0,ds=null,Nr(s,i,b,6);break;case 8:Hh(),ce=6;break t;default:throw Error(n(462))}}F_();break}catch(V){Xm(s,V)}while(!0);return dn=vi=null,P.H=h,P.A=g,Ft=l,Nt!==null?0:(Wt=null,Dt=0,il(),ce)}function F_(){for(;Nt!==null&&!Uo();)Qm(Nt)}function Qm(s){var i=_m(s.alternate,s,An);s.memoizedProps=s.pendingProps,i===null?Ul(s):Nt=i}function Jm(s){var i=s,l=i.alternate;switch(i.tag){case 15:case 0:i=gm(l,i,i.pendingProps,i.type,void 0,Dt);break;case 11:i=gm(l,i,i.pendingProps,i.type.render,i.ref,Dt);break;case 5:ih(i);default:Sm(l,i),i=Nt=Wp(i,An),i=_m(l,i,An)}s.memoizedProps=s.pendingProps,i===null?Ul(s):Nt=i}function Nr(s,i,l,h){dn=vi=null,ih(i),vr=null,Sa=0;var g=i.return;try{if(R_(s,g,i,l,Dt)){ce=1,Tl(s,As(l,s.current)),Nt=null;return}}catch(b){if(g!==null)throw Nt=g,b;ce=1,Tl(s,As(l,s.current)),Nt=null;return}i.flags&32768?(jt||h===1?s=!0:Tr||(Dt&536870912)!==0?s=!1:($n=s=!0,(h===2||h===9||h===3||h===6)&&(h=us.current,h!==null&&h.tag===13&&(h.flags|=16384))),Zm(i,s)):Ul(i)}function Ul(s){var i=s;do{if((i.flags&32768)!==0){Zm(i,$n);return}s=i.return;var l=k_(i.alternate,i,An);if(l!==null){Nt=l;return}if(i=i.sibling,i!==null){Nt=i;return}Nt=i=s}while(i!==null);ce===0&&(ce=5)}function Zm(s,i){do{var l=D_(s.alternate,s);if(l!==null){l.flags&=32767,Nt=l;return}if(l=s.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!i&&(s=s.sibling,s!==null)){Nt=s;return}Nt=s=l}while(s!==null);ce=6,Nt=null}function t0(s,i,l,h,g,b,A,C,D){s.cancelPendingCommit=null;do Fl();while(Ae!==0);if((Ft&6)!==0)throw Error(n(327));if(i!==null){if(i===s.current)throw Error(n(177));if(b=i.lanes|i.childLanes,b|=ku,Ps(s,l,b,A,C,D),s===Wt&&(Nt=Wt=null,Dt=0),Rr=i,Vn=s,Sn=l,Uh=b,Fh=g,$m=h,(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,q_(Xi,function(){return r0(),null})):(s.callbackNode=null,s.callbackPriority=0),h=(i.flags&13878)!==0,(i.subtreeFlags&13878)!==0||h){h=P.T,P.T=null,g=$.p,$.p=2,A=Ft,Ft|=4;try{M_(s,i,l)}finally{Ft=A,$.p=g,P.T=h}}Ae=1,e0(),s0(),n0()}}function e0(){if(Ae===1){Ae=0;var s=Vn,i=Rr,l=(i.flags&13878)!==0;if((i.subtreeFlags&13878)!==0||l){l=P.T,P.T=null;var h=$.p;$.p=2;var g=Ft;Ft|=4;try{Lm(i,s);var b=ed,A=zp(s.containerInfo),C=b.focusedElem,D=b.selectionRange;if(A!==C&&C&&C.ownerDocument&&Fp(C.ownerDocument.documentElement,C)){if(D!==null&&Tu(C)){var F=D.start,V=D.end;if(V===void 0&&(V=F),"selectionStart"in C)C.selectionStart=F,C.selectionEnd=Math.min(V,C.value.length);else{var K=C.ownerDocument||document,z=K&&K.defaultView||window;if(z.getSelection){var q=z.getSelection(),rt=C.textContent.length,yt=Math.min(D.start,rt),Yt=D.end===void 0?yt:Math.min(D.end,rt);!q.extend&&yt>Yt&&(A=Yt,Yt=yt,yt=A);var B=Up(C,yt),L=Up(C,Yt);if(B&&L&&(q.rangeCount!==1||q.anchorNode!==B.node||q.anchorOffset!==B.offset||q.focusNode!==L.node||q.focusOffset!==L.offset)){var U=K.createRange();U.setStart(B.node,B.offset),q.removeAllRanges(),yt>Yt?(q.addRange(U),q.extend(L.node,L.offset)):(U.setEnd(L.node,L.offset),q.addRange(U))}}}}for(K=[],q=C;q=q.parentNode;)q.nodeType===1&&K.push({element:q,left:q.scrollLeft,top:q.scrollTop});for(typeof C.focus=="function"&&C.focus(),C=0;C<K.length;C++){var Y=K[C];Y.element.scrollLeft=Y.left,Y.element.scrollTop=Y.top}}Jl=!!td,ed=td=null}finally{Ft=g,$.p=h,P.T=l}}s.current=i,Ae=2}}function s0(){if(Ae===2){Ae=0;var s=Vn,i=Rr,l=(i.flags&8772)!==0;if((i.subtreeFlags&8772)!==0||l){l=P.T,P.T=null;var h=$.p;$.p=2;var g=Ft;Ft|=4;try{Nm(s,i.alternate,i)}finally{Ft=g,$.p=h,P.T=l}}Ae=3}}function n0(){if(Ae===4||Ae===3){Ae=0,eu();var s=Vn,i=Rr,l=Sn,h=$m;(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?Ae=5:(Ae=0,Rr=Vn=null,i0(s,s.pendingLanes));var g=s.pendingLanes;if(g===0&&(Gn=null),ou(l),i=i.stateNode,$e&&typeof $e.onCommitFiberRoot=="function")try{$e.onCommitFiberRoot(ui,i,void 0,(i.current.flags&128)===128)}catch{}if(h!==null){i=P.T,g=$.p,$.p=2,P.T=null;try{for(var b=s.onRecoverableError,A=0;A<h.length;A++){var C=h[A];b(C.value,{componentStack:C.stack})}}finally{P.T=i,$.p=g}}(Sn&3)!==0&&Fl(),Ys(s),g=s.pendingLanes,(l&261930)!==0&&(g&42)!==0?s===zh?Fa++:(Fa=0,zh=s):Fa=0,za(0)}}function i0(s,i){(s.pooledCacheLanes&=i)===0&&(i=s.pooledCache,i!=null&&(s.pooledCache=null,_a(i)))}function Fl(){return e0(),s0(),n0(),r0()}function r0(){if(Ae!==5)return!1;var s=Vn,i=Uh;Uh=0;var l=ou(Sn),h=P.T,g=$.p;try{$.p=32>l?32:l,P.T=null,l=Fh,Fh=null;var b=Vn,A=Sn;if(Ae=0,Rr=Vn=null,Sn=0,(Ft&6)!==0)throw Error(n(331));var C=Ft;if(Ft|=4,Fm(b.current),Bm(b,b.current,A,l),Ft=C,za(0,!1),$e&&typeof $e.onPostCommitFiberRoot=="function")try{$e.onPostCommitFiberRoot(ui,b)}catch{}return!0}finally{$.p=g,P.T=h,i0(s,i)}}function a0(s,i,l){i=As(l,i),i=vh(s.stateNode,i,2),s=Un(s,i,2),s!==null&&(Bt(s,2),Ys(s))}function Gt(s,i,l){if(s.tag===3)a0(s,s,l);else for(;i!==null;){if(i.tag===3){a0(i,s,l);break}else if(i.tag===1){var h=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Gn===null||!Gn.has(h))){s=As(l,s),l=om(2),h=Un(i,l,2),h!==null&&(lm(l,h,i,s),Bt(h,2),Ys(h));break}}i=i.return}}function qh(s,i,l){var h=s.pingCache;if(h===null){h=s.pingCache=new P_;var g=new Set;h.set(i,g)}else g=h.get(i),g===void 0&&(g=new Set,h.set(i,g));g.has(l)||(Ph=!0,g.add(l),s=z_.bind(null,s,i,l),i.then(s,s))}function z_(s,i,l){var h=s.pingCache;h!==null&&h.delete(i),s.pingedLanes|=s.suspendedLanes&l,s.warmLanes&=~l,Wt===s&&(Dt&l)===l&&(ce===4||ce===3&&(Dt&62914560)===Dt&&300>Fe()-jl?(Ft&2)===0&&Or(s,0):Bh|=l,Cr===Dt&&(Cr=0)),Ys(s)}function o0(s,i){i===0&&(i=dt()),s=mi(s,i),s!==null&&(Bt(s,i),Ys(s))}function H_(s){var i=s.memoizedState,l=0;i!==null&&(l=i.retryLane),o0(s,l)}function $_(s,i){var l=0;switch(s.tag){case 31:case 13:var h=s.stateNode,g=s.memoizedState;g!==null&&(l=g.retryLane);break;case 19:h=s.stateNode;break;case 22:h=s.stateNode._retryCache;break;default:throw Error(n(314))}h!==null&&h.delete(i),o0(s,l)}function q_(s,i){return Vi(s,i)}var zl=null,kr=null,Gh=!1,Hl=!1,Vh=!1,Yn=0;function Ys(s){s!==kr&&s.next===null&&(kr===null?zl=kr=s:kr=kr.next=s),Hl=!0,Gh||(Gh=!0,V_())}function za(s,i){if(!Vh&&Hl){Vh=!0;do for(var l=!1,h=zl;h!==null;){if(s!==0){var g=h.pendingLanes;if(g===0)var b=0;else{var A=h.suspendedLanes,C=h.pingedLanes;b=(1<<31-qe(42|s)+1)-1,b&=g&~(A&~C),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(l=!0,h0(h,b))}else b=Dt,b=Qi(h,h===Wt?b:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),(b&3)===0||H(h,b)||(l=!0,h0(h,b));h=h.next}while(l);Vh=!1}}function G_(){l0()}function l0(){Hl=Gh=!1;var s=0;Yn!==0&&sA()&&(s=Yn);for(var i=Fe(),l=null,h=zl;h!==null;){var g=h.next,b=c0(h,i);b===0?(h.next=null,l===null?zl=g:l.next=g,g===null&&(kr=l)):(l=h,(s!==0||(b&3)!==0)&&(Hl=!0)),h=g}Ae!==0&&Ae!==5||za(s),Yn!==0&&(Yn=0)}function c0(s,i){for(var l=s.suspendedLanes,h=s.pingedLanes,g=s.expirationTimes,b=s.pendingLanes&-62914561;0<b;){var A=31-qe(b),C=1<<A,D=g[A];D===-1?((C&l)===0||(C&h)!==0)&&(g[A]=W(C,i)):D<=i&&(s.expiredLanes|=C),b&=~C}if(i=Wt,l=Dt,l=Qi(s,s===i?l:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),h=s.callbackNode,l===0||s===i&&(qt===2||qt===9)||s.cancelPendingCommit!==null)return h!==null&&h!==null&&ci(h),s.callbackNode=null,s.callbackPriority=0;if((l&3)===0||H(s,l)){if(i=l&-l,i===s.callbackPriority)return i;switch(h!==null&&ci(h),ou(l)){case 2:case 8:l=zo;break;case 32:l=Xi;break;case 268435456:l=Ho;break;default:l=Xi}return h=u0.bind(null,s),l=Vi(l,h),s.callbackPriority=i,s.callbackNode=l,i}return h!==null&&h!==null&&ci(h),s.callbackPriority=2,s.callbackNode=null,2}function u0(s,i){if(Ae!==0&&Ae!==5)return s.callbackNode=null,s.callbackPriority=0,null;var l=s.callbackNode;if(Fl()&&s.callbackNode!==l)return null;var h=Dt;return h=Qi(s,s===Wt?h:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),h===0?null:(Gm(s,h,i),c0(s,Fe()),s.callbackNode!=null&&s.callbackNode===l?u0.bind(null,s):null)}function h0(s,i){if(Fl())return null;Gm(s,i,!0)}function V_(){iA(function(){(Ft&6)!==0?Vi(Fo,G_):l0()})}function Xh(){if(Yn===0){var s=mr;s===0&&(s=Yi,Yi<<=1,(Yi&261888)===0&&(Yi=256)),Yn=s}return Yn}function d0(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Wo(""+s)}function f0(s,i){var l=i.ownerDocument.createElement("input");return l.name=i.name,l.value=i.value,s.id&&l.setAttribute("form",s.id),i.parentNode.insertBefore(l,i),s=new FormData(s),l.parentNode.removeChild(l),s}function X_(s,i,l,h,g){if(i==="submit"&&l&&l.stateNode===g){var b=d0((g[We]||null).action),A=h.submitter;A&&(i=(i=A[We]||null)?d0(i.formAction):A.getAttribute("formAction"),i!==null&&(b=i,A=null));var C=new tl("action","action",null,h,g);s.push({event:C,listeners:[{instance:null,listener:function(){if(h.defaultPrevented){if(Yn!==0){var D=A?f0(g,A):new FormData(g);fh(l,{pending:!0,data:D,method:g.method,action:b},null,D)}}else typeof b=="function"&&(C.preventDefault(),D=A?f0(g,A):new FormData(g),fh(l,{pending:!0,data:D,method:g.method,action:b},b,D))},currentTarget:g}]})}}for(var Yh=0;Yh<Nu.length;Yh++){var Kh=Nu[Yh],Y_=Kh.toLowerCase(),K_=Kh[0].toUpperCase()+Kh.slice(1);Bs(Y_,"on"+K_)}Bs(qp,"onAnimationEnd"),Bs(Gp,"onAnimationIteration"),Bs(Vp,"onAnimationStart"),Bs("dblclick","onDoubleClick"),Bs("focusin","onFocus"),Bs("focusout","onBlur"),Bs(h_,"onTransitionRun"),Bs(d_,"onTransitionStart"),Bs(f_,"onTransitionCancel"),Bs(Xp,"onTransitionEnd"),sr("onMouseEnter",["mouseout","mouseover"]),sr("onMouseLeave",["mouseout","mouseover"]),sr("onPointerEnter",["pointerout","pointerover"]),sr("onPointerLeave",["pointerout","pointerover"]),di("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),di("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),di("onBeforeInput",["compositionend","keypress","textInput","paste"]),di("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),di("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),di("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ha="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),W_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ha));function p0(s,i){i=(i&4)!==0;for(var l=0;l<s.length;l++){var h=s[l],g=h.event;h=h.listeners;t:{var b=void 0;if(i)for(var A=h.length-1;0<=A;A--){var C=h[A],D=C.instance,F=C.currentTarget;if(C=C.listener,D!==b&&g.isPropagationStopped())break t;b=C,g.currentTarget=F;try{b(g)}catch(V){nl(V)}g.currentTarget=null,b=D}else for(A=0;A<h.length;A++){if(C=h[A],D=C.instance,F=C.currentTarget,C=C.listener,D!==b&&g.isPropagationStopped())break t;b=C,g.currentTarget=F;try{b(g)}catch(V){nl(V)}g.currentTarget=null,b=D}}}}function kt(s,i){var l=i[lu];l===void 0&&(l=i[lu]=new Set);var h=s+"__bubble";l.has(h)||(g0(i,s,2,!1),l.add(h))}function Wh(s,i,l){var h=0;i&&(h|=4),g0(l,s,h,i)}var $l="_reactListening"+Math.random().toString(36).slice(2);function Qh(s){if(!s[$l]){s[$l]=!0,lp.forEach(function(l){l!=="selectionchange"&&(W_.has(l)||Wh(l,!1,s),Wh(l,!0,s))});var i=s.nodeType===9?s:s.ownerDocument;i===null||i[$l]||(i[$l]=!0,Wh("selectionchange",!1,i))}}function g0(s,i,l,h){switch(q0(i)){case 2:var g=xA;break;case 8:g=EA;break;default:g=dd}l=g.bind(null,i,l,s),g=void 0,!bu||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(g=!0),h?g!==void 0?s.addEventListener(i,l,{capture:!0,passive:g}):s.addEventListener(i,l,!0):g!==void 0?s.addEventListener(i,l,{passive:g}):s.addEventListener(i,l,!1)}function Jh(s,i,l,h,g){var b=h;if((i&1)===0&&(i&2)===0&&h!==null)t:for(;;){if(h===null)return;var A=h.tag;if(A===3||A===4){var C=h.stateNode.containerInfo;if(C===g)break;if(A===4)for(A=h.return;A!==null;){var D=A.tag;if((D===3||D===4)&&A.stateNode.containerInfo===g)return;A=A.return}for(;C!==null;){if(A=Zi(C),A===null)return;if(D=A.tag,D===5||D===6||D===26||D===27){h=b=A;continue t}C=C.parentNode}}h=h.return}wp(function(){var F=b,V=gu(l),K=[];t:{var z=Yp.get(s);if(z!==void 0){var q=tl,rt=s;switch(s){case"keypress":if(Jo(l)===0)break t;case"keydown":case"keyup":q=$w;break;case"focusin":rt="focus",q=_u;break;case"focusout":rt="blur",q=_u;break;case"beforeblur":case"afterblur":q=_u;break;case"click":if(l.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":q=Sp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":q=kw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":q=Vw;break;case qp:case Gp:case Vp:q=jw;break;case Xp:q=Yw;break;case"scroll":case"scrollend":q=Ow;break;case"wheel":q=Ww;break;case"copy":case"cut":case"paste":q=Pw;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":q=Ep;break;case"toggle":case"beforetoggle":q=Jw}var yt=(i&4)!==0,Yt=!yt&&(s==="scroll"||s==="scrollend"),B=yt?z!==null?z+"Capture":null:z;yt=[];for(var L=F,U;L!==null;){var Y=L;if(U=Y.stateNode,Y=Y.tag,Y!==5&&Y!==26&&Y!==27||U===null||B===null||(Y=ua(L,B),Y!=null&&yt.push($a(L,Y,U))),Yt)break;L=L.return}0<yt.length&&(z=new q(z,rt,null,l,V),K.push({event:z,listeners:yt}))}}if((i&7)===0){t:{if(z=s==="mouseover"||s==="pointerover",q=s==="mouseout"||s==="pointerout",z&&l!==pu&&(rt=l.relatedTarget||l.fromElement)&&(Zi(rt)||rt[Ji]))break t;if((q||z)&&(z=V.window===V?V:(z=V.ownerDocument)?z.defaultView||z.parentWindow:window,q?(rt=l.relatedTarget||l.toElement,q=F,rt=rt?Zi(rt):null,rt!==null&&(Yt=a(rt),yt=rt.tag,rt!==Yt||yt!==5&&yt!==27&&yt!==6)&&(rt=null)):(q=null,rt=F),q!==rt)){if(yt=Sp,Y="onMouseLeave",B="onMouseEnter",L="mouse",(s==="pointerout"||s==="pointerover")&&(yt=Ep,Y="onPointerLeave",B="onPointerEnter",L="pointer"),Yt=q==null?z:ca(q),U=rt==null?z:ca(rt),z=new yt(Y,L+"leave",q,l,V),z.target=Yt,z.relatedTarget=U,Y=null,Zi(V)===F&&(yt=new yt(B,L+"enter",rt,l,V),yt.target=U,yt.relatedTarget=Yt,Y=yt),Yt=Y,q&&rt)e:{for(yt=Q_,B=q,L=rt,U=0,Y=B;Y;Y=yt(Y))U++;Y=0;for(var pt=L;pt;pt=yt(pt))Y++;for(;0<U-Y;)B=yt(B),U--;for(;0<Y-U;)L=yt(L),Y--;for(;U--;){if(B===L||L!==null&&B===L.alternate){yt=B;break e}B=yt(B),L=yt(L)}yt=null}else yt=null;q!==null&&m0(K,z,q,yt,!1),rt!==null&&Yt!==null&&m0(K,Yt,rt,yt,!0)}}t:{if(z=F?ca(F):window,q=z.nodeName&&z.nodeName.toLowerCase(),q==="select"||q==="input"&&z.type==="file")var It=Mp;else if(kp(z))if(jp)It=l_;else{It=a_;var ot=r_}else q=z.nodeName,!q||q.toLowerCase()!=="input"||z.type!=="checkbox"&&z.type!=="radio"?F&&fu(F.elementType)&&(It=Mp):It=o_;if(It&&(It=It(s,F))){Dp(K,It,l,V);break t}ot&&ot(s,z,F),s==="focusout"&&F&&z.type==="number"&&F.memoizedProps.value!=null&&du(z,"number",z.value)}switch(ot=F?ca(F):window,s){case"focusin":(kp(ot)||ot.contentEditable==="true")&&(lr=ot,Cu=F,ya=null);break;case"focusout":ya=Cu=lr=null;break;case"mousedown":Ru=!0;break;case"contextmenu":case"mouseup":case"dragend":Ru=!1,Hp(K,l,V);break;case"selectionchange":if(u_)break;case"keydown":case"keyup":Hp(K,l,V)}var Rt;if(Su)t:{switch(s){case"compositionstart":var Mt="onCompositionStart";break t;case"compositionend":Mt="onCompositionEnd";break t;case"compositionupdate":Mt="onCompositionUpdate";break t}Mt=void 0}else or?Op(s,l)&&(Mt="onCompositionEnd"):s==="keydown"&&l.keyCode===229&&(Mt="onCompositionStart");Mt&&(Tp&&l.locale!=="ko"&&(or||Mt!=="onCompositionStart"?Mt==="onCompositionEnd"&&or&&(Rt=_p()):(Dn=V,yu="value"in Dn?Dn.value:Dn.textContent,or=!0)),ot=ql(F,Mt),0<ot.length&&(Mt=new xp(Mt,s,null,l,V),K.push({event:Mt,listeners:ot}),Rt?Mt.data=Rt:(Rt=Np(l),Rt!==null&&(Mt.data=Rt)))),(Rt=t_?e_(s,l):s_(s,l))&&(Mt=ql(F,"onBeforeInput"),0<Mt.length&&(ot=new xp("onBeforeInput","beforeinput",null,l,V),K.push({event:ot,listeners:Mt}),ot.data=Rt)),X_(K,s,F,l,V)}p0(K,i)})}function $a(s,i,l){return{instance:s,listener:i,currentTarget:l}}function ql(s,i){for(var l=i+"Capture",h=[];s!==null;){var g=s,b=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||b===null||(g=ua(s,l),g!=null&&h.unshift($a(s,g,b)),g=ua(s,i),g!=null&&h.push($a(s,g,b))),s.tag===3)return h;s=s.return}return[]}function Q_(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function m0(s,i,l,h,g){for(var b=i._reactName,A=[];l!==null&&l!==h;){var C=l,D=C.alternate,F=C.stateNode;if(C=C.tag,D!==null&&D===h)break;C!==5&&C!==26&&C!==27||F===null||(D=F,g?(F=ua(l,b),F!=null&&A.unshift($a(l,F,D))):g||(F=ua(l,b),F!=null&&A.push($a(l,F,D)))),l=l.return}A.length!==0&&s.push({event:i,listeners:A})}var J_=/\r\n?/g,Z_=/\u0000|\uFFFD/g;function b0(s){return(typeof s=="string"?s:""+s).replace(J_,`
`).replace(Z_,"")}function y0(s,i){return i=b0(i),b0(s)===i}function Xt(s,i,l,h,g,b){switch(l){case"children":typeof h=="string"?i==="body"||i==="textarea"&&h===""||ir(s,h):(typeof h=="number"||typeof h=="bigint")&&i!=="body"&&ir(s,""+h);break;case"className":Yo(s,"class",h);break;case"tabIndex":Yo(s,"tabindex",h);break;case"dir":case"role":case"viewBox":case"width":case"height":Yo(s,l,h);break;case"style":yp(s,h,b);break;case"data":if(i!=="object"){Yo(s,"data",h);break}case"src":case"href":if(h===""&&(i!=="a"||l!=="href")){s.removeAttribute(l);break}if(h==null||typeof h=="function"||typeof h=="symbol"||typeof h=="boolean"){s.removeAttribute(l);break}h=Wo(""+h),s.setAttribute(l,h);break;case"action":case"formAction":if(typeof h=="function"){s.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(l==="formAction"?(i!=="input"&&Xt(s,i,"name",g.name,g,null),Xt(s,i,"formEncType",g.formEncType,g,null),Xt(s,i,"formMethod",g.formMethod,g,null),Xt(s,i,"formTarget",g.formTarget,g,null)):(Xt(s,i,"encType",g.encType,g,null),Xt(s,i,"method",g.method,g,null),Xt(s,i,"target",g.target,g,null)));if(h==null||typeof h=="symbol"||typeof h=="boolean"){s.removeAttribute(l);break}h=Wo(""+h),s.setAttribute(l,h);break;case"onClick":h!=null&&(s.onclick=ln);break;case"onScroll":h!=null&&kt("scroll",s);break;case"onScrollEnd":h!=null&&kt("scrollend",s);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(n(61));if(l=h.__html,l!=null){if(g.children!=null)throw Error(n(60));s.innerHTML=l}}break;case"multiple":s.multiple=h&&typeof h!="function"&&typeof h!="symbol";break;case"muted":s.muted=h&&typeof h!="function"&&typeof h!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(h==null||typeof h=="function"||typeof h=="boolean"||typeof h=="symbol"){s.removeAttribute("xlink:href");break}l=Wo(""+h),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":h!=null&&typeof h!="function"&&typeof h!="symbol"?s.setAttribute(l,""+h):s.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":h&&typeof h!="function"&&typeof h!="symbol"?s.setAttribute(l,""):s.removeAttribute(l);break;case"capture":case"download":h===!0?s.setAttribute(l,""):h!==!1&&h!=null&&typeof h!="function"&&typeof h!="symbol"?s.setAttribute(l,h):s.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":h!=null&&typeof h!="function"&&typeof h!="symbol"&&!isNaN(h)&&1<=h?s.setAttribute(l,h):s.removeAttribute(l);break;case"rowSpan":case"start":h==null||typeof h=="function"||typeof h=="symbol"||isNaN(h)?s.removeAttribute(l):s.setAttribute(l,h);break;case"popover":kt("beforetoggle",s),kt("toggle",s),Xo(s,"popover",h);break;case"xlinkActuate":on(s,"http://www.w3.org/1999/xlink","xlink:actuate",h);break;case"xlinkArcrole":on(s,"http://www.w3.org/1999/xlink","xlink:arcrole",h);break;case"xlinkRole":on(s,"http://www.w3.org/1999/xlink","xlink:role",h);break;case"xlinkShow":on(s,"http://www.w3.org/1999/xlink","xlink:show",h);break;case"xlinkTitle":on(s,"http://www.w3.org/1999/xlink","xlink:title",h);break;case"xlinkType":on(s,"http://www.w3.org/1999/xlink","xlink:type",h);break;case"xmlBase":on(s,"http://www.w3.org/XML/1998/namespace","xml:base",h);break;case"xmlLang":on(s,"http://www.w3.org/XML/1998/namespace","xml:lang",h);break;case"xmlSpace":on(s,"http://www.w3.org/XML/1998/namespace","xml:space",h);break;case"is":Xo(s,"is",h);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=Cw.get(l)||l,Xo(s,l,h))}}function Zh(s,i,l,h,g,b){switch(l){case"style":yp(s,h,b);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(n(61));if(l=h.__html,l!=null){if(g.children!=null)throw Error(n(60));s.innerHTML=l}}break;case"children":typeof h=="string"?ir(s,h):(typeof h=="number"||typeof h=="bigint")&&ir(s,""+h);break;case"onScroll":h!=null&&kt("scroll",s);break;case"onScrollEnd":h!=null&&kt("scrollend",s);break;case"onClick":h!=null&&(s.onclick=ln);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!cp.hasOwnProperty(l))t:{if(l[0]==="o"&&l[1]==="n"&&(g=l.endsWith("Capture"),i=l.slice(2,g?l.length-7:void 0),b=s[We]||null,b=b!=null?b[l]:null,typeof b=="function"&&s.removeEventListener(i,b,g),typeof h=="function")){typeof b!="function"&&b!==null&&(l in s?s[l]=null:s.hasAttribute(l)&&s.removeAttribute(l)),s.addEventListener(i,h,g);break t}l in s?s[l]=h:h===!0?s.setAttribute(l,""):Xo(s,l,h)}}}function ke(s,i,l){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":kt("error",s),kt("load",s);var h=!1,g=!1,b;for(b in l)if(l.hasOwnProperty(b)){var A=l[b];if(A!=null)switch(b){case"src":h=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,i));default:Xt(s,i,b,A,l,null)}}g&&Xt(s,i,"srcSet",l.srcSet,l,null),h&&Xt(s,i,"src",l.src,l,null);return;case"input":kt("invalid",s);var C=b=A=g=null,D=null,F=null;for(h in l)if(l.hasOwnProperty(h)){var V=l[h];if(V!=null)switch(h){case"name":g=V;break;case"type":A=V;break;case"checked":D=V;break;case"defaultChecked":F=V;break;case"value":b=V;break;case"defaultValue":C=V;break;case"children":case"dangerouslySetInnerHTML":if(V!=null)throw Error(n(137,i));break;default:Xt(s,i,h,V,l,null)}}pp(s,b,C,D,F,A,g,!1);return;case"select":kt("invalid",s),h=A=b=null;for(g in l)if(l.hasOwnProperty(g)&&(C=l[g],C!=null))switch(g){case"value":b=C;break;case"defaultValue":A=C;break;case"multiple":h=C;default:Xt(s,i,g,C,l,null)}i=b,l=A,s.multiple=!!h,i!=null?nr(s,!!h,i,!1):l!=null&&nr(s,!!h,l,!0);return;case"textarea":kt("invalid",s),b=g=h=null;for(A in l)if(l.hasOwnProperty(A)&&(C=l[A],C!=null))switch(A){case"value":h=C;break;case"defaultValue":g=C;break;case"children":b=C;break;case"dangerouslySetInnerHTML":if(C!=null)throw Error(n(91));break;default:Xt(s,i,A,C,l,null)}mp(s,h,g,b);return;case"option":for(D in l)if(l.hasOwnProperty(D)&&(h=l[D],h!=null))switch(D){case"selected":s.selected=h&&typeof h!="function"&&typeof h!="symbol";break;default:Xt(s,i,D,h,l,null)}return;case"dialog":kt("beforetoggle",s),kt("toggle",s),kt("cancel",s),kt("close",s);break;case"iframe":case"object":kt("load",s);break;case"video":case"audio":for(h=0;h<Ha.length;h++)kt(Ha[h],s);break;case"image":kt("error",s),kt("load",s);break;case"details":kt("toggle",s);break;case"embed":case"source":case"link":kt("error",s),kt("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(F in l)if(l.hasOwnProperty(F)&&(h=l[F],h!=null))switch(F){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,i));default:Xt(s,i,F,h,l,null)}return;default:if(fu(i)){for(V in l)l.hasOwnProperty(V)&&(h=l[V],h!==void 0&&Zh(s,i,V,h,l,void 0));return}}for(C in l)l.hasOwnProperty(C)&&(h=l[C],h!=null&&Xt(s,i,C,h,l,null))}function tA(s,i,l,h){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,b=null,A=null,C=null,D=null,F=null,V=null;for(q in l){var K=l[q];if(l.hasOwnProperty(q)&&K!=null)switch(q){case"checked":break;case"value":break;case"defaultValue":D=K;default:h.hasOwnProperty(q)||Xt(s,i,q,null,h,K)}}for(var z in h){var q=h[z];if(K=l[z],h.hasOwnProperty(z)&&(q!=null||K!=null))switch(z){case"type":b=q;break;case"name":g=q;break;case"checked":F=q;break;case"defaultChecked":V=q;break;case"value":A=q;break;case"defaultValue":C=q;break;case"children":case"dangerouslySetInnerHTML":if(q!=null)throw Error(n(137,i));break;default:q!==K&&Xt(s,i,z,q,h,K)}}hu(s,A,C,D,F,V,b,g);return;case"select":q=A=C=z=null;for(b in l)if(D=l[b],l.hasOwnProperty(b)&&D!=null)switch(b){case"value":break;case"multiple":q=D;default:h.hasOwnProperty(b)||Xt(s,i,b,null,h,D)}for(g in h)if(b=h[g],D=l[g],h.hasOwnProperty(g)&&(b!=null||D!=null))switch(g){case"value":z=b;break;case"defaultValue":C=b;break;case"multiple":A=b;default:b!==D&&Xt(s,i,g,b,h,D)}i=C,l=A,h=q,z!=null?nr(s,!!l,z,!1):!!h!=!!l&&(i!=null?nr(s,!!l,i,!0):nr(s,!!l,l?[]:"",!1));return;case"textarea":q=z=null;for(C in l)if(g=l[C],l.hasOwnProperty(C)&&g!=null&&!h.hasOwnProperty(C))switch(C){case"value":break;case"children":break;default:Xt(s,i,C,null,h,g)}for(A in h)if(g=h[A],b=l[A],h.hasOwnProperty(A)&&(g!=null||b!=null))switch(A){case"value":z=g;break;case"defaultValue":q=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(n(91));break;default:g!==b&&Xt(s,i,A,g,h,b)}gp(s,z,q);return;case"option":for(var rt in l)if(z=l[rt],l.hasOwnProperty(rt)&&z!=null&&!h.hasOwnProperty(rt))switch(rt){case"selected":s.selected=!1;break;default:Xt(s,i,rt,null,h,z)}for(D in h)if(z=h[D],q=l[D],h.hasOwnProperty(D)&&z!==q&&(z!=null||q!=null))switch(D){case"selected":s.selected=z&&typeof z!="function"&&typeof z!="symbol";break;default:Xt(s,i,D,z,h,q)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var yt in l)z=l[yt],l.hasOwnProperty(yt)&&z!=null&&!h.hasOwnProperty(yt)&&Xt(s,i,yt,null,h,z);for(F in h)if(z=h[F],q=l[F],h.hasOwnProperty(F)&&z!==q&&(z!=null||q!=null))switch(F){case"children":case"dangerouslySetInnerHTML":if(z!=null)throw Error(n(137,i));break;default:Xt(s,i,F,z,h,q)}return;default:if(fu(i)){for(var Yt in l)z=l[Yt],l.hasOwnProperty(Yt)&&z!==void 0&&!h.hasOwnProperty(Yt)&&Zh(s,i,Yt,void 0,h,z);for(V in h)z=h[V],q=l[V],!h.hasOwnProperty(V)||z===q||z===void 0&&q===void 0||Zh(s,i,V,z,h,q);return}}for(var B in l)z=l[B],l.hasOwnProperty(B)&&z!=null&&!h.hasOwnProperty(B)&&Xt(s,i,B,null,h,z);for(K in h)z=h[K],q=l[K],!h.hasOwnProperty(K)||z===q||z==null&&q==null||Xt(s,i,K,z,h,q)}function v0(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function eA(){if(typeof performance.getEntriesByType=="function"){for(var s=0,i=0,l=performance.getEntriesByType("resource"),h=0;h<l.length;h++){var g=l[h],b=g.transferSize,A=g.initiatorType,C=g.duration;if(b&&C&&v0(A)){for(A=0,C=g.responseEnd,h+=1;h<l.length;h++){var D=l[h],F=D.startTime;if(F>C)break;var V=D.transferSize,K=D.initiatorType;V&&v0(K)&&(D=D.responseEnd,A+=V*(D<C?1:(C-F)/(D-F)))}if(--h,i+=8*(b+A)/(g.duration/1e3),s++,10<s)break}}if(0<s)return i/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var td=null,ed=null;function Gl(s){return s.nodeType===9?s:s.ownerDocument}function w0(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function _0(s,i){if(s===0)switch(i){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&i==="foreignObject"?0:s}function sd(s,i){return s==="textarea"||s==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.children=="bigint"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var nd=null;function sA(){var s=window.event;return s&&s.type==="popstate"?s===nd?!1:(nd=s,!0):(nd=null,!1)}var A0=typeof setTimeout=="function"?setTimeout:void 0,nA=typeof clearTimeout=="function"?clearTimeout:void 0,S0=typeof Promise=="function"?Promise:void 0,iA=typeof queueMicrotask=="function"?queueMicrotask:typeof S0<"u"?function(s){return S0.resolve(null).then(s).catch(rA)}:A0;function rA(s){setTimeout(function(){throw s})}function Kn(s){return s==="head"}function x0(s,i){var l=i,h=0;do{var g=l.nextSibling;if(s.removeChild(l),g&&g.nodeType===8)if(l=g.data,l==="/$"||l==="/&"){if(h===0){s.removeChild(g),Lr(i);return}h--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")h++;else if(l==="html")qa(s.ownerDocument.documentElement);else if(l==="head"){l=s.ownerDocument.head,qa(l);for(var b=l.firstChild;b;){var A=b.nextSibling,C=b.nodeName;b[la]||C==="SCRIPT"||C==="STYLE"||C==="LINK"&&b.rel.toLowerCase()==="stylesheet"||l.removeChild(b),b=A}}else l==="body"&&qa(s.ownerDocument.body);l=g}while(l);Lr(i)}function E0(s,i){var l=s;s=0;do{var h=l.nextSibling;if(l.nodeType===1?i?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(i?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),h&&h.nodeType===8)if(l=h.data,l==="/$"){if(s===0)break;s--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||s++;l=h}while(l)}function id(s){var i=s.firstChild;for(i&&i.nodeType===10&&(i=i.nextSibling);i;){var l=i;switch(i=i.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":id(l),cu(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}s.removeChild(l)}}function aA(s,i,l,h){for(;s.nodeType===1;){var g=l;if(s.nodeName.toLowerCase()!==i.toLowerCase()){if(!h&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(h){if(!s[la])switch(i){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(b=s.getAttribute("rel"),b==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(b!==g.rel||s.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||s.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||s.getAttribute("title")!==(g.title==null?null:g.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(b=s.getAttribute("src"),(b!==(g.src==null?null:g.src)||s.getAttribute("type")!==(g.type==null?null:g.type)||s.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&b&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(i==="input"&&s.type==="hidden"){var b=g.name==null?null:""+g.name;if(g.type==="hidden"&&s.getAttribute("name")===b)return s}else return s;if(s=Cs(s.nextSibling),s===null)break}return null}function oA(s,i,l){if(i==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!l||(s=Cs(s.nextSibling),s===null))return null;return s}function T0(s,i){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!i||(s=Cs(s.nextSibling),s===null))return null;return s}function rd(s){return s.data==="$?"||s.data==="$~"}function ad(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function lA(s,i){var l=s.ownerDocument;if(s.data==="$~")s._reactRetry=i;else if(s.data!=="$?"||l.readyState!=="loading")i();else{var h=function(){i(),l.removeEventListener("DOMContentLoaded",h)};l.addEventListener("DOMContentLoaded",h),s._reactRetry=h}}function Cs(s){for(;s!=null;s=s.nextSibling){var i=s.nodeType;if(i===1||i===3)break;if(i===8){if(i=s.data,i==="$"||i==="$!"||i==="$?"||i==="$~"||i==="&"||i==="F!"||i==="F")break;if(i==="/$"||i==="/&")return null}}return s}var od=null;function C0(s){s=s.nextSibling;for(var i=0;s;){if(s.nodeType===8){var l=s.data;if(l==="/$"||l==="/&"){if(i===0)return Cs(s.nextSibling);i--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||i++}s=s.nextSibling}return null}function R0(s){s=s.previousSibling;for(var i=0;s;){if(s.nodeType===8){var l=s.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(i===0)return s;i--}else l!=="/$"&&l!=="/&"||i++}s=s.previousSibling}return null}function O0(s,i,l){switch(i=Gl(l),s){case"html":if(s=i.documentElement,!s)throw Error(n(452));return s;case"head":if(s=i.head,!s)throw Error(n(453));return s;case"body":if(s=i.body,!s)throw Error(n(454));return s;default:throw Error(n(451))}}function qa(s){for(var i=s.attributes;i.length;)s.removeAttributeNode(i[0]);cu(s)}var Rs=new Map,N0=new Set;function Vl(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var xn=$.d;$.d={f:cA,r:uA,D:hA,C:dA,L:fA,m:pA,X:mA,S:gA,M:bA};function cA(){var s=xn.f(),i=Bl();return s||i}function uA(s){var i=tr(s);i!==null&&i.tag===5&&i.type==="form"?Xg(i):xn.r(s)}var Dr=typeof document>"u"?null:document;function k0(s,i,l){var h=Dr;if(h&&typeof i=="string"&&i){var g=ws(i);g='link[rel="'+s+'"][href="'+g+'"]',typeof l=="string"&&(g+='[crossorigin="'+l+'"]'),N0.has(g)||(N0.add(g),s={rel:s,crossOrigin:l,href:i},h.querySelector(g)===null&&(i=h.createElement("link"),ke(i,"link",s),Se(i),h.head.appendChild(i)))}}function hA(s){xn.D(s),k0("dns-prefetch",s,null)}function dA(s,i){xn.C(s,i),k0("preconnect",s,i)}function fA(s,i,l){xn.L(s,i,l);var h=Dr;if(h&&s&&i){var g='link[rel="preload"][as="'+ws(i)+'"]';i==="image"&&l&&l.imageSrcSet?(g+='[imagesrcset="'+ws(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(g+='[imagesizes="'+ws(l.imageSizes)+'"]')):g+='[href="'+ws(s)+'"]';var b=g;switch(i){case"style":b=Mr(s);break;case"script":b=jr(s)}Rs.has(b)||(s=m({rel:"preload",href:i==="image"&&l&&l.imageSrcSet?void 0:s,as:i},l),Rs.set(b,s),h.querySelector(g)!==null||i==="style"&&h.querySelector(Ga(b))||i==="script"&&h.querySelector(Va(b))||(i=h.createElement("link"),ke(i,"link",s),Se(i),h.head.appendChild(i)))}}function pA(s,i){xn.m(s,i);var l=Dr;if(l&&s){var h=i&&typeof i.as=="string"?i.as:"script",g='link[rel="modulepreload"][as="'+ws(h)+'"][href="'+ws(s)+'"]',b=g;switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=jr(s)}if(!Rs.has(b)&&(s=m({rel:"modulepreload",href:s},i),Rs.set(b,s),l.querySelector(g)===null)){switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(Va(b)))return}h=l.createElement("link"),ke(h,"link",s),Se(h),l.head.appendChild(h)}}}function gA(s,i,l){xn.S(s,i,l);var h=Dr;if(h&&s){var g=er(h).hoistableStyles,b=Mr(s);i=i||"default";var A=g.get(b);if(!A){var C={loading:0,preload:null};if(A=h.querySelector(Ga(b)))C.loading=5;else{s=m({rel:"stylesheet",href:s,"data-precedence":i},l),(l=Rs.get(b))&&ld(s,l);var D=A=h.createElement("link");Se(D),ke(D,"link",s),D._p=new Promise(function(F,V){D.onload=F,D.onerror=V}),D.addEventListener("load",function(){C.loading|=1}),D.addEventListener("error",function(){C.loading|=2}),C.loading|=4,Xl(A,i,h)}A={type:"stylesheet",instance:A,count:1,state:C},g.set(b,A)}}}function mA(s,i){xn.X(s,i);var l=Dr;if(l&&s){var h=er(l).hoistableScripts,g=jr(s),b=h.get(g);b||(b=l.querySelector(Va(g)),b||(s=m({src:s,async:!0},i),(i=Rs.get(g))&&cd(s,i),b=l.createElement("script"),Se(b),ke(b,"link",s),l.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},h.set(g,b))}}function bA(s,i){xn.M(s,i);var l=Dr;if(l&&s){var h=er(l).hoistableScripts,g=jr(s),b=h.get(g);b||(b=l.querySelector(Va(g)),b||(s=m({src:s,async:!0,type:"module"},i),(i=Rs.get(g))&&cd(s,i),b=l.createElement("script"),Se(b),ke(b,"link",s),l.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},h.set(g,b))}}function D0(s,i,l,h){var g=(g=bt.current)?Vl(g):null;if(!g)throw Error(n(446));switch(s){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(i=Mr(l.href),l=er(g).hoistableStyles,h=l.get(i),h||(h={type:"style",instance:null,count:0,state:null},l.set(i,h)),h):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){s=Mr(l.href);var b=er(g).hoistableStyles,A=b.get(s);if(A||(g=g.ownerDocument||g,A={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(s,A),(b=g.querySelector(Ga(s)))&&!b._p&&(A.instance=b,A.state.loading=5),Rs.has(s)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},Rs.set(s,l),b||yA(g,s,l,A.state))),i&&h===null)throw Error(n(528,""));return A}if(i&&h!==null)throw Error(n(529,""));return null;case"script":return i=l.async,l=l.src,typeof l=="string"&&i&&typeof i!="function"&&typeof i!="symbol"?(i=jr(l),l=er(g).hoistableScripts,h=l.get(i),h||(h={type:"script",instance:null,count:0,state:null},l.set(i,h)),h):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,s))}}function Mr(s){return'href="'+ws(s)+'"'}function Ga(s){return'link[rel="stylesheet"]['+s+"]"}function M0(s){return m({},s,{"data-precedence":s.precedence,precedence:null})}function yA(s,i,l,h){s.querySelector('link[rel="preload"][as="style"]['+i+"]")?h.loading=1:(i=s.createElement("link"),h.preload=i,i.addEventListener("load",function(){return h.loading|=1}),i.addEventListener("error",function(){return h.loading|=2}),ke(i,"link",l),Se(i),s.head.appendChild(i))}function jr(s){return'[src="'+ws(s)+'"]'}function Va(s){return"script[async]"+s}function j0(s,i,l){if(i.count++,i.instance===null)switch(i.type){case"style":var h=s.querySelector('style[data-href~="'+ws(l.href)+'"]');if(h)return i.instance=h,Se(h),h;var g=m({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return h=(s.ownerDocument||s).createElement("style"),Se(h),ke(h,"style",g),Xl(h,l.precedence,s),i.instance=h;case"stylesheet":g=Mr(l.href);var b=s.querySelector(Ga(g));if(b)return i.state.loading|=4,i.instance=b,Se(b),b;h=M0(l),(g=Rs.get(g))&&ld(h,g),b=(s.ownerDocument||s).createElement("link"),Se(b);var A=b;return A._p=new Promise(function(C,D){A.onload=C,A.onerror=D}),ke(b,"link",h),i.state.loading|=4,Xl(b,l.precedence,s),i.instance=b;case"script":return b=jr(l.src),(g=s.querySelector(Va(b)))?(i.instance=g,Se(g),g):(h=l,(g=Rs.get(b))&&(h=m({},l),cd(h,g)),s=s.ownerDocument||s,g=s.createElement("script"),Se(g),ke(g,"link",h),s.head.appendChild(g),i.instance=g);case"void":return null;default:throw Error(n(443,i.type))}else i.type==="stylesheet"&&(i.state.loading&4)===0&&(h=i.instance,i.state.loading|=4,Xl(h,l.precedence,s));return i.instance}function Xl(s,i,l){for(var h=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=h.length?h[h.length-1]:null,b=g,A=0;A<h.length;A++){var C=h[A];if(C.dataset.precedence===i)b=C;else if(b!==g)break}b?b.parentNode.insertBefore(s,b.nextSibling):(i=l.nodeType===9?l.head:l,i.insertBefore(s,i.firstChild))}function ld(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.title==null&&(s.title=i.title)}function cd(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.integrity==null&&(s.integrity=i.integrity)}var Yl=null;function L0(s,i,l){if(Yl===null){var h=new Map,g=Yl=new Map;g.set(l,h)}else g=Yl,h=g.get(l),h||(h=new Map,g.set(l,h));if(h.has(s))return h;for(h.set(s,null),l=l.getElementsByTagName(s),g=0;g<l.length;g++){var b=l[g];if(!(b[la]||b[Ce]||s==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var A=b.getAttribute(i)||"";A=s+A;var C=h.get(A);C?C.push(b):h.set(A,[b])}}return h}function P0(s,i,l){s=s.ownerDocument||s,s.head.insertBefore(l,i==="title"?s.querySelector("head > title"):null)}function vA(s,i,l){if(l===1||i.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof i.precedence!="string"||typeof i.href!="string"||i.href==="")break;return!0;case"link":if(typeof i.rel!="string"||typeof i.href!="string"||i.href===""||i.onLoad||i.onError)break;switch(i.rel){case"stylesheet":return s=i.disabled,typeof i.precedence=="string"&&s==null;default:return!0}case"script":if(i.async&&typeof i.async!="function"&&typeof i.async!="symbol"&&!i.onLoad&&!i.onError&&i.src&&typeof i.src=="string")return!0}return!1}function B0(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function wA(s,i,l,h){if(l.type==="stylesheet"&&(typeof h.media!="string"||matchMedia(h.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var g=Mr(h.href),b=i.querySelector(Ga(g));if(b){i=b._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(s.count++,s=Kl.bind(s),i.then(s,s)),l.state.loading|=4,l.instance=b,Se(b);return}b=i.ownerDocument||i,h=M0(h),(g=Rs.get(g))&&ld(h,g),b=b.createElement("link"),Se(b);var A=b;A._p=new Promise(function(C,D){A.onload=C,A.onerror=D}),ke(b,"link",h),l.instance=b}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(l,i),(i=l.state.preload)&&(l.state.loading&3)===0&&(s.count++,l=Kl.bind(s),i.addEventListener("load",l),i.addEventListener("error",l))}}var ud=0;function _A(s,i){return s.stylesheets&&s.count===0&&Ql(s,s.stylesheets),0<s.count||0<s.imgCount?function(l){var h=setTimeout(function(){if(s.stylesheets&&Ql(s,s.stylesheets),s.unsuspend){var b=s.unsuspend;s.unsuspend=null,b()}},6e4+i);0<s.imgBytes&&ud===0&&(ud=62500*eA());var g=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&Ql(s,s.stylesheets),s.unsuspend)){var b=s.unsuspend;s.unsuspend=null,b()}},(s.imgBytes>ud?50:800)+i);return s.unsuspend=l,function(){s.unsuspend=null,clearTimeout(h),clearTimeout(g)}}:null}function Kl(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Ql(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Wl=null;function Ql(s,i){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Wl=new Map,i.forEach(AA,s),Wl=null,Kl.call(s))}function AA(s,i){if(!(i.state.loading&4)){var l=Wl.get(s);if(l)var h=l.get(null);else{l=new Map,Wl.set(s,l);for(var g=s.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<g.length;b++){var A=g[b];(A.nodeName==="LINK"||A.getAttribute("media")!=="not all")&&(l.set(A.dataset.precedence,A),h=A)}h&&l.set(null,h)}g=i.instance,A=g.getAttribute("data-precedence"),b=l.get(A)||h,b===h&&l.set(null,g),l.set(A,g),this.count++,h=Kl.bind(this),g.addEventListener("load",h),g.addEventListener("error",h),b?b.parentNode.insertBefore(g,b.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(g,s.firstChild)),i.state.loading|=4}}var Xa={$$typeof:T,Provider:null,Consumer:null,_currentValue:tt,_currentValue2:tt,_threadCount:0};function SA(s,i,l,h,g,b,A,C,D){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ct(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ct(0),this.hiddenUpdates=ct(null),this.identifierPrefix=h,this.onUncaughtError=g,this.onCaughtError=b,this.onRecoverableError=A,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=D,this.incompleteTransitions=new Map}function I0(s,i,l,h,g,b,A,C,D,F,V,K){return s=new SA(s,i,l,A,D,F,V,K,C),i=1,b===!0&&(i|=24),b=cs(3,null,null,i),s.current=b,b.stateNode=s,i=$u(),i.refCount++,s.pooledCache=i,i.refCount++,b.memoizedState={element:h,isDehydrated:l,cache:i},Xu(b),s}function U0(s){return s?(s=hr,s):hr}function F0(s,i,l,h,g,b){g=U0(g),h.context===null?h.context=g:h.pendingContext=g,h=In(i),h.payload={element:l},b=b===void 0?null:b,b!==null&&(h.callback=b),l=Un(s,h,i),l!==null&&(ss(l,s,i),Ea(l,s,i))}function z0(s,i){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var l=s.retryLane;s.retryLane=l!==0&&l<i?l:i}}function hd(s,i){z0(s,i),(s=s.alternate)&&z0(s,i)}function H0(s){if(s.tag===13||s.tag===31){var i=mi(s,67108864);i!==null&&ss(i,s,67108864),hd(s,67108864)}}function $0(s){if(s.tag===13||s.tag===31){var i=ps();i=au(i);var l=mi(s,i);l!==null&&ss(l,s,i),hd(s,i)}}var Jl=!0;function xA(s,i,l,h){var g=P.T;P.T=null;var b=$.p;try{$.p=2,dd(s,i,l,h)}finally{$.p=b,P.T=g}}function EA(s,i,l,h){var g=P.T;P.T=null;var b=$.p;try{$.p=8,dd(s,i,l,h)}finally{$.p=b,P.T=g}}function dd(s,i,l,h){if(Jl){var g=fd(h);if(g===null)Jh(s,i,h,Zl,l),G0(s,h);else if(CA(g,s,i,l,h))h.stopPropagation();else if(G0(s,h),i&4&&-1<TA.indexOf(s)){for(;g!==null;){var b=tr(g);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var A=an(b.pendingLanes);if(A!==0){var C=b;for(C.pendingLanes|=2,C.entangledLanes|=2;A;){var D=1<<31-qe(A);C.entanglements[1]|=D,A&=~D}Ys(b),(Ft&6)===0&&(Ll=Fe()+500,za(0))}}break;case 31:case 13:C=mi(b,2),C!==null&&ss(C,b,2),Bl(),hd(b,2)}if(b=fd(h),b===null&&Jh(s,i,h,Zl,l),b===g)break;g=b}g!==null&&h.stopPropagation()}else Jh(s,i,h,null,l)}}function fd(s){return s=gu(s),pd(s)}var Zl=null;function pd(s){if(Zl=null,s=Zi(s),s!==null){var i=a(s);if(i===null)s=null;else{var l=i.tag;if(l===13){if(s=o(i),s!==null)return s;s=null}else if(l===31){if(s=u(i),s!==null)return s;s=null}else if(l===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;s=null}else i!==s&&(s=null)}}return Zl=s,null}function q0(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(su()){case Fo:return 2;case zo:return 8;case Xi:case nu:return 32;case Ho:return 268435456;default:return 32}default:return 32}}var gd=!1,Wn=null,Qn=null,Jn=null,Ya=new Map,Ka=new Map,Zn=[],TA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function G0(s,i){switch(s){case"focusin":case"focusout":Wn=null;break;case"dragenter":case"dragleave":Qn=null;break;case"mouseover":case"mouseout":Jn=null;break;case"pointerover":case"pointerout":Ya.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ka.delete(i.pointerId)}}function Wa(s,i,l,h,g,b){return s===null||s.nativeEvent!==b?(s={blockedOn:i,domEventName:l,eventSystemFlags:h,nativeEvent:b,targetContainers:[g]},i!==null&&(i=tr(i),i!==null&&H0(i)),s):(s.eventSystemFlags|=h,i=s.targetContainers,g!==null&&i.indexOf(g)===-1&&i.push(g),s)}function CA(s,i,l,h,g){switch(i){case"focusin":return Wn=Wa(Wn,s,i,l,h,g),!0;case"dragenter":return Qn=Wa(Qn,s,i,l,h,g),!0;case"mouseover":return Jn=Wa(Jn,s,i,l,h,g),!0;case"pointerover":var b=g.pointerId;return Ya.set(b,Wa(Ya.get(b)||null,s,i,l,h,g)),!0;case"gotpointercapture":return b=g.pointerId,Ka.set(b,Wa(Ka.get(b)||null,s,i,l,h,g)),!0}return!1}function V0(s){var i=Zi(s.target);if(i!==null){var l=a(i);if(l!==null){if(i=l.tag,i===13){if(i=o(l),i!==null){s.blockedOn=i,ap(s.priority,function(){$0(l)});return}}else if(i===31){if(i=u(l),i!==null){s.blockedOn=i,ap(s.priority,function(){$0(l)});return}}else if(i===3&&l.stateNode.current.memoizedState.isDehydrated){s.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}s.blockedOn=null}function tc(s){if(s.blockedOn!==null)return!1;for(var i=s.targetContainers;0<i.length;){var l=fd(s.nativeEvent);if(l===null){l=s.nativeEvent;var h=new l.constructor(l.type,l);pu=h,l.target.dispatchEvent(h),pu=null}else return i=tr(l),i!==null&&H0(i),s.blockedOn=l,!1;i.shift()}return!0}function X0(s,i,l){tc(s)&&l.delete(i)}function RA(){gd=!1,Wn!==null&&tc(Wn)&&(Wn=null),Qn!==null&&tc(Qn)&&(Qn=null),Jn!==null&&tc(Jn)&&(Jn=null),Ya.forEach(X0),Ka.forEach(X0)}function ec(s,i){s.blockedOn===i&&(s.blockedOn=null,gd||(gd=!0,c.unstable_scheduleCallback(c.unstable_NormalPriority,RA)))}var sc=null;function Y0(s){sc!==s&&(sc=s,c.unstable_scheduleCallback(c.unstable_NormalPriority,function(){sc===s&&(sc=null);for(var i=0;i<s.length;i+=3){var l=s[i],h=s[i+1],g=s[i+2];if(typeof h!="function"){if(pd(h||l)===null)continue;break}var b=tr(l);b!==null&&(s.splice(i,3),i-=3,fh(b,{pending:!0,data:g,method:l.method,action:h},h,g))}}))}function Lr(s){function i(D){return ec(D,s)}Wn!==null&&ec(Wn,s),Qn!==null&&ec(Qn,s),Jn!==null&&ec(Jn,s),Ya.forEach(i),Ka.forEach(i);for(var l=0;l<Zn.length;l++){var h=Zn[l];h.blockedOn===s&&(h.blockedOn=null)}for(;0<Zn.length&&(l=Zn[0],l.blockedOn===null);)V0(l),l.blockedOn===null&&Zn.shift();if(l=(s.ownerDocument||s).$$reactFormReplay,l!=null)for(h=0;h<l.length;h+=3){var g=l[h],b=l[h+1],A=g[We]||null;if(typeof b=="function")A||Y0(l);else if(A){var C=null;if(b&&b.hasAttribute("formAction")){if(g=b,A=b[We]||null)C=A.formAction;else if(pd(g)!==null)continue}else C=A.action;typeof C=="function"?l[h+1]=C:(l.splice(h,3),h-=3),Y0(l)}}}function K0(){function s(b){b.canIntercept&&b.info==="react-transition"&&b.intercept({handler:function(){return new Promise(function(A){return g=A})},focusReset:"manual",scroll:"manual"})}function i(){g!==null&&(g(),g=null),h||setTimeout(l,20)}function l(){if(!h&&!navigation.transition){var b=navigation.currentEntry;b&&b.url!=null&&navigation.navigate(b.url,{state:b.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var h=!1,g=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",i),navigation.addEventListener("navigateerror",i),setTimeout(l,100),function(){h=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",i),navigation.removeEventListener("navigateerror",i),g!==null&&(g(),g=null)}}}function md(s){this._internalRoot=s}nc.prototype.render=md.prototype.render=function(s){var i=this._internalRoot;if(i===null)throw Error(n(409));var l=i.current,h=ps();F0(l,h,s,i,null,null)},nc.prototype.unmount=md.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var i=s.containerInfo;F0(s.current,2,null,s,null,null),Bl(),i[Ji]=null}};function nc(s){this._internalRoot=s}nc.prototype.unstable_scheduleHydration=function(s){if(s){var i=rp();s={blockedOn:null,target:s,priority:i};for(var l=0;l<Zn.length&&i!==0&&i<Zn[l].priority;l++);Zn.splice(l,0,s),l===0&&V0(s)}};var W0=t.version;if(W0!=="19.2.1")throw Error(n(527,W0,"19.2.1"));$.findDOMNode=function(s){var i=s._reactInternals;if(i===void 0)throw typeof s.render=="function"?Error(n(188)):(s=Object.keys(s).join(","),Error(n(268,s)));return s=f(i),s=s!==null?p(s):null,s=s===null?null:s.stateNode,s};var OA={bundleType:0,version:"19.2.1",rendererPackageName:"react-dom",currentDispatcherRef:P,reconcilerVersion:"19.2.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ic=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ic.isDisabled&&ic.supportsFiber)try{ui=ic.inject(OA),$e=ic}catch{}}return Ja.createRoot=function(s,i){if(!r(s))throw Error(n(299));var l=!1,h="",g=nm,b=im,A=rm;return i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(h=i.identifierPrefix),i.onUncaughtError!==void 0&&(g=i.onUncaughtError),i.onCaughtError!==void 0&&(b=i.onCaughtError),i.onRecoverableError!==void 0&&(A=i.onRecoverableError)),i=I0(s,1,!1,null,null,l,h,null,g,b,A,K0),s[Ji]=i.current,Qh(s),new md(i)},Ja.hydrateRoot=function(s,i,l){if(!r(s))throw Error(n(299));var h=!1,g="",b=nm,A=im,C=rm,D=null;return l!=null&&(l.unstable_strictMode===!0&&(h=!0),l.identifierPrefix!==void 0&&(g=l.identifierPrefix),l.onUncaughtError!==void 0&&(b=l.onUncaughtError),l.onCaughtError!==void 0&&(A=l.onCaughtError),l.onRecoverableError!==void 0&&(C=l.onRecoverableError),l.formState!==void 0&&(D=l.formState)),i=I0(s,1,!0,i,l??null,h,g,D,b,A,C,K0),i.context=U0(null),l=i.current,h=ps(),h=au(h),g=In(h),g.callback=null,Un(l,g,h),l=h,i.current.lanes=l,Bt(i,l),Ys(i),s[Ji]=i.current,Qh(s),new nc(i)},Ja.version="19.2.1",Ja}var lb;function FA(){if(lb)return wd.exports;lb=1;function c(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c)}catch(t){console.error(t)}}return c(),wd.exports=UA(),wd.exports}var zA=FA(),En={},rc={},$d=function(c,t){return $d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])},$d(c,t)};function by(c,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");$d(c,t);function e(){this.constructor=c}c.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var kc=function(){return kc=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},kc.apply(this,arguments)};function ia(c,t){var e={};for(var n in c)Object.prototype.hasOwnProperty.call(c,n)&&t.indexOf(n)<0&&(e[n]=c[n]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(c);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(c,n[r])&&(e[n[r]]=c[n[r]]);return e}function yy(c,t,e,n){var r=arguments.length,a=r<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(c,t,e,n);else for(var u=c.length-1;u>=0;u--)(o=c[u])&&(a=(r<3?o(a):r>3?o(t,e,a):o(t,e))||a);return r>3&&a&&Object.defineProperty(t,e,a),a}function vy(c,t){return function(e,n){t(e,n,c)}}function wy(c,t,e,n,r,a){function o(E){if(E!==void 0&&typeof E!="function")throw new TypeError("Function expected");return E}for(var u=n.kind,d=u==="getter"?"get":u==="setter"?"set":"value",f=!t&&c?n.static?c:c.prototype:null,p=t||(f?Object.getOwnPropertyDescriptor(f,n.name):{}),m,y=!1,v=e.length-1;v>=0;v--){var _={};for(var w in n)_[w]=w==="access"?{}:n[w];for(var w in n.access)_.access[w]=n.access[w];_.addInitializer=function(E){if(y)throw new TypeError("Cannot add initializers after decoration has completed");a.push(o(E||null))};var S=(0,e[v])(u==="accessor"?{get:p.get,set:p.set}:p[d],_);if(u==="accessor"){if(S===void 0)continue;if(S===null||typeof S!="object")throw new TypeError("Object expected");(m=o(S.get))&&(p.get=m),(m=o(S.set))&&(p.set=m),(m=o(S.init))&&r.unshift(m)}else(m=o(S))&&(u==="field"?r.unshift(m):p[d]=m)}f&&Object.defineProperty(f,n.name,p),y=!0}function _y(c,t,e){for(var n=arguments.length>2,r=0;r<t.length;r++)e=n?t[r].call(c,e):t[r].call(c);return n?e:void 0}function Ay(c){return typeof c=="symbol"?c:"".concat(c)}function Sy(c,t,e){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(c,"name",{configurable:!0,value:e?"".concat(e," ",t):t})}function xy(c,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(c,t)}function it(c,t,e,n){function r(a){return a instanceof e?a:new e(function(o){o(a)})}return new(e||(e=Promise))(function(a,o){function u(p){try{f(n.next(p))}catch(m){o(m)}}function d(p){try{f(n.throw(p))}catch(m){o(m)}}function f(p){p.done?a(p.value):r(p.value).then(u,d)}f((n=n.apply(c,t||[])).next())})}function Ey(c,t){var e={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,r,a,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=u(0),o.throw=u(1),o.return=u(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(f){return function(p){return d([f,p])}}function d(f){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,f[0]&&(e=0)),e;)try{if(n=1,r&&(a=f[0]&2?r.return:f[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,f[1])).done)return a;switch(r=0,a&&(f=[f[0]&2,a.value]),f[0]){case 0:case 1:a=f;break;case 4:return e.label++,{value:f[1],done:!1};case 5:e.label++,r=f[1],f=[0];continue;case 7:f=e.ops.pop(),e.trys.pop();continue;default:if(a=e.trys,!(a=a.length>0&&a[a.length-1])&&(f[0]===6||f[0]===2)){e=0;continue}if(f[0]===3&&(!a||f[1]>a[0]&&f[1]<a[3])){e.label=f[1];break}if(f[0]===6&&e.label<a[1]){e.label=a[1],a=f;break}if(a&&e.label<a[2]){e.label=a[2],e.ops.push(f);break}a[2]&&e.ops.pop(),e.trys.pop();continue}f=t.call(c,e)}catch(p){f=[6,p],r=0}finally{n=a=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}var qc=Object.create?(function(c,t,e,n){n===void 0&&(n=e);var r=Object.getOwnPropertyDescriptor(t,e);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(c,n,r)}):(function(c,t,e,n){n===void 0&&(n=e),c[n]=t[e]});function Ty(c,t){for(var e in c)e!=="default"&&!Object.prototype.hasOwnProperty.call(t,e)&&qc(t,c,e)}function Dc(c){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&c[t],n=0;if(e)return e.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&n>=c.length&&(c=void 0),{value:c&&c[n++],done:!c}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Rf(c,t){var e=typeof Symbol=="function"&&c[Symbol.iterator];if(!e)return c;var n=e.call(c),r,a=[],o;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)a.push(r.value)}catch(u){o={error:u}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(o)throw o.error}}return a}function Cy(){for(var c=[],t=0;t<arguments.length;t++)c=c.concat(Rf(arguments[t]));return c}function Ry(){for(var c=0,t=0,e=arguments.length;t<e;t++)c+=arguments[t].length;for(var n=Array(c),r=0,t=0;t<e;t++)for(var a=arguments[t],o=0,u=a.length;o<u;o++,r++)n[r]=a[o];return n}function Oy(c,t,e){if(e||arguments.length===2)for(var n=0,r=t.length,a;n<r;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return c.concat(a||Array.prototype.slice.call(t))}function ea(c){return this instanceof ea?(this.v=c,this):new ea(c)}function Ny(c,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(c,t||[]),r,a=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",o),r[Symbol.asyncIterator]=function(){return this},r;function o(v){return function(_){return Promise.resolve(_).then(v,m)}}function u(v,_){n[v]&&(r[v]=function(w){return new Promise(function(S,E){a.push([v,w,S,E])>1||d(v,w)})},_&&(r[v]=_(r[v])))}function d(v,_){try{f(n[v](_))}catch(w){y(a[0][3],w)}}function f(v){v.value instanceof ea?Promise.resolve(v.value.v).then(p,m):y(a[0][2],v)}function p(v){d("next",v)}function m(v){d("throw",v)}function y(v,_){v(_),a.shift(),a.length&&d(a[0][0],a[0][1])}}function ky(c){var t,e;return t={},n("next"),n("throw",function(r){throw r}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(r,a){t[r]=c[r]?function(o){return(e=!e)?{value:ea(c[r](o)),done:!1}:a?a(o):o}:a}}function Dy(c){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=c[Symbol.asyncIterator],e;return t?t.call(c):(c=typeof Dc=="function"?Dc(c):c[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(a){e[a]=c[a]&&function(o){return new Promise(function(u,d){o=c[a](o),r(u,d,o.done,o.value)})}}function r(a,o,u,d){Promise.resolve(d).then(function(f){a({value:f,done:u})},o)}}function My(c,t){return Object.defineProperty?Object.defineProperty(c,"raw",{value:t}):c.raw=t,c}var HA=Object.create?(function(c,t){Object.defineProperty(c,"default",{enumerable:!0,value:t})}):function(c,t){c.default=t},qd=function(c){return qd=Object.getOwnPropertyNames||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[e.length]=n);return e},qd(c)};function jy(c){if(c&&c.__esModule)return c;var t={};if(c!=null)for(var e=qd(c),n=0;n<e.length;n++)e[n]!=="default"&&qc(t,c,e[n]);return HA(t,c),t}function Ly(c){return c&&c.__esModule?c:{default:c}}function Py(c,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?c!==t||!n:!t.has(c))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(c):n?n.value:t.get(c)}function By(c,t,e,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?c!==t||!r:!t.has(c))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(c,e):r?r.value=e:t.set(c,e),e}function Iy(c,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof c=="function"?t===c:c.has(t)}function Uy(c,t,e){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var n,r;if(e){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=t[Symbol.asyncDispose]}if(n===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=t[Symbol.dispose],e&&(r=n)}if(typeof n!="function")throw new TypeError("Object not disposable.");r&&(n=function(){try{r.call(this)}catch(a){return Promise.reject(a)}}),c.stack.push({value:t,dispose:n,async:e})}else e&&c.stack.push({async:!0});return t}var $A=typeof SuppressedError=="function"?SuppressedError:function(c,t,e){var n=new Error(e);return n.name="SuppressedError",n.error=c,n.suppressed=t,n};function Fy(c){function t(a){c.error=c.hasError?new $A(a,c.error,"An error was suppressed during disposal."):a,c.hasError=!0}var e,n=0;function r(){for(;e=c.stack.pop();)try{if(!e.async&&n===1)return n=0,c.stack.push(e),Promise.resolve().then(r);if(e.dispose){var a=e.dispose.call(e.value);if(e.async)return n|=2,Promise.resolve(a).then(r,function(o){return t(o),r()})}else n|=1}catch(o){t(o)}if(n===1)return c.hasError?Promise.reject(c.error):Promise.resolve();if(c.hasError)throw c.error}return r()}function zy(c,t){return typeof c=="string"&&/^\.\.?\//.test(c)?c.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(e,n,r,a,o){return n?t?".jsx":".js":r&&(!a||!o)?e:r+a+"."+o.toLowerCase()+"js"}):c}const qA={__extends:by,__assign:kc,__rest:ia,__decorate:yy,__param:vy,__esDecorate:wy,__runInitializers:_y,__propKey:Ay,__setFunctionName:Sy,__metadata:xy,__awaiter:it,__generator:Ey,__createBinding:qc,__exportStar:Ty,__values:Dc,__read:Rf,__spread:Cy,__spreadArrays:Ry,__spreadArray:Oy,__await:ea,__asyncGenerator:Ny,__asyncDelegator:ky,__asyncValues:Dy,__makeTemplateObject:My,__importStar:jy,__importDefault:Ly,__classPrivateFieldGet:Py,__classPrivateFieldSet:By,__classPrivateFieldIn:Iy,__addDisposableResource:Uy,__disposeResources:Fy,__rewriteRelativeImportExtension:zy},GA=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:Uy,get __assign(){return kc},__asyncDelegator:ky,__asyncGenerator:Ny,__asyncValues:Dy,__await:ea,__awaiter:it,__classPrivateFieldGet:Py,__classPrivateFieldIn:Iy,__classPrivateFieldSet:By,__createBinding:qc,__decorate:yy,__disposeResources:Fy,__esDecorate:wy,__exportStar:Ty,__extends:by,__generator:Ey,__importDefault:Ly,__importStar:jy,__makeTemplateObject:My,__metadata:xy,__param:vy,__propKey:Ay,__read:Rf,__rest:ia,__rewriteRelativeImportExtension:zy,__runInitializers:_y,__setFunctionName:Sy,__spread:Cy,__spreadArray:Oy,__spreadArrays:Ry,__values:Dc,default:qA},Symbol.toStringTag,{value:"Module"})),VA=c=>c?(...t)=>c(...t):(...t)=>fetch(...t);let Gc=class extends Error{constructor(t,e="FunctionsError",n){super(t),this.name=e,this.context=n}},Hy=class extends Gc{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}},Gd=class extends Gc{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}},Vd=class extends Gc{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}};var Mc;(function(c){c.Any="any",c.ApNortheast1="ap-northeast-1",c.ApNortheast2="ap-northeast-2",c.ApSouth1="ap-south-1",c.ApSoutheast1="ap-southeast-1",c.ApSoutheast2="ap-southeast-2",c.CaCentral1="ca-central-1",c.EuCentral1="eu-central-1",c.EuWest1="eu-west-1",c.EuWest2="eu-west-2",c.EuWest3="eu-west-3",c.SaEast1="sa-east-1",c.UsEast1="us-east-1",c.UsWest1="us-west-1",c.UsWest2="us-west-2"})(Mc||(Mc={}));class XA{constructor(t,{headers:e={},customFetch:n,region:r=Mc.Any}={}){this.url=t,this.headers=e,this.region=r,this.fetch=VA(n)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return it(this,arguments,void 0,function*(e,n={}){var r;let a,o;try{const{headers:u,method:d,body:f,signal:p,timeout:m}=n;let y={},{region:v}=n;v||(v=this.region);const _=new URL(`${this.url}/${e}`);v&&v!=="any"&&(y["x-region"]=v,_.searchParams.set("forceFunctionRegion",v));let w;f&&(u&&!Object.prototype.hasOwnProperty.call(u,"Content-Type")||!u)?typeof Blob<"u"&&f instanceof Blob||f instanceof ArrayBuffer?(y["Content-Type"]="application/octet-stream",w=f):typeof f=="string"?(y["Content-Type"]="text/plain",w=f):typeof FormData<"u"&&f instanceof FormData?w=f:(y["Content-Type"]="application/json",w=JSON.stringify(f)):w=f;let S=p;m&&(o=new AbortController,a=setTimeout(()=>o.abort(),m),p?(S=o.signal,p.addEventListener("abort",()=>o.abort())):S=o.signal);const E=yield this.fetch(_.toString(),{method:d||"POST",headers:Object.assign(Object.assign(Object.assign({},y),this.headers),u),body:w,signal:S}).catch(N=>{throw new Hy(N)}),R=E.headers.get("x-relay-error");if(R&&R==="true")throw new Gd(E);if(!E.ok)throw new Vd(E);let T=((r=E.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),O;return T==="application/json"?O=yield E.json():T==="application/octet-stream"||T==="application/pdf"?O=yield E.blob():T==="text/event-stream"?O=E:T==="multipart/form-data"?O=yield E.formData():O=yield E.text(),{data:O,error:null,response:E}}catch(u){return{data:null,error:u,response:u instanceof Vd||u instanceof Gd?u.context:void 0}}finally{a&&clearTimeout(a)}})}}const YA=Object.freeze(Object.defineProperty({__proto__:null,get FunctionRegion(){return Mc},FunctionsClient:XA,FunctionsError:Gc,FunctionsFetchError:Hy,FunctionsHttpError:Vd,FunctionsRelayError:Gd},Symbol.toStringTag,{value:"Module"})),$y=Ro(YA);var He={};const ra=Ro(GA);var ac={},oc={},lc={},cc={},uc={},hc={},cb;function qy(){if(cb)return hc;cb=1,Object.defineProperty(hc,"__esModule",{value:!0});class c extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}return hc.default=c,hc}var ub;function Gy(){if(ub)return uc;ub=1,Object.defineProperty(uc,"__esModule",{value:!0});const t=ra.__importDefault(qy());let e=class{constructor(r){var a,o;this.shouldThrowOnError=!1,this.method=r.method,this.url=r.url,this.headers=new Headers(r.headers),this.schema=r.schema,this.body=r.body,this.shouldThrowOnError=(a=r.shouldThrowOnError)!==null&&a!==void 0?a:!1,this.signal=r.signal,this.isMaybeSingle=(o=r.isMaybeSingle)!==null&&o!==void 0?o:!1,r.fetch?this.fetch=r.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(r,a){return this.headers=new Headers(this.headers),this.headers.set(r,a),this}then(r,a){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const o=this.fetch;let u=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async d=>{var f,p,m,y;let v=null,_=null,w=null,S=d.status,E=d.statusText;if(d.ok){if(this.method!=="HEAD"){const N=await d.text();N===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((f=this.headers.get("Accept"))===null||f===void 0)&&f.includes("application/vnd.pgrst.plan+text"))?_=N:_=JSON.parse(N))}const T=(p=this.headers.get("Prefer"))===null||p===void 0?void 0:p.match(/count=(exact|planned|estimated)/),O=(m=d.headers.get("content-range"))===null||m===void 0?void 0:m.split("/");T&&O&&O.length>1&&(w=parseInt(O[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(_)&&(_.length>1?(v={code:"PGRST116",details:`Results contain ${_.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},_=null,w=null,S=406,E="Not Acceptable"):_.length===1?_=_[0]:_=null)}else{const T=await d.text();try{v=JSON.parse(T),Array.isArray(v)&&d.status===404&&(_=[],v=null,S=200,E="OK")}catch{d.status===404&&T===""?(S=204,E="No Content"):v={message:T}}if(v&&this.isMaybeSingle&&(!((y=v?.details)===null||y===void 0)&&y.includes("0 rows"))&&(v=null,S=200,E="OK"),v&&this.shouldThrowOnError)throw new t.default(v)}return{error:v,data:_,count:w,status:S,statusText:E}});return this.shouldThrowOnError||(u=u.catch(d=>{var f,p,m,y,v,_;let w="";const S=d?.cause;if(S){const E=(f=S?.message)!==null&&f!==void 0?f:"",R=(p=S?.code)!==null&&p!==void 0?p:"";w=`${(m=d?.name)!==null&&m!==void 0?m:"FetchError"}: ${d?.message}`,w+=`

Caused by: ${(y=S?.name)!==null&&y!==void 0?y:"Error"}: ${E}`,R&&(w+=` (${R})`),S?.stack&&(w+=`
${S.stack}`)}else w=(v=d?.stack)!==null&&v!==void 0?v:"";return{error:{message:`${(_=d?.name)!==null&&_!==void 0?_:"FetchError"}: ${d?.message}`,details:w,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),u.then(r,a)}returns(){return this}overrideTypes(){return this}};return uc.default=e,uc}var hb;function Vy(){if(hb)return cc;hb=1,Object.defineProperty(cc,"__esModule",{value:!0});const t=ra.__importDefault(Gy());let e=class extends t.default{select(r){let a=!1;const o=(r??"*").split("").map(u=>/\s/.test(u)&&!a?"":(u==='"'&&(a=!a),u)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(r,{ascending:a=!0,nullsFirst:o,foreignTable:u,referencedTable:d=u}={}){const f=d?`${d}.order`:"order",p=this.url.searchParams.get(f);return this.url.searchParams.set(f,`${p?`${p},`:""}${r}.${a?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(r,{foreignTable:a,referencedTable:o=a}={}){const u=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(u,`${r}`),this}range(r,a,{foreignTable:o,referencedTable:u=o}={}){const d=typeof u>"u"?"offset":`${u}.offset`,f=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(d,`${r}`),this.url.searchParams.set(f,`${a-r+1}`),this}abortSignal(r){return this.signal=r,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:r=!1,verbose:a=!1,settings:o=!1,buffers:u=!1,wal:d=!1,format:f="text"}={}){var p;const m=[r?"analyze":null,a?"verbose":null,o?"settings":null,u?"buffers":null,d?"wal":null].filter(Boolean).join("|"),y=(p=this.headers.get("Accept"))!==null&&p!==void 0?p:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${f}; for="${y}"; options=${m};`),f==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(r){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${r}`),this}};return cc.default=e,cc}var db;function Of(){if(db)return lc;db=1,Object.defineProperty(lc,"__esModule",{value:!0});const t=ra.__importDefault(Vy()),e=new RegExp("[,()]");let n=class extends t.default{eq(a,o){return this.url.searchParams.append(a,`eq.${o}`),this}neq(a,o){return this.url.searchParams.append(a,`neq.${o}`),this}gt(a,o){return this.url.searchParams.append(a,`gt.${o}`),this}gte(a,o){return this.url.searchParams.append(a,`gte.${o}`),this}lt(a,o){return this.url.searchParams.append(a,`lt.${o}`),this}lte(a,o){return this.url.searchParams.append(a,`lte.${o}`),this}like(a,o){return this.url.searchParams.append(a,`like.${o}`),this}likeAllOf(a,o){return this.url.searchParams.append(a,`like(all).{${o.join(",")}}`),this}likeAnyOf(a,o){return this.url.searchParams.append(a,`like(any).{${o.join(",")}}`),this}ilike(a,o){return this.url.searchParams.append(a,`ilike.${o}`),this}ilikeAllOf(a,o){return this.url.searchParams.append(a,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(a,o){return this.url.searchParams.append(a,`ilike(any).{${o.join(",")}}`),this}regexMatch(a,o){return this.url.searchParams.append(a,`match.${o}`),this}regexIMatch(a,o){return this.url.searchParams.append(a,`imatch.${o}`),this}is(a,o){return this.url.searchParams.append(a,`is.${o}`),this}isDistinct(a,o){return this.url.searchParams.append(a,`isdistinct.${o}`),this}in(a,o){const u=Array.from(new Set(o)).map(d=>typeof d=="string"&&e.test(d)?`"${d}"`:`${d}`).join(",");return this.url.searchParams.append(a,`in.(${u})`),this}contains(a,o){return typeof o=="string"?this.url.searchParams.append(a,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(a,`cs.{${o.join(",")}}`):this.url.searchParams.append(a,`cs.${JSON.stringify(o)}`),this}containedBy(a,o){return typeof o=="string"?this.url.searchParams.append(a,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(a,`cd.{${o.join(",")}}`):this.url.searchParams.append(a,`cd.${JSON.stringify(o)}`),this}rangeGt(a,o){return this.url.searchParams.append(a,`sr.${o}`),this}rangeGte(a,o){return this.url.searchParams.append(a,`nxl.${o}`),this}rangeLt(a,o){return this.url.searchParams.append(a,`sl.${o}`),this}rangeLte(a,o){return this.url.searchParams.append(a,`nxr.${o}`),this}rangeAdjacent(a,o){return this.url.searchParams.append(a,`adj.${o}`),this}overlaps(a,o){return typeof o=="string"?this.url.searchParams.append(a,`ov.${o}`):this.url.searchParams.append(a,`ov.{${o.join(",")}}`),this}textSearch(a,o,{config:u,type:d}={}){let f="";d==="plain"?f="pl":d==="phrase"?f="ph":d==="websearch"&&(f="w");const p=u===void 0?"":`(${u})`;return this.url.searchParams.append(a,`${f}fts${p}.${o}`),this}match(a){return Object.entries(a).forEach(([o,u])=>{this.url.searchParams.append(o,`eq.${u}`)}),this}not(a,o,u){return this.url.searchParams.append(a,`not.${o}.${u}`),this}or(a,{foreignTable:o,referencedTable:u=o}={}){const d=u?`${u}.or`:"or";return this.url.searchParams.append(d,`(${a})`),this}filter(a,o,u){return this.url.searchParams.append(a,`${o}.${u}`),this}};return lc.default=n,lc}var fb;function Xy(){if(fb)return oc;fb=1,Object.defineProperty(oc,"__esModule",{value:!0});const t=ra.__importDefault(Of());let e=class{constructor(r,{headers:a={},schema:o,fetch:u}){this.url=r,this.headers=new Headers(a),this.schema=o,this.fetch=u}select(r,a){const{head:o=!1,count:u}=a??{},d=o?"HEAD":"GET";let f=!1;const p=(r??"*").split("").map(m=>/\s/.test(m)&&!f?"":(m==='"'&&(f=!f),m)).join("");return this.url.searchParams.set("select",p),u&&this.headers.append("Prefer",`count=${u}`),new t.default({method:d,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(r,{count:a,defaultToNull:o=!0}={}){var u;const d="POST";if(a&&this.headers.append("Prefer",`count=${a}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(r)){const f=r.reduce((p,m)=>p.concat(Object.keys(m)),[]);if(f.length>0){const p=[...new Set(f)].map(m=>`"${m}"`);this.url.searchParams.set("columns",p.join(","))}}return new t.default({method:d,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}upsert(r,{onConflict:a,ignoreDuplicates:o=!1,count:u,defaultToNull:d=!0}={}){var f;const p="POST";if(this.headers.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),a!==void 0&&this.url.searchParams.set("on_conflict",a),u&&this.headers.append("Prefer",`count=${u}`),d||this.headers.append("Prefer","missing=default"),Array.isArray(r)){const m=r.reduce((y,v)=>y.concat(Object.keys(v)),[]);if(m.length>0){const y=[...new Set(m)].map(v=>`"${v}"`);this.url.searchParams.set("columns",y.join(","))}}return new t.default({method:p,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}update(r,{count:a}={}){var o;const u="PATCH";return a&&this.headers.append("Prefer",`count=${a}`),new t.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}delete({count:r}={}){var a;const o="DELETE";return r&&this.headers.append("Prefer",`count=${r}`),new t.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}};return oc.default=e,oc}var pb;function KA(){if(pb)return ac;pb=1,Object.defineProperty(ac,"__esModule",{value:!0});const c=ra,t=c.__importDefault(Xy()),e=c.__importDefault(Of());let n=class Yy{constructor(a,{headers:o={},schema:u,fetch:d}={}){this.url=a,this.headers=new Headers(o),this.schemaName=u,this.fetch=d}from(a){if(!a||typeof a!="string"||a.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");const o=new URL(`${this.url}/${a}`);return new t.default(o,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(a){return new Yy(this.url,{headers:this.headers,schema:a,fetch:this.fetch})}rpc(a,o={},{head:u=!1,get:d=!1,count:f}={}){var p;let m;const y=new URL(`${this.url}/rpc/${a}`);let v;u||d?(m=u?"HEAD":"GET",Object.entries(o).filter(([w,S])=>S!==void 0).map(([w,S])=>[w,Array.isArray(S)?`{${S.join(",")}}`:`${S}`]).forEach(([w,S])=>{y.searchParams.append(w,S)})):(m="POST",v=o);const _=new Headers(this.headers);return f&&_.set("Prefer",`count=${f}`),new e.default({method:m,url:y,headers:_,schema:this.schemaName,body:v,fetch:(p=this.fetch)!==null&&p!==void 0?p:fetch})}};return ac.default=n,ac}var gb;function Ky(){if(gb)return He;gb=1,Object.defineProperty(He,"__esModule",{value:!0}),He.PostgrestError=He.PostgrestBuilder=He.PostgrestTransformBuilder=He.PostgrestFilterBuilder=He.PostgrestQueryBuilder=He.PostgrestClient=void 0;const c=ra,t=c.__importDefault(KA());He.PostgrestClient=t.default;const e=c.__importDefault(Xy());He.PostgrestQueryBuilder=e.default;const n=c.__importDefault(Of());He.PostgrestFilterBuilder=n.default;const r=c.__importDefault(Vy());He.PostgrestTransformBuilder=r.default;const a=c.__importDefault(Gy());He.PostgrestBuilder=a.default;const o=c.__importDefault(qy());return He.PostgrestError=o.default,He.default={PostgrestClient:t.default,PostgrestQueryBuilder:e.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:r.default,PostgrestBuilder:a.default,PostgrestError:o.default},He}class Wy{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const e=process.versions;if(e&&e.node){const n=e.node,r=parseInt(n.replace(/^v/,"").split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let e=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(e+=`

Suggested solution: ${t.workaround}`),new Error(e)}static createWebSocket(t,e){const n=this.getWebSocketConstructor();return new n(t,e)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const WA="2.87.1",QA=`realtime-js/${WA}`,Qy="1.0.0",JA="2.0.0",mb=Qy,Xd=1e4,ZA=1e3,tS=100;var ji;(function(c){c[c.connecting=0]="connecting",c[c.open=1]="open",c[c.closing=2]="closing",c[c.closed=3]="closed"})(ji||(ji={}));var we;(function(c){c.closed="closed",c.errored="errored",c.joined="joined",c.joining="joining",c.leaving="leaving"})(we||(we={}));var $s;(function(c){c.close="phx_close",c.error="phx_error",c.join="phx_join",c.reply="phx_reply",c.leave="phx_leave",c.access_token="access_token"})($s||($s={}));var Yd;(function(c){c.websocket="websocket"})(Yd||(Yd={}));var Li;(function(c){c.Connecting="connecting",c.Open="open",c.Closing="closing",c.Closed="closed"})(Li||(Li={}));class eS{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,e){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return e(this._binaryEncodeUserBroadcastPush(t));let n=[t.join_ref,t.ref,t.topic,t.event,t.payload];return e(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(t){var e;return this._isArrayBuffer((e=t.payload)===null||e===void 0?void 0:e.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var e,n;const r=(n=(e=t.payload)===null||e===void 0?void 0:e.payload)!==null&&n!==void 0?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,r)}_encodeJsonUserBroadcastPush(t){var e,n;const r=(n=(e=t.payload)===null||e===void 0?void 0:e.payload)!==null&&n!==void 0?n:{},o=new TextEncoder().encode(JSON.stringify(r)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(t,e,n){var r,a;const o=t.topic,u=(r=t.ref)!==null&&r!==void 0?r:"",d=(a=t.join_ref)!==null&&a!==void 0?a:"",f=t.payload.event,p=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},m=Object.keys(p).length===0?"":JSON.stringify(p);if(d.length>255)throw new Error(`joinRef length ${d.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`ref length ${u.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(f.length>255)throw new Error(`userEvent length ${f.length} exceeds maximum of 255`);if(m.length>255)throw new Error(`metadata length ${m.length} exceeds maximum of 255`);const y=this.USER_BROADCAST_PUSH_META_LENGTH+d.length+u.length+o.length+f.length+m.length,v=new ArrayBuffer(this.HEADER_LENGTH+y);let _=new DataView(v),w=0;_.setUint8(w++,this.KINDS.userBroadcastPush),_.setUint8(w++,d.length),_.setUint8(w++,u.length),_.setUint8(w++,o.length),_.setUint8(w++,f.length),_.setUint8(w++,m.length),_.setUint8(w++,e),Array.from(d,E=>_.setUint8(w++,E.charCodeAt(0))),Array.from(u,E=>_.setUint8(w++,E.charCodeAt(0))),Array.from(o,E=>_.setUint8(w++,E.charCodeAt(0))),Array.from(f,E=>_.setUint8(w++,E.charCodeAt(0))),Array.from(m,E=>_.setUint8(w++,E.charCodeAt(0)));var S=new Uint8Array(v.byteLength+n.byteLength);return S.set(new Uint8Array(v),0),S.set(new Uint8Array(n),v.byteLength),S.buffer}decode(t,e){if(this._isArrayBuffer(t)){let n=this._binaryDecode(t);return e(n)}if(typeof t=="string"){const n=JSON.parse(t),[r,a,o,u,d]=n;return e({join_ref:r,ref:a,topic:o,event:u,payload:d})}return e({})}_binaryDecode(t){const e=new DataView(t),n=e.getUint8(0),r=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(t,e,r)}}_decodeUserBroadcast(t,e,n){const r=e.getUint8(1),a=e.getUint8(2),o=e.getUint8(3),u=e.getUint8(4);let d=this.HEADER_LENGTH+4;const f=n.decode(t.slice(d,d+r));d=d+r;const p=n.decode(t.slice(d,d+a));d=d+a;const m=n.decode(t.slice(d,d+o));d=d+o;const y=t.slice(d,t.byteLength),v=u===this.JSON_ENCODING?JSON.parse(n.decode(y)):y,_={type:this.BROADCAST_EVENT,event:p,payload:v};return o>0&&(_.meta=JSON.parse(m)),{join_ref:null,ref:null,topic:f,event:this.BROADCAST_EVENT,payload:_}}_isArrayBuffer(t){var e;return t instanceof ArrayBuffer||((e=t?.constructor)===null||e===void 0?void 0:e.name)==="ArrayBuffer"}_pick(t,e){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([n])=>e.includes(n)))}}class Jy{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Zt;(function(c){c.abstime="abstime",c.bool="bool",c.date="date",c.daterange="daterange",c.float4="float4",c.float8="float8",c.int2="int2",c.int4="int4",c.int4range="int4range",c.int8="int8",c.int8range="int8range",c.json="json",c.jsonb="jsonb",c.money="money",c.numeric="numeric",c.oid="oid",c.reltime="reltime",c.text="text",c.time="time",c.timestamp="timestamp",c.timestamptz="timestamptz",c.timetz="timetz",c.tsrange="tsrange",c.tstzrange="tstzrange"})(Zt||(Zt={}));const bb=(c,t,e={})=>{var n;const r=(n=e.skipTypes)!==null&&n!==void 0?n:[];return t?Object.keys(t).reduce((a,o)=>(a[o]=sS(o,c,t,r),a),{}):{}},sS=(c,t,e,n)=>{const r=t.find(u=>u.name===c),a=r?.type,o=e[c];return a&&!n.includes(a)?Zy(a,o):Kd(o)},Zy=(c,t)=>{if(c.charAt(0)==="_"){const e=c.slice(1,c.length);return aS(t,e)}switch(c){case Zt.bool:return nS(t);case Zt.float4:case Zt.float8:case Zt.int2:case Zt.int4:case Zt.int8:case Zt.numeric:case Zt.oid:return iS(t);case Zt.json:case Zt.jsonb:return rS(t);case Zt.timestamp:return oS(t);case Zt.abstime:case Zt.date:case Zt.daterange:case Zt.int4range:case Zt.int8range:case Zt.money:case Zt.reltime:case Zt.text:case Zt.time:case Zt.timestamptz:case Zt.timetz:case Zt.tsrange:case Zt.tstzrange:return Kd(t);default:return Kd(t)}},Kd=c=>c,nS=c=>{switch(c){case"t":return!0;case"f":return!1;default:return c}},iS=c=>{if(typeof c=="string"){const t=parseFloat(c);if(!Number.isNaN(t))return t}return c},rS=c=>{if(typeof c=="string")try{return JSON.parse(c)}catch(t){return console.log(`JSON parse error: ${t}`),c}return c},aS=(c,t)=>{if(typeof c!="string")return c;const e=c.length-1,n=c[e];if(c[0]==="{"&&n==="}"){let a;const o=c.slice(1,e);try{a=JSON.parse("["+o+"]")}catch{a=o?o.split(","):[]}return a.map(u=>Zy(t,u))}return c},oS=c=>typeof c=="string"?c.replace(" ","T"):c,tv=c=>{const t=new URL(c);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class xd{constructor(t,e,n={},r=Xd){this.channel=t,this.event=e,this.payload=n,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var n;return this._hasReceived(t)&&e((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:e}){this.recHooks.filter(n=>n.status===t).forEach(n=>n.callback(e))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var Wd;(function(c){c.SYNC="sync",c.JOIN="join",c.LEAVE="leave"})(Wd||(Wd={}));let ev=class xc{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=e?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},r=>{const{onJoin:a,onLeave:o,onSync:u}=this.caller;this.joinRef=this.channel._joinRef(),this.state=xc.syncState(this.state,r,a,o),this.pendingDiffs.forEach(d=>{this.state=xc.syncDiff(this.state,d,a,o)}),this.pendingDiffs=[],u()}),this.channel._on(n.diff,{},r=>{const{onJoin:a,onLeave:o,onSync:u}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(r):(this.state=xc.syncDiff(this.state,r,a,o),u())}),this.onJoin((r,a,o)=>{this.channel._trigger("presence",{event:"join",key:r,currentPresences:a,newPresences:o})}),this.onLeave((r,a,o)=>{this.channel._trigger("presence",{event:"leave",key:r,currentPresences:a,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,e,n,r){const a=this.cloneDeep(t),o=this.transformState(e),u={},d={};return this.map(a,(f,p)=>{o[f]||(d[f]=p)}),this.map(o,(f,p)=>{const m=a[f];if(m){const y=p.map(S=>S.presence_ref),v=m.map(S=>S.presence_ref),_=p.filter(S=>v.indexOf(S.presence_ref)<0),w=m.filter(S=>y.indexOf(S.presence_ref)<0);_.length>0&&(u[f]=_),w.length>0&&(d[f]=w)}else u[f]=p}),this.syncDiff(a,{joins:u,leaves:d},n,r)}static syncDiff(t,e,n,r){const{joins:a,leaves:o}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return n||(n=()=>{}),r||(r=()=>{}),this.map(a,(u,d)=>{var f;const p=(f=t[u])!==null&&f!==void 0?f:[];if(t[u]=this.cloneDeep(d),p.length>0){const m=t[u].map(v=>v.presence_ref),y=p.filter(v=>m.indexOf(v.presence_ref)<0);t[u].unshift(...y)}n(u,p,d)}),this.map(o,(u,d)=>{let f=t[u];if(!f)return;const p=d.map(m=>m.presence_ref);f=f.filter(m=>p.indexOf(m.presence_ref)<0),t[u]=f,r(u,f,d),f.length===0&&delete t[u]}),t}static map(t,e){return Object.getOwnPropertyNames(t).map(n=>e(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((e,n)=>{const r=t[n];return"metas"in r?e[n]=r.metas.map(a=>(a.presence_ref=a.phx_ref,delete a.phx_ref,delete a.phx_ref_prev,a)):e[n]=r,e},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};var Qd;(function(c){c.ALL="*",c.INSERT="INSERT",c.UPDATE="UPDATE",c.DELETE="DELETE"})(Qd||(Qd={}));var Kr;(function(c){c.BROADCAST="broadcast",c.PRESENCE="presence",c.POSTGRES_CHANGES="postgres_changes",c.SYSTEM="system"})(Kr||(Kr={}));var tn;(function(c){c.SUBSCRIBED="SUBSCRIBED",c.TIMED_OUT="TIMED_OUT",c.CLOSED="CLOSED",c.CHANNEL_ERROR="CHANNEL_ERROR"})(tn||(tn={}));const lS=we;let sv=class co{constructor(t,e={config:{}},n){var r,a;if(this.topic=t,this.params=e,this.socket=n,this.bindings={},this.state=we.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new xd(this,$s.join,this.params,this.timeout),this.rejoinTimer=new Jy(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=we.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=we.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=we.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=we.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=we.errored,this.rejoinTimer.scheduleTimeout())}),this._on($s.reply,{},(o,u)=>{this._trigger(this._replyEventName(u),o)}),this.presence=new ev(this),this.broadcastEndpointURL=tv(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((a=(r=this.params.config)===null||r===void 0?void 0:r.broadcast)===null||a===void 0)&&a.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,e=this.timeout){var n,r,a;if(this.socket.isConnected()||this.socket.connect(),this.state==we.closed){const{config:{broadcast:o,presence:u,private:d}}=this.params,f=(r=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(v=>v.filter))!==null&&r!==void 0?r:[],p=!!this.bindings[Kr.PRESENCE]&&this.bindings[Kr.PRESENCE].length>0||((a=this.params.config.presence)===null||a===void 0?void 0:a.enabled)===!0,m={},y={broadcast:o,presence:Object.assign(Object.assign({},u),{enabled:p}),postgres_changes:f,private:d};this.socket.accessTokenValue&&(m.access_token=this.socket.accessTokenValue),this._onError(v=>t?.(tn.CHANNEL_ERROR,v)),this._onClose(()=>t?.(tn.CLOSED)),this.updateJoinPayload(Object.assign({config:y},m)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",async({postgres_changes:v})=>{var _;if(this.socket._isManualToken()||this.socket.setAuth(),v===void 0){t?.(tn.SUBSCRIBED);return}else{const w=this.bindings.postgres_changes,S=(_=w?.length)!==null&&_!==void 0?_:0,E=[];for(let R=0;R<S;R++){const T=w[R],{filter:{event:O,schema:N,table:k,filter:M}}=T,I=v&&v[R];if(I&&I.event===O&&co.isFilterValueEqual(I.schema,N)&&co.isFilterValueEqual(I.table,k)&&co.isFilterValueEqual(I.filter,M))E.push(Object.assign(Object.assign({},T),{id:I.id}));else{this.unsubscribe(),this.state=we.errored,t?.(tn.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=E,t&&t(tn.SUBSCRIBED);return}}).receive("error",v=>{this.state=we.errored,t?.(tn.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(v).join(", ")||"error")))}).receive("timeout",()=>{t?.(tn.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,e={}){return await this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,e,n){return this.state===we.joined&&t===Kr.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,e,n)}async httpSend(t,e,n={}){var r;const a=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(e==null)return Promise.reject("Payload is required for httpSend()");const o={method:"POST",headers:{Authorization:a,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:e,private:this.private}]})},u=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);if(u.status===202)return{success:!0};let d=u.statusText;try{const f=await u.json();d=f.error||f.message||d}catch{}return Promise.reject(new Error(d))}async send(t,e={}){var n,r;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:a,payload:o}=t,d={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:o,private:this.private}]})};try{const f=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(n=e.timeout)!==null&&n!==void 0?n:this.timeout);return await((r=f.body)===null||r===void 0?void 0:r.cancel()),f.ok?"ok":"error"}catch(f){return f.name==="AbortError"?"timed out":"error"}}else return new Promise(a=>{var o,u,d;const f=this._push(t.type,t,e.timeout||this.timeout);t.type==="broadcast"&&!(!((d=(u=(o=this.params)===null||o===void 0?void 0:o.config)===null||u===void 0?void 0:u.broadcast)===null||d===void 0)&&d.ack)&&a("ok"),f.receive("ok",()=>a("ok")),f.receive("error",()=>a("error")),f.receive("timeout",()=>a("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=we.leaving;const e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger($s.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(r=>{n=new xd(this,$s.leave,{},t),n.receive("ok",()=>{e(),r("ok")}).receive("timeout",()=>{e(),r("timed out")}).receive("error",()=>{r("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=we.closed,this.bindings={}}async _fetchWithTimeout(t,e,n){const r=new AbortController,a=setTimeout(()=>r.abort(),n),o=await this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:r.signal}));return clearTimeout(a),o}_push(t,e,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new xd(this,t,e,n);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>tS){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(t,e,n){return e}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,e,n){var r,a;const o=t.toLocaleLowerCase(),{close:u,error:d,leave:f,join:p}=$s;if(n&&[u,d,f,p].indexOf(o)>=0&&n!==this._joinRef())return;let y=this._onMessage(o,e,n);if(e&&!y)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(r=this.bindings.postgres_changes)===null||r===void 0||r.filter(v=>{var _,w,S;return((_=v.filter)===null||_===void 0?void 0:_.event)==="*"||((S=(w=v.filter)===null||w===void 0?void 0:w.event)===null||S===void 0?void 0:S.toLocaleLowerCase())===o}).map(v=>v.callback(y,n)):(a=this.bindings[o])===null||a===void 0||a.filter(v=>{var _,w,S,E,R,T;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in v){const O=v.id,N=(_=v.filter)===null||_===void 0?void 0:_.event;return O&&((w=e.ids)===null||w===void 0?void 0:w.includes(O))&&(N==="*"||N?.toLocaleLowerCase()===((S=e.data)===null||S===void 0?void 0:S.type.toLocaleLowerCase()))}else{const O=(R=(E=v?.filter)===null||E===void 0?void 0:E.event)===null||R===void 0?void 0:R.toLocaleLowerCase();return O==="*"||O===((T=e?.event)===null||T===void 0?void 0:T.toLocaleLowerCase())}else return v.type.toLocaleLowerCase()===o}).map(v=>{if(typeof y=="object"&&"ids"in y){const _=y.data,{schema:w,table:S,commit_timestamp:E,type:R,errors:T}=_;y=Object.assign(Object.assign({},{schema:w,table:S,commit_timestamp:E,eventType:R,new:{},old:{},errors:T}),this._getPayloadRecords(_))}v.callback(y,n)})}_isClosed(){return this.state===we.closed}_isJoined(){return this.state===we.joined}_isJoining(){return this.state===we.joining}_isLeaving(){return this.state===we.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,e,n){const r=t.toLocaleLowerCase(),a={type:r,filter:e,callback:n};return this.bindings[r]?this.bindings[r].push(a):this.bindings[r]=[a],this}_off(t,e){const n=t.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(r=>{var a;return!(((a=r.type)===null||a===void 0?void 0:a.toLocaleLowerCase())===n&&co.isEqual(r.filter,e))})),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}static isFilterValueEqual(t,e){return(t??void 0)===(e??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on($s.close,{},t)}_onError(t){this._on($s.error,{},e=>t(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=we.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const e={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(e.new=bb(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(e.old=bb(t.columns,t.old_record)),e}};const Ed=()=>{},dc={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},cS=[1e3,2e3,5e3,1e4],uS=1e4,hS=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;let dS=class{constructor(t,e){var n;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Xd,this.transport=null,this.heartbeatIntervalMs=dc.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Ed,this.ref=0,this.reconnectTimer=null,this.vsn=mb,this.logger=Ed,this.conn=null,this.sendBuffer=[],this.serializer=new eS,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=r=>r?(...a)=>r(...a):(...a)=>fetch(...a),!(!((n=e?.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=e.params.apikey,this.endPoint=`${t}/${Yd.websocket}`,this.httpEndpoint=tv(t),this._initializeOptions(e),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(e?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Wy.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const e=t.message;throw e.includes("Node.js")?new Error(`${e}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${e}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,e){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,e??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const e=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),e}async removeAllChannels(){const t=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,e,n){this.logger(t,e,n)}connectionState(){switch(this.conn&&this.conn.readyState){case ji.connecting:return Li.Connecting;case ji.open:return Li.Open;case ji.closing:return Li.Closing;default:return Li.Closed}}isConnected(){return this.connectionState()===Li.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,e={config:{}}){const n=`realtime:${t}`,r=this.getChannels().find(a=>a.topic===n);if(r)return r;{const a=new sv(`realtime:${t}`,e,this);return this.channels.push(a),a}}push(t){const{topic:e,event:n,payload:r,ref:a}=t,o=()=>{this.encode(t,u=>{var d;(d=this.conn)===null||d===void 0||d.send(u)})};this.log("push",`${e} ${n} (${a})`,r),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(ZA,"heartbeat timeout"),setTimeout(()=>{var e;this.isConnected()||(e=this.reconnectTimer)===null||e===void 0||e.scheduleTimeout()},dc.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let e=this.channels.find(n=>n.topic===t&&(n._isJoined()||n._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}_remove(t){this.channels=this.channels.filter(e=>e.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,e=>{if(e.topic==="phoenix"&&e.event==="phx_reply")try{this.heartbeatCallback(e.payload.status==="ok"?"ok":"error")}catch(f){this.log("error","error in heartbeat callback",f)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:r,payload:a,ref:o}=e,u=o?`(${o})`:"",d=a.status||"";this.log("receive",`${d} ${n} ${r} ${u}`.trim(),a),this.channels.filter(f=>f._isMember(n)).forEach(f=>f._trigger(r,a,o)),this._triggerStateCallbacks("message",e)})}_clearTimer(t){var e;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((e=this.reconnectTimer)===null||e===void 0||e.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){if(this.conn){if(this.conn.readyState===ji.open||this.conn.readyState===ji.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{e.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var e;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(e=this.reconnectTimer)===null||e===void 0||e.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger($s.error))}_appendParams(t,e){if(Object.keys(e).length===0)return t;const n=t.match(/\?/)?"&":"?",r=new URLSearchParams(e);return`${t}${n}${r}`}_workerObjectUrl(t){let e;if(t)e=t;else{const n=new Blob([hS],{type:"application/javascript"});e=URL.createObjectURL(n)}return e}_setConnectionState(t,e=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=e)}async _performAuth(t=null){let e,n=!1;if(t)e=t,n=!0;else if(this.accessToken)try{e=await this.accessToken()}catch(r){this.log("error","Error fetching access token from callback",r),e=this.accessTokenValue}else e=this.accessTokenValue;n?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(r=>{const a={access_token:e,version:QA};e&&r.updateJoinPayload(a),r.joinedOnce&&r._isJoined()&&r._push($s.access_token,{access_token:e})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(e=>{this.log("error",`Error setting auth in ${t}`,e)})}_triggerStateCallbacks(t,e){try{this.stateChangeCallbacks[t].forEach(n=>{try{n(e)}catch(r){this.log("error",`error in ${t} callback`,r)}})}catch(n){this.log("error",`error triggering ${t} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new Jy(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},dc.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var e,n,r,a,o,u,d,f,p,m,y,v;switch(this.transport=(e=t?.transport)!==null&&e!==void 0?e:null,this.timeout=(n=t?.timeout)!==null&&n!==void 0?n:Xd,this.heartbeatIntervalMs=(r=t?.heartbeatIntervalMs)!==null&&r!==void 0?r:dc.HEARTBEAT_INTERVAL,this.worker=(a=t?.worker)!==null&&a!==void 0?a:!1,this.accessToken=(o=t?.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(u=t?.heartbeatCallback)!==null&&u!==void 0?u:Ed,this.vsn=(d=t?.vsn)!==null&&d!==void 0?d:mb,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(f=t?.reconnectAfterMs)!==null&&f!==void 0?f:(_=>cS[_-1]||uS),this.vsn){case Qy:this.encode=(p=t?.encode)!==null&&p!==void 0?p:((_,w)=>w(JSON.stringify(_))),this.decode=(m=t?.decode)!==null&&m!==void 0?m:((_,w)=>w(JSON.parse(_)));break;case JA:this.encode=(y=t?.encode)!==null&&y!==void 0?y:this.serializer.encode.bind(this.serializer),this.decode=(v=t?.decode)!==null&&v!==void 0?v:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}};const fS=Object.freeze(Object.defineProperty({__proto__:null,REALTIME_CHANNEL_STATES:lS,get REALTIME_LISTEN_TYPES(){return Kr},get REALTIME_POSTGRES_CHANGES_LISTEN_EVENT(){return Qd},get REALTIME_PRESENCE_LISTEN_EVENTS(){return Wd},get REALTIME_SUBSCRIBE_STATES(){return tn},RealtimeChannel:sv,RealtimeClient:dS,RealtimePresence:ev,WebSocketFactory:Wy},Symbol.toStringTag,{value:"Module"})),nv=Ro(fS);class Oo extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function re(c){return typeof c=="object"&&c!==null&&"__isStorageError"in c}class iv extends Oo{constructor(t,e,n){super(t),this.name="StorageApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class jc extends Oo{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}}const Nf=c=>c?(...t)=>c(...t):(...t)=>fetch(...t),pS=()=>Response,Jd=c=>{if(Array.isArray(c))return c.map(e=>Jd(e));if(typeof c=="function"||c!==Object(c))return c;const t={};return Object.entries(c).forEach(([e,n])=>{const r=e.replace(/([-_][a-z])/gi,a=>a.toUpperCase().replace(/[-_]/g,""));t[r]=Jd(n)}),t},gS=c=>{if(typeof c!="object"||c===null)return!1;const t=Object.getPrototypeOf(c);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in c)&&!(Symbol.iterator in c)},mS=c=>!c||typeof c!="string"||c.length===0||c.length>100||c.trim()!==c||c.includes("/")||c.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(c),Td=c=>{var t;return c.msg||c.message||c.error_description||(typeof c.error=="string"?c.error:(t=c.error)===null||t===void 0?void 0:t.message)||JSON.stringify(c)},bS=(c,t,e)=>it(void 0,void 0,void 0,function*(){const n=yield pS();c instanceof n&&!e?.noResolveJson?c.json().then(r=>{const a=c.status||500,o=r?.statusCode||a+"";t(new iv(Td(r),a,o))}).catch(r=>{t(new jc(Td(r),r))}):t(new jc(Td(c),c))}),yS=(c,t,e,n)=>{const r={method:c,headers:t?.headers||{}};return c==="GET"||!n?r:(gS(n)?(r.headers=Object.assign({"Content-Type":"application/json"},t?.headers),r.body=JSON.stringify(n)):r.body=n,t?.duplex&&(r.duplex=t.duplex),Object.assign(Object.assign({},r),e))};function No(c,t,e,n,r,a){return it(this,void 0,void 0,function*(){return new Promise((o,u)=>{c(e,yS(t,n,r,a)).then(d=>{if(!d.ok)throw d;return n?.noResolveJson?d:d.json()}).then(d=>o(d)).catch(d=>bS(d,u,n))})})}function wo(c,t,e,n){return it(this,void 0,void 0,function*(){return No(c,"GET",t,e,n)})}function zs(c,t,e,n,r){return it(this,void 0,void 0,function*(){return No(c,"POST",t,n,r,e)})}function Zd(c,t,e,n,r){return it(this,void 0,void 0,function*(){return No(c,"PUT",t,n,r,e)})}function vS(c,t,e,n){return it(this,void 0,void 0,function*(){return No(c,"HEAD",t,Object.assign(Object.assign({},e),{noResolveJson:!0}),n)})}function kf(c,t,e,n,r){return it(this,void 0,void 0,function*(){return No(c,"DELETE",t,n,r,e)})}class wS{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}execute(){return it(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(re(t))return{data:null,error:t};throw t}})}}var rv;class _S{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[rv]="BlobDownloadBuilder",this.promise=null}asStream(){return new wS(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return it(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(re(t))return{data:null,error:t};throw t}})}}rv=Symbol.toStringTag;const AS={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},yb={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class SS{constructor(t,e={},n,r){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.bucketId=n,this.fetch=Nf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,e,n,r){return it(this,void 0,void 0,function*(){try{let a;const o=Object.assign(Object.assign({},yb),r);let u=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(o.upsert)});const d=o.metadata;typeof Blob<"u"&&n instanceof Blob?(a=new FormData,a.append("cacheControl",o.cacheControl),d&&a.append("metadata",this.encodeMetadata(d)),a.append("",n)):typeof FormData<"u"&&n instanceof FormData?(a=n,a.has("cacheControl")||a.append("cacheControl",o.cacheControl),d&&!a.has("metadata")&&a.append("metadata",this.encodeMetadata(d))):(a=n,u["cache-control"]=`max-age=${o.cacheControl}`,u["content-type"]=o.contentType,d&&(u["x-metadata"]=this.toBase64(this.encodeMetadata(d))),(typeof ReadableStream<"u"&&a instanceof ReadableStream||a&&typeof a=="object"&&"pipe"in a&&typeof a.pipe=="function")&&!o.duplex&&(o.duplex="half")),r?.headers&&(u=Object.assign(Object.assign({},u),r.headers));const f=this._removeEmptyFolders(e),p=this._getFinalPath(f),m=yield(t=="PUT"?Zd:zs)(this.fetch,`${this.url}/object/${p}`,a,Object.assign({headers:u},o?.duplex?{duplex:o.duplex}:{}));return{data:{path:f,id:m.Id,fullPath:m.Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(re(a))return{data:null,error:a};throw a}})}upload(t,e,n){return it(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,e,n)})}uploadToSignedUrl(t,e,n,r){return it(this,void 0,void 0,function*(){const a=this._removeEmptyFolders(t),o=this._getFinalPath(a),u=new URL(this.url+`/object/upload/sign/${o}`);u.searchParams.set("token",e);try{let d;const f=Object.assign({upsert:yb.upsert},r),p=Object.assign(Object.assign({},this.headers),{"x-upsert":String(f.upsert)});typeof Blob<"u"&&n instanceof Blob?(d=new FormData,d.append("cacheControl",f.cacheControl),d.append("",n)):typeof FormData<"u"&&n instanceof FormData?(d=n,d.append("cacheControl",f.cacheControl)):(d=n,p["cache-control"]=`max-age=${f.cacheControl}`,p["content-type"]=f.contentType);const m=yield Zd(this.fetch,u.toString(),d,{headers:p});return{data:{path:a,fullPath:m.Key},error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(re(d))return{data:null,error:d};throw d}})}createSignedUploadUrl(t,e){return it(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t);const r=Object.assign({},this.headers);e?.upsert&&(r["x-upsert"]="true");const a=yield zs(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:r}),o=new URL(this.url+a.url),u=o.searchParams.get("token");if(!u)throw new Oo("No token returned by API");return{data:{signedUrl:o.toString(),path:t,token:u},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(re(n))return{data:null,error:n};throw n}})}update(t,e,n){return it(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,e,n)})}move(t,e,n){return it(this,void 0,void 0,function*(){try{return{data:yield zs(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(re(r))return{data:null,error:r};throw r}})}copy(t,e,n){return it(this,void 0,void 0,function*(){try{return{data:{path:(yield zs(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(re(r))return{data:null,error:r};throw r}})}createSignedUrl(t,e,n){return it(this,void 0,void 0,function*(){try{let r=this._getFinalPath(t),a=yield zs(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:e},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const o=n?.download?`&download=${n.download===!0?"":n.download}`:"";return a={signedUrl:encodeURI(`${this.url}${a.signedURL}${o}`)},{data:a,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(re(r))return{data:null,error:r};throw r}})}createSignedUrls(t,e,n){return it(this,void 0,void 0,function*(){try{const r=yield zs(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:t},{headers:this.headers}),a=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:r.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${a}`):null})),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(re(r))return{data:null,error:r};throw r}})}download(t,e){const r=typeof e?.transform<"u"?"render/image/authenticated":"object",a=this.transformOptsToQueryString(e?.transform||{}),o=a?`?${a}`:"",u=this._getFinalPath(t),d=()=>wo(this.fetch,`${this.url}/${r}/${u}${o}`,{headers:this.headers,noResolveJson:!0});return new _S(d,this.shouldThrowOnError)}info(t){return it(this,void 0,void 0,function*(){const e=this._getFinalPath(t);try{const n=yield wo(this.fetch,`${this.url}/object/info/${e}`,{headers:this.headers});return{data:Jd(n),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(re(n))return{data:null,error:n};throw n}})}exists(t){return it(this,void 0,void 0,function*(){const e=this._getFinalPath(t);try{return yield vS(this.fetch,`${this.url}/object/${e}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(re(n)&&n instanceof jc){const r=n.originalError;if([400,404].includes(r?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(t,e){const n=this._getFinalPath(t),r=[],a=e?.download?`download=${e.download===!0?"":e.download}`:"";a!==""&&r.push(a);const u=typeof e?.transform<"u"?"render/image":"object",d=this.transformOptsToQueryString(e?.transform||{});d!==""&&r.push(d);let f=r.join("&");return f!==""&&(f=`?${f}`),{data:{publicUrl:encodeURI(`${this.url}/${u}/public/${n}${f}`)}}}remove(t){return it(this,void 0,void 0,function*(){try{return{data:yield kf(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(re(e))return{data:null,error:e};throw e}})}list(t,e,n){return it(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},AS),e),{prefix:t||""});return{data:yield zs(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},n),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(re(r))return{data:null,error:r};throw r}})}listV2(t,e){return it(this,void 0,void 0,function*(){try{const n=Object.assign({},t);return{data:yield zs(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},e),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(re(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}}const av="2.87.1",ov={"X-Client-Info":`storage-js/${av}`};class xS{constructor(t,e={},n,r){this.shouldThrowOnError=!1;const a=new URL(t);r?.useNewHostname&&/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase.")),this.url=a.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},ov),e),this.fetch=Nf(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(t){return it(this,void 0,void 0,function*(){try{const e=this.listBucketOptionsToQueryString(t);return{data:yield wo(this.fetch,`${this.url}/bucket${e}`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(re(e))return{data:null,error:e};throw e}})}getBucket(t){return it(this,void 0,void 0,function*(){try{return{data:yield wo(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(re(e))return{data:null,error:e};throw e}})}createBucket(t){return it(this,arguments,void 0,function*(e,n={public:!1}){try{return{data:yield zs(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:n.type,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(re(r))return{data:null,error:r};throw r}})}updateBucket(t,e){return it(this,void 0,void 0,function*(){try{return{data:yield Zd(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(re(n))return{data:null,error:n};throw n}})}emptyBucket(t){return it(this,void 0,void 0,function*(){try{return{data:yield zs(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(re(e))return{data:null,error:e};throw e}})}deleteBucket(t){return it(this,void 0,void 0,function*(){try{return{data:yield kf(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(re(e))return{data:null,error:e};throw e}})}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}}var _o=class extends Error{constructor(c,t){super(c),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&t.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function ES(c,t,e){const n=new URL(t,c);if(e)for(const[r,a]of Object.entries(e))a!==void 0&&n.searchParams.set(r,a);return n.toString()}async function TS(c){return!c||c.type==="none"?{}:c.type==="bearer"?{Authorization:`Bearer ${c.token}`}:c.type==="header"?{[c.name]:c.value}:c.type==="custom"?await c.getHeaders():{}}function CS(c){const t=c.fetchImpl??globalThis.fetch;return{async request({method:e,path:n,query:r,body:a,headers:o}){const u=ES(c.baseUrl,n,r),d=await TS(c.auth),f=await t(u,{method:e,headers:{...a?{"Content-Type":"application/json"}:{},...d,...o},body:a?JSON.stringify(a):void 0}),p=await f.text(),m=(f.headers.get("content-type")||"").includes("application/json"),y=m&&p?JSON.parse(p):p;if(!f.ok){const v=m?y:void 0,_=v?.error;throw new _o(_?.message??`Request failed with status ${f.status}`,{status:f.status,icebergType:_?.type,icebergCode:_?.code,details:v})}return{status:f.status,headers:f.headers,data:y}}}}function fc(c){return c.join("")}var RS=class{constructor(c,t=""){this.client=c,this.prefix=t}async listNamespaces(c){const t=c?{parent:fc(c.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(n=>({namespace:n}))}async createNamespace(c,t){const e={namespace:c.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:e})).data}async dropNamespace(c){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${fc(c.namespace)}`})}async loadNamespaceMetadata(c){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${fc(c.namespace)}`})).data.properties}}async namespaceExists(c){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${fc(c.namespace)}`}),!0}catch(t){if(t instanceof _o&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(c,t){try{return await this.createNamespace(c,t)}catch(e){if(e instanceof _o&&e.status===409)return;throw e}}};function Pr(c){return c.join("")}var OS=class{constructor(c,t="",e){this.client=c,this.prefix=t,this.accessDelegation=e}async listTables(c){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Pr(c.namespace)}/tables`})).data.identifiers}async createTable(c,t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Pr(c.namespace)}/tables`,body:t,headers:e})).data.metadata}async updateTable(c,t){const e=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Pr(c.namespace)}/tables/${c.name}`,body:t});return{"metadata-location":e.data["metadata-location"],metadata:e.data.metadata}}async dropTable(c,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Pr(c.namespace)}/tables/${c.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(c){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Pr(c.namespace)}/tables/${c.name}`,headers:t})).data.metadata}async tableExists(c){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Pr(c.namespace)}/tables/${c.name}`,headers:t}),!0}catch(e){if(e instanceof _o&&e.status===404)return!1;throw e}}async createTableIfNotExists(c,t){try{return await this.createTable(c,t)}catch(e){if(e instanceof _o&&e.status===409)return await this.loadTable({namespace:c.namespace,name:t.name});throw e}}},NS=class{constructor(c){let t="v1";c.catalogName&&(t+=`/${c.catalogName}`);const e=c.baseUrl.endsWith("/")?c.baseUrl:`${c.baseUrl}/`;this.client=CS({baseUrl:e,auth:c.auth,fetchImpl:c.fetch}),this.accessDelegation=c.accessDelegation?.join(","),this.namespaceOps=new RS(this.client,t),this.tableOps=new OS(this.client,t,this.accessDelegation)}async listNamespaces(c){return this.namespaceOps.listNamespaces(c)}async createNamespace(c,t){return this.namespaceOps.createNamespace(c,t)}async dropNamespace(c){await this.namespaceOps.dropNamespace(c)}async loadNamespaceMetadata(c){return this.namespaceOps.loadNamespaceMetadata(c)}async listTables(c){return this.tableOps.listTables(c)}async createTable(c,t){return this.tableOps.createTable(c,t)}async updateTable(c,t){return this.tableOps.updateTable(c,t)}async dropTable(c,t){await this.tableOps.dropTable(c,t)}async loadTable(c){return this.tableOps.loadTable(c)}async namespaceExists(c){return this.namespaceOps.namespaceExists(c)}async tableExists(c){return this.tableOps.tableExists(c)}async createNamespaceIfNotExists(c,t){return this.namespaceOps.createNamespaceIfNotExists(c,t)}async createTableIfNotExists(c,t){return this.tableOps.createTableIfNotExists(c,t)}};class lv{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},ov),e),this.fetch=Nf(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return it(this,void 0,void 0,function*(){try{return{data:yield zs(this.fetch,`${this.url}/bucket`,{name:t},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(re(e))return{data:null,error:e};throw e}})}listBuckets(t){return it(this,void 0,void 0,function*(){try{const e=new URLSearchParams;t?.limit!==void 0&&e.set("limit",t.limit.toString()),t?.offset!==void 0&&e.set("offset",t.offset.toString()),t?.sortColumn&&e.set("sortColumn",t.sortColumn),t?.sortOrder&&e.set("sortOrder",t.sortOrder),t?.search&&e.set("search",t.search);const n=e.toString(),r=n?`${this.url}/bucket?${n}`:`${this.url}/bucket`;return{data:yield wo(this.fetch,r,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(re(e))return{data:null,error:e};throw e}})}deleteBucket(t){return it(this,void 0,void 0,function*(){try{return{data:yield kf(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(re(e))return{data:null,error:e};throw e}})}from(t){if(!mS(t))throw new Oo("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const e=new NS({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:()=>it(this,void 0,void 0,function*(){return this.headers})},fetch:this.fetch}),n=this.shouldThrowOnError;return new Proxy(e,{get(a,o){const u=a[o];return typeof u!="function"?u:(...d)=>it(this,void 0,void 0,function*(){try{return{data:yield u.apply(a,d),error:null}}catch(f){if(n)throw f;return{data:null,error:f}}})}})}}const Df={"X-Client-Info":`storage-js/${av}`,"Content-Type":"application/json"};class Mf extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function os(c){return typeof c=="object"&&c!==null&&"__isStorageVectorsError"in c}class Ec extends Mf{constructor(t,e,n){super(t),this.name="StorageVectorsApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class cv extends Mf{constructor(t,e){super(t),this.name="StorageVectorsUnknownError",this.originalError=e}}var tf;(function(c){c.InternalError="InternalError",c.S3VectorConflictException="S3VectorConflictException",c.S3VectorNotFoundException="S3VectorNotFoundException",c.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",c.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",c.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(tf||(tf={}));const Vc=c=>c?(...t)=>c(...t):(...t)=>fetch(...t),kS=()=>Response,uv=c=>{if(typeof c!="object"||c===null)return!1;const t=Object.getPrototypeOf(c);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in c)&&!(Symbol.iterator in c)},DS=c=>Array.from(new Float32Array(c)),MS=(c,t)=>{if(t!==void 0&&c.float32.length!==t)throw new Error(`Vector dimension mismatch: expected ${t}, got ${c.float32.length}`)},vb=c=>c.msg||c.message||c.error_description||c.error||JSON.stringify(c),jS=(c,t,e)=>it(void 0,void 0,void 0,function*(){if(c&&typeof c=="object"&&"status"in c&&"ok"in c&&typeof c.status=="number"&&!e?.noResolveJson){const r=c.status||500,a=c;if(typeof a.json=="function")a.json().then(o=>{const u=o?.statusCode||o?.code||r+"";t(new Ec(vb(o),r,u))}).catch(()=>{const o=r+"",u=a.statusText||`HTTP ${r} error`;t(new Ec(u,r,o))});else{const o=r+"",u=a.statusText||`HTTP ${r} error`;t(new Ec(u,r,o))}}else t(new cv(vb(c),c))}),LS=(c,t,e,n)=>{const r={method:c,headers:t?.headers||{}};return n?(uv(n)?(r.headers=Object.assign({"Content-Type":"application/json"},t?.headers),r.body=JSON.stringify(n)):r.body=n,Object.assign(Object.assign({},r),e)):r};function PS(c,t,e,n,r,a){return it(this,void 0,void 0,function*(){return new Promise((o,u)=>{c(e,LS(t,n,r,a)).then(d=>{if(!d.ok)throw d;if(n?.noResolveJson)return d;const f=d.headers.get("content-type");return!f||!f.includes("application/json")?{}:d.json()}).then(d=>o(d)).catch(d=>jS(d,u,n))})})}function bs(c,t,e,n,r){return it(this,void 0,void 0,function*(){return PS(c,"POST",t,n,r,e)})}class hv{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Df),e),this.fetch=Vc(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(t){return it(this,void 0,void 0,function*(){try{return{data:(yield bs(this.fetch,`${this.url}/CreateIndex`,t,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(os(e))return{data:null,error:e};throw e}})}getIndex(t,e){return it(this,void 0,void 0,function*(){try{return{data:yield bs(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(os(n))return{data:null,error:n};throw n}})}listIndexes(t){return it(this,void 0,void 0,function*(){try{return{data:yield bs(this.fetch,`${this.url}/ListIndexes`,t,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(os(e))return{data:null,error:e};throw e}})}deleteIndex(t,e){return it(this,void 0,void 0,function*(){try{return{data:(yield bs(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(os(n))return{data:null,error:n};throw n}})}}class dv{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Df),e),this.fetch=Vc(n)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(t){return it(this,void 0,void 0,function*(){try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield bs(this.fetch,`${this.url}/PutVectors`,t,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(os(e))return{data:null,error:e};throw e}})}getVectors(t){return it(this,void 0,void 0,function*(){try{return{data:yield bs(this.fetch,`${this.url}/GetVectors`,t,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(os(e))return{data:null,error:e};throw e}})}listVectors(t){return it(this,void 0,void 0,function*(){try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:yield bs(this.fetch,`${this.url}/ListVectors`,t,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(os(e))return{data:null,error:e};throw e}})}queryVectors(t){return it(this,void 0,void 0,function*(){try{return{data:yield bs(this.fetch,`${this.url}/QueryVectors`,t,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(os(e))return{data:null,error:e};throw e}})}deleteVectors(t){return it(this,void 0,void 0,function*(){try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield bs(this.fetch,`${this.url}/DeleteVectors`,t,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(os(e))return{data:null,error:e};throw e}})}}class fv{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Df),e),this.fetch=Vc(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return it(this,void 0,void 0,function*(){try{return{data:(yield bs(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(os(e))return{data:null,error:e};throw e}})}getBucket(t){return it(this,void 0,void 0,function*(){try{return{data:yield bs(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:t},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(os(e))return{data:null,error:e};throw e}})}listBuckets(){return it(this,arguments,void 0,function*(t={}){try{return{data:yield bs(this.fetch,`${this.url}/ListVectorBuckets`,t,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(os(e))return{data:null,error:e};throw e}})}deleteBucket(t){return it(this,void 0,void 0,function*(){try{return{data:(yield bs(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(os(e))return{data:null,error:e};throw e}})}}class pv extends fv{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new gv(this.url,this.headers,t,this.fetch)}createBucket(t){const e=Object.create(null,{createBucket:{get:()=>super.createBucket}});return it(this,void 0,void 0,function*(){return e.createBucket.call(this,t)})}getBucket(t){const e=Object.create(null,{getBucket:{get:()=>super.getBucket}});return it(this,void 0,void 0,function*(){return e.getBucket.call(this,t)})}listBuckets(){const t=Object.create(null,{listBuckets:{get:()=>super.listBuckets}});return it(this,arguments,void 0,function*(e={}){return t.listBuckets.call(this,e)})}deleteBucket(t){const e=Object.create(null,{deleteBucket:{get:()=>super.deleteBucket}});return it(this,void 0,void 0,function*(){return e.deleteBucket.call(this,t)})}}class gv extends hv{constructor(t,e,n,r){super(t,e,r),this.vectorBucketName=n}createIndex(t){const e=Object.create(null,{createIndex:{get:()=>super.createIndex}});return it(this,void 0,void 0,function*(){return e.createIndex.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const t=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return it(this,arguments,void 0,function*(e={}){return t.listIndexes.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}getIndex(t){const e=Object.create(null,{getIndex:{get:()=>super.getIndex}});return it(this,void 0,void 0,function*(){return e.getIndex.call(this,this.vectorBucketName,t)})}deleteIndex(t){const e=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return it(this,void 0,void 0,function*(){return e.deleteIndex.call(this,this.vectorBucketName,t)})}index(t){return new mv(this.url,this.headers,this.vectorBucketName,t,this.fetch)}}class mv extends dv{constructor(t,e,n,r,a){super(t,e,a),this.vectorBucketName=n,this.indexName=r}putVectors(t){const e=Object.create(null,{putVectors:{get:()=>super.putVectors}});return it(this,void 0,void 0,function*(){return e.putVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(t){const e=Object.create(null,{getVectors:{get:()=>super.getVectors}});return it(this,void 0,void 0,function*(){return e.getVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const t=Object.create(null,{listVectors:{get:()=>super.listVectors}});return it(this,arguments,void 0,function*(e={}){return t.listVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(t){const e=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return it(this,void 0,void 0,function*(){return e.queryVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(t){const e=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return it(this,void 0,void 0,function*(){return e.deleteVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class BS extends xS{constructor(t,e={},n,r){super(t,e,n,r)}from(t){return new SS(this.url,this.headers,t,this.fetch)}get vectors(){return new pv(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new lv(this.url+"/iceberg",this.headers,this.fetch)}}const IS=Object.freeze(Object.defineProperty({__proto__:null,StorageAnalyticsClient:lv,StorageApiError:iv,StorageClient:BS,StorageError:Oo,StorageUnknownError:jc,StorageVectorsApiError:Ec,StorageVectorsClient:pv,StorageVectorsError:Mf,get StorageVectorsErrorCode(){return tf},StorageVectorsUnknownError:cv,VectorBucketApi:fv,VectorBucketScope:gv,VectorDataApi:dv,VectorIndexApi:hv,VectorIndexScope:mv,isPlainObject:uv,isStorageError:re,isStorageVectorsError:os,normalizeToFloat32:DS,resolveFetch:Vc,resolveResponse:kS,validateVectorDimension:MS},Symbol.toStringTag,{value:"Module"})),US=Ro(IS);var Cd={},Za={},wb;function FS(){return wb||(wb=1,Object.defineProperty(Za,"__esModule",{value:!0}),Za.version=void 0,Za.version="2.87.1"),Za}var _b;function zS(){return _b||(_b=1,(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.DEFAULT_REALTIME_OPTIONS=c.DEFAULT_AUTH_OPTIONS=c.DEFAULT_DB_OPTIONS=c.DEFAULT_GLOBAL_OPTIONS=c.DEFAULT_HEADERS=void 0;const t=FS();let e="";typeof Deno<"u"?e="deno":typeof document<"u"?e="web":typeof navigator<"u"&&navigator.product==="ReactNative"?e="react-native":e="node",c.DEFAULT_HEADERS={"X-Client-Info":`supabase-js-${e}/${t.version}`},c.DEFAULT_GLOBAL_OPTIONS={headers:c.DEFAULT_HEADERS},c.DEFAULT_DB_OPTIONS={schema:"public"},c.DEFAULT_AUTH_OPTIONS={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},c.DEFAULT_REALTIME_OPTIONS={}})(Cd)),Cd}var Rd={},Ab;function HS(){return Ab||(Ab=1,(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.fetchWithAuth=c.resolveHeadersConstructor=c.resolveFetch=void 0;const t=r=>r?(...a)=>r(...a):(...a)=>fetch(...a);c.resolveFetch=t;const e=()=>Headers;c.resolveHeadersConstructor=e;const n=(r,a,o)=>{const u=(0,c.resolveFetch)(o),d=(0,c.resolveHeadersConstructor)();return async(f,p)=>{var m;const y=(m=await a())!==null&&m!==void 0?m:r;let v=new d(p?.headers);return v.has("apikey")||v.set("apikey",r),v.has("Authorization")||v.set("Authorization",`Bearer ${y}`),u(f,Object.assign(Object.assign({},p),{headers:v}))}};c.fetchWithAuth=n})(Rd)),Rd}var Tn={},Sb;function $S(){if(Sb)return Tn;Sb=1,Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.isBrowser=void 0,Tn.uuid=c,Tn.ensureTrailingSlash=t,Tn.applySettingDefaults=n,Tn.validateSupabaseUrl=r;function c(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var o=Math.random()*16|0,u=a=="x"?o:o&3|8;return u.toString(16)})}function t(a){return a.endsWith("/")?a:a+"/"}const e=()=>typeof window<"u";Tn.isBrowser=e;function n(a,o){var u,d;const{db:f,auth:p,realtime:m,global:y}=a,{db:v,auth:_,realtime:w,global:S}=o,E={db:Object.assign(Object.assign({},v),f),auth:Object.assign(Object.assign({},_),p),realtime:Object.assign(Object.assign({},w),m),storage:{},global:Object.assign(Object.assign(Object.assign({},S),y),{headers:Object.assign(Object.assign({},(u=S?.headers)!==null&&u!==void 0?u:{}),(d=y?.headers)!==null&&d!==void 0?d:{})}),accessToken:async()=>""};return a.accessToken?E.accessToken=a.accessToken:delete E.accessToken,E}function r(a){const o=a?.trim();if(!o)throw new Error("supabaseUrl is required.");if(!o.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(t(o))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}return Tn}var to={};const bv="2.87.1",zr=30*1e3,ef=3,Od=ef*zr,qS="http://localhost:9999",GS="supabase.auth.token",VS={"X-Client-Info":`gotrue-js/${bv}`},sf="X-Supabase-Api-Version",yv={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},XS=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,YS=600*1e3;let sa=class extends Error{constructor(t,e,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=n}};function lt(c){return typeof c=="object"&&c!==null&&"__isAuthError"in c}let vv=class extends sa{constructor(t,e,n){super(t,e,n),this.name="AuthApiError",this.status=e,this.code=n}};function wv(c){return lt(c)&&c.name==="AuthApiError"}let ei=class extends sa{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}},Nn=class extends sa{constructor(t,e,n,r){super(t,n,r),this.name=e,this.status=n}},is=class extends Nn{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}};function _v(c){return lt(c)&&c.name==="AuthSessionMissingError"}let ki=class extends Nn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}},uo=class extends Nn{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}},ho=class extends Nn{constructor(t,e=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};function Av(c){return lt(c)&&c.name==="AuthImplicitGrantRedirectError"}let nf=class extends Nn{constructor(t,e=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},Lc=class extends Nn{constructor(t,e){super(t,"AuthRetryableFetchError",e,void 0)}};function Tc(c){return lt(c)&&c.name==="AuthRetryableFetchError"}let rf=class extends Nn{constructor(t,e,n){super(t,"AuthWeakPasswordError",e,"weak_password"),this.reasons=n}};function KS(c){return lt(c)&&c.name==="AuthWeakPasswordError"}let Pc=class extends Nn{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}};const Bc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),xb=` 	
\r=`.split(""),WS=(()=>{const c=new Array(128);for(let t=0;t<c.length;t+=1)c[t]=-1;for(let t=0;t<xb.length;t+=1)c[xb[t].charCodeAt(0)]=-2;for(let t=0;t<Bc.length;t+=1)c[Bc[t].charCodeAt(0)]=t;return c})();function Eb(c,t,e){if(c!==null)for(t.queue=t.queue<<8|c,t.queuedBits+=8;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;e(Bc[n]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;e(Bc[n]),t.queuedBits-=6}}function Sv(c,t,e){const n=WS[c];if(n>-1)for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)e(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(c)}"`)}}function Tb(c){const t=[],e=o=>{t.push(String.fromCodePoint(o))},n={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},a=o=>{ZS(o,n,e)};for(let o=0;o<c.length;o+=1)Sv(c.charCodeAt(o),r,a);return t.join("")}function QS(c,t){if(c<=127){t(c);return}else if(c<=2047){t(192|c>>6),t(128|c&63);return}else if(c<=65535){t(224|c>>12),t(128|c>>6&63),t(128|c&63);return}else if(c<=1114111){t(240|c>>18),t(128|c>>12&63),t(128|c>>6&63),t(128|c&63);return}throw new Error(`Unrecognized Unicode codepoint: ${c.toString(16)}`)}function JS(c,t){for(let e=0;e<c.length;e+=1){let n=c.charCodeAt(e);if(n>55295&&n<=56319){const r=(n-55296)*1024&65535;n=(c.charCodeAt(e+1)-56320&65535|r)+65536,e+=1}QS(n,t)}}function ZS(c,t,e){if(t.utf8seq===0){if(c<=127){e(c);return}for(let n=1;n<6;n+=1)if((c>>7-n&1)===0){t.utf8seq=n;break}if(t.utf8seq===2)t.codepoint=c&31;else if(t.utf8seq===3)t.codepoint=c&15;else if(t.utf8seq===4)t.codepoint=c&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(c<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|c&63,t.utf8seq-=1,t.utf8seq===0&&e(t.codepoint)}}function Wr(c){const t=[],e={queue:0,queuedBits:0},n=r=>{t.push(r)};for(let r=0;r<c.length;r+=1)Sv(c.charCodeAt(r),e,n);return new Uint8Array(t)}function tx(c){const t=[];return JS(c,e=>t.push(e)),new Uint8Array(t)}function Pi(c){const t=[],e={queue:0,queuedBits:0},n=r=>{t.push(r)};return c.forEach(r=>Eb(r,e,n)),Eb(null,e,n),t.join("")}function ex(c){return Math.round(Date.now()/1e3)+c}function sx(){return Symbol("auth-callback")}const je=()=>typeof window<"u"&&typeof document<"u",Oi={tested:!1,writable:!1},xv=()=>{if(!je())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Oi.tested)return Oi.writable;const c=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(c,c),globalThis.localStorage.removeItem(c),Oi.tested=!0,Oi.writable=!0}catch{Oi.tested=!0,Oi.writable=!1}return Oi.writable};function nx(c){const t={},e=new URL(c);if(e.hash&&e.hash[0]==="#")try{new URLSearchParams(e.hash.substring(1)).forEach((r,a)=>{t[a]=r})}catch{}return e.searchParams.forEach((n,r)=>{t[r]=n}),t}const Ev=c=>c?(...t)=>c(...t):(...t)=>fetch(...t),ix=c=>typeof c=="object"&&c!==null&&"status"in c&&"ok"in c&&"json"in c&&typeof c.json=="function",Hr=async(c,t,e)=>{await c.setItem(t,JSON.stringify(e))},Ni=async(c,t)=>{const e=await c.getItem(t);if(!e)return null;try{return JSON.parse(e)}catch{return e}},De=async(c,t)=>{await c.removeItem(t)};class Xc{constructor(){this.promise=new Xc.promiseConstructor((t,e)=>{this.resolve=t,this.reject=e})}}Xc.promiseConstructor=Promise;function Nd(c){const t=c.split(".");if(t.length!==3)throw new Pc("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!XS.test(t[n]))throw new Pc("JWT not in base64url format");return{header:JSON.parse(Tb(t[0])),payload:JSON.parse(Tb(t[1])),signature:Wr(t[2]),raw:{header:t[0],payload:t[1]}}}async function rx(c){return await new Promise(t=>{setTimeout(()=>t(null),c)})}function ax(c,t){return new Promise((n,r)=>{(async()=>{for(let a=0;a<1/0;a++)try{const o=await c(a);if(!t(a,null,o)){n(o);return}}catch(o){if(!t(a,o)){r(o);return}}})()})}function ox(c){return("0"+c.toString(16)).substr(-2)}function lx(){const t=new Uint32Array(56);if(typeof crypto>"u"){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=e.length;let r="";for(let a=0;a<56;a++)r+=e.charAt(Math.floor(Math.random()*n));return r}return crypto.getRandomValues(t),Array.from(t,ox).join("")}async function cx(c){const e=new TextEncoder().encode(c),n=await crypto.subtle.digest("SHA-256",e),r=new Uint8Array(n);return Array.from(r).map(a=>String.fromCharCode(a)).join("")}async function ux(c){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),c;const e=await cx(c);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Br(c,t,e=!1){const n=lx();let r=n;e&&(r+="/PASSWORD_RECOVERY"),await Hr(c,`${t}-code-verifier`,r);const a=await ux(n);return[a,n===a?"plain":"s256"]}const hx=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function dx(c){const t=c.headers.get(sf);if(!t||!t.match(hx))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function fx(c){if(!c)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(c<=t)throw new Error("JWT has expired")}function px(c){switch(c){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const gx=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ir(c){if(!gx.test(c))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function kd(){const c={};return new Proxy(c,{get:(t,e)=>{if(e==="__isUserNotAvailableProxy")return!0;if(typeof e=="symbol"){const n=e.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${e}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function mx(c,t){return new Proxy(c,{get:(e,n,r)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const a=n.toString();if(a==="Symbol(Symbol.toPrimitive)"||a==="Symbol(Symbol.toStringTag)"||a==="Symbol(util.inspect.custom)"||a==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(e,n,r)}return!t.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(e,n,r)}})}function Cb(c){return JSON.parse(JSON.stringify(c))}const Di=c=>c.msg||c.message||c.error_description||c.error||JSON.stringify(c),bx=[502,503,504];async function Rb(c){var t;if(!ix(c))throw new Lc(Di(c),0);if(bx.includes(c.status))throw new Lc(Di(c),c.status);let e;try{e=await c.json()}catch(a){throw new ei(Di(a),a)}let n;const r=dx(c);if(r&&r.getTime()>=yv["2024-01-01"].timestamp&&typeof e=="object"&&e&&typeof e.code=="string"?n=e.code:typeof e=="object"&&e&&typeof e.error_code=="string"&&(n=e.error_code),n){if(n==="weak_password")throw new rf(Di(e),c.status,((t=e.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(n==="session_not_found")throw new is}else if(typeof e=="object"&&e&&typeof e.weak_password=="object"&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((a,o)=>a&&typeof o=="string",!0))throw new rf(Di(e),c.status,e.weak_password.reasons);throw new vv(Di(e),c.status||500,n)}const yx=(c,t,e,n)=>{const r={method:c,headers:t?.headers||{}};return c==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),r.body=JSON.stringify(n),Object.assign(Object.assign({},r),e))};async function vt(c,t,e,n){var r;const a=Object.assign({},n?.headers);a[sf]||(a[sf]=yv["2024-01-01"].name),n?.jwt&&(a.Authorization=`Bearer ${n.jwt}`);const o=(r=n?.query)!==null&&r!==void 0?r:{};n?.redirectTo&&(o.redirect_to=n.redirectTo);const u=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",d=await vx(c,t,e+u,{headers:a,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(d):{data:Object.assign({},d),error:null}}async function vx(c,t,e,n,r,a){const o=yx(t,n,r,a);let u;try{u=await c(e,Object.assign({},o))}catch(d){throw console.error(d),new Lc(Di(d),0)}if(u.ok||await Rb(u),n?.noResolveJson)return u;try{return await u.json()}catch(d){await Rb(d)}}function Fs(c){var t;let e=null;Ax(c)&&(e=Object.assign({},c),c.expires_at||(e.expires_at=ex(c.expires_in)));const n=(t=c.user)!==null&&t!==void 0?t:c;return{data:{session:e,user:n},error:null}}function Ob(c){const t=Fs(c);return!t.error&&c.weak_password&&typeof c.weak_password=="object"&&Array.isArray(c.weak_password.reasons)&&c.weak_password.reasons.length&&c.weak_password.message&&typeof c.weak_password.message=="string"&&c.weak_password.reasons.reduce((e,n)=>e&&typeof n=="string",!0)&&(t.data.weak_password=c.weak_password),t}function si(c){var t;return{data:{user:(t=c.user)!==null&&t!==void 0?t:c},error:null}}function wx(c){return{data:c,error:null}}function _x(c){const{action_link:t,email_otp:e,hashed_token:n,redirect_to:r,verification_type:a}=c,o=ia(c,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),u={action_link:t,email_otp:e,hashed_token:n,redirect_to:r,verification_type:a},d=Object.assign({},o);return{data:{properties:u,user:d},error:null}}function Nb(c){return c}function Ax(c){return c.access_token&&c.refresh_token&&c.expires_in}const Cc=["global","local","others"];let jf=class{constructor({url:t="",headers:e={},fetch:n}){this.url=t,this.headers=e,this.fetch=Ev(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,e=Cc[0]){if(Cc.indexOf(e)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Cc.join(", ")}`);try{return await vt(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(lt(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t,e={}){try{return await vt(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:si})}catch(n){if(lt(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:e}=t,n=ia(t,["options"]),r=Object.assign(Object.assign({},n),e);return"newEmail"in n&&(r.new_email=n?.newEmail,delete r.newEmail),await vt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:_x,redirectTo:e?.redirectTo})}catch(e){if(lt(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(t){try{return await vt(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:si})}catch(e){if(lt(e))return{data:{user:null},error:e};throw e}}async listUsers(t){var e,n,r,a,o,u,d;try{const f={nextPage:null,lastPage:0,total:0},p=await vt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(e=t?.page)===null||e===void 0?void 0:e.toString())!==null&&n!==void 0?n:"",per_page:(a=(r=t?.perPage)===null||r===void 0?void 0:r.toString())!==null&&a!==void 0?a:""},xform:Nb});if(p.error)throw p.error;const m=await p.json(),y=(o=p.headers.get("x-total-count"))!==null&&o!==void 0?o:0,v=(d=(u=p.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&d!==void 0?d:[];return v.length>0&&(v.forEach(_=>{const w=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(_.split(";")[1].split("=")[1]);f[`${S}Page`]=w}),f.total=parseInt(y)),{data:Object.assign(Object.assign({},m),f),error:null}}catch(f){if(lt(f))return{data:{users:[]},error:f};throw f}}async getUserById(t){Ir(t);try{return await vt(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:si})}catch(e){if(lt(e))return{data:{user:null},error:e};throw e}}async updateUserById(t,e){Ir(t);try{return await vt(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:si})}catch(n){if(lt(n))return{data:{user:null},error:n};throw n}}async deleteUser(t,e=!1){Ir(t);try{return await vt(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:si})}catch(n){if(lt(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){Ir(t.userId);try{const{data:e,error:n}=await vt(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:r=>({data:{factors:r},error:null})});return{data:e,error:n}}catch(e){if(lt(e))return{data:null,error:e};throw e}}async _deleteFactor(t){Ir(t.userId),Ir(t.id);try{return{data:await vt(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(lt(e))return{data:null,error:e};throw e}}async _listOAuthClients(t){var e,n,r,a,o,u,d;try{const f={nextPage:null,lastPage:0,total:0},p=await vt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(e=t?.page)===null||e===void 0?void 0:e.toString())!==null&&n!==void 0?n:"",per_page:(a=(r=t?.perPage)===null||r===void 0?void 0:r.toString())!==null&&a!==void 0?a:""},xform:Nb});if(p.error)throw p.error;const m=await p.json(),y=(o=p.headers.get("x-total-count"))!==null&&o!==void 0?o:0,v=(d=(u=p.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&d!==void 0?d:[];return v.length>0&&(v.forEach(_=>{const w=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(_.split(";")[1].split("=")[1]);f[`${S}Page`]=w}),f.total=parseInt(y)),{data:Object.assign(Object.assign({},m),f),error:null}}catch(f){if(lt(f))return{data:{clients:[]},error:f};throw f}}async _createOAuthClient(t){try{return await vt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(lt(e))return{data:null,error:e};throw e}}async _getOAuthClient(t){try{return await vt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(lt(e))return{data:null,error:e};throw e}}async _updateOAuthClient(t,e){try{return await vt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(lt(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(t){try{return await vt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(e){if(lt(e))return{data:null,error:e};throw e}}async _regenerateOAuthClientSecret(t){try{return await vt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(lt(e))return{data:null,error:e};throw e}}};function kb(c={}){return{getItem:t=>c[t]||null,setItem:(t,e)=>{c[t]=e},removeItem:t=>{delete c[t]}}}const Mi={debug:!!(globalThis&&xv()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Lf extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}let Tv=class extends Lf{};class Sx extends Lf{}async function Cv(c,t,e){Mi.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",c,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),Mi.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",c)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(c,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async r=>{if(r){Mi.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",c,r.name);try{return await e()}finally{Mi.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",c,r.name)}}else{if(t===0)throw Mi.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",c),new Tv(`Acquiring an exclusive Navigator LockManager lock "${c}" immediately failed`);if(Mi.debug)try{const a=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(a,null,"  "))}catch(a){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",a)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await e()}}))}const Db={};async function xx(c,t,e){var n;const r=(n=Db[c])!==null&&n!==void 0?n:Promise.resolve(),a=Promise.race([r.catch(()=>null),t>=0?new Promise((o,u)=>{setTimeout(()=>{u(new Sx(`Acquring process lock with name "${c}" timed out`))},t)}):null].filter(o=>o)).catch(o=>{if(o&&o.isAcquireTimeout)throw o;return null}).then(async()=>await e());return Db[c]=a.catch(async o=>{if(o&&o.isAcquireTimeout)return await r,null;throw o}),await a}function Ex(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Rv(c){if(!/^0x[a-fA-F0-9]{40}$/.test(c))throw new Error(`@supabase/auth-js: Address "${c}" is invalid.`);return c.toLowerCase()}function Tx(c){return parseInt(c,16)}function Cx(c){const t=new TextEncoder().encode(c);return"0x"+Array.from(t,n=>n.toString(16).padStart(2,"0")).join("")}function Rx(c){var t;const{chainId:e,domain:n,expirationTime:r,issuedAt:a=new Date,nonce:o,notBefore:u,requestId:d,resources:f,scheme:p,uri:m,version:y}=c;{if(!Number.isInteger(e))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${e}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!m)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(y!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${y}`);if(!((t=c.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${c.statement}`)}const v=Rv(c.address),_=p?`${p}://${n}`:n,w=c.statement?`${c.statement}
`:"",S=`${_} wants you to sign in with your Ethereum account:
${v}

${w}`;let E=`URI: ${m}
Version: ${y}
Chain ID: ${e}${o?`
Nonce: ${o}`:""}
Issued At: ${a.toISOString()}`;if(r&&(E+=`
Expiration Time: ${r.toISOString()}`),u&&(E+=`
Not Before: ${u.toISOString()}`),d&&(E+=`
Request ID: ${d}`),f){let R=`
Resources:`;for(const T of f){if(!T||typeof T!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${T}`);R+=`
- ${T}`}E+=R}return`${S}
${E}`}class _e extends Error{constructor({message:t,code:e,cause:n,name:r}){var a;super(t,{cause:n}),this.__isWebAuthnError=!0,this.name=(a=r??(n instanceof Error?n.name:void 0))!==null&&a!==void 0?a:"Unknown Error",this.code=e}}class Ic extends _e{constructor(t,e){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e,message:t}),this.name="WebAuthnUnknownError",this.originalError=e}}function Ox({error:c,options:t}){var e,n,r;const{publicKey:a}=t;if(!a)throw Error("options was missing required publicKey property");if(c.name==="AbortError"){if(t.signal instanceof AbortSignal)return new _e({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:c})}else if(c.name==="ConstraintError"){if(((e=a.authenticatorSelection)===null||e===void 0?void 0:e.requireResidentKey)===!0)return new _e({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:c});if(t.mediation==="conditional"&&((n=a.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new _e({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:c});if(((r=a.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new _e({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:c})}else{if(c.name==="InvalidStateError")return new _e({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:c});if(c.name==="NotAllowedError")return new _e({message:c.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:c});if(c.name==="NotSupportedError")return a.pubKeyCredParams.filter(u=>u.type==="public-key").length===0?new _e({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:c}):new _e({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:c});if(c.name==="SecurityError"){const o=window.location.hostname;if(Ov(o)){if(a.rp.id!==o)return new _e({message:`The RP ID "${a.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:c})}else return new _e({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:c})}else if(c.name==="TypeError"){if(a.user.id.byteLength<1||a.user.id.byteLength>64)return new _e({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:c})}else if(c.name==="UnknownError")return new _e({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:c})}return new _e({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:c})}function Nx({error:c,options:t}){const{publicKey:e}=t;if(!e)throw Error("options was missing required publicKey property");if(c.name==="AbortError"){if(t.signal instanceof AbortSignal)return new _e({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:c})}else{if(c.name==="NotAllowedError")return new _e({message:c.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:c});if(c.name==="SecurityError"){const n=window.location.hostname;if(Ov(n)){if(e.rpId!==n)return new _e({message:`The RP ID "${e.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:c})}else return new _e({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:c})}else if(c.name==="UnknownError")return new _e({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:c})}return new _e({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:c})}class kx{createNewAbortSignal(){if(this.controller){const e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const Dx=new kx;function Mx(c){if(!c)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(c);const{challenge:t,user:e,excludeCredentials:n}=c,r=ia(c,["challenge","user","excludeCredentials"]),a=Wr(t).buffer,o=Object.assign(Object.assign({},e),{id:Wr(e.id).buffer}),u=Object.assign(Object.assign({},r),{challenge:a,user:o});if(n&&n.length>0){u.excludeCredentials=new Array(n.length);for(let d=0;d<n.length;d++){const f=n[d];u.excludeCredentials[d]=Object.assign(Object.assign({},f),{id:Wr(f.id).buffer,type:f.type||"public-key",transports:f.transports})}}return u}function jx(c){if(!c)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(c);const{challenge:t,allowCredentials:e}=c,n=ia(c,["challenge","allowCredentials"]),r=Wr(t).buffer,a=Object.assign(Object.assign({},n),{challenge:r});if(e&&e.length>0){a.allowCredentials=new Array(e.length);for(let o=0;o<e.length;o++){const u=e[o];a.allowCredentials[o]=Object.assign(Object.assign({},u),{id:Wr(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return a}function Lx(c){var t;if("toJSON"in c&&typeof c.toJSON=="function")return c.toJSON();const e=c;return{id:c.id,rawId:c.id,response:{attestationObject:Pi(new Uint8Array(c.response.attestationObject)),clientDataJSON:Pi(new Uint8Array(c.response.clientDataJSON))},type:"public-key",clientExtensionResults:c.getClientExtensionResults(),authenticatorAttachment:(t=e.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Px(c){var t;if("toJSON"in c&&typeof c.toJSON=="function")return c.toJSON();const e=c,n=c.getClientExtensionResults(),r=c.response;return{id:c.id,rawId:c.id,response:{authenticatorData:Pi(new Uint8Array(r.authenticatorData)),clientDataJSON:Pi(new Uint8Array(r.clientDataJSON)),signature:Pi(new Uint8Array(r.signature)),userHandle:r.userHandle?Pi(new Uint8Array(r.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(t=e.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Ov(c){return c==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(c)}function Mb(){var c,t;return!!(je()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((c=navigator?.credentials)===null||c===void 0?void 0:c.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}async function Bx(c){try{const t=await navigator.credentials.create(c);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Ic("Browser returned unexpected credential type",t)}:{data:null,error:new Ic("Empty credential response",t)}}catch(t){return{data:null,error:Ox({error:t,options:c})}}}async function Ix(c){try{const t=await navigator.credentials.get(c);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Ic("Browser returned unexpected credential type",t)}:{data:null,error:new Ic("Empty credential response",t)}}catch(t){return{data:null,error:Nx({error:t,options:c})}}}const Ux={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},Fx={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Uc(...c){const t=r=>r!==null&&typeof r=="object"&&!Array.isArray(r),e=r=>r instanceof ArrayBuffer||ArrayBuffer.isView(r),n={};for(const r of c)if(r)for(const a in r){const o=r[a];if(o!==void 0)if(Array.isArray(o))n[a]=o;else if(e(o))n[a]=o;else if(t(o)){const u=n[a];t(u)?n[a]=Uc(u,o):n[a]=Uc(o)}else n[a]=o}return n}function zx(c,t){return Uc(Ux,c,t||{})}function Hx(c,t){return Uc(Fx,c,t||{})}class $x{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:e,friendlyName:n,signal:r},a){try{const{data:o,error:u}=await this.client.mfa.challenge({factorId:t,webauthn:e});if(!o)return{data:null,error:u};const d=r??Dx.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:f}=o.webauthn.credential_options.publicKey;f.name||(f.name=`${f.id}:${n}`),f.displayName||(f.displayName=f.name)}switch(o.webauthn.type){case"create":{const f=zx(o.webauthn.credential_options.publicKey,a?.create),{data:p,error:m}=await Bx({publicKey:f,signal:d});return p?{data:{factorId:t,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:p}},error:null}:{data:null,error:m}}case"request":{const f=Hx(o.webauthn.credential_options.publicKey,a?.request),{data:p,error:m}=await Ix(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:f,signal:d}));return p?{data:{factorId:t,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:p}},error:null}:{data:null,error:m}}}}catch(o){return lt(o)?{data:null,error:o}:{data:null,error:new ei("Unexpected error in challenge",o)}}}async _verify({challengeId:t,factorId:e,webauthn:n}){return this.client.mfa.verify({factorId:e,challengeId:t,webauthn:n})}async _authenticate({factorId:t,webauthn:{rpId:e=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:r}={}},a){if(!e)return{data:null,error:new sa("rpId is required for WebAuthn authentication")};try{if(!Mb())return{data:null,error:new ei("Browser does not support WebAuthn",null)};const{data:o,error:u}=await this.challenge({factorId:t,webauthn:{rpId:e,rpOrigins:n},signal:r},{request:a});if(!o)return{data:null,error:u};const{webauthn:d}=o;return this._verify({factorId:t,challengeId:o.challengeId,webauthn:{type:d.type,rpId:e,rpOrigins:n,credential_response:d.credential_response}})}catch(o){return lt(o)?{data:null,error:o}:{data:null,error:new ei("Unexpected error in authenticate",o)}}}async _register({friendlyName:t,webauthn:{rpId:e=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:r}={}},a){if(!e)return{data:null,error:new sa("rpId is required for WebAuthn registration")};try{if(!Mb())return{data:null,error:new ei("Browser does not support WebAuthn",null)};const{data:o,error:u}=await this._enroll({friendlyName:t});if(!o)return await this.client.mfa.listFactors().then(p=>{var m;return(m=p.data)===null||m===void 0?void 0:m.all.find(y=>y.factor_type==="webauthn"&&y.friendly_name===t&&y.status!=="unverified")}).then(p=>p?this.client.mfa.unenroll({factorId:p?.id}):void 0),{data:null,error:u};const{data:d,error:f}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:e,rpOrigins:n},signal:r},{create:a});return d?this._verify({factorId:o.id,challengeId:d.challengeId,webauthn:{rpId:e,rpOrigins:n,type:d.webauthn.type,credential_response:d.webauthn.credential_response}}):{data:null,error:f}}catch(o){return lt(o)?{data:null,error:o}:{data:null,error:new ei("Unexpected error in register",o)}}}}Ex();const qx={url:qS,storageKey:GS,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:VS,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function jb(c,t,e){return await e()}const Ur={};let Pf=class af{get jwks(){var t,e;return(e=(t=Ur[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&e!==void 0?e:{keys:[]}}set jwks(t){Ur[this.storageKey]=Object.assign(Object.assign({},Ur[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,e;return(e=(t=Ur[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&e!==void 0?e:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Ur[this.storageKey]=Object.assign(Object.assign({},Ur[this.storageKey]),{cachedAt:t})}constructor(t){var e,n,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const a=Object.assign(Object.assign({},qx),t);if(this.storageKey=a.storageKey,this.instanceID=(e=af.nextInstanceID[this.storageKey])!==null&&e!==void 0?e:0,af.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!a.debug,typeof a.debug=="function"&&(this.logger=a.debug),this.instanceID>0&&je()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=a.persistSession,this.autoRefreshToken=a.autoRefreshToken,this.admin=new jf({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=Ev(a.fetch),this.lock=a.lock||jb,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,this.throwOnError=a.throwOnError,a.lock?this.lock=a.lock:this.persistSession&&je()&&(!((n=globalThis?.navigator)===null||n===void 0)&&n.locks)?this.lock=Cv:this.lock=jb,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new $x(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:xv()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=kb(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=kb(this.memoryStorage)),je()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${bv}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let e={},n="none";if(je()&&(e=nx(window.location.href),this._isImplicitGrantCallback(e)?n="implicit":await this._isPKCECallback(e)&&(n="pkce")),je()&&this.detectSessionInUrl&&n!=="none"){const{data:r,error:a}=await this._getSessionFromURL(e,n);if(a){if(this._debug("#_initialize()","error detecting session from URL",a),Av(a)){const d=(t=a.details)===null||t===void 0?void 0:t.code;if(d==="identity_already_exists"||d==="identity_not_found"||d==="single_identity_not_deletable")return{error:a}}return await this._removeSession(),{error:a}}const{session:o,redirectType:u}=r;return this._debug("#_initialize()","detected session in URL",o,"redirect type",u),await this._saveSession(o),setTimeout(async()=>{u==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return lt(e)?this._returnResult({error:e}):this._returnResult({error:new ei("Unexpected error during initialization",e)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var e,n,r;try{const a=await vt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(e=t?.options)===null||e===void 0?void 0:e.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(r=t?.options)===null||r===void 0?void 0:r.captchaToken}},xform:Fs}),{data:o,error:u}=a;if(u||!o)return this._returnResult({data:{user:null,session:null},error:u});const d=o.session,f=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",d)),this._returnResult({data:{user:f,session:d},error:null})}catch(a){if(lt(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signUp(t){var e,n,r;try{let a;if("email"in t){const{email:p,password:m,options:y}=t;let v=null,_=null;this.flowType==="pkce"&&([v,_]=await Br(this.storage,this.storageKey)),a=await vt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:y?.emailRedirectTo,body:{email:p,password:m,data:(e=y?.data)!==null&&e!==void 0?e:{},gotrue_meta_security:{captcha_token:y?.captchaToken},code_challenge:v,code_challenge_method:_},xform:Fs})}else if("phone"in t){const{phone:p,password:m,options:y}=t;a=await vt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:p,password:m,data:(n=y?.data)!==null&&n!==void 0?n:{},channel:(r=y?.channel)!==null&&r!==void 0?r:"sms",gotrue_meta_security:{captcha_token:y?.captchaToken}},xform:Fs})}else throw new uo("You must provide either an email or phone number and a password");const{data:o,error:u}=a;if(u||!o)return await De(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:u});const d=o.session,f=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",d)),this._returnResult({data:{user:f,session:d},error:null})}catch(a){if(await De(this.storage,`${this.storageKey}-code-verifier`),lt(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithPassword(t){try{let e;if("email"in t){const{email:a,password:o,options:u}=t;e=await vt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:a,password:o,gotrue_meta_security:{captcha_token:u?.captchaToken}},xform:Ob})}else if("phone"in t){const{phone:a,password:o,options:u}=t;e=await vt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:a,password:o,gotrue_meta_security:{captcha_token:u?.captchaToken}},xform:Ob})}else throw new uo("You must provide either an email or phone number and a password");const{data:n,error:r}=e;if(r)return this._returnResult({data:{user:null,session:null},error:r});if(!n||!n.session||!n.user){const a=new ki;return this._returnResult({data:{user:null,session:null},error:a})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:r})}catch(e){if(lt(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOAuth(t){var e,n,r,a;return await this._handleProviderSignIn(t.provider,{redirectTo:(e=t.options)===null||e===void 0?void 0:e.redirectTo,scopes:(n=t.options)===null||n===void 0?void 0:n.scopes,queryParams:(r=t.options)===null||r===void 0?void 0:r.queryParams,skipBrowserRedirect:(a=t.options)===null||a===void 0?void 0:a.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:e}=t;switch(e){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${e}"`)}}async signInWithEthereum(t){var e,n,r,a,o,u,d,f,p,m,y;let v,_;if("message"in t)v=t.message,_=t.signature;else{const{chain:w,wallet:S,statement:E,options:R}=t;let T;if(je())if(typeof S=="object")T=S;else{const X=window;if("ethereum"in X&&typeof X.ethereum=="object"&&"request"in X.ethereum&&typeof X.ethereum.request=="function")T=X.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof S!="object"||!R?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");T=S}const O=new URL((e=R?.url)!==null&&e!==void 0?e:window.location.href),N=await T.request({method:"eth_requestAccounts"}).then(X=>X).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!N||N.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const k=Rv(N[0]);let M=(n=R?.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!M){const X=await T.request({method:"eth_chainId"});M=Tx(X)}const I={domain:O.host,address:k,statement:E,uri:O.href,version:"1",chainId:M,nonce:(r=R?.signInWithEthereum)===null||r===void 0?void 0:r.nonce,issuedAt:(o=(a=R?.signInWithEthereum)===null||a===void 0?void 0:a.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(u=R?.signInWithEthereum)===null||u===void 0?void 0:u.expirationTime,notBefore:(d=R?.signInWithEthereum)===null||d===void 0?void 0:d.notBefore,requestId:(f=R?.signInWithEthereum)===null||f===void 0?void 0:f.requestId,resources:(p=R?.signInWithEthereum)===null||p===void 0?void 0:p.resources};v=Rx(I),_=await T.request({method:"personal_sign",params:[Cx(v),k]})}try{const{data:w,error:S}=await vt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:v,signature:_},!((m=t.options)===null||m===void 0)&&m.captchaToken?{gotrue_meta_security:{captcha_token:(y=t.options)===null||y===void 0?void 0:y.captchaToken}}:null),xform:Fs});if(S)throw S;if(!w||!w.session||!w.user){const E=new ki;return this._returnResult({data:{user:null,session:null},error:E})}return w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),this._returnResult({data:Object.assign({},w),error:S})}catch(w){if(lt(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async signInWithSolana(t){var e,n,r,a,o,u,d,f,p,m,y,v;let _,w;if("message"in t)_=t.message,w=t.signature;else{const{chain:S,wallet:E,statement:R,options:T}=t;let O;if(je())if(typeof E=="object")O=E;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))O=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof E!="object"||!T?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");O=E}const N=new URL((e=T?.url)!==null&&e!==void 0?e:window.location.href);if("signIn"in O&&O.signIn){const k=await O.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},T?.signInWithSolana),{version:"1",domain:N.host,uri:N.href}),R?{statement:R}:null));let M;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")M=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)M=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in M&&"signature"in M&&(typeof M.signedMessage=="string"||M.signedMessage instanceof Uint8Array)&&M.signature instanceof Uint8Array)_=typeof M.signedMessage=="string"?M.signedMessage:new TextDecoder().decode(M.signedMessage),w=M.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in O)||typeof O.signMessage!="function"||!("publicKey"in O)||typeof O!="object"||!O.publicKey||!("toBase58"in O.publicKey)||typeof O.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");_=[`${N.host} wants you to sign in with your Solana account:`,O.publicKey.toBase58(),...R?["",R,""]:[""],"Version: 1",`URI: ${N.href}`,`Issued At: ${(r=(n=T?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&r!==void 0?r:new Date().toISOString()}`,...!((a=T?.signInWithSolana)===null||a===void 0)&&a.notBefore?[`Not Before: ${T.signInWithSolana.notBefore}`]:[],...!((o=T?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${T.signInWithSolana.expirationTime}`]:[],...!((u=T?.signInWithSolana)===null||u===void 0)&&u.chainId?[`Chain ID: ${T.signInWithSolana.chainId}`]:[],...!((d=T?.signInWithSolana)===null||d===void 0)&&d.nonce?[`Nonce: ${T.signInWithSolana.nonce}`]:[],...!((f=T?.signInWithSolana)===null||f===void 0)&&f.requestId?[`Request ID: ${T.signInWithSolana.requestId}`]:[],...!((m=(p=T?.signInWithSolana)===null||p===void 0?void 0:p.resources)===null||m===void 0)&&m.length?["Resources",...T.signInWithSolana.resources.map(M=>`- ${M}`)]:[]].join(`
`);const k=await O.signMessage(new TextEncoder().encode(_),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");w=k}}try{const{data:S,error:E}=await vt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:_,signature:Pi(w)},!((y=t.options)===null||y===void 0)&&y.captchaToken?{gotrue_meta_security:{captcha_token:(v=t.options)===null||v===void 0?void 0:v.captchaToken}}:null),xform:Fs});if(E)throw E;if(!S||!S.session||!S.user){const R=new ki;return this._returnResult({data:{user:null,session:null},error:R})}return S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",S.session)),this._returnResult({data:Object.assign({},S),error:E})}catch(S){if(lt(S))return this._returnResult({data:{user:null,session:null},error:S});throw S}}async _exchangeCodeForSession(t){const e=await Ni(this.storage,`${this.storageKey}-code-verifier`),[n,r]=(e??"").split("/");try{const{data:a,error:o}=await vt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:Fs});if(await De(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!a||!a.session||!a.user){const u=new ki;return this._returnResult({data:{user:null,session:null,redirectType:null},error:u})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:Object.assign(Object.assign({},a),{redirectType:r??null}),error:o})}catch(a){if(await De(this.storage,`${this.storageKey}-code-verifier`),lt(a))return this._returnResult({data:{user:null,session:null,redirectType:null},error:a});throw a}}async signInWithIdToken(t){try{const{options:e,provider:n,token:r,access_token:a,nonce:o}=t,u=await vt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:r,access_token:a,nonce:o,gotrue_meta_security:{captcha_token:e?.captchaToken}},xform:Fs}),{data:d,error:f}=u;if(f)return this._returnResult({data:{user:null,session:null},error:f});if(!d||!d.session||!d.user){const p=new ki;return this._returnResult({data:{user:null,session:null},error:p})}return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",d.session)),this._returnResult({data:d,error:f})}catch(e){if(lt(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOtp(t){var e,n,r,a,o;try{if("email"in t){const{email:u,options:d}=t;let f=null,p=null;this.flowType==="pkce"&&([f,p]=await Br(this.storage,this.storageKey));const{error:m}=await vt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:u,data:(e=d?.data)!==null&&e!==void 0?e:{},create_user:(n=d?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:d?.captchaToken},code_challenge:f,code_challenge_method:p},redirectTo:d?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:m})}if("phone"in t){const{phone:u,options:d}=t,{data:f,error:p}=await vt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:u,data:(r=d?.data)!==null&&r!==void 0?r:{},create_user:(a=d?.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:d?.captchaToken},channel:(o=d?.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:f?.message_id},error:p})}throw new uo("You must provide either an email or phone number.")}catch(u){if(await De(this.storage,`${this.storageKey}-code-verifier`),lt(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async verifyOtp(t){var e,n;try{let r,a;"options"in t&&(r=(e=t.options)===null||e===void 0?void 0:e.redirectTo,a=(n=t.options)===null||n===void 0?void 0:n.captchaToken);const{data:o,error:u}=await vt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:a}}),redirectTo:r,xform:Fs});if(u)throw u;if(!o)throw new Error("An error occurred on token verification.");const d=o.session,f=o.user;return d?.access_token&&(await this._saveSession(d),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",d)),this._returnResult({data:{user:f,session:d},error:null})}catch(r){if(lt(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithSSO(t){var e,n,r,a,o;try{let u=null,d=null;this.flowType==="pkce"&&([u,d]=await Br(this.storage,this.storageKey));const f=await vt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(n=(e=t.options)===null||e===void 0?void 0:e.redirectTo)!==null&&n!==void 0?n:void 0}),!((r=t?.options)===null||r===void 0)&&r.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:u,code_challenge_method:d}),headers:this.headers,xform:wx});return!((a=f.data)===null||a===void 0)&&a.url&&je()&&!(!((o=t.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(f.data.url),this._returnResult(f)}catch(u){if(await De(this.storage,`${this.storageKey}-code-verifier`),lt(u))return this._returnResult({data:null,error:u});throw u}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:e},error:n}=t;if(n)throw n;if(!e)throw new is;const{error:r}=await vt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return this._returnResult({data:{user:null,session:null},error:r})})}catch(t){if(lt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const e=`${this.url}/resend`;if("email"in t){const{email:n,type:r,options:a}=t,{error:o}=await vt(this.fetch,"POST",e,{headers:this.headers,body:{email:n,type:r,gotrue_meta_security:{captcha_token:a?.captchaToken}},redirectTo:a?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in t){const{phone:n,type:r,options:a}=t,{data:o,error:u}=await vt(this.fetch,"POST",e,{headers:this.headers,body:{phone:n,type:r,gotrue_meta_security:{captcha_token:a?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o?.message_id},error:u})}throw new uo("You must provide either an email or phone number and a type")}catch(e){if(lt(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(t,e){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await n,await e()))();return this.pendingInLock.push((async()=>{try{await r}catch{}})()),r}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=e();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const r=[...this.pendingInLock];await Promise.all(r),this.pendingInLock.splice(0,r.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const e=await this.__loadSession();return await t(e)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const e=await Ni(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",e),e!==null&&(this._isValidSession(e)?t=e:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=t.expires_at?t.expires_at*1e3-Date.now()<Od:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.userStorage){const o=await Ni(this.userStorage,this.storageKey+"-user");o?.user?t.user=o.user:t.user=kd()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};t.user=mx(t.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:r,error:a}=await this._callRefreshToken(t.refresh_token);return a?this._returnResult({data:{session:null},error:a}):this._returnResult({data:{session:r},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const e=await this._acquireLock(-1,async()=>await this._getUser());return e.data.user&&(this.suppressGetSessionWarning=!0),e}async _getUser(t){try{return t?await vt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:si}):await this._useSession(async e=>{var n,r,a;const{data:o,error:u}=e;if(u)throw u;return!(!((n=o.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new is}:await vt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(a=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&a!==void 0?a:void 0,xform:si})})}catch(e){if(lt(e))return _v(e)&&(await this._removeSession(),await De(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:e});throw e}}async updateUser(t,e={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,e))}async _updateUser(t,e={}){try{return await this._useSession(async n=>{const{data:r,error:a}=n;if(a)throw a;if(!r.session)throw new is;const o=r.session;let u=null,d=null;this.flowType==="pkce"&&t.email!=null&&([u,d]=await Br(this.storage,this.storageKey));const{data:f,error:p}=await vt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:e?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:u,code_challenge_method:d}),jwt:o.access_token,xform:si});if(p)throw p;return o.user=f.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(n){if(await De(this.storage,`${this.storageKey}-code-verifier`),lt(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new is;const e=Date.now()/1e3;let n=e,r=!0,a=null;const{payload:o}=Nd(t.access_token);if(o.exp&&(n=o.exp,r=n<=e),r){const{data:u,error:d}=await this._callRefreshToken(t.refresh_token);if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!u)return{data:{user:null,session:null},error:null};a=u}else{const{data:u,error:d}=await this._getUser(t.access_token);if(d)throw d;a={access_token:t.access_token,refresh_token:t.refresh_token,user:u.user,token_type:"bearer",expires_in:n-e,expires_at:n},await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)}return this._returnResult({data:{user:a.user,session:a},error:null})}catch(e){if(lt(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async e=>{var n;if(!t){const{data:o,error:u}=e;if(u)throw u;t=(n=o.session)!==null&&n!==void 0?n:void 0}if(!t?.refresh_token)throw new is;const{data:r,error:a}=await this._callRefreshToken(t.refresh_token);return a?this._returnResult({data:{user:null,session:null},error:a}):r?this._returnResult({data:{user:r.user,session:r},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(e){if(lt(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _getSessionFromURL(t,e){try{if(!je())throw new ho("No browser detected.");if(t.error||t.error_description||t.error_code)throw new ho(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(e){case"implicit":if(this.flowType==="pkce")throw new nf("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ho("Not a valid implicit grant flow url.");break;default:}if(e==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new nf("No code detected.");const{data:R,error:T}=await this._exchangeCodeForSession(t.code);if(T)throw T;const O=new URL(window.location.href);return O.searchParams.delete("code"),window.history.replaceState(window.history.state,"",O.toString()),{data:{session:R.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:r,access_token:a,refresh_token:o,expires_in:u,expires_at:d,token_type:f}=t;if(!a||!u||!o||!f)throw new ho("No session defined in URL");const p=Math.round(Date.now()/1e3),m=parseInt(u);let y=p+m;d&&(y=parseInt(d));const v=y-p;v*1e3<=zr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${v}s, should have been closer to ${m}s`);const _=y-m;p-_>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",_,y,p):p-_<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",_,y,p);const{data:w,error:S}=await this._getUser(a);if(S)throw S;const E={provider_token:n,provider_refresh_token:r,access_token:a,expires_in:m,expires_at:y,refresh_token:o,token_type:f,user:w.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:E,redirectType:t.type},error:null})}catch(n){if(lt(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const e=await Ni(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&e)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async e=>{var n;const{data:r,error:a}=e;if(a)return this._returnResult({error:a});const o=(n=r.session)===null||n===void 0?void 0:n.access_token;if(o){const{error:u}=await this.admin.signOut(o,t);if(u&&!(wv(u)&&(u.status===404||u.status===401||u.status===403)))return this._returnResult({error:u})}return t!=="others"&&(await this._removeSession(),await De(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const e=sx(),n={id:e,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",e),this.stateChangeEmitters.delete(e)}};return this._debug("#onAuthStateChange()","registered callback with id",e),this.stateChangeEmitters.set(e,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(e)})))(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async e=>{var n,r;try{const{data:{session:a},error:o}=e;if(o)throw o;await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",a)),this._debug("INITIAL_SESSION","callback id",t,"session",a)}catch(a){await((r=this.stateChangeEmitters.get(t))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",a),console.error(a)}})}async resetPasswordForEmail(t,e={}){let n=null,r=null;this.flowType==="pkce"&&([n,r]=await Br(this.storage,this.storageKey,!0));try{return await vt(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:r,gotrue_meta_security:{captcha_token:e.captchaToken}},headers:this.headers,redirectTo:e.redirectTo})}catch(a){if(await De(this.storage,`${this.storageKey}-code-verifier`),lt(a))return this._returnResult({data:null,error:a});throw a}}async getUserIdentities(){var t;try{const{data:e,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(t=e.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(e){if(lt(e))return this._returnResult({data:null,error:e});throw e}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var e;try{const{data:n,error:r}=await this._useSession(async a=>{var o,u,d,f,p;const{data:m,error:y}=a;if(y)throw y;const v=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(o=t.options)===null||o===void 0?void 0:o.redirectTo,scopes:(u=t.options)===null||u===void 0?void 0:u.scopes,queryParams:(d=t.options)===null||d===void 0?void 0:d.queryParams,skipBrowserRedirect:!0});return await vt(this.fetch,"GET",v,{headers:this.headers,jwt:(p=(f=m.session)===null||f===void 0?void 0:f.access_token)!==null&&p!==void 0?p:void 0})});if(r)throw r;return je()&&!(!((e=t.options)===null||e===void 0)&&e.skipBrowserRedirect)&&window.location.assign(n?.url),this._returnResult({data:{provider:t.provider,url:n?.url},error:null})}catch(n){if(lt(n))return this._returnResult({data:{provider:t.provider,url:null},error:n});throw n}}async linkIdentityIdToken(t){return await this._useSession(async e=>{var n;try{const{error:r,data:{session:a}}=e;if(r)throw r;const{options:o,provider:u,token:d,access_token:f,nonce:p}=t,m=await vt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=a?.access_token)!==null&&n!==void 0?n:void 0,body:{provider:u,id_token:d,access_token:f,nonce:p,link_identity:!0,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:Fs}),{data:y,error:v}=m;return v?this._returnResult({data:{user:null,session:null},error:v}):!y||!y.session||!y.user?this._returnResult({data:{user:null,session:null},error:new ki}):(y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("USER_UPDATED",y.session)),this._returnResult({data:y,error:v}))}catch(r){if(await De(this.storage,`${this.storageKey}-code-verifier`),lt(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}})}async unlinkIdentity(t){try{return await this._useSession(async e=>{var n,r;const{data:a,error:o}=e;if(o)throw o;return await vt(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(r=(n=a.session)===null||n===void 0?void 0:n.access_token)!==null&&r!==void 0?r:void 0})})}catch(e){if(lt(e))return this._returnResult({data:null,error:e});throw e}}async _refreshAccessToken(t){const e=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(e,"begin");try{const n=Date.now();return await ax(async r=>(r>0&&await rx(200*Math.pow(2,r-1)),this._debug(e,"refreshing attempt",r),await vt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Fs})),(r,a)=>{const o=200*Math.pow(2,r);return a&&Tc(a)&&Date.now()+o-n<zr})}catch(n){if(this._debug(e,"error",n),lt(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(e,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,e){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:e.redirectTo,scopes:e.scopes,queryParams:e.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",e,"url",n),je()&&!e.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t,e;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const r=await Ni(this.storage,this.storageKey);if(r&&this.userStorage){let o=await Ni(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:r.user},await Hr(this.userStorage,this.storageKey+"-user",o)),r.user=(t=o?.user)!==null&&t!==void 0?t:kd()}else if(r&&!r.user&&!r.user){const o=await Ni(this.storage,this.storageKey+"-user");o&&o?.user?(r.user=o.user,await De(this.storage,this.storageKey+"-user"),await Hr(this.storage,this.storageKey,r)):r.user=kd()}if(this._debug(n,"session from storage",r),!this._isValidSession(r)){this._debug(n,"session is not valid"),r!==null&&await this._removeSession();return}const a=((e=r.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Od;if(this._debug(n,`session has${a?"":" not"} expired with margin of ${Od}s`),a){if(this.autoRefreshToken&&r.refresh_token){const{error:o}=await this._callRefreshToken(r.refresh_token);o&&(console.error(o),Tc(o)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(r.user&&r.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:u}=await this._getUser(r.access_token);!u&&o?.user?(r.user=o.user,await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(n,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(n,"error",r),console.error(r);return}finally{this._debug(n,"end")}}async _callRefreshToken(t){var e,n;if(!t)throw new is;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new Xc;const{data:a,error:o}=await this._refreshAccessToken(t);if(o)throw o;if(!a.session)throw new is;await this._saveSession(a.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",a.session);const u={data:a.session,error:null};return this.refreshingDeferred.resolve(u),u}catch(a){if(this._debug(r,"error",a),lt(a)){const o={data:null,error:a};return Tc(a)||await this._removeSession(),(e=this.refreshingDeferred)===null||e===void 0||e.resolve(o),o}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(a),a}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(t,e,n=!0){const r=`#_notifyAllSubscribers(${t})`;this._debug(r,"begin",e,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:e});const a=[],o=Array.from(this.stateChangeEmitters.values()).map(async u=>{try{await u.callback(t,e)}catch(d){a.push(d)}});if(await Promise.all(o),a.length>0){for(let u=0;u<a.length;u+=1)console.error(a[u]);throw a[0]}}finally{this._debug(r,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await De(this.storage,`${this.storageKey}-code-verifier`);const e=Object.assign({},t),n=e.user&&e.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&e.user&&await Hr(this.userStorage,this.storageKey+"-user",{user:e.user});const r=Object.assign({},e);delete r.user;const a=Cb(r);await Hr(this.storage,this.storageKey,a)}else{const r=Cb(e);await Hr(this.storage,this.storageKey,r)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await De(this.storage,this.storageKey),await De(this.storage,this.storageKey+"-code-verifier"),await De(this.storage,this.storageKey+"-user"),this.userStorage&&await De(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&je()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),zr);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async e=>{const{data:{session:n}}=e;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((n.expires_at*1e3-t)/zr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${zr}ms, refresh threshold is ${ef} ticks`),r<=ef&&await this._callRefreshToken(n.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof Lf)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!je()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const e=`#_onVisibilityChanged(${t})`;this._debug(e,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(e,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,e,n){const r=[`provider=${encodeURIComponent(e)}`];if(n?.redirectTo&&r.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&r.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[a,o]=await Br(this.storage,this.storageKey),u=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(o)}`});r.push(u.toString())}if(n?.queryParams){const a=new URLSearchParams(n.queryParams);r.push(a.toString())}return n?.skipBrowserRedirect&&r.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${r.join("&")}`}async _unenroll(t){try{return await this._useSession(async e=>{var n;const{data:r,error:a}=e;return a?this._returnResult({data:null,error:a}):await vt(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(n=r?.session)===null||n===void 0?void 0:n.access_token})})}catch(e){if(lt(e))return this._returnResult({data:null,error:e});throw e}}async _enroll(t){try{return await this._useSession(async e=>{var n,r;const{data:a,error:o}=e;if(o)return this._returnResult({data:null,error:o});const u=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:d,error:f}=await vt(this.fetch,"POST",`${this.url}/factors`,{body:u,headers:this.headers,jwt:(n=a?.session)===null||n===void 0?void 0:n.access_token});return f?this._returnResult({data:null,error:f}):(t.factorType==="totp"&&d.type==="totp"&&(!((r=d?.totp)===null||r===void 0)&&r.qr_code)&&(d.totp.qr_code=`data:image/svg+xml;utf-8,${d.totp.qr_code}`),this._returnResult({data:d,error:null}))})}catch(e){if(lt(e))return this._returnResult({data:null,error:e});throw e}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async e=>{var n;const{data:r,error:a}=e;if(a)return this._returnResult({data:null,error:a});const o=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?Lx(t.webauthn.credential_response):Px(t.webauthn.credential_response)})}:{code:t.code}),{data:u,error:d}=await vt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:o,headers:this.headers,jwt:(n=r?.session)===null||n===void 0?void 0:n.access_token});return d?this._returnResult({data:null,error:d}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),this._returnResult({data:u,error:d}))})}catch(e){if(lt(e))return this._returnResult({data:null,error:e});throw e}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async e=>{var n;const{data:r,error:a}=e;if(a)return this._returnResult({data:null,error:a});const o=await vt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(n=r?.session)===null||n===void 0?void 0:n.access_token});if(o.error)return o;const{data:u}=o;if(u.type!=="webauthn")return{data:u,error:null};switch(u.webauthn.type){case"create":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:Mx(u.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:jx(u.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(e){if(lt(e))return this._returnResult({data:null,error:e});throw e}})}async _challengeAndVerify(t){const{data:e,error:n}=await this._challenge({factorId:t.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:t.factorId,challengeId:e.id,code:t.code})}async _listFactors(){var t;const{data:{user:e},error:n}=await this.getUser();if(n)return{data:null,error:n};const r={all:[],phone:[],totp:[],webauthn:[]};for(const a of(t=e?.factors)!==null&&t!==void 0?t:[])r.all.push(a),a.status==="verified"&&r[a.factor_type].push(a);return{data:r,error:null}}async _getAuthenticatorAssuranceLevel(){var t,e;const{data:{session:n},error:r}=await this.getSession();if(r)return this._returnResult({data:null,error:r});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=Nd(n.access_token);let o=null;a.aal&&(o=a.aal);let u=o;((e=(t=n.user.factors)===null||t===void 0?void 0:t.filter(p=>p.status==="verified"))!==null&&e!==void 0?e:[]).length>0&&(u="aal2");const f=a.amr||[];return{data:{currentLevel:o,nextLevel:u,currentAuthenticationMethods:f},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;return r?this._returnResult({data:null,error:r}):n?await vt(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:n.access_token,xform:a=>({data:a,error:null})}):this._returnResult({data:null,error:new is})})}catch(e){if(lt(e))return this._returnResult({data:null,error:e});throw e}}async _approveAuthorization(t,e){try{return await this._useSession(async n=>{const{data:{session:r},error:a}=n;if(a)return this._returnResult({data:null,error:a});if(!r)return this._returnResult({data:null,error:new is});const o=await vt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:r.access_token,body:{action:"approve"},xform:u=>({data:u,error:null})});return o.data&&o.data.redirect_url&&je()&&!e?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(n){if(lt(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(t,e){try{return await this._useSession(async n=>{const{data:{session:r},error:a}=n;if(a)return this._returnResult({data:null,error:a});if(!r)return this._returnResult({data:null,error:new is});const o=await vt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:r.access_token,body:{action:"deny"},xform:u=>({data:u,error:null})});return o.data&&o.data.redirect_url&&je()&&!e?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(n){if(lt(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:e},error:n}=t;return n?this._returnResult({data:null,error:n}):e?await vt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:e.access_token,xform:r=>({data:r,error:null})}):this._returnResult({data:null,error:new is})})}catch(t){if(lt(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;return r?this._returnResult({data:null,error:r}):n?(await vt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new is})})}catch(e){if(lt(e))return this._returnResult({data:null,error:e});throw e}}async fetchJwk(t,e={keys:[]}){let n=e.keys.find(u=>u.kid===t);if(n)return n;const r=Date.now();if(n=this.jwks.keys.find(u=>u.kid===t),n&&this.jwks_cached_at+YS>r)return n;const{data:a,error:o}=await vt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!a.keys||a.keys.length===0||(this.jwks=a,this.jwks_cached_at=r,n=a.keys.find(u=>u.kid===t),!n)?null:n}async getClaims(t,e={}){try{let n=t;if(!n){const{data:v,error:_}=await this.getSession();if(_||!v.session)return this._returnResult({data:null,error:_});n=v.session.access_token}const{header:r,payload:a,signature:o,raw:{header:u,payload:d}}=Nd(n);e?.allowExpired||fx(a.exp);const f=!r.alg||r.alg.startsWith("HS")||!r.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(r.kid,e?.keys?{keys:e.keys}:e?.jwks);if(!f){const{error:v}=await this.getUser(n);if(v)throw v;return{data:{claims:a,header:r,signature:o},error:null}}const p=px(r.alg),m=await crypto.subtle.importKey("jwk",f,p,!0,["verify"]);if(!await crypto.subtle.verify(p,m,o,tx(`${u}.${d}`)))throw new Pc("Invalid JWT signature");return{data:{claims:a,header:r,signature:o},error:null}}catch(n){if(lt(n))return this._returnResult({data:null,error:n});throw n}}};Pf.nextInstanceID={};const Gx=jf,Vx=Pf,Xx=Object.freeze(Object.defineProperty({__proto__:null,AuthAdminApi:Gx,AuthApiError:vv,AuthClient:Vx,AuthError:sa,AuthImplicitGrantRedirectError:ho,AuthInvalidCredentialsError:uo,AuthInvalidJwtError:Pc,AuthInvalidTokenResponseError:ki,AuthPKCEGrantCodeExchangeError:nf,AuthRetryableFetchError:Lc,AuthSessionMissingError:is,AuthUnknownError:ei,AuthWeakPasswordError:rf,CustomAuthError:Nn,GoTrueAdminApi:jf,GoTrueClient:Pf,NavigatorLockAcquireTimeoutError:Tv,SIGN_OUT_SCOPES:Cc,isAuthApiError:wv,isAuthError:lt,isAuthImplicitGrantRedirectError:Av,isAuthRetryableFetchError:Tc,isAuthSessionMissingError:_v,isAuthWeakPasswordError:KS,lockInternals:Mi,navigatorLock:Cv,processLock:xx},Symbol.toStringTag,{value:"Module"})),Nv=Ro(Xx);var Lb;function Yx(){if(Lb)return to;Lb=1,Object.defineProperty(to,"__esModule",{value:!0}),to.SupabaseAuthClient=void 0;const c=Nv;let t=class extends c.AuthClient{constructor(n){super(n)}};return to.SupabaseAuthClient=t,to}var Pb;function Bb(){if(Pb)return rc;Pb=1,Object.defineProperty(rc,"__esModule",{value:!0});const c=$y,t=Ky(),e=nv,n=US,r=zS(),a=HS(),o=$S(),u=Yx();class d{constructor(p,m,y){var v,_,w;this.supabaseUrl=p,this.supabaseKey=m;const S=(0,o.validateSupabaseUrl)(p);if(!m)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",S),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",S),this.storageUrl=new URL("storage/v1",S),this.functionsUrl=new URL("functions/v1",S);const E=`sb-${S.hostname.split(".")[0]}-auth-token`,R={db:r.DEFAULT_DB_OPTIONS,realtime:r.DEFAULT_REALTIME_OPTIONS,auth:Object.assign(Object.assign({},r.DEFAULT_AUTH_OPTIONS),{storageKey:E}),global:r.DEFAULT_GLOBAL_OPTIONS},T=(0,o.applySettingDefaults)(y??{},R);this.storageKey=(v=T.auth.storageKey)!==null&&v!==void 0?v:"",this.headers=(_=T.global.headers)!==null&&_!==void 0?_:{},T.accessToken?(this.accessToken=T.accessToken,this.auth=new Proxy({},{get:(O,N)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(N)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((w=T.auth)!==null&&w!==void 0?w:{},this.headers,T.global.fetch),this.fetch=(0,a.fetchWithAuth)(m,this._getAccessToken.bind(this),T.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},T.realtime)),this.accessToken&&this.accessToken().then(O=>this.realtime.setAuth(O)).catch(O=>console.warn("Failed to set initial Realtime auth token:",O)),this.rest=new t.PostgrestClient(new URL("rest/v1",S).href,{headers:this.headers,schema:T.db.schema,fetch:this.fetch}),this.storage=new n.StorageClient(this.storageUrl.href,this.headers,this.fetch,y?.storage),T.accessToken||this._listenForAuthEvents()}get functions(){return new c.FunctionsClient(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(p){return this.rest.from(p)}schema(p){return this.rest.schema(p)}rpc(p,m={},y={head:!1,get:!1,count:void 0}){return this.rest.rpc(p,m,y)}channel(p,m={config:{}}){return this.realtime.channel(p,m)}getChannels(){return this.realtime.getChannels()}removeChannel(p){return this.realtime.removeChannel(p)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var p,m;if(this.accessToken)return await this.accessToken();const{data:y}=await this.auth.getSession();return(m=(p=y.session)===null||p===void 0?void 0:p.access_token)!==null&&m!==void 0?m:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:p,persistSession:m,detectSessionInUrl:y,storage:v,userStorage:_,storageKey:w,flowType:S,lock:E,debug:R,throwOnError:T},O,N){const k={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new u.SupabaseAuthClient({url:this.authUrl.href,headers:Object.assign(Object.assign({},k),O),storageKey:w,autoRefreshToken:p,persistSession:m,detectSessionInUrl:y,storage:v,userStorage:_,flowType:S,lock:E,debug:R,throwOnError:T,fetch:N,hasCustomAuthorizationHeader:Object.keys(this.headers).some(M=>M.toLowerCase()==="authorization")})}_initRealtimeClient(p){return new e.RealtimeClient(this.realtimeUrl.href,Object.assign(Object.assign({},p),{params:Object.assign({apikey:this.supabaseKey},p?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((m,y)=>{this._handleTokenChanged(m,"CLIENT",y?.access_token)})}_handleTokenChanged(p,m,y){(p==="TOKEN_REFRESHED"||p==="SIGNED_IN")&&this.changedAccessToken!==y?(this.changedAccessToken=y,this.realtime.setAuth(y)):p==="SIGNED_OUT"&&(this.realtime.setAuth(),m=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}return rc.default=d,rc}var Ib;function Kx(){return Ib||(Ib=1,(function(c){var t=En&&En.__createBinding||(Object.create?(function(p,m,y,v){v===void 0&&(v=y);var _=Object.getOwnPropertyDescriptor(m,y);(!_||("get"in _?!m.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return m[y]}}),Object.defineProperty(p,v,_)}):(function(p,m,y,v){v===void 0&&(v=y),p[v]=m[y]})),e=En&&En.__exportStar||function(p,m){for(var y in p)y!=="default"&&!Object.prototype.hasOwnProperty.call(m,y)&&t(m,p,y)},n=En&&En.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(c,"__esModule",{value:!0}),c.createClient=c.SupabaseClient=c.FunctionRegion=c.FunctionsError=c.FunctionsRelayError=c.FunctionsFetchError=c.FunctionsHttpError=c.PostgrestError=void 0;const r=n(Bb());e(Nv,c);var a=Ky();Object.defineProperty(c,"PostgrestError",{enumerable:!0,get:function(){return a.PostgrestError}});var o=$y;Object.defineProperty(c,"FunctionsHttpError",{enumerable:!0,get:function(){return o.FunctionsHttpError}}),Object.defineProperty(c,"FunctionsFetchError",{enumerable:!0,get:function(){return o.FunctionsFetchError}}),Object.defineProperty(c,"FunctionsRelayError",{enumerable:!0,get:function(){return o.FunctionsRelayError}}),Object.defineProperty(c,"FunctionsError",{enumerable:!0,get:function(){return o.FunctionsError}}),Object.defineProperty(c,"FunctionRegion",{enumerable:!0,get:function(){return o.FunctionRegion}}),e(nv,c);var u=Bb();Object.defineProperty(c,"SupabaseClient",{enumerable:!0,get:function(){return n(u).default}});const d=(p,m,y)=>new r.default(p,m,y);c.createClient=d;function f(){if(typeof window<"u"||typeof process>"u")return!1;const p=process.version;if(p==null)return!1;const m=p.match(/^v(\d+)\./);return m?parseInt(m[1],10)<=18:!1}f()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217")})(En)),En}var kv=Kx();const Dv=my(kv),Wx=kA({__proto__:null,default:Dv},[kv]),{PostgrestError:xC,FunctionsHttpError:EC,FunctionsFetchError:TC,FunctionsRelayError:CC,FunctionsError:RC,FunctionRegion:OC,SupabaseClient:NC,createClient:Qx,GoTrueAdminApi:kC,GoTrueClient:DC,AuthAdminApi:MC,AuthClient:jC,navigatorLock:LC,NavigatorLockAcquireTimeoutError:PC,lockInternals:BC,processLock:IC,SIGN_OUT_SCOPES:UC,AuthError:FC,AuthApiError:zC,AuthUnknownError:HC,CustomAuthError:$C,AuthSessionMissingError:qC,AuthInvalidTokenResponseError:GC,AuthInvalidCredentialsError:VC,AuthImplicitGrantRedirectError:XC,AuthPKCEGrantCodeExchangeError:YC,AuthRetryableFetchError:KC,AuthWeakPasswordError:WC,AuthInvalidJwtError:QC,isAuthError:JC,isAuthApiError:ZC,isAuthSessionMissingError:tR,isAuthImplicitGrantRedirectError:eR,isAuthRetryableFetchError:sR,isAuthWeakPasswordError:nR,RealtimePresence:iR,RealtimeChannel:rR,RealtimeClient:aR,REALTIME_LISTEN_TYPES:oR,REALTIME_POSTGRES_CHANGES_LISTEN_EVENT:lR,REALTIME_PRESENCE_LISTEN_EVENTS:cR,REALTIME_SUBSCRIBE_STATES:uR,REALTIME_CHANNEL_STATES:hR}=Dv||Wx,Jx="https://iktrhksfmflxrxzvaaaa.supabase.co",Zx="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlrdHJoa3NmbWZseHJ4enZhYWFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzOTc4NTUsImV4cCI6MjA4MDk3Mzg1NX0.IPqGlZJ0UX6dSiwNzIwq93-afpm7pKcN6leKuPgEeZw",Ie=Qx(Jx,Zx,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),Mv=ut.createContext(null);function tE({children:c}){const[t,e]=ut.useState(null),[n,r]=ut.useState(!0);ut.useEffect(()=>{let p=!1;async function m(){try{const{data:{session:v},error:_}=await Ie.auth.getSession();_&&(console.error("Error getting initial session:",_),await Ie.auth.signOut()),p||(e(v?.user??null),r(!1))}catch(v){console.error("Failed to initialize auth:",v),p||(e(null),r(!1))}}m();const{data:{subscription:y}}=Ie.auth.onAuthStateChange(async(v,_)=>{p||e(_?.user??null),v==="TOKEN_REFRESHED"||v==="SIGNED_OUT"&&e(null)});return()=>{p=!0,y.unsubscribe()}},[]);async function a(p,m){const{error:y}=await Ie.auth.signInWithPassword({email:p,password:m});if(y)throw y}async function o(p,m){const{data:y,error:v}=await Ie.auth.signUp({email:p,password:m,options:{emailRedirectTo:window.location.origin}});if(v)throw v;return y}async function u(){try{const{error:p}=await Ie.auth.signOut();p&&console.error("Error signing out:",p),e(null)}catch(p){console.error("Sign out failed:",p),e(null)}}async function d(p){const{error:m}=await Ie.auth.resetPasswordForEmail(p,{redirectTo:window.location.origin});if(m)throw m}const f={user:t,authLoading:n,signInWithEmail:a,signUpWithEmail:o,signOut:u,resetPassword:d};return x.jsx(Mv.Provider,{value:f,children:c})}function eE(){const c=ut.useContext(Mv);if(!c)throw new Error("useSupabaseAuth must be used inside SupabaseAuthProvider");return c}async function sE(c,t){c&&await Ie.from("user_state").upsert({id:c,state:t},{onConflict:"id"})}async function nE(c){if(!c)return null;const{data:t,error:e}=await Ie.from("user_state").select("state").eq("id",c).single();return e&&e.code!=="PGRST116"?(console.error("Error loading user state:",e),null):t?.state??null}const mo=["","","","","","","","","",""];function iE(c=""){let t=0;for(let e=0;e<c.length;e++)t=(t<<5)-t+c.charCodeAt(e),t|=0;return Math.abs(t)}function jv(c,t="Budgeteer"){if(!c)return t;const e=c.trim();return e&&e.replace(/[^a-zA-Z0-9_\- ]+/g,"").slice(0,32)||t}function of(c){const t=c?.email?.split("@")[0]??"",e=jv(t,"Budgeteer"),n=c?.id||c?.email||e||String(Date.now()),r=iE(n)%mo.length;return{username:e,avatar_emoji:mo[r]}}async function rE(c){const t=typeof c=="string"?c:c?.id;if(!t)return null;try{const{data:e,error:n}=await Ie.from("user_metadata").select("username, avatar_emoji").eq("id",t).single();if(n){if(n.code==="PGRST116"){const r=of(typeof c=="string"?{id:t}:c),{data:a,error:o}=await Ie.from("user_metadata").insert({id:t,...r}).select("username, avatar_emoji").single();return o?(console.error("Failed to insert default profile:",o),r):a??r}return console.error("Failed to load user metadata:",n),null}return e??null}catch(e){return console.error("Unexpected error loading profile metadata:",e),null}}async function aE(c,{username:t,avatar_emoji:e}={}){if(!c)throw new Error("Missing user id for profile update");const n={};if(typeof t=="string"&&(n.username=jv(t)),typeof e=="string"&&e.length<=4&&(n.avatar_emoji=e),!(Object.keys(n).length>0)){const{data:u}=await Ie.from("user_metadata").select("username, avatar_emoji").eq("id",c).single();return u??of({id:c})}const{data:a,error:o}=await Ie.from("user_metadata").update(n).eq("id",c).select("username, avatar_emoji").single();if(o){if(o.code==="PGRST116"){const u={...of({id:c}),...n},{data:d,error:f}=await Ie.from("user_metadata").insert({id:c,...u}).select("username, avatar_emoji").single();if(f)throw console.error("Failed to recreate missing profile row:",f),f;return d??u}throw console.error("Failed to update user metadata:",o),o}return a}function oE({label:c,active:t,onClick:e}){return x.jsx("button",{onClick:e,className:`px-3 py-1 rounded-full border text-xs transition
      ${t?"border-cyan-400 bg-cyan-500/10 text-cyan-200":"border-slate-600/60 text-slate-300 hover:border-cyan-400/60 hover:text-cyan-200"}`,children:c})}const lf=[{key:"dark",label:"Cyber Dark",description:"Charcoal with neon cyan highlights",shellClass:"bg-[#05060A] text-slate-100",headerClass:"border-[#1f2937] bg-[#05060F]/90",pillClass:"border-slate-600/70 bg-black/20 hover:bg-black/40",previewGradient:"from-[#020617] via-[#05060f] to-[#020617]"},{key:"light",label:"Soft Light",description:"Warm whites with slate ink",shellClass:"bg-slate-50 text-slate-900",headerClass:"border-slate-200 bg-white/80",pillClass:"border-slate-300 bg-white/70 hover:bg-slate-100",previewGradient:"from-white via-slate-100 to-slate-200"},{key:"midnight",label:"Midnight Pulse",description:"Indigo mist with electric purple",shellClass:"bg-[#070718] text-indigo-100",headerClass:"border-[#191d3a] bg-gradient-to-r from-[#0f1032cc] to-[#1b0d3fcc]",pillClass:"border-indigo-600/50 bg-indigo-900/40 hover:bg-indigo-900/70",previewGradient:"from-[#0b1433] via-[#25124f] to-[#3b0f49]"},{key:"aurora",label:"Aurora Mist",description:"Deep teal with aurora glow",shellClass:"bg-gradient-to-br from-[#041b1f] via-[#082831] to-[#041b1f] text-emerald-50",headerClass:"border-emerald-900/40 bg-[#051f25]/90",pillClass:"border-emerald-500/40 bg-emerald-900/40 hover:bg-emerald-900/70",previewGradient:"from-[#052528] via-[#0b4b4f] to-[#0f766e]"},{key:"crimson",label:"Crimson Bloom",description:"Deep burgundy with neon rose edges",shellClass:"bg-gradient-to-br from-[#19070a] via-[#2b0d12] to-[#19070a] text-rose-50",headerClass:"border-rose-900/40 bg-[#2b0d12]/90",pillClass:"border-rose-500/50 bg-rose-900/40 hover:bg-rose-900/70",previewGradient:"from-[#300911] via-[#5b0a1c] to-[#be123c]"}];function Lv(c){return lf.find(t=>t.key===c)||lf[0]}function lE({option:c,active:t,onSelect:e}){return x.jsxs("button",{type:"button",onClick:()=>e(c.key),className:`w-full text-left rounded-xl border px-3 py-2 transition ${t?"border-cyan-400 bg-cyan-500/10":"border-white/10 hover:border-cyan-400/60"}`,children:[x.jsx("div",{className:`h-10 rounded-lg bg-gradient-to-r ${c.previewGradient} mb-2`}),x.jsx("p",{className:"text-sm font-semibold text-white",children:c.label}),x.jsx("p",{className:"text-[11px] text-slate-300",children:c.description})]})}function cE({value:c,onChange:t,variant:e="default",onAfterSelect:n=()=>{}}){const[r,a]=ut.useState(!1),o=ut.useMemo(()=>Lv(c),[c]),u=e==="menu";function d(m){t?.(m),a(!1),n?.()}const f=u?"w-full text-left px-3 py-2 text-slate-200 hover:bg-slate-800/80 rounded-md transition":`px-2 py-1 rounded border transition ${o.pillClass}`,p=`absolute ${u?"left-0":"right-0"} ${u?"mt-1":"mt-2"} w-64 rounded-2xl border border-white/15 bg-[#05060F]/95 p-3 shadow-xl backdrop-blur z-50 transition-all duration-150 ${r?"opacity-100 translate-y-0 pointer-events-auto":"opacity-0 -translate-y-1 pointer-events-none"}`;return x.jsxs("div",{className:`relative text-xs ${u?"w-full":""}`,children:[x.jsxs("button",{type:"button",onClick:()=>a(m=>!m),className:f,children:["Theme: ",o.label]}),x.jsx("div",{className:p,children:x.jsx("div",{className:"space-y-2",children:lf.map(m=>x.jsx(lE,{option:m,active:m.key===o.key,onSelect:d},m.key))})})]})}function uE({customizeMode:c,setCustomizeMode:t,onReset:e,onSignOut:n,themeValue:r,onChangeTheme:a=()=>{}}){const[o,u]=ut.useState(!1);return x.jsxs("div",{className:"relative",children:[x.jsx("button",{type:"button",className:"flex items-center justify-center w-9 h-9 rounded-full border border-slate-600/70 text-slate-300 hover:border-cyan-400/60 hover:text-cyan-200 transition",onClick:()=>u(d=>!d),children:x.jsxs("span",{className:"relative flex flex-col justify-between w-4 h-3",children:[x.jsx("span",{className:`h-[2px] rounded-full bg-current transition-transform duration-200 ${o?"translate-y-[5px] rotate-45":""}`}),x.jsx("span",{className:`h-[2px] rounded-full bg-current transition-opacity duration-200 ${o?"opacity-0":"opacity-100"}`}),x.jsx("span",{className:`h-[2px] rounded-full bg-current transition-transform duration-200 ${o?"-translate-y-[5px] -rotate-45":""}`})]})}),x.jsxs("div",{className:`absolute right-0 mt-2 w-52 bg-[#0B0C14] border border-slate-700/70 rounded-lg shadow-lg z-50 text-xs origin-top-right transform transition-all duration-150 ${o?"opacity-100 scale-100 translate-y-0 pointer-events-auto":"opacity-0 scale-95 -translate-y-1 pointer-events-none"}`,children:[x.jsx("div",{className:"px-2 py-2 border-b border-slate-800/70",children:x.jsx(cE,{value:r,onChange:a,variant:"menu",onAfterSelect:()=>u(!1)})}),x.jsx("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-slate-800/80 text-slate-200",onClick:()=>{t(d=>!d),u(!1)},children:c?"Finish Customizing":"Customize Layout"}),x.jsx("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-slate-800/80 text-rose-300",onClick:()=>{u(!1),e()},children:"Reset Data"}),x.jsx("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-slate-800/80 text-slate-200",onClick:async()=>{u(!1);try{await n()}catch(d){console.error("Sign out failed:",d)}},children:"Sign Out"})]})]})}function hE({onSignIn:c,onSignUp:t,onResetPassword:e,loading:n}){const[r,a]=Pe.useState("signin"),[o,u]=Pe.useState(""),[d,f]=Pe.useState(""),[p,m]=Pe.useState(null),[y,v]=Pe.useState(null),[_,w]=Pe.useState(!1),[S,E]=Pe.useState(!1);async function R(){if(m(null),v(null),!o){m("Please enter your email first, then click 'Forgot password?'.");return}if(e){E(!0);try{await e(o),v("If an account exists with that email, a reset link has been sent. Check your inbox.")}catch(O){m(O.message||"Failed to start password reset.")}finally{E(!1)}}}async function T(O){O.preventDefault(),m(null),v(null),w(!0);try{if(r==="signin")await c(o,d);else{const N=await t(o,d),k=N?.user||null,M=N?.session||null;v(k&&!M?"Account created! Check your email and click the confirmation link.":"Account created!")}}catch(N){m(N.message||"Something went wrong.")}finally{w(!1)}}return n?x.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-950 text-slate-200",children:x.jsx("div",{className:"text-sm text-slate-400",children:"Checking session..."})}):x.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-950 text-slate-100 px-4",children:x.jsxs("div",{className:"w-full max-w-md space-y-6 rounded-2xl border border-white/10 bg-black/30 p-8 shadow-[0_20px_50px_rgba(8,8,12,0.8)]",children:[x.jsxs("div",{className:"space-y-2 text-center",children:[x.jsx("p",{className:"text-xs tracking-[0.4em] uppercase text-cyan-300",children:"Budget Center"}),x.jsx("h1",{className:"text-2xl font-semibold text-white",children:"Access portal"}),x.jsx("p",{className:"text-sm text-slate-400",children:r==="signin"?"Sign in to load your encrypted budgets.":"Create an account to sync your budgets and goals across devices."})]}),x.jsxs("div",{className:"grid grid-cols-2 rounded-full bg-white/5 p-1 text-sm",children:[x.jsx("button",{type:"button",onClick:()=>a("signin"),className:`rounded-full py-2 font-medium transition ${r==="signin"?"bg-cyan-500 text-black":"text-slate-400 hover:text-white"}`,children:"Sign in"}),x.jsx("button",{type:"button",onClick:()=>a("signup"),className:`rounded-full py-2 font-medium transition ${r==="signup"?"bg-cyan-500 text-black":"text-slate-400 hover:text-white"}`,children:"Create account"})]}),p&&x.jsx("div",{className:"rounded border border-red-500/60 bg-red-500/10 px-3 py-2 text-sm text-red-100",children:p}),y&&x.jsx("div",{className:"rounded border border-emerald-400/60 bg-emerald-400/10 px-3 py-2 text-sm text-emerald-100",children:y}),x.jsxs("form",{onSubmit:T,className:"space-y-4",children:[x.jsxs("label",{className:"block text-sm",children:[x.jsx("span",{className:"text-slate-300",children:"Email"}),x.jsx("input",{type:"email",required:!0,value:o,onChange:O=>u(O.target.value),className:"mt-1 w-full rounded-lg border border-white/10 bg-black/40 px-3 py-2 text-sm text-white placeholder-slate-500 focus:border-cyan-400 focus:outline-none",placeholder:"you@email.com",autoComplete:"email"})]}),x.jsxs("label",{className:"block text-sm",children:[x.jsx("span",{className:"text-slate-300",children:"Password"}),x.jsx("input",{type:"password",required:!0,minLength:6,value:d,onChange:O=>f(O.target.value),className:"mt-1 w-full rounded-lg border border-white/10 bg-black/40 px-3 py-2 text-sm text-white placeholder-slate-500 focus:border-cyan-400 focus:outline-none",placeholder:"",autoComplete:r==="signin"?"current-password":"new-password"})]}),x.jsx("button",{type:"submit",disabled:_,className:"w-full rounded-lg bg-cyan-500 py-2 text-sm font-semibold text-black transition hover:bg-cyan-400 disabled:opacity-60",children:_?"Please wait...":r==="signin"?"Sign in":"Create account"})]}),x.jsx("div",{className:"text-center text-sm text-slate-400",children:x.jsx("button",{type:"button",className:"font-medium text-cyan-300 hover:text-cyan-200 disabled:opacity-60",onClick:R,disabled:S,children:S?"Sending reset link...":"Forgot password?"})})]})})}function dE({message:c,variant:t="info",actionLabel:e,onAction:n,onClose:r}){const a=t==="success";return x.jsx("div",{className:"fixed bottom-4 right-4 z-50 max-w-xs sm:max-w-sm",children:x.jsxs("div",{className:`toast-enter flex items-start gap-3 rounded-xl border px-4 py-3 text-xs shadow-xl bg-[#05060F]/95 backdrop-blur
        ${a?"border-emerald-400/80 text-emerald-100":"border-cyan-400/80 text-cyan-100"}`,children:[x.jsx("div",{className:"mt-[2px] text-lg",children:a?"":""}),x.jsxs("div",{className:"flex-1 space-y-1",children:[x.jsx("p",{className:"leading-snug",children:c}),e&&n&&x.jsxs("button",{onClick:n,className:"inline-flex items-center gap-1 text-[0.7rem] mt-1 px-2 py-1 rounded-full border border-cyan-400/70 text-cyan-100 hover:bg-cyan-500/10 hover:border-cyan-300 transition",children:[x.jsx("span",{children:e}),x.jsx("span",{className:"text-[0.75rem]",children:""})]})]}),r&&x.jsx("button",{className:"ml-1 text-[0.7rem] text-slate-500 hover:text-slate-200",onClick:r,children:""})]})})}function fE({emoji:c,active:t,onSelect:e}){return x.jsx("button",{type:"button",onClick:()=>e(c),className:`w-9 h-9 text-lg rounded-full border transition flex items-center justify-center
      ${t?"border-cyan-400/80 bg-cyan-500/10":"border-slate-600/60 bg-black/30 hover:border-cyan-400/40"}`,children:c})}function pE({profile:c,email:t,loading:e,onUpdateProfile:n}){const[r,a]=ut.useState(!1),[o,u]=ut.useState(c?.username??""),[d,f]=ut.useState(c?.avatar_emoji??mo[0]),[p,m]=ut.useState(!1);ut.useEffect(()=>{u(c?.username??""),f(c?.avatar_emoji??mo[0])},[c?.username,c?.avatar_emoji]);async function y(w){if(w.preventDefault(),!n)return;m(!0);const S=await n({username:o,avatar_emoji:d});m(!1),S&&a(!1)}const v=c?.avatar_emoji??"",_=c?.username||"Budgeteer";return x.jsxs("div",{className:"relative",children:[x.jsxs("button",{type:"button",onClick:()=>a(w=>!w),className:"flex items-center gap-2 rounded-full border border-slate-600/70 bg-black/20 px-2 py-1 text-left hover:border-cyan-400/60 transition",children:[x.jsx("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-cyan-500/10 text-lg",children:v}),x.jsxs("span",{className:"flex flex-col leading-tight text-xs text-slate-300",children:[x.jsx("span",{className:"text-cyan-200",children:_}),x.jsx("span",{className:"text-[10px] text-slate-500",children:e?"Syncing...":"Profile"})]})]}),x.jsxs("form",{className:`absolute right-0 mt-2 w-64 rounded-xl border border-slate-700/70 bg-[#05060F] p-4 text-xs shadow-xl transition-all duration-150 ${r?"opacity-100 translate-y-0 pointer-events-auto":"opacity-0 -translate-y-1 pointer-events-none"}`,onSubmit:y,children:[x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{className:"text-[11px] text-slate-400",children:t?`Signed in as ${t}`:"Signed in"}),x.jsxs("label",{className:"block",children:[x.jsx("span",{className:"text-slate-300",children:"Display name"}),x.jsx("input",{type:"text",value:o,onChange:w=>u(w.target.value),placeholder:"Budgeteer",className:"mt-1 w-full rounded-lg border border-white/10 bg-black/40 px-3 py-2 text-xs text-white placeholder-slate-500 focus:border-cyan-400 focus:outline-none"})]})]}),x.jsxs("div",{className:"mt-3",children:[x.jsx("p",{className:"mb-2 text-slate-300",children:"Avatar"}),x.jsx("div",{className:"grid grid-cols-5 gap-2",children:mo.map(w=>x.jsx(fE,{emoji:w,active:d===w,onSelect:f},w))})]}),x.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[x.jsx("button",{type:"button",className:"text-[11px] text-slate-500 hover:text-slate-200",onClick:()=>a(!1),children:"Cancel"}),x.jsx("button",{type:"submit",disabled:p,className:"rounded-full bg-cyan-500 px-3 py-1 text-[11px] font-semibold text-black transition hover:bg-cyan-400 disabled:opacity-60",children:p?"Saving...":"Save changes"})]})]})]})}const bo=[{key:"cyber",label:"Cyber Cyan",background:"bg-gradient-to-br from-[#041019] via-[#051c25] to-[#03070d]"},{key:"sunset",label:"Sunset Glow",background:"bg-gradient-to-br from-orange-500 via-pink-500 to-rose-500"},{key:"forest",label:"Forest Echo",background:"bg-gradient-to-br from-[#0f3d2a] via-[#145036] to-[#1e6746]"},{key:"midnight",label:"Midnight Pulse",background:"bg-gradient-to-br from-[#09001a] via-[#1b0231] to-[#330057]"}],cf=["","","","","","","",""],gE={name:"",target:0,current:0,monthlyPlan:0,emoji:"",description:"",dueDate:"",theme:bo[0].key,icon:cf[0],background:bo[0].key,animation:"pulse"};function mE({open:c,mode:t="create",initialGoal:e={},onClose:n,onSave:r,onDelete:a}){const[o,u]=ut.useState(gE);ut.useEffect(()=>{c&&u({name:e?.name||"",target:Number(e?.target??0),current:Number(e?.current??e?.saved??0),monthlyPlan:Number(e?.monthlyPlan??0),emoji:e?.emoji||"",description:e?.description||"",dueDate:e?.dueDate||"",theme:e?.theme||bo[0].key,icon:e?.icon||cf[0],background:e?.background||bo[0].key,animation:e?.animation||"pulse"})},[e,c]);const d=t==="edit",f=d?"Edit goal":"Create new goal";function p(w,S){u(E=>({...E,[w]:S}))}function m(w,S){const E=Number(S);p(w,Number.isFinite(E)?E:0)}function y(w){w.preventDefault(),o.name.trim()||p("name","Untitled goal"),r?.({...o,name:o.name.trim()||"Untitled goal"})}const v=!c,_=ut.useMemo(()=>{const w=Number(o.target)||0;if(w<=0)return 0;const S=Math.max(0,Number(o.current)||0);return Math.min(100,S/w*100)},[o.target,o.current]);return c?x.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm px-4",children:x.jsxs("form",{className:"w-full max-w-lg space-y-4 rounded-2xl border border-white/10 bg-[#05060F] p-6 text-sm shadow-2xl",onSubmit:y,children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:f}),x.jsx("p",{className:"text-[11px] text-slate-400",children:"Track savings progress, target amount, and plans."})]}),x.jsx("button",{type:"button",className:"text-slate-500 hover:text-slate-200 text-base",onClick:n,children:""})]}),x.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[x.jsxs("label",{className:"space-y-1",children:[x.jsx("span",{className:"text-xs text-slate-400",children:"Goal name"}),x.jsx("input",{type:"text",className:"w-full rounded-lg border border-white/10 bg-black/30 px-3 py-2 text-sm text-white placeholder-slate-500 focus:border-cyan-400 focus:outline-none",value:o.name,onChange:w=>p("name",w.target.value),placeholder:"Emergency fund"})]}),x.jsxs("label",{className:"space-y-1",children:[x.jsx("span",{className:"text-xs text-slate-400",children:"Emoji"}),x.jsx("input",{type:"text",className:"w-full rounded-lg border border-white/10 bg-black/30 px-3 py-2 text-sm text-white placeholder-slate-500 focus:border-cyan-400 focus:outline-none",value:o.emoji,onChange:w=>p("emoji",w.target.value.slice(0,4)),placeholder:""})]})]}),x.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[x.jsxs("label",{className:"space-y-1",children:[x.jsx("span",{className:"text-xs text-slate-400",children:"Target amount"}),x.jsx("input",{type:"number",min:"0",step:"100",className:"w-full rounded-lg border border-white/10 bg-black/30 px-3 py-2 text-sm text-white placeholder-slate-500 focus:border-cyan-400 focus:outline-none",value:o.target,onChange:w=>m("target",w.target.value),placeholder:"5000"})]}),x.jsxs("label",{className:"space-y-1",children:[x.jsx("span",{className:"text-xs text-slate-400",children:"Saved so far"}),x.jsx("input",{type:"number",min:"0",step:"50",className:"w-full rounded-lg border border-white/10 bg-black/30 px-3 py-2 text-sm text-white placeholder-slate-500 focus:border-cyan-400 focus:outline-none",value:o.current,onChange:w=>m("current",w.target.value),placeholder:"1000"})]}),x.jsxs("label",{className:"space-y-1",children:[x.jsx("span",{className:"text-xs text-slate-400",children:"Monthly plan"}),x.jsx("input",{type:"number",min:"0",step:"1",className:"w-full rounded-lg border border-white/10 bg-black/30 px-3 py-2 text-sm text-white placeholder-slate-500 focus:border-cyan-400 focus:outline-none",value:o.monthlyPlan,onChange:w=>m("monthlyPlan",w.target.value),placeholder:"250"})]})]}),x.jsxs("label",{className:"space-y-1 block",children:[x.jsx("span",{className:"text-xs text-slate-400",children:"Description"}),x.jsx("textarea",{rows:"3",className:"w-full rounded-lg border border-white/10 bg-black/30 px-3 py-2 text-sm text-white placeholder-slate-500 focus:border-cyan-400 focus:outline-none",value:o.description,onChange:w=>p("description",w.target.value),placeholder:"What is this goal for?"})]}),x.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[x.jsxs("label",{className:"space-y-1",children:[x.jsx("span",{className:"text-xs text-slate-400",children:"Target date"}),x.jsx("input",{type:"date",value:o.dueDate,onChange:w=>p("dueDate",w.target.value),className:"w-full rounded-lg border border-white/10 bg-black/30 px-3 py-2 text-sm text-white focus:border-cyan-400 focus:outline-none"})]}),x.jsxs("label",{className:"space-y-1",children:[x.jsx("span",{className:"text-xs text-slate-400",children:"Animation style"}),x.jsxs("select",{value:o.animation,onChange:w=>p("animation",w.target.value),className:"w-full rounded-lg border border-white/10 bg-black/30 px-3 py-2 text-sm text-white focus:border-cyan-400 focus:outline-none",children:[x.jsx("option",{value:"pulse",children:"Pulse"}),x.jsx("option",{value:"glow",children:"Glow"}),x.jsx("option",{value:"slide",children:"Slide"}),x.jsx("option",{value:"wave",children:"Wave"})]})]})]}),x.jsxs("div",{className:"space-y-3",children:[x.jsx("label",{className:"block text-xs text-slate-400",children:"Theme"}),x.jsx("div",{className:"grid grid-cols-2 gap-3",children:bo.map(w=>x.jsxs("button",{type:"button",onClick:()=>u(S=>({...S,theme:w.key,background:w.key})),className:`rounded-xl p-3 text-left transition border ${o.theme===w.key?"border-cyan-400 bg-cyan-500/10":"border-white/10 hover:border-cyan-400/50"}`,children:[x.jsx("div",{className:`h-12 rounded-lg ${w.background} mb-2`}),x.jsx("p",{className:"text-sm text-white",children:w.label})]},w.key))})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx("span",{className:"text-xs text-slate-400",children:"Icon"}),x.jsx("div",{className:"flex flex-wrap gap-2",children:cf.map(w=>x.jsx("button",{type:"button",onClick:()=>p("icon",w),className:`w-10 h-10 rounded-full border text-lg flex items-center justify-center ${o.icon===w?"border-cyan-400 bg-cyan-500/10":"border-white/10 hover:border-cyan-400/50"}`,children:w},w))})]}),x.jsxs("div",{className:"text-xs text-slate-400",children:["Progress preview: ",_.toFixed(1),"%"]}),x.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 pt-2",children:[d?x.jsx("button",{type:"button",disabled:v,className:"text-xs text-rose-300 hover:text-rose-200 disabled:opacity-50",onClick:()=>{if(!e?.id)return;window.confirm(`Delete goal "${e.name||"this goal"}"?`)&&a?.(e.id)},children:"Delete goal"}):x.jsx("span",{}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx("button",{type:"button",className:"rounded-full border border-slate-600/70 px-4 py-2 text-xs text-slate-300 hover:border-slate-400",onClick:n,disabled:v,children:"Cancel"}),x.jsx("button",{type:"submit",className:"rounded-full bg-cyan-500 px-4 py-2 text-xs font-semibold text-black hover:bg-cyan-400 disabled:opacity-60",disabled:v,children:d?"Save changes":"Create goal"})]})]})]})}):null}function bE({open:c,goal:t,onAdd:e,onClose:n}){const[r,a]=ut.useState("");return ut.useEffect(()=>{c&&a("")},[c]),c?x.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm px-4",children:x.jsxs("div",{className:"w-full max-w-sm rounded-2xl border border-white/10 bg-[#05060F] p-5 shadow-2xl text-sm",children:[x.jsxs("header",{className:"mb-4",children:[x.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:"Add contribution"}),x.jsxs("h2",{className:"text-base font-semibold text-slate-100",children:[t?.emoji," ",t?.name||"Goal"]}),x.jsx("p",{className:"text-[11px] text-slate-400",children:"Log a manual contribution to update your saved amount."})]}),x.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Amount"}),x.jsx("input",{type:"number",min:"0",step:"1",value:r,onChange:o=>a(o.target.value),className:"w-full rounded-lg border border-white/10 bg-black/30 px-3 py-2 text-sm text-white placeholder-slate-500 focus:border-cyan-400 focus:outline-none",placeholder:"150"}),x.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[x.jsx("button",{type:"button",className:"rounded-full border border-slate-600/70 px-3 py-1 text-xs text-slate-300 hover:border-slate-400",onClick:n,children:"Cancel"}),x.jsx("button",{type:"button",className:"rounded-full bg-cyan-500 px-4 py-1 text-xs font-semibold text-black hover:bg-cyan-400 disabled:opacity-60",onClick:()=>e?.(r),disabled:!r||Number(r)<=0,children:"Add"})]})]})}):null}function qs({title:c,children:t}){return x.jsxs("section",{className:"card-surface border rounded-xl p-4",children:[c&&x.jsx("h2",{className:"text-xs font-semibold tracking-[0.25em] text-slate-400 mb-3 uppercase",children:c}),t]})}function Bf({value:c=0}){const t=Math.max(0,Math.min(100,Number.isNaN(c)?0:c));return x.jsx("div",{className:"progress-bar",children:x.jsx("div",{className:"progress-bar-filled",style:{width:`${t}%`},children:t>2&&x.jsx("div",{className:"progress-shine shine"})})})}function yE(c){switch(c){case"sunset":return"bg-gradient-to-br from-orange-500/70 via-pink-500/60 to-rose-500/60 border-rose-400/60";case"forest":return"bg-gradient-to-br from-emerald-900/70 via-emerald-800/60 to-emerald-700/60 border-emerald-400/60";case"midnight":return"bg-gradient-to-br from-indigo-900/70 via-purple-900/60 to-indigo-900/70 border-indigo-400/60";case"cyber":default:return"bg-[#090a11] border-slate-800"}}function vE({goal:c,onClick:t}){const e=Number(c?.saved??c?.current??0),n=Number(c?.target??0),r=Number(c?.monthlyPlan??0),a=c?.icon||c?.emoji||"",o=c?.name||"Untitled Goal",u=n>0?Math.min(100,e/n*100):0,d=yE(c?.theme);return x.jsxs("button",{onClick:t,className:`text-left rounded-xl p-3 hover:border-cyan-400/70 hover:shadow-[0_0_18px_rgba(34,211,238,0.35)] transition ${d}`,children:[x.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"text-lg",children:a}),x.jsx("span",{className:"text-sm font-medium text-slate-100",children:o})]}),x.jsxs("span",{className:"text-[0.7rem] text-slate-400",children:["Plan: $",r.toFixed(0),"/mo"]})]}),x.jsxs("div",{className:"text-xs text-slate-400 mb-1",children:["$",e.toFixed(0)," / $",n.toFixed(0)]}),x.jsx(Bf,{value:u})]})}const uf=[{key:"chase",label:"Chase"},{key:"capitalone",label:"Capital One"},{key:"wellsfargo",label:"Wells Fargo"},{key:"americanexpress",label:"Amex"},{key:"discover",label:"Discover"},{key:"navyfederal",label:"Navy Federal"},{key:"mountainamerica",label:"Mountain America"},{key:"bankofamerica",label:"Bank of America"},{key:"usbank",label:"US Bank"},{key:"pnc",label:"PNC"}];function hf(c=""){return c.toLowerCase().replace(/[^a-z0-9]/g,"")}function Ub(c="",t=""){const e=hf((t||"")+" "+c.slice(0,4e3));for(const n of uf)if(e.includes(n.key))return n.label;return null}function Ao(c){const t=[];let e="",n=!1;for(let r=0;r<c.length;r++){const a=c[r];if(a==='"'){n=!n;continue}a===","&&!n?(t.push(e),e=""):e+=a}return t.push(e),t}function yo(c){if(c==null)return NaN;let t=String(c).trim();t=t.replace(/"/g,"");let e=!1;if(t.startsWith("(")&&t.endsWith(")")&&(e=!0,t=t.slice(1,-1)),t=t.replace(/[$,]/g,""),t==="")return NaN;const n=Number(t);return Number.isNaN(n)?NaN:e?-n:n}function If(c,t){const e=(c||"").toLowerCase();return t>0?e.includes("payroll")||e.includes("direct deposit")?"Income  Paycheck":e.includes("refund")||e.includes("rebate")?"Income  Refund":"Income  Other":e.includes("uber")||e.includes("lyft")||e.includes("taxi")?"Transport  Rideshare":e.includes("shell")||e.includes("chevron")||e.includes("exxon")||e.includes("gas")||e.includes("fuel")?"Transport  Gas":e.includes("walmart")||e.includes("costco")||e.includes("grocery")||e.includes("smith")||e.includes("kroger")?"Groceries":e.includes("starbucks")||e.includes("coffee")||e.includes("mcdonald")||e.includes("taco bell")||e.includes("restaurant")||e.includes("cafe")?"Food & Dining":e.includes("netflix")||e.includes("spotify")||e.includes("hulu")||e.includes("disney")||e.includes("subscription")||e.includes("prime")?"Subscriptions":e.includes("rent")||e.includes("landlord")||e.includes("mortgage")?"Housing  Rent/Mortgage":e.includes("power")||e.includes("electric")||e.includes("water")||e.includes("utility")||e.includes("utilities")?"Utilities":e.includes("gym")||e.includes("fitness")?"Health & Fitness":e.includes("insurance")||e.includes("geico")||e.includes("allstate")?"Insurance":e.includes("amazon")||e.includes("target")||e.includes("best buy")||e.includes("shop")?"Shopping":"Other"}const eo={date:["date","transaction date","posted date","posting date","trans date"],description:["description","details","memo","payee","transaction description","narrative"],debit:["debit","withdrawal","outflow","money out","charge"],credit:["credit","deposit","inflow","money in","payment","credit amount"],amount:["amount","amt","transaction amount","value"]};function wE(c){return Ao(c).map(e=>e.trim()).map(e=>{let n=e.toLowerCase().replace(/"/g,"");return n=n.replace(/\s+/g," ").trim(),n})}function so(c,t){return c.findIndex(e=>t.includes(e))}function Uf(c){if(!c)return"";let t=String(c).trim().replace(/"/g,"");if(!t)return"";let e=t.match(/^(\d{4})[-/.](\d{1,2})[-/.](\d{1,2})$/);if(e){const[,r,a,o]=e;return`${r}-${a.padStart(2,"0")}-${o.padStart(2,"0")}`}if(e=t.match(/^(\d{4})(\d{2})(\d{2})$/),e){const[,r,a,o]=e;return`${r}-${a}-${o}`}if(e=t.match(/^(\d{1,2})[\/.-](\d{1,2})[\/.-](\d{2,4})$/),e){let[,r,a,o]=e,u=o.length===2?Number(o)>=70?`19${o}`:`20${o}`:o;const d=Number(r),f=Number(a);let p,m;return d>12&&f<=12?(m=d,p=f):(p=d,m=f),`${u}-${String(p).padStart(2,"0")}-${String(m).padStart(2,"0")}`}if(e=t.match(/^(\d{1,2})\s+([A-Za-z]{3,})\s+(\d{2,4})$/),e){const[,r,a,o]=e,u=o.length===2?`20${o}`:o,f=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"].indexOf(a.toLowerCase().slice(0,3));if(f>=0){const p=String(f+1).padStart(2,"0"),m=String(r).padStart(2,"0");return`${u}-${p}-${m}`}}if(e=t.match(/^([A-Za-z]{3,})\s+(\d{1,2}),?\s+(\d{2,4})$/),e){const[,r,a,o]=e,u=o.length===2?`20${o}`:o,f=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"].indexOf(r.toLowerCase().slice(0,3));if(f>=0){const p=String(f+1).padStart(2,"0"),m=String(a).padStart(2,"0");return`${u}-${p}-${m}`}}const n=new Date(t);return Number.isNaN(n.getTime())?t:n.toISOString().slice(0,10)}function _E(c){const t=c.split(/\r?\n/).find(r=>r.trim().length>0)||"";if(!t)return[];const e=Ao(t).map(r=>r.trim().replace(/^"|"$/g,""));return e.some(r=>/[a-zA-Z]/.test(r))?e.map((r,a)=>r||`Column ${a+1}`):e.map((r,a)=>`Column ${a+1}`)}function AE(c){const t=c.split(/\r?\n/).filter(y=>y.trim()!=="");if(t.length===0)return[];let e=wE(t[0]),n=1;function r(y){const v=so(y,eo.date),_=so(y,eo.description),w=so(y,eo.amount),S=so(y,eo.debit),E=so(y,eo.credit);return{dateIndex:v,descIndex:_,amountIndex:w,debitIndex:S,creditIndex:E}}let{dateIndex:a,descIndex:o,amountIndex:u,debitIndex:d,creditIndex:f}=r(e);if(a<0&&o<0&&u<0&&d<0&&f<0){const y=Ao(t[0]).map(_=>_.trim());e=y.map((_,w)=>w===0?"date":w===1?"description":w===2||w===y.length-1?"amount":`col${w+1}`),n=0,{dateIndex:a,descIndex:o,amountIndex:u,debitIndex:d,creditIndex:f}=r(e)}const m=[];for(let y=n;y<t.length;y++){const v=t[y],_=Ao(v).map(O=>O.trim());if(_.length===0||_.every(O=>O===""))continue;const w=a>=0?_[a]:"",S=Uf(w),E=o>=0?_[o]:"";let R=NaN;if(u>=0)R=yo(_[u]);else if(d>=0||f>=0){const O=d>=0?yo(_[d]):0;R=(f>=0?yo(_[f]):0)-O}if(!S&&!E&&Number.isNaN(R)||typeof R!="number"||Number.isNaN(R))continue;const T=If(E,R);m.push({date:S,description:E,amount:R,category:T})}return m}function SE(c,{dateIndex:t=null,descIndex:e=null,amountIndex:n=null}={}){const r=c.split(/\r?\n/).filter(o=>o.trim()!=="");if(r.length===0)return[];const a=[];for(let o=1;o<r.length;o++){const u=r[o],d=Ao(u).map(_=>_.trim());if(d.length===0||d.every(_=>_===""))continue;const f=t!=null&&t>=0?d[t]:"",p=Uf(f),m=e!=null&&e>=0?d[e]:"";let y=NaN;if(n!=null&&n>=0&&(y=yo(d[n])),!p&&!m&&Number.isNaN(y)||typeof y!="number"||Number.isNaN(y))continue;const v=If(m,y);a.push({date:p,description:m,amount:y,category:v})}return a}const Xe=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),df=[.001,0,0,.001,0,0],Dd=1.35,gs={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},ni={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},So="pdfjs_internal_editor_",Tt={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},Lt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},xE={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},ff={TRIANGLES:1,LATTICE:2},Me={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Rc={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},ve={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},$r={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Yc={ERRORS:0,WARNINGS:1,INFOS:5},xo={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},no={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},EE={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Kc=Yc.WARNINGS;function TE(c){Number.isInteger(c)&&(Kc=c)}function CE(){return Kc}function Wc(c){Kc>=Yc.INFOS&&console.info(`Info: ${c}`)}function xt(c){Kc>=Yc.WARNINGS&&console.warn(`Warning: ${c}`)}function Qt(c){throw new Error(c)}function Pt(c,t){c||Qt(t)}function RE(c){switch(c?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Pv(c,t=null,e=null){if(!c)return null;if(e&&typeof c=="string"&&(e.addDefaultProtocol&&c.startsWith("www.")&&c.match(/\./g)?.length>=2&&(c=`http://${c}`),e.tryConvertEncoding))try{c=ME(c)}catch{}const n=t?URL.parse(c,t):URL.parse(c);return RE(n)?n:null}function Bv(c,t,e=!1){const n=URL.parse(c);return n?(n.hash=t,n.href):e&&Pv(c,"http://example.com")?c.split("#",1)[0]+`${t?`#${t}`:""}`:""}function Et(c,t,e,n=!1){return Object.defineProperty(c,t,{value:e,enumerable:!n,configurable:!0,writable:!1}),e}const qi=(function(){function t(e,n){this.message=e,this.name=n}return t.prototype=new Error,t.constructor=t,t})();class Fb extends qi{constructor(t,e){super(t,"PasswordException"),this.code=e}}class Md extends qi{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class pf extends qi{constructor(t){super(t,"InvalidPDFException")}}class Fc extends qi{constructor(t,e,n){super(t,"ResponseException"),this.status=e,this.missing=n}}class OE extends qi{constructor(t){super(t,"FormatError")}}class ri extends qi{constructor(t){super(t,"AbortException")}}function Iv(c){(typeof c!="object"||c?.length===void 0)&&Qt("Invalid argument for bytesToString");const t=c.length,e=8192;if(t<e)return String.fromCharCode.apply(null,c);const n=[];for(let r=0;r<t;r+=e){const a=Math.min(r+e,t),o=c.subarray(r,a);n.push(String.fromCharCode.apply(null,o))}return n.join("")}function ko(c){typeof c!="string"&&Qt("Invalid argument for stringToBytes");const t=c.length,e=new Uint8Array(t);for(let n=0;n<t;++n)e[n]=c.charCodeAt(n)&255;return e}function NE(c){return String.fromCharCode(c>>24&255,c>>16&255,c>>8&255,c&255)}function kE(){const c=new Uint8Array(4);return c[0]=1,new Uint32Array(c.buffer,0,1)[0]===1}function DE(){try{return new Function(""),!0}catch{return!1}}class Ue{static get isLittleEndian(){return Et(this,"isLittleEndian",kE())}static get isEvalSupported(){return Et(this,"isEvalSupported",DE())}static get isOffscreenCanvasSupported(){return Et(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Et(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return Et(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return Et(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return Et(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){return Et(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const jd=Array.from(Array(256).keys(),c=>c.toString(16).padStart(2,"0"));class at{static makeHexColor(t,e,n){return`#${jd[t]}${jd[e]}${jd[n]}`}static domMatrixToTransform(t){return[t.a,t.b,t.c,t.d,t.e,t.f]}static scaleMinMax(t,e){let n;t[0]?(t[0]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[3],e[3]*=t[3]):(n=e[0],e[0]=e[1],e[1]=n,n=e[2],e[2]=e[3],e[3]=n,t[1]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static multiplyByDOMMatrix(t,e){return[t[0]*e.a+t[2]*e.b,t[1]*e.a+t[3]*e.b,t[0]*e.c+t[2]*e.d,t[1]*e.c+t[3]*e.d,t[0]*e.e+t[2]*e.f+t[4],t[1]*e.e+t[3]*e.f+t[5]]}static applyTransform(t,e,n=0){const r=t[n],a=t[n+1];t[n]=r*e[0]+a*e[2]+e[4],t[n+1]=r*e[1]+a*e[3]+e[5]}static applyTransformToBezier(t,e,n=0){const r=e[0],a=e[1],o=e[2],u=e[3],d=e[4],f=e[5];for(let p=0;p<6;p+=2){const m=t[n+p],y=t[n+p+1];t[n+p]=m*r+y*o+d,t[n+p+1]=m*a+y*u+f}}static applyInverseTransform(t,e){const n=t[0],r=t[1],a=e[0]*e[3]-e[1]*e[2];t[0]=(n*e[3]-r*e[2]+e[2]*e[5]-e[4]*e[3])/a,t[1]=(-n*e[1]+r*e[0]+e[4]*e[1]-e[5]*e[0])/a}static axialAlignedBoundingBox(t,e,n){const r=e[0],a=e[1],o=e[2],u=e[3],d=e[4],f=e[5],p=t[0],m=t[1],y=t[2],v=t[3];let _=r*p+d,w=_,S=r*y+d,E=S,R=u*m+f,T=R,O=u*v+f,N=O;if(a!==0||o!==0){const k=a*p,M=a*y,I=o*m,X=o*v;_+=I,E+=I,S+=X,w+=X,R+=k,N+=k,O+=M,T+=M}n[0]=Math.min(n[0],_,S,w,E),n[1]=Math.min(n[1],R,O,T,N),n[2]=Math.max(n[2],_,S,w,E),n[3]=Math.max(n[3],R,O,T,N)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const n=t[0],r=t[1],a=t[2],o=t[3],u=n**2+r**2,d=n*a+r*o,f=a**2+o**2,p=(u+f)/2,m=Math.sqrt(p**2-(u*f-d**2));e[0]=Math.sqrt(p+m||1),e[1]=Math.sqrt(p-m||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const n=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),r=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(n>r)return null;const a=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),o=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return a>o?null:[n,a,r,o]}static pointBoundingBox(t,e,n){n[0]=Math.min(n[0],t),n[1]=Math.min(n[1],e),n[2]=Math.max(n[2],t),n[3]=Math.max(n[3],e)}static rectBoundingBox(t,e,n,r,a){a[0]=Math.min(a[0],t,n),a[1]=Math.min(a[1],e,r),a[2]=Math.max(a[2],t,n),a[3]=Math.max(a[3],e,r)}static#t(t,e,n,r,a,o,u,d,f,p){if(f<=0||f>=1)return;const m=1-f,y=f*f,v=y*f,_=m*(m*(m*t+3*f*e)+3*y*n)+v*r,w=m*(m*(m*a+3*f*o)+3*y*u)+v*d;p[0]=Math.min(p[0],_),p[1]=Math.min(p[1],w),p[2]=Math.max(p[2],_),p[3]=Math.max(p[3],w)}static#e(t,e,n,r,a,o,u,d,f,p,m,y){if(Math.abs(f)<1e-12){Math.abs(p)>=1e-12&&this.#t(t,e,n,r,a,o,u,d,-m/p,y);return}const v=p**2-4*m*f;if(v<0)return;const _=Math.sqrt(v),w=2*f;this.#t(t,e,n,r,a,o,u,d,(-p+_)/w,y),this.#t(t,e,n,r,a,o,u,d,(-p-_)/w,y)}static bezierBoundingBox(t,e,n,r,a,o,u,d,f){f[0]=Math.min(f[0],t,u),f[1]=Math.min(f[1],e,d),f[2]=Math.max(f[2],t,u),f[3]=Math.max(f[3],e,d),this.#e(t,n,a,u,e,r,o,d,3*(-t+3*(n-a)+u),6*(t-2*n+a),3*(n-t),f),this.#e(t,n,a,u,e,r,o,d,3*(-e+3*(r-o)+d),6*(e-2*r+o),3*(r-e),f)}}function ME(c){return decodeURIComponent(escape(c))}let Ld=null,zb=null;function jE(c){return Ld||(Ld=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,zb=new Map([["","t"]])),c.replaceAll(Ld,(t,e,n)=>e?e.normalize("NFKC"):zb.get(n))}function Uv(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const c=new Uint8Array(32);return crypto.getRandomValues(c),Iv(c)}const Vr="pdfjs_internal_id_";function LE(c,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[n,r,...a]=e;if(!c(n)&&!Number.isInteger(n)||!t(r))return!1;const o=a.length;let u=!0;switch(r.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return o===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(o!==4)return!1;u=!1;break;default:return!1}for(const d of a)if(!(typeof d=="number"||u&&d===null))return!1;return!0}function Ye(c,t,e){return Math.min(Math.max(c,t),e)}function Fv(c){return Uint8Array.prototype.toBase64?c.toBase64():btoa(Iv(c))}function PE(c){return Uint8Array.fromBase64?Uint8Array.fromBase64(c):ko(atob(c))}typeof Promise.try!="function"&&(Promise.try=function(c,...t){return new Promise(e=>{e(c(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(c){return c.reduce((t,e)=>t+e,0)});class Eo{static textContent(t){const e=[],n={items:e,styles:Object.create(null)};function r(a){if(!a)return;let o=null;const u=a.name;if(u==="#text")o=a.value;else if(Eo.shouldBuildText(u))a?.attributes?.textContent?o=a.attributes.textContent:a.value&&(o=a.value);else return;if(o!==null&&e.push({str:o}),!!a.children)for(const d of a.children)r(d)}return r(t),n}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}class zv{static setupStorage(t,e,n,r,a){const o=r.getValue(e,{value:null});switch(n.name){case"textarea":if(o.value!==null&&(t.textContent=o.value),a==="print")break;t.addEventListener("input",u=>{r.setValue(e,{value:u.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(o.value===n.attributes.xfaOn?t.setAttribute("checked",!0):o.value===n.attributes.xfaOff&&t.removeAttribute("checked"),a==="print")break;t.addEventListener("change",u=>{r.setValue(e,{value:u.target.checked?u.target.getAttribute("xfaOn"):u.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&t.setAttribute("value",o.value),a==="print")break;t.addEventListener("input",u=>{r.setValue(e,{value:u.target.value})})}break;case"select":if(o.value!==null){t.setAttribute("value",o.value);for(const u of n.children)u.attributes.value===o.value?u.attributes.selected=!0:u.attributes.hasOwnProperty("selected")&&delete u.attributes.selected}t.addEventListener("input",u=>{const d=u.target.options,f=d.selectedIndex===-1?"":d[d.selectedIndex].value;r.setValue(e,{value:f})});break}}static setAttributes({html:t,element:e,storage:n=null,intent:r,linkService:a}){const{attributes:o}=e,u=t instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${r}`);for(const[d,f]of Object.entries(o))if(f!=null)switch(d){case"class":f.length&&t.setAttribute(d,f.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",f);break;case"style":Object.assign(t.style,f);break;case"textContent":t.textContent=f;break;default:(!u||d!=="href"&&d!=="newWindow")&&t.setAttribute(d,f)}u&&a.addLinkAttributes(t,o.href,o.newWindow),n&&o.dataId&&this.setupStorage(t,o.dataId,e,n)}static render(t){const e=t.annotationStorage,n=t.linkService,r=t.xfaHtml,a=t.intent||"display",o=document.createElement(r.name);r.attributes&&this.setAttributes({html:o,element:r,intent:a,linkService:n});const u=a!=="richText",d=t.div;if(d.append(o),t.viewport){const m=`matrix(${t.viewport.transform.join(",")})`;d.style.transform=m}u&&d.setAttribute("class","xfaLayer xfaFont");const f=[];if(r.children.length===0){if(r.value){const m=document.createTextNode(r.value);o.append(m),u&&Eo.shouldBuildText(r.name)&&f.push(m)}return{textDivs:f}}const p=[[r,-1,o]];for(;p.length>0;){const[m,y,v]=p.at(-1);if(y+1===m.children.length){p.pop();continue}const _=m.children[++p.at(-1)[1]];if(_===null)continue;const{name:w}=_;if(w==="#text"){const E=document.createTextNode(_.value);f.push(E),v.append(E);continue}const S=_?.attributes?.xmlns?document.createElementNS(_.attributes.xmlns,w):document.createElement(w);if(v.append(S),_.attributes&&this.setAttributes({html:S,element:_,storage:e,intent:a,linkService:n}),_.children?.length>0)p.push([_,-1,S]);else if(_.value){const E=document.createTextNode(_.value);u&&Eo.shouldBuildText(w)&&f.push(E),S.append(E)}}for(const m of d.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:f}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const Cn="http://www.w3.org/2000/svg";class na{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function Do(c,t="text"){if(fo(c,document.baseURI)){const e=await fetch(c);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,n)=>{const r=new XMLHttpRequest;r.open("GET",c,!0),r.responseType=t,r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE){if(r.status===200||r.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(r.response);return}e(r.responseText);return}n(new Error(r.statusText))}},r.send(null)})}class Mo{constructor({viewBox:t,userUnit:e,scale:n,rotation:r,offsetX:a=0,offsetY:o=0,dontFlip:u=!1}){this.viewBox=t,this.userUnit=e,this.scale=n,this.rotation=r,this.offsetX=a,this.offsetY=o,n*=e;const d=(t[2]+t[0])/2,f=(t[3]+t[1])/2;let p,m,y,v;switch(r%=360,r<0&&(r+=360),r){case 180:p=-1,m=0,y=0,v=1;break;case 90:p=0,m=1,y=1,v=0;break;case 270:p=0,m=-1,y=-1,v=0;break;case 0:p=1,m=0,y=0,v=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}u&&(y=-y,v=-v);let _,w,S,E;p===0?(_=Math.abs(f-t[1])*n+a,w=Math.abs(d-t[0])*n+o,S=(t[3]-t[1])*n,E=(t[2]-t[0])*n):(_=Math.abs(d-t[0])*n+a,w=Math.abs(f-t[1])*n+o,S=(t[2]-t[0])*n,E=(t[3]-t[1])*n),this.transform=[p*n,m*n,y*n,v*n,_-p*n*d-y*n*f,w-m*n*d-v*n*f],this.width=S,this.height=E}get rawDims(){const t=this.viewBox;return Et(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:n=this.offsetX,offsetY:r=this.offsetY,dontFlip:a=!1}={}){return new Mo({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:r,dontFlip:a})}convertToViewportPoint(t,e){const n=[t,e];return at.applyTransform(n,this.transform),n}convertToViewportRectangle(t){const e=[t[0],t[1]];at.applyTransform(e,this.transform);const n=[t[2],t[3]];return at.applyTransform(n,this.transform),[e[0],e[1],n[0],n[1]]}convertToPdfPoint(t,e){const n=[t,e];return at.applyInverseTransform(n,this.transform),n}}class Ff extends qi{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function Qc(c){const t=c.length;let e=0;for(;e<t&&c[e].trim()==="";)e++;return c.substring(e,e+5).toLowerCase()==="data:"}function zf(c){return typeof c=="string"&&/\.pdf$/i.test(c)}function BE(c){return[c]=c.split(/[#?]/,1),c.substring(c.lastIndexOf("/")+1)}function IE(c,t="document.pdf"){if(typeof c!="string")return t;if(Qc(c))return xt('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const n=(u=>{try{return new URL(u)}catch{try{return new URL(decodeURIComponent(u))}catch{try{return new URL(u,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(u),"https://foo.bar")}catch{return null}}}}})(c);if(!n)return t;const r=u=>{try{let d=decodeURIComponent(u);return d.includes("/")?(d=d.split("/").at(-1),d.test(/^\.pdf$/i)?d:u):d}catch{return u}},a=/\.pdf$/i,o=n.pathname.split("/").at(-1);if(a.test(o))return r(o);if(n.searchParams.size>0){const u=Array.from(n.searchParams.values()).reverse();for(const f of u)if(a.test(f))return r(f);const d=Array.from(n.searchParams.keys()).reverse();for(const f of d)if(a.test(f))return r(f)}if(n.hash){const d=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(d)return r(d[0])}return t}class Hb{started=Object.create(null);times=[];time(t){t in this.started&&xt(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||xt(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:n}of this.times)e=Math.max(n.length,e);for(const{name:n,start:r,end:a}of this.times)t.push(`${n.padEnd(e)} ${a-r}ms
`);return t.join("")}}function fo(c,t){const e=t?URL.parse(c,t):URL.parse(c);return e?.protocol==="http:"||e?.protocol==="https:"}function Ds(c){c.preventDefault()}function ue(c){c.preventDefault(),c.stopPropagation()}function UE(c){console.log("Deprecated API usage: "+c)}class gf{static#t;static toDateObject(t){if(t instanceof Date)return t;if(!t||typeof t!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#t.exec(t);if(!e)return null;const n=parseInt(e[1],10);let r=parseInt(e[2],10);r=r>=1&&r<=12?r-1:0;let a=parseInt(e[3],10);a=a>=1&&a<=31?a:1;let o=parseInt(e[4],10);o=o>=0&&o<=23?o:0;let u=parseInt(e[5],10);u=u>=0&&u<=59?u:0;let d=parseInt(e[6],10);d=d>=0&&d<=59?d:0;const f=e[7]||"Z";let p=parseInt(e[8],10);p=p>=0&&p<=23?p:0;let m=parseInt(e[9],10)||0;return m=m>=0&&m<=59?m:0,f==="-"?(o+=p,u+=m):f==="+"&&(o-=p,u-=m),new Date(Date.UTC(n,r,a,o,u,d))}}function FE(c,{scale:t=1,rotation:e=0}){const{width:n,height:r}=c.attributes.style,a=[0,0,parseInt(n),parseInt(r)];return new Mo({viewBox:a,userUnit:1,scale:t,rotation:e})}function jo(c){if(c.startsWith("#")){const t=parseInt(c.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return c.startsWith("rgb(")?c.slice(4,-1).split(",").map(t=>parseInt(t)):c.startsWith("rgba(")?c.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(xt(`Not a valid color format: "${c}"`),[0,0,0])}function zE(c){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of c.keys()){t.style.color=e;const n=window.getComputedStyle(t).color;c.set(e,jo(n))}t.remove()}function ae(c){const{a:t,b:e,c:n,d:r,e:a,f:o}=c.getTransform();return[t,e,n,r,a,o]}function Qs(c){const{a:t,b:e,c:n,d:r,e:a,f:o}=c.getTransform().invertSelf();return[t,e,n,r,a,o]}function Hi(c,t,e=!1,n=!0){if(t instanceof Mo){const{pageWidth:r,pageHeight:a}=t.rawDims,{style:o}=c,u=Ue.isCSSRoundSupported,d=`var(--total-scale-factor) * ${r}px`,f=`var(--total-scale-factor) * ${a}px`,p=u?`round(down, ${d}, var(--scale-round-x))`:`calc(${d})`,m=u?`round(down, ${f}, var(--scale-round-y))`:`calc(${f})`;!e||t.rotation%180===0?(o.width=p,o.height=m):(o.width=m,o.height=p)}n&&c.setAttribute("data-main-rotation",t.rotation)}class sn{constructor(){const{pixelRatio:t}=sn;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,n,r,a=-1){let o=1/0,u=1/0,d=1/0;n=sn.capPixels(n,a),n>0&&(o=Math.sqrt(n/(t*e))),r!==-1&&(u=r/t,d=r/e);const f=Math.min(o,u,d);return this.sx>f||this.sy>f?(this.sx=f,this.sy=f,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,n):n}return t}}const mf=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class HE{static get isDarkMode(){return Et(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class $E{static get commentForegroundColor(){const t=document.createElement("span");t.classList.add("comment","sidebar");const{style:e}=t;e.width=e.height="0",e.display="none",e.color="var(--comment-fg-color)",document.body.append(t);const{color:n}=window.getComputedStyle(t);return t.remove(),Et(this,"commentForegroundColor",jo(n))}}function qE(c,t,e,n){n=Math.min(Math.max(n??1,0),1);const r=255*(1-n);return c=Math.round(c*n+r),t=Math.round(t*n+r),e=Math.round(e*n+r),[c,t,e]}function $b(c,t){const e=c[0]/255,n=c[1]/255,r=c[2]/255,a=Math.max(e,n,r),o=Math.min(e,n,r),u=(a+o)/2;if(a===o)t[0]=t[1]=0;else{const d=a-o;switch(t[1]=u<.5?d/(a+o):d/(2-a-o),a){case e:t[0]=((n-r)/d+(n<r?6:0))*60;break;case n:t[0]=((r-e)/d+2)*60;break;case r:t[0]=((e-n)/d+4)*60;break}}t[2]=u}function bf(c,t){const e=c[0],n=c[1],r=c[2],a=(1-Math.abs(2*r-1))*n,o=a*(1-Math.abs(e/60%2-1)),u=r-a/2;switch(Math.floor(e/60)){case 0:t[0]=a+u,t[1]=o+u,t[2]=u;break;case 1:t[0]=o+u,t[1]=a+u,t[2]=u;break;case 2:t[0]=u,t[1]=a+u,t[2]=o+u;break;case 3:t[0]=u,t[1]=o+u,t[2]=a+u;break;case 4:t[0]=o+u,t[1]=u,t[2]=a+u;break;case 5:case 6:t[0]=a+u,t[1]=u,t[2]=o+u;break}}function qb(c){return c<=.03928?c/12.92:((c+.055)/1.055)**2.4}function Gb(c,t,e){bf(c,e),e.map(qb);const n=.2126*e[0]+.7152*e[1]+.0722*e[2];bf(t,e),e.map(qb);const r=.2126*e[0]+.7152*e[1]+.0722*e[2];return n>r?(n+.05)/(r+.05):(r+.05)/(n+.05)}const Vb=new Map;function GE(c,t){const e=c[0]+c[1]*256+c[2]*65536+t[0]*16777216+t[1]*4294967296+t[2]*1099511627776;let n=Vb.get(e);if(n)return n;const r=new Float32Array(9),a=r.subarray(0,3),o=r.subarray(3,6);$b(c,o);const u=r.subarray(6,9);$b(t,u);const d=u[2]<.5,f=d?12:4.5;if(o[2]=d?Math.sqrt(o[2]):1-Math.sqrt(1-o[2]),Gb(o,u,a)<f){let p,m;d?(p=o[2],m=1):(p=0,m=o[2]);const y=.005;for(;m-p>y;){const v=o[2]=(p+m)/2;d===Gb(o,u,a)<f?p=v:m=v}o[2]=d?m:p}return bf(o,a),n=at.makeHexColor(Math.round(a[0]*255),Math.round(a[1]*255),Math.round(a[2]*255)),Vb.set(e,n),n}function Hv({html:c,dir:t,className:e},n){const r=document.createDocumentFragment();if(typeof c=="string"){const a=document.createElement("p");a.dir=t||"auto";const o=c.split(/(?:\r\n?|\n)/);for(let u=0,d=o.length;u<d;++u){const f=o[u];a.append(document.createTextNode(f)),u<d-1&&a.append(document.createElement("br"))}r.append(a)}else zv.render({xfaHtml:c,div:r,intent:"richText"});r.firstElementChild.classList.add("richText",e),n.append(r)}function $v(c){const t=new Path2D;if(!c)return t;for(let e=0,n=c.length;e<n;)switch(c[e++]){case no.moveTo:t.moveTo(c[e++],c[e++]);break;case no.lineTo:t.lineTo(c[e++],c[e++]);break;case no.curveTo:t.bezierCurveTo(c[e++],c[e++],c[e++],c[e++],c[e++],c[e++]);break;case no.quadraticCurveTo:t.quadraticCurveTo(c[e++],c[e++],c[e++],c[e++]);break;case no.closePath:t.closePath();break;default:xt(`Unrecognized drawing path operator: ${c[e-1]}`);break}return t}class vo{#t=null;#e=null;#n;#s=null;#a=null;#r=null;#i=null;#o=null;static#c=null;constructor(t){this.#n=t,vo.#c||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const t=this.#t=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#n._uiManager._signal;e instanceof AbortSignal&&!e.aborted&&(t.addEventListener("contextmenu",Ds,{signal:e}),t.addEventListener("pointerdown",vo.#l,{signal:e}));const n=this.#s=document.createElement("div");n.className="buttons",t.append(n);const r=this.#n.toolbarPosition;if(r){const{style:a}=t,o=this.#n._uiManager.direction==="ltr"?1-r[0]:r[0];a.insetInlineEnd=`${100*o}%`,a.top=`calc(${100*r[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return this.#t}static#l(t){t.stopPropagation()}#d(t){this.#n._focusEventsAllowed=!1,ue(t)}#h(t){this.#n._focusEventsAllowed=!0,ue(t)}#f(t){const e=this.#n._uiManager._signal;return!(e instanceof AbortSignal)||e.aborted?!1:(t.addEventListener("focusin",this.#d.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#h.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",Ds,{signal:e}),!0)}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#a?.shown(),this.#r?.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=this.#n,n=document.createElement("button");n.classList.add("basic","deleteButton"),n.tabIndex=0,n.setAttribute("data-l10n-id",vo.#c[t]),this.#f(n)&&n.addEventListener("click",r=>{e.delete()},{signal:e._signal}),this.#s.append(n)}get#m(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#f(e),this.#s.append(e,this.#m),this.#a=t}addComment(t,e=null){if(this.#r)return;const n=t.renderForToolbar();if(!n)return;this.#f(n);const r=this.#i=this.#m;e?(this.#s.insertBefore(n,e),this.#s.insertBefore(r,e)):this.#s.append(n,r),this.#r=t,t.toolbar=this}addColorPicker(t){if(this.#e)return;this.#e=t;const e=t.renderButton();this.#f(e),this.#s.append(e,this.#m)}async addEditSignatureButton(t){const e=this.#o=await t.renderEditButton(this.#n);this.#f(e),this.#s.append(e,this.#m)}removeButton(t){switch(t){case"comment":this.#r?.removeToolbarCommentButton(),this.#r=null,this.#i?.remove(),this.#i=null;break}}async addButton(t,e){switch(t){case"colorPicker":e&&this.addColorPicker(e);break;case"altText":e&&await this.addAltText(e);break;case"editSignature":e&&await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":e&&this.addComment(e);break}}async addButtonBefore(t,e,n){if(!e&&t==="comment")return;const r=this.#s.querySelector(n);r&&t==="comment"&&this.addComment(e,r)}updateEditSignatureButton(t){this.#o&&(this.#o.title=t)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class VE{#t=null;#e=null;#n;constructor(t){this.#n=t}#s(){const t=this.#e=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar");const e=this.#n._signal;e instanceof AbortSignal&&!e.aborted&&t.addEventListener("contextmenu",Ds,{signal:e});const n=this.#t=document.createElement("div");return n.className="buttons",t.append(n),this.#n.hasCommentManager()&&this.#r("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#n.commentSelection("floating_button")}),this.#r("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#n.highlightSelection("floating_button")}),t}#a(t,e){let n=0,r=0;for(const a of t){const o=a.y+a.height;if(o<n)continue;const u=a.x+(e?a.width:0);if(o>n){r=u,n=o;continue}e?u>r&&(r=u):u<r&&(r=u)}return[e?1-r:r,n]}show(t,e,n){const[r,a]=this.#a(e,n),{style:o}=this.#e||=this.#s();t.append(this.#e),o.insetInlineEnd=`${100*r}%`,o.top=`calc(${100*a}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#r(t,e,n,r){const a=document.createElement("button");a.classList.add("basic",t),a.tabIndex=0,a.setAttribute("data-l10n-id",e);const o=document.createElement("span");a.append(o),o.className="visuallyHidden",o.setAttribute("data-l10n-id",n);const u=this.#n._signal;u instanceof AbortSignal&&!u.aborted&&(a.addEventListener("contextmenu",Ds,{signal:u}),a.addEventListener("click",r,{signal:u})),this.#t.append(a)}}function qv(c,t,e){for(const n of e)t.addEventListener(n,c[n].bind(c))}class Ht{static#t=NaN;static#e=null;static#n=NaN;static#s=null;static initializeAndAddPointerId(t){(Ht.#e||=new Set).add(t)}static setPointer(t,e){Ht.#t||=e,Ht.#s??=t}static setTimeStamp(t){Ht.#n=t}static isSamePointerId(t){return Ht.#t===t}static isSamePointerIdOrRemove(t){return Ht.#t===t?!0:(Ht.#e?.delete(t),!1)}static isSamePointerType(t){return Ht.#s===t}static isInitializedAndDifferentPointerType(t){return Ht.#s!==null&&!Ht.isSamePointerType(t)}static isSameTimeStamp(t){return Ht.#n===t}static isUsingMultiplePointers(){return Ht.#e?.size>=1}static clearPointerType(){Ht.#s=null}static clearPointerIds(){Ht.#t=NaN,Ht.#e=null}static clearTimeStamp(){Ht.#n=NaN}}class XE{#t=0;get id(){return`${So}${this.#t++}`}}class Hf{#t=Uv();#e=0;#n=null;static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),r=new Image;r.src=t;const a=r.decode().then(()=>(n.drawImage(r,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return Et(this,"_isSVGFittingCanvas",a)}async#s(t,e){this.#n||=new Map;let n=this.#n.get(t);if(n===null)return null;if(n?.bitmap)return n.refCounter+=1,n;try{n||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let r;if(typeof e=="string"?(n.url=e,r=await Do(e,"blob")):e instanceof File?r=n.file=e:e instanceof Blob&&(r=e),r.type==="image/svg+xml"){const a=Hf._isSVGFittingCanvas,o=new FileReader,u=new Image,d=new Promise((f,p)=>{u.onload=()=>{n.bitmap=u,n.isSvg=!0,f()},o.onload=async()=>{const m=n.svgUrl=o.result;u.src=await a?`${m}#svgView(preserveAspectRatio(none))`:m},u.onerror=o.onerror=p});o.readAsDataURL(r),await d}else n.bitmap=await createImageBitmap(r);n.refCounter=1}catch(r){xt(r),n=null}return this.#n.set(t,n),n&&this.#n.set(n.id,n),n}async getFromFile(t){const{lastModified:e,name:n,size:r,type:a}=t;return this.#s(`${e}_${n}_${r}_${a}`,t)}async getFromUrl(t){return this.#s(t,t)}async getFromBlob(t,e){const n=await e;return this.#s(t,n)}async getFromId(t){this.#n||=new Map;const e=this.#n.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:n}=e;return delete e.blobPromise,this.getFromBlob(e.id,n)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#n||=new Map;let n=this.#n.get(t);if(n?.bitmap)return n.refCounter+=1,n;const r=new OffscreenCanvas(e.width,e.height);return r.getContext("2d").drawImage(e,0,0),n={bitmap:r.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#n.set(t,n),this.#n.set(n.id,n),n}getSvgUrl(t){const e=this.#n.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#n||=new Map;const e=this.#n.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:n}=e;if(!e.url&&!e.file){const r=new OffscreenCanvas(n.width,n.height);r.getContext("bitmaprenderer").transferFromImageBitmap(n),e.blobPromise=r.convertToBlob()}n.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#t}_`)}}class YE{#t=[];#e=!1;#n;#s=-1;constructor(t=128){this.#n=t}add({cmd:t,undo:e,post:n,mustExec:r,type:a=NaN,overwriteIfSameType:o=!1,keepUndo:u=!1}){if(r&&t(),this.#e)return;const d={cmd:t,undo:e,post:n,type:a};if(this.#s===-1){this.#t.length>0&&(this.#t.length=0),this.#s=0,this.#t.push(d);return}if(o&&this.#t[this.#s].type===a){u&&(d.undo=this.#t[this.#s].undo),this.#t[this.#s]=d;return}const f=this.#s+1;f===this.#n?this.#t.splice(0,1):(this.#s=f,f<this.#t.length&&this.#t.splice(f)),this.#t.push(d)}undo(){if(this.#s===-1)return;this.#e=!0;const{undo:t,post:e}=this.#t[this.#s];t(),e?.(),this.#e=!1,this.#s-=1}redo(){if(this.#s<this.#t.length-1){this.#s+=1,this.#e=!0;const{cmd:t,post:e}=this.#t[this.#s];t(),e?.(),this.#e=!1}}hasSomethingToUndo(){return this.#s!==-1}hasSomethingToRedo(){return this.#s<this.#t.length-1}cleanType(t){if(this.#s!==-1){for(let e=this.#s;e>=0;e--)if(this.#t[e].type!==t){this.#t.splice(e+1,this.#s-e),this.#s=e;return}this.#t.length=0,this.#s=-1}}destroy(){this.#t=null}}class Lo{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=Ue.platform;for(const[n,r,a={}]of t)for(const o of n){const u=o.startsWith("mac+");e&&u?(this.callbacks.set(o.slice(4),{callback:r,options:a}),this.allKeys.add(o.split("+").at(-1))):!e&&!u&&(this.callbacks.set(o,{callback:r,options:a}),this.allKeys.add(o.split("+").at(-1)))}}#t(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const n=this.callbacks.get(this.#t(e));if(!n)return;const{callback:r,options:{bubbles:a=!1,args:o=[],checker:u=null}}=n;u&&!u(t,e)||(r.bind(t,...o,e)(),a||ue(e))}}class $f{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return zE(t),Et(this,"_colors",t)}convert(t){const e=jo(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[n,r]of this._colors)if(r.every((a,o)=>a===e[o]))return $f._colorsMapping.get(n);return e}getHexCode(t){const e=this._colors.get(t);return e?at.makeHexColor(...e):t}}class ai{#t=new AbortController;#e=null;#n=null;#s=new Map;#a=new Map;#r=null;#i=null;#o=null;#c=new YE;#l=null;#d=null;#h=null;#f=0;#m=new Set;#g=null;#u=null;#p=new Set;_editorUndoBar=null;#b=!1;#v=!1;#y=!1;#E=null;#S=null;#_=null;#C=null;#w=!1;#x=null;#N=new XE;#R=!1;#O=!1;#B=!1;#D=null;#j=null;#I=null;#L=null;#q=null;#T=Tt.NONE;#A=new Set;#M=null;#U=null;#z=null;#X=null;#V=null;#Y={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#H=[0,0];#P=null;#G=null;#J=null;#Z=null;#F=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=ai.prototype,e=o=>o.#G.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),n=(o,{target:u})=>{if(u instanceof HTMLInputElement){const{type:d}=u;return d!=="text"&&d!=="number"}return!0},r=this.TRANSLATE_SMALL,a=this.TRANSLATE_BIG;return Et(this,"_keyboardManager",new Lo([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],t.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:n}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(o,{target:u})=>!(u instanceof HTMLButtonElement)&&o.#G.contains(u)&&!o.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(o,{target:u})=>!(u instanceof HTMLButtonElement)&&o.#G.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-r,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-a,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[r,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[a,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-r],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-a],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,r],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,a],checker:e}]]))}constructor(t,e,n,r,a,o,u,d,f,p,m,y,v,_,w,S){const E=this._signal=this.#t.signal;this.#G=t,this.#J=e,this.#Z=n,this.#r=r,this.#l=a,this.#U=o,this.#V=d,this._eventBus=u,u._on("editingaction",this.onEditingAction.bind(this),{signal:E}),u._on("pagechanging",this.onPageChanging.bind(this),{signal:E}),u._on("scalechanging",this.onScaleChanging.bind(this),{signal:E}),u._on("rotationchanging",this.onRotationChanging.bind(this),{signal:E}),u._on("setpreference",this.onSetPreference.bind(this),{signal:E}),u._on("switchannotationeditorparams",R=>this.updateParams(R.type,R.value),{signal:E}),window.addEventListener("pointerdown",()=>{this.#O=!0},{capture:!0,signal:E}),window.addEventListener("pointerup",()=>{this.#O=!1},{capture:!0,signal:E}),this.#at(),this.#dt(),this.#et(),this.#i=d.annotationStorage,this.#E=d.filterFactory,this.#z=f,this.#C=p||null,this.#b=m,this.#v=y,this.#y=v,this.#q=_||null,this.viewParameters={realScale:na.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=w||null,this._supportsPinchToZoom=S!==!1,a?.setSidebarUiManager(this)}destroy(){this.#F?.resolve(),this.#F=null,this.#t?.abort(),this.#t=null,this._signal=null;for(const t of this.#a.values())t.destroy();this.#a.clear(),this.#s.clear(),this.#p.clear(),this.#L?.clear(),this.#e=null,this.#A.clear(),this.#c.destroy(),this.#r?.destroy(),this.#l?.destroy(),this.#U?.destroy(),this.#x?.hide(),this.#x=null,this.#I?.destroy(),this.#I=null,this.#n=null,this.#S&&(clearTimeout(this.#S),this.#S=null),this.#P&&(clearTimeout(this.#P),this.#P=null),this._editorUndoBar?.destroy(),this.#V=null}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#q}get useNewAltTextFlow(){return this.#v}get useNewAltTextWhenAddingImage(){return this.#y}get hcmFilter(){return Et(this,"hcmFilter",this.#z?this.#E.addHCMFilter(this.#z.foreground,this.#z.background):"none")}get direction(){return Et(this,"direction",getComputedStyle(this.#G).direction)}get _highlightColors(){return Et(this,"_highlightColors",this.#C?new Map(this.#C.split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return Et(this,"highlightColors",null);const e=new Map,n=!!this.#z;for(const[r,a]of t){const o=r.endsWith("_HCM");if(n&&o){e.set(r.replace("_HCM",""),a);continue}!n&&!o&&e.set(r,a)}return Et(this,"highlightColors",e)}get highlightColorNames(){return Et(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#h=t}setMainHighlightColorPicker(t){this.#I=t}editAltText(t,e=!1){this.#r?.editAltText(this,t,e)}hasCommentManager(){return!!this.#l}editComment(t,e,n,r){this.#l?.showDialog(this,t,e,n,r)}selectComment(t,e){this.#a.get(t)?.getEditorByUID(e)?.toggleComment(!0,!0)}updateComment(t){this.#l?.updateComment(t.getData())}updatePopupColor(t){this.#l?.updatePopupColor(t)}removeComment(t){this.#l?.removeComments([t.uid])}toggleComment(t,e,n=void 0){this.#l?.toggleCommentPopup(t,e,n)}makeCommentColor(t,e){return t&&this.#l?.makeCommentColor(t,e)||null}getCommentDialogElement(){return this.#l?.dialogElement||null}async waitForEditorsRendered(t){if(this.#a.has(t-1))return;const{resolve:e,promise:n}=Promise.withResolvers(),r=a=>{a.pageNumber===t&&(this._eventBus._off("editorsrendered",r),e())};this._eventBus.on("editorsrendered",r),await n}getSignature(t){this.#U?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#U}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":this.#y=e;break}}onPageChanging({pageNumber:t}){this.#f=t-1}focusMainContainer(){this.#G.focus()}findParent(t,e){for(const n of this.#a.values()){const{x:r,y:a,width:o,height:u}=n.div.getBoundingClientRect();if(t>=r&&t<=r+o&&e>=a&&e<=a+u)return n}return null}disableUserSelect(t=!1){this.#J.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#p.add(t)}removeShouldRescale(t){this.#p.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*na.PDF_TO_CSS_UNITS;for(const e of this.#p)e.onScaleChanging();this.#h?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#Q({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#tt(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const n of this.#a.values())if(n.hasTextLayer(t))return n;return null}highlightSelection(t="",e=!1){const n=document.getSelection();if(!n||n.isCollapsed)return;const{anchorNode:r,anchorOffset:a,focusNode:o,focusOffset:u}=n,d=n.toString(),p=this.#Q(n).closest(".textLayer"),m=this.getSelectionBoxes(p);if(!m)return;n.empty();const y=this.#tt(p),v=this.#T===Tt.NONE,_=()=>{const w=y?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:m,anchorNode:r,anchorOffset:a,focusNode:o,focusOffset:u,text:d});v&&this.showAllEditors("highlight",!0,!0),e&&w?.editComment()};if(v){this.switchToMode(Tt.HIGHLIGHT,_);return}_()}commentSelection(t=""){this.highlightSelection(t,!0)}#it(){const t=document.getSelection();if(!t||t.isCollapsed)return;const n=this.#Q(t).closest(".textLayer"),r=this.getSelectionBoxes(n);r&&(this.#x||=new VE(this),this.#x.show(n,r,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(t){if(!this.#i)return null;const e=`${So}${t}`,n=this.#i.getRawValue(e);return n&&this.#i.remove(e),n}addToAnnotationStorage(t){!t.isEmpty()&&this.#i&&!this.#i.has(t.id)&&this.#i.setValue(t.id,t)}a11yAlert(t,e=null){const n=this.#Z;n&&(n.setAttribute("data-l10n-id",t),e?n.setAttribute("data-l10n-args",JSON.stringify(e)):n.removeAttribute("data-l10n-args"))}#rt(){const t=document.getSelection();if(!t||t.isCollapsed){this.#M&&(this.#x?.hide(),this.#M=null,this.#k({hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===this.#M)return;const r=this.#Q(t).closest(".textLayer");if(!r){this.#M&&(this.#x?.hide(),this.#M=null,this.#k({hasSelectedText:!1}));return}if(this.#x?.hide(),this.#M=e,this.#k({hasSelectedText:!0}),!(this.#T!==Tt.HIGHLIGHT&&this.#T!==Tt.NONE)&&(this.#T===Tt.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#w=this.isShiftKeyDown,!this.isShiftKeyDown)){const a=this.#T===Tt.HIGHLIGHT?this.#tt(r):null;if(a?.toggleDrawing(),this.#O){const o=new AbortController,u=this.combinedSignal(o),d=f=>{f.type==="pointerup"&&f.button!==0||(o.abort(),a?.toggleDrawing(!0),f.type==="pointerup"&&this.#K("main_toolbar"))};window.addEventListener("pointerup",d,{signal:u}),window.addEventListener("blur",d,{signal:u})}else a?.toggleDrawing(!0),this.#K("main_toolbar")}}#K(t=""){this.#T===Tt.HIGHLIGHT?this.highlightSelection(t):this.#b&&this.#it()}#at(){document.addEventListener("selectionchange",this.#rt.bind(this),{signal:this._signal})}#ot(){if(this.#_)return;this.#_=new AbortController;const t=this.combinedSignal(this.#_);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#lt(){this.#_?.abort(),this.#_=null}blur(){if(this.isShiftKeyDown=!1,this.#w&&(this.#w=!1,this.#K("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#A)if(e.div.contains(t)){this.#j=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#j)return;const[t,e]=this.#j;this.#j=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#et(){if(this.#D)return;this.#D=new AbortController;const t=this.combinedSignal(this.#D);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#ct(){this.#D?.abort(),this.#D=null}#ut(){if(this.#d)return;this.#d=new AbortController;const t=this.combinedSignal(this.#d);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#ht(){this.#d?.abort(),this.#d=null}#dt(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#et(),this.setEditingState(!0)}removeEditListeners(){this.#ct(),this.setEditingState(!1)}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const n of this.#u)if(n.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const n of this.#u)if(n.isHandlingMimeForPasting(e.type)){n.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const n of this.#A){const r=n.serialize(!0);r&&e.push(r)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const a of e.items)for(const o of this.#u)if(o.isHandlingMimeForPasting(a.type)){o.paste(a,this.currentLayer);return}let n=e.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(a){xt(`paste: "${a.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();const r=this.currentLayer;try{const a=[];for(const d of n){const f=await r.deserialize(d);if(!f)return;a.push(f)}const o=()=>{for(const d of a)this.#st(d);this.#nt(a)},u=()=>{for(const d of a)d.remove()};this.addCommands({cmd:o,undo:u,mustExec:!0})}catch(a){xt(`paste: "${a.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#T!==Tt.NONE&&!this.isEditorHandlingKeyboard&&ai._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#w&&(this.#w=!1,this.#K("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#k(t){Object.entries(t).some(([n,r])=>this.#Y[n]!==r)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#Y,t)}),this.#T===Tt.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#$([[Lt.HIGHLIGHT_FREE,!0]]))}#$(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#ot(),this.#ut(),this.#k({isEditing:this.#T!==Tt.NONE,isEmpty:this.#W(),hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:this.#c.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#lt(),this.#ht(),this.#k({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#u){this.#u=t;for(const e of this.#u)this.#$(e.defaultPropertiesToUpdate)}}getId(){return this.#N.id}get currentLayer(){return this.#a.get(this.#f)}getLayer(t){return this.#a.get(t)}get currentPageIndex(){return this.#f}addLayer(t){this.#a.set(t.pageIndex,t),this.#R?t.enable():t.disable()}removeLayer(t){this.#a.delete(t.pageIndex)}async updateMode(t,e=null,n=!1,r=!1,a=!1){if(this.#T!==t&&!(this.#F&&(await this.#F.promise,!this.#F))){if(this.#F=Promise.withResolvers(),this.#h?.commitOrRemove(),this.#T===Tt.POPUP&&this.#l?.hideSidebar(),this.#l?.destroyPopup(),this.#T=t,t===Tt.NONE){this.setEditingState(!1),this.#pt();for(const o of this.#s.values())o.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#F.resolve();return}for(const o of this.#s.values())o.addStandaloneCommentButton();t===Tt.SIGNATURE&&await this.#U?.loadSignatures(),this.setEditingState(!0),await this.#ft(),this.unselectAll();for(const o of this.#a.values())o.updateMode(t);if(t===Tt.POPUP){this.#n||=await this.#V.getAnnotationsByType(new Set(this.#u.map(d=>d._editorType)));const o=new Set,u=[];for(const d of this.#s.values()){const{annotationElementId:f,hasComment:p,deleted:m}=d;f&&o.add(f),p&&!m&&u.push(d.getData())}for(const d of this.#n){const{id:f,popupRef:p,contentsObj:m}=d;p&&m?.str&&!o.has(f)&&!this.#m.has(f)&&u.push(d)}this.#l?.showSidebar(u)}if(!e){n&&this.addNewEditorFromKeyboard(),this.#F.resolve();return}for(const o of this.#s.values())o.uid===e?(this.setSelected(o),a?o.editComment():r?o.enterInEditMode():o.focus()):o.unselect();this.#F.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==this.#T&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(this.#u){switch(t){case Lt.CREATE:this.currentLayer.addNewEditor(e);return;case Lt.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#X||=new Map).set(t,e),this.showAllEditors("highlight",e);break}if(this.hasSelection)for(const n of this.#A)n.updateParams(t,e);else for(const n of this.#u)n.updateDefaultParams(t,e)}}showAllEditors(t,e,n=!1){for(const a of this.#s.values())a.editorType===t&&a.show(e);(this.#X?.get(Lt.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#$([[Lt.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#B!==t){this.#B=t;for(const e of this.#a.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#ft(){if(!this.#R){this.#R=!0;const t=[];for(const e of this.#a.values())t.push(e.enable());await Promise.all(t);for(const e of this.#s.values())e.enable()}}#pt(){if(this.unselectAll(),this.#R){this.#R=!1;for(const t of this.#a.values())t.disable();for(const t of this.#s.values())t.disable()}}*getEditors(t){for(const e of this.#s.values())e.pageIndex===t&&(yield e)}getEditor(t){return this.#s.get(t)}addEditor(t){this.#s.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#S&&clearTimeout(this.#S),this.#S=setTimeout(()=>{this.focusMainContainer(),this.#S=null},0)),this.#s.delete(t.id),t.annotationElementId&&this.#L?.delete(t.annotationElementId),this.unselect(t),(!t.annotationElementId||!this.#m.has(t.annotationElementId))&&this.#i?.remove(t.id)}addDeletedAnnotationElement(t){this.#m.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#m.has(t)}removeDeletedAnnotationElement(t){this.#m.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#st(t){const e=this.#a.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#$(t.propertiesToUpdate))}get#gt(){let t=null;for(t of this.#A);return t}updateUI(t){this.#gt===t&&this.#$(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#$(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#A.has(t)){this.#A.delete(t),t.unselect(),this.#k({hasSelectedEditor:this.hasSelection});return}this.#A.add(t),t.select(),this.#$(t.propertiesToUpdate),this.#k({hasSelectedEditor:!0})}setSelected(t){this.updateToolbar({mode:t.mode,editId:t.uid}),this.#h?.commitOrRemove();for(const e of this.#A)e!==t&&e.unselect();this.#A.clear(),this.#A.add(t),t.select(),this.#$(t.propertiesToUpdate),this.#k({hasSelectedEditor:!0})}isSelected(t){return this.#A.has(t)}get firstSelectedEditor(){return this.#A.values().next().value}unselect(t){t.unselect(),this.#A.delete(t),this.#k({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#A.size!==0}get isEnterHandled(){return this.#A.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#c.undo(),this.#k({hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#W()}),this._editorUndoBar?.hide()}redo(){this.#c.redo(),this.#k({hasSomethingToUndo:!0,hasSomethingToRedo:this.#c.hasSomethingToRedo(),isEmpty:this.#W()})}addCommands(t){this.#c.add(t),this.#k({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#W()})}cleanUndoStack(t){this.#c.cleanType(t)}#W(){if(this.#s.size===0)return!0;if(this.#s.size===1)for(const t of this.#s.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...this.#A],n=()=>{this._editorUndoBar?.show(r,e.length===1?e[0].editorType:e.length);for(const a of e)a.remove()},r=()=>{for(const a of e)this.#st(a)};this.addCommands({cmd:n,undo:r,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#nt(t){for(const e of this.#A)e.unselect();this.#A.clear();for(const e of t)e.isEmpty()||(this.#A.add(e),e.select());this.#k({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#A)t.commit();this.#nt(this.#s.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#T!==Tt.NONE))&&!this.#h?.commitOrRemove()&&this.hasSelection){for(const t of this.#A)t.unselect();this.#A.clear(),this.#k({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;this.#H[0]+=t,this.#H[1]+=e;const[r,a]=this.#H,o=[...this.#A],u=1e3;this.#P&&clearTimeout(this.#P),this.#P=setTimeout(()=>{this.#P=null,this.#H[0]=this.#H[1]=0,this.addCommands({cmd:()=>{for(const d of o)this.#s.has(d.id)&&(d.translateInPage(r,a),d.translationDone())},undo:()=>{for(const d of o)this.#s.has(d.id)&&(d.translateInPage(-r,-a),d.translationDone())},mustExec:!1})},u);for(const d of o)d.translateInPage(t,e),d.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#g=new Map;for(const t of this.#A)this.#g.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#g)return!1;this.disableUserSelect(!1);const t=this.#g;this.#g=null;let e=!1;for(const[{x:r,y:a,pageIndex:o},u]of t)u.newX=r,u.newY=a,u.newPageIndex=o,e||=r!==u.savedX||a!==u.savedY||o!==u.savedPageIndex;if(!e)return!1;const n=(r,a,o,u)=>{if(this.#s.has(r.id)){const d=this.#a.get(u);d?r._setParentAndPosition(d,a,o):(r.pageIndex=u,r.x=a,r.y=o)}};return this.addCommands({cmd:()=>{for(const[r,{newX:a,newY:o,newPageIndex:u}]of t)n(r,a,o,u)},undo:()=>{for(const[r,{savedX:a,savedY:o,savedPageIndex:u}]of t)n(r,a,o,u)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#g)for(const n of this.#g.keys())n.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#A.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#T}isEditingMode(){return this.#T!==Tt.NONE}get imageManager(){return Et(this,"imageManager",new Hf)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let f=0,p=e.rangeCount;f<p;f++)if(!t.contains(e.getRangeAt(f).commonAncestorContainer))return null;const{x:n,y:r,width:a,height:o}=t.getBoundingClientRect();let u;switch(t.getAttribute("data-main-rotation")){case"90":u=(f,p,m,y)=>({x:(p-r)/o,y:1-(f+m-n)/a,width:y/o,height:m/a});break;case"180":u=(f,p,m,y)=>({x:1-(f+m-n)/a,y:1-(p+y-r)/o,width:m/a,height:y/o});break;case"270":u=(f,p,m,y)=>({x:1-(p+y-r)/o,y:(f-n)/a,width:y/o,height:m/a});break;default:u=(f,p,m,y)=>({x:(f-n)/a,y:(p-r)/o,width:m/a,height:y/o});break}const d=[];for(let f=0,p=e.rangeCount;f<p;f++){const m=e.getRangeAt(f);if(!m.collapsed)for(const{x:y,y:v,width:_,height:w}of m.getClientRects())_===0||w===0||d.push(u(y,v,_,w))}return d.length===0?null:d}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#o||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#o?.delete(t)}renderAnnotationElement(t){const e=this.#o?.get(t.data.id);if(!e)return;const n=this.#i.getRawValue(e);n&&(this.#T===Tt.NONE&&!n.hasBeenModified||n.renderAnnotationElement(t))}setMissingCanvas(t,e,n){const r=this.#L?.get(t);r&&(r.setCanvas(e,n),this.#L.delete(t))}addMissingCanvas(t,e){(this.#L||=new Map).set(t,e)}}class en{#t=null;#e=!1;#n=null;#s=null;#a=null;#r=null;#i=!1;#o=null;#c=null;#l=null;#d=null;#h=!1;static#f=null;static _l10n=null;constructor(t){this.#c=t,this.#h=t._uiManager.useNewAltTextFlow,en.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){en._l10n??=t}async render(){const t=this.#n=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#s=document.createElement("span");t.append(e),this.#h?(t.classList.add("new"),t.setAttribute("data-l10n-id",en.#f.missing),e.setAttribute("data-l10n-id",en.#f["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=this.#c._uiManager._signal;t.addEventListener("contextmenu",Ds,{signal:n}),t.addEventListener("pointerdown",a=>a.stopPropagation(),{signal:n});const r=a=>{a.preventDefault(),this.#c._uiManager.editAltText(this.#c),this.#h&&this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#m}})};return t.addEventListener("click",r,{capture:!0,signal:n}),t.addEventListener("keydown",a=>{a.target===t&&a.key==="Enter"&&(this.#i=!0,r(a))},{signal:n}),await this.#g(),t}get#m(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#n&&(this.#n.focus({focusVisible:this.#i}),this.#i=!1)}isEmpty(){return this.#h?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#h?this.#t!==null||!!this.#l:this.isEmpty()}get guessedText(){return this.#l}async setGuessedText(t){this.#t===null&&(this.#l=t,this.#d=await en._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#g())}toggleAltTextBadge(t=!1){if(!this.#h||this.#t){this.#o?.remove(),this.#o=null;return}if(!this.#o){const e=this.#o=document.createElement("div");e.className="noAltTextBadge",this.#c.div.append(e)}this.#o.classList.toggle("hidden",!t)}serialize(t){let e=this.#t;return!t&&this.#l===e&&(e=this.#d),{altText:e,decorative:this.#e,guessedText:this.#l,textWithDisclaimer:this.#d}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:e,guessedText:n,textWithDisclaimer:r,cancel:a=!1}){n&&(this.#l=n,this.#d=r),!(this.#t===t&&this.#e===e)&&(a||(this.#t=t,this.#e=e),this.#g())}toggle(t=!1){this.#n&&(!t&&this.#r&&(clearTimeout(this.#r),this.#r=null),this.#n.disabled=!t)}shown(){this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#m}})}destroy(){this.#n?.remove(),this.#n=null,this.#s=null,this.#a=null,this.#o?.remove(),this.#o=null}async#g(){const t=this.#n;if(!t)return;if(this.#h){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",en.#f[this.#m]),this.#s?.setAttribute("data-l10n-id",en.#f[`${this.#m}-label`]),!this.#t){this.#a?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#a?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#a;if(!e){this.#a=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#c.id}`;const r=100,a=this.#c._uiManager._signal;a.addEventListener("abort",()=>{clearTimeout(this.#r),this.#r=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#r=setTimeout(()=>{this.#r=null,this.#a.classList.add("show"),this.#c._reportTelemetry({action:"alt_text_tooltip"})},r)},{signal:a}),t.addEventListener("mouseleave",()=>{this.#r&&(clearTimeout(this.#r),this.#r=null),this.#a?.classList.remove("show")},{signal:a})}this.#e?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#t),e.parentNode||t.append(e),this.#c.getElementForAltText()?.setAttribute("aria-describedby",e.id)}}class pc{#t=null;#e=null;#n=!1;#s=null;#a=null;#r=null;#i=null;#o=null;#c=!1;#l=null;constructor(t){this.#s=t}renderForToolbar(){const t=this.#e=document.createElement("button");return t.className="comment",this.#d(t,!1)}renderForStandalone(){const t=this.#t=document.createElement("button");t.className="annotationCommentButton";const e=this.#s.commentButtonPosition;if(e){const{style:n}=t;n.insetInlineEnd=`calc(${100*(this.#s._uiManager.direction==="ltr"?1-e[0]:e[0])}% - var(--comment-button-dim))`,n.top=`calc(${100*e[1]}% - var(--comment-button-dim))`;const r=this.#s.commentButtonColor;r&&(n.backgroundColor=r)}return this.#d(t,!0)}focusButton(){setTimeout(()=>{(this.#t??this.#e)?.focus()},0)}onUpdatedColor(){if(!this.#t)return;const t=this.#s.commentButtonColor;t&&(this.#t.style.backgroundColor=t),this.#s._uiManager.updatePopupColor(this.#s)}get commentButtonWidth(){return(this.#t?.getBoundingClientRect().width??0)/this.#s.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#l)return this.#l;if(!this.#t)return null;const{x:t,y:e,height:n}=this.#t.getBoundingClientRect(),{x:r,y:a,width:o,height:u}=this.#s.parent.boundingClientRect;return[(t-r)/o,(e+n-a)/u]}set commentPopupPositionInLayer(t){this.#l=t}hasDefaultPopupPosition(){return this.#l===null}removeStandaloneCommentButton(){this.#t?.remove(),this.#t=null}removeToolbarCommentButton(){this.#e?.remove(),this.#e=null}setCommentButtonStates({selected:t,hasPopup:e}){this.#t&&(this.#t.classList.toggle("selected",t),this.#t.ariaExpanded=e)}#d(t,e){if(!this.#s._uiManager.hasCommentManager())return null;t.tabIndex="0",t.ariaHasPopup="dialog",e?(t.ariaControls="commentPopup",t.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(t.ariaControlsElements=[this.#s._uiManager.getCommentDialogElement()],t.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const n=this.#s._uiManager._signal;if(!(n instanceof AbortSignal)||n.aborted)return t;t.addEventListener("contextmenu",Ds,{signal:n}),e&&(t.addEventListener("focusin",a=>{this.#s._focusEventsAllowed=!1,ue(a)},{capture:!0,signal:n}),t.addEventListener("focusout",a=>{this.#s._focusEventsAllowed=!0,ue(a)},{capture:!0,signal:n})),t.addEventListener("pointerdown",a=>a.stopPropagation(),{signal:n});const r=a=>{a.preventDefault(),t===this.#e?this.edit():this.#s.toggleComment(!0)};return t.addEventListener("click",r,{capture:!0,signal:n}),t.addEventListener("keydown",a=>{a.target===t&&a.key==="Enter"&&(this.#n=!0,r(a))},{signal:n}),t.addEventListener("pointerenter",()=>{this.#s.toggleComment(!1,!0)},{signal:n}),t.addEventListener("pointerleave",()=>{this.#s.toggleComment(!1,!1)},{signal:n}),t}edit(t){const e=this.commentPopupPositionInLayer;let n,r;if(e)[n,r]=e;else{[n,r]=this.#s.commentButtonPosition;const{width:p,height:m,x:y,y:v}=this.#s;n=y+n*p,r=v+r*m}const a=this.#s.parent.boundingClientRect,{x:o,y:u,width:d,height:f}=a;this.#s._uiManager.editComment(this.#s,o+n*d,u+r*f,{...t,parentDimensions:a})}finish(){this.#e&&(this.#e.focus({focusVisible:this.#n}),this.#n=!1)}isDeleted(){return this.#c||this.#i===""}isEmpty(){return this.#i===null}hasBeenEdited(){return this.isDeleted()||this.#i!==this.#a}serialize(){return this.data}get data(){return{text:this.#i,richText:this.#r,date:this.#o,deleted:this.isDeleted()}}set data(t){if(t!==this.#i&&(this.#r=null),t===null){this.#i="",this.#c=!0;return}this.#i=t,this.#o=new Date,this.#c=!1}setInitialText(t,e=null){this.#a=t,this.data=t,this.#o=null,this.#r=e}shown(){}destroy(){this.#e?.remove(),this.#e=null,this.#t?.remove(),this.#t=null,this.#i="",this.#r=null,this.#o=null,this.#s=null,this.#n=!1,this.#c=!1}}class Jc{#t;#e=!1;#n=null;#s;#a;#r;#i;#o=null;#c;#l=null;#d;#h=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:n=null,onPinchStart:r=null,onPinching:a=null,onPinchEnd:o=null,signal:u}){this.#t=t,this.#n=n,this.#s=e,this.#a=r,this.#r=a,this.#i=o,this.#d=new AbortController,this.#c=AbortSignal.any([u,this.#d.signal]),t.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#c})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/sn.pixelRatio}#f(t){if(this.#s?.())return;if(t.touches.length===1){if(this.#o)return;const r=this.#o=new AbortController,a=AbortSignal.any([this.#c,r.signal]),o=this.#t,u={capture:!0,signal:a,passive:!1},d=f=>{f.pointerType==="touch"&&(this.#o?.abort(),this.#o=null)};o.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&(ue(f),d(f))},u),o.addEventListener("pointerup",d,u),o.addEventListener("pointercancel",d,u);return}if(!this.#h){this.#h=new AbortController;const r=AbortSignal.any([this.#c,this.#h.signal]),a=this.#t,o={signal:r,capture:!1,passive:!1};a.addEventListener("touchmove",this.#m.bind(this),o);const u=this.#g.bind(this);a.addEventListener("touchend",u,o),a.addEventListener("touchcancel",u,o),o.capture=!0,a.addEventListener("pointerdown",ue,o),a.addEventListener("pointermove",ue,o),a.addEventListener("pointercancel",ue,o),a.addEventListener("pointerup",ue,o),this.#a?.()}if(ue(t),t.touches.length!==2||this.#n?.()){this.#l=null;return}let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]),this.#l={touch0X:e.screenX,touch0Y:e.screenY,touch1X:n.screenX,touch1Y:n.screenY}}#m(t){if(!this.#l||t.touches.length!==2)return;ue(t);let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]);const{screenX:r,screenY:a}=e,{screenX:o,screenY:u}=n,d=this.#l,{touch0X:f,touch0Y:p,touch1X:m,touch1Y:y}=d,v=m-f,_=y-p,w=o-r,S=u-a,E=Math.hypot(w,S)||1,R=Math.hypot(v,_)||1;if(!this.#e&&Math.abs(R-E)<=Jc.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(d.touch0X=r,d.touch0Y=a,d.touch1X=o,d.touch1Y=u,!this.#e){this.#e=!0;return}const T=[(r+o)/2,(a+u)/2];this.#r?.(T,R,E)}#g(t){t.touches.length>=2||(this.#h&&(this.#h.abort(),this.#h=null,this.#i?.()),this.#l&&(ue(t),this.#l=null,this.#e=!1))}destroy(){this.#d?.abort(),this.#d=null,this.#o?.abort(),this.#o=null}}class gt{#t=null;#e=null;#n=null;#s=null;#a=null;#r=!1;#i=null;#o="";#c=null;#l=null;#d=null;#h=null;#f=null;#m="";#g=!1;#u=null;#p=!1;#b=!1;#v=!1;#y=null;#E=0;#S=0;#_=null;#C=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#w=!1;#x=gt._zIndex++;static _borderLineWidth=-1;static _colorManager=new $f;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=gt.prototype._resizeWithKeyboard,e=ai.TRANSLATE_SMALL,n=ai.TRANSLATE_BIG;return Et(this,"_resizerKeyboardManager",new Lo([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,n]}],[["Escape","mac+Escape"],gt.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null,this.creationDate=t.creationDate||new Date,this.modificationDate=t.modificationDate||null,this.canAddComment=!0;const{rotation:e,rawDims:{pageWidth:n,pageHeight:r,pageX:a,pageY:o}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,r],this.pageTranslation=[a,o];const[u,d]=this.parentDimensions;this.x=t.x/u,this.y=t.y/d,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return Et(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new KE({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(gt._l10n??=t,gt._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),gt._borderLineWidth!==-1)return;const n=getComputedStyle(document.documentElement);gt._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){Qt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#w}set _isDraggable(t){this.#w=t,this.div?.classList.toggle("draggable",t)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#x}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):(this.#P(),this.#h?.remove(),this.#h=null),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#g?this.#g=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,n,r){const[a,o]=this.parentDimensions;[n,r]=this.screenToPageTranslation(n,r),this.x=(t+n)/a,this.y=(e+r)/o,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[n,r]=this.parentDimensions;this.setAt(t*n,e*r,this.width*n,this.height*r),this._onTranslated()}#N([t,e],n,r){[n,r]=this.screenToPageTranslation(n,r),this.x+=n/t,this.y+=r/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#N(this.parentDimensions,t,e)}translateInPage(t,e){this.#u||=[this.x,this.y,this.width,this.height],this.#N(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){this.#u||=[this.x,this.y,this.width,this.height];const{div:n,parentDimensions:[r,a]}=this;if(this.x+=t/r,this.y+=e/a,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:m,y}=this.div.getBoundingClientRect();this.parent.findNewParent(this,m,y)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:u}=this;const[d,f]=this.getBaseTranslation();o+=d,u+=f;const{style:p}=n;p.left=`${(100*o).toFixed(2)}%`,p.top=`${(100*u).toFixed(2)}%`,this._onTranslating(o,u),n.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#u&&(this.#u[0]!==this.x||this.#u[1]!==this.y)}get _hasBeenResized(){return!!this.#u&&(this.#u[2]!==this.width||this.#u[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:n}=gt,r=n/t,a=n/e;switch(this.rotation){case 90:return[-r,a];case 180:return[r,a];case 270:return[r,-a];default:return[-r,-a]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[n,r]}=this;let{x:a,y:o,width:u,height:d}=this;if(u*=n,d*=r,a*=n,o*=r,this._mustFixPosition)switch(t){case 0:a=Ye(a,0,n-u),o=Ye(o,0,r-d);break;case 90:a=Ye(a,0,n-d),o=Ye(o,u,r);break;case 180:a=Ye(a,u,n),o=Ye(o,d,r);break;case 270:a=Ye(a,d,n),o=Ye(o,0,r-u);break}this.x=a/=n,this.y=o/=r;const[f,p]=this.getBaseTranslation();a+=f,o+=p,e.left=`${(100*a).toFixed(2)}%`,e.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}static#R(t,e,n){switch(n){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return gt.#R(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return gt.#R(t,e,360-this.parentRotation)}#O(t){switch(t){case 90:{const[e,n]=this.pageDimensions;return[0,-e/n,n/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,n]=this.pageDimensions;return[0,e/n,-n/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,n]}=this;return[e*t,n*t]}setDims(){const{div:{style:t},width:e,height:n}=this;t.width=`${(100*e).toFixed(2)}%`,t.height=`${(100*n).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#B(){if(this.#c)return;this.#c=document.createElement("div"),this.#c.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const n of t){const r=document.createElement("div");this.#c.append(r),r.classList.add("resizer",n),r.setAttribute("data-resizer-name",n),r.addEventListener("pointerdown",this.#D.bind(this,n),{signal:e}),r.addEventListener("contextmenu",Ds,{signal:e}),r.tabIndex=-1}this.div.prepend(this.#c)}#D(t,e){e.preventDefault();const{isMac:n}=Ue.platform;if(e.button!==0||e.ctrlKey&&n)return;this.#n?.toggle(!1);const r=this._isDraggable;this._isDraggable=!1,this.#l=[e.screenX,e.screenY];const a=new AbortController,o=this._uiManager.combinedSignal(a);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#L.bind(this,t),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",ue,{passive:!1,signal:o}),window.addEventListener("contextmenu",Ds,{signal:o}),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const u=this.parent.div.style.cursor,d=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const f=()=>{a.abort(),this.parent.togglePointerEvents(!0),this.#n?.toggle(!0),this._isDraggable=r,this.parent.div.style.cursor=u,this.div.style.cursor=d,this.#I()};window.addEventListener("pointerup",f,{signal:o}),window.addEventListener("blur",f,{signal:o})}#j(t,e,n,r){this.width=n,this.height=r,this.x=t,this.y=e,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#I(){if(!this.#d)return;const{savedX:t,savedY:e,savedWidth:n,savedHeight:r}=this.#d;this.#d=null;const a=this.x,o=this.y,u=this.width,d=this.height;a===t&&o===e&&u===n&&d===r||this.addCommands({cmd:this.#j.bind(this,a,o,u,d),undo:this.#j.bind(this,t,e,n,r),mustExec:!0})}static _round(t){return Math.round(t*1e4)/1e4}#L(t,e){const[n,r]=this.parentDimensions,a=this.x,o=this.y,u=this.width,d=this.height,f=gt.MIN_SIZE/n,p=gt.MIN_SIZE/r,m=this.#O(this.rotation),y=(P,$)=>[m[0]*P+m[2]*$,m[1]*P+m[3]*$],v=this.#O(360-this.rotation),_=(P,$)=>[v[0]*P+v[2]*$,v[1]*P+v[3]*$];let w,S,E=!1,R=!1;switch(t){case"topLeft":E=!0,w=(P,$)=>[0,0],S=(P,$)=>[P,$];break;case"topMiddle":w=(P,$)=>[P/2,0],S=(P,$)=>[P/2,$];break;case"topRight":E=!0,w=(P,$)=>[P,0],S=(P,$)=>[0,$];break;case"middleRight":R=!0,w=(P,$)=>[P,$/2],S=(P,$)=>[0,$/2];break;case"bottomRight":E=!0,w=(P,$)=>[P,$],S=(P,$)=>[0,0];break;case"bottomMiddle":w=(P,$)=>[P/2,$],S=(P,$)=>[P/2,0];break;case"bottomLeft":E=!0,w=(P,$)=>[0,$],S=(P,$)=>[P,0];break;case"middleLeft":R=!0,w=(P,$)=>[0,$/2],S=(P,$)=>[P,$/2];break}const T=w(u,d),O=S(u,d);let N=y(...O);const k=gt._round(a+N[0]),M=gt._round(o+N[1]);let I=1,X=1,Q,Z;if(e.fromKeyboard)({deltaX:Q,deltaY:Z}=e);else{const{screenX:P,screenY:$}=e,[tt,At]=this.#l;[Q,Z]=this.screenToPageTranslation(P-tt,$-At),this.#l[0]=P,this.#l[1]=$}if([Q,Z]=_(Q/n,Z/r),E){const P=Math.hypot(u,d);I=X=Math.max(Math.min(Math.hypot(O[0]-T[0]-Q,O[1]-T[1]-Z)/P,1/u,1/d),f/u,p/d)}else R?I=Ye(Math.abs(O[0]-T[0]-Q),f,1)/u:X=Ye(Math.abs(O[1]-T[1]-Z),p,1)/d;const st=gt._round(u*I),ht=gt._round(d*X);N=y(...S(st,ht));const wt=k-N[0],_t=M-N[1];this.#u||=[this.x,this.y,this.width,this.height],this.width=st,this.height=ht,this.x=wt,this.y=_t,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#n?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#b)return this._editToolbar;this._editToolbar=new vo(this),this.div.append(this._editToolbar.render());const{toolbarButtons:t}=this;if(t)for(const[e,n]of t)await this._editToolbar.addButton(e,n);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#n?.destroy()}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#n||(en.initialize(gt._l10n),this.#n=new en(this),this.#t&&(this.#n.data=this.#t,this.#t=null)),this.#n}get altTextData(){return this.#n?.data}set altTextData(t){this.#n&&(this.#n.data=t)}get guessedAltText(){return this.#n?.guessedText}async setGuessedAltText(t){await this.#n?.setGuessedText(t)}serializeAltText(t){return this.#n?.serialize(t)}hasAltText(){return!!this.#n&&!this.#n.isEmpty()}hasAltTextData(){return this.#n?.hasData()??!1}focusCommentButton(){this.#s?.focusButton()}addCommentButton(){return this.canAddComment?this.#s||=new pc(this):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(this.#a){this._uiManager.isEditingMode()&&this.#a.classList.remove("hidden");return}this.hasComment&&(this.#a=this.#s.renderForStandalone(),this.div.append(this.#a))}}removeStandaloneCommentButton(){this.#s.removeStandaloneCommentButton(),this.#a=null}hideStandaloneCommentButton(){this.#a?.classList.add("hidden")}get comment(){const{data:{richText:t,text:e,date:n,deleted:r}}=this.#s;return{text:e,richText:t,date:n,deleted:r,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(t){this.#s||=new pc(this),this.#s.data=t,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:t,popupRef:e,richText:n}){if(!e||(this.#s||=new pc(this),this.#s.setInitialText(t,n),!this.annotationElementId))return;const r=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);r&&this.updateFromAnnotationLayer(r)}get hasEditedComment(){return this.#s?.hasBeenEdited()}get hasDeletedComment(){return this.#s?.isDeleted()}get hasComment(){return!!this.#s&&!this.#s.isEmpty()&&!this.#s.isDeleted()}async editComment(t){this.#s||=new pc(this),this.#s.edit(t)}toggleComment(t,e=void 0){this.hasComment&&this._uiManager.toggleComment(this,t,e)}setSelectedCommentButton(t){this.#s.setSelectedButton(t)}addComment(t){if(this.hasEditedComment){const[,,,r]=t.rect,[a]=this.pageDimensions,[o]=this.pageTranslation,u=o+a+1,d=r-100,f=u+180;t.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[u,d,f,r]}}}updateFromAnnotationLayer({popup:{contents:t,deleted:e}}){this.#s.data=e?null:t}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=this.#r?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),this.#z();const[e,n]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*n/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/n).toFixed(2)}%`);const[r,a]=this.getInitialTranslation();return this.translate(r,a),qv(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#C||=new Jc({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#q.bind(this),onPinching:this.#T.bind(this),onPinchEnd:this.#A.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),t}#q(){this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#n?.toggle(!1),this.parent.togglePointerEvents(!1)}#T(t,e,n){let a=.7*(n/e)+1-.7;if(a===1)return;const o=this.#O(this.rotation),u=(k,M)=>[o[0]*k+o[2]*M,o[1]*k+o[3]*M],[d,f]=this.parentDimensions,p=this.x,m=this.y,y=this.width,v=this.height,_=gt.MIN_SIZE/d,w=gt.MIN_SIZE/f;a=Math.max(Math.min(a,1/y,1/v),_/y,w/v);const S=gt._round(y*a),E=gt._round(v*a);if(S===y&&E===v)return;this.#u||=[p,m,y,v];const R=u(y/2,v/2),T=gt._round(p+R[0]),O=gt._round(m+R[1]),N=u(S/2,E/2);this.x=T-N[0],this.y=O-N[1],this.width=S,this.height=E,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#A(){this.#n?.toggle(!0),this.parent.togglePointerEvents(!0),this.#I()}pointerdown(t){const{isMac:e}=Ue.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#g=!0,this._isDraggable){this.#U(t);return}this.#M(t)}#M(t){const{isMac:e}=Ue.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#U(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let n=!1;const r=new AbortController,a=this._uiManager.combinedSignal(r),o={capture:!0,passive:!1,signal:a},u=f=>{r.abort(),this.#i=null,this.#g=!1,this._uiManager.endDragSession()||this.#M(f),n&&this._onStopDragging()};e&&(this.#E=t.clientX,this.#S=t.clientY,this.#i=t.pointerId,this.#o=t.pointerType,window.addEventListener("pointermove",f=>{n||(n=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:p,clientY:m,pointerId:y}=f;if(y!==this.#i){ue(f);return}const[v,_]=this.screenToPageTranslation(p-this.#E,m-this.#S);this.#E=p,this.#S=m,this._uiManager.dragSelectedEditors(v,_)},o),window.addEventListener("touchmove",ue,o),window.addEventListener("pointerdown",f=>{f.pointerType===this.#o&&(this.#C||f.isPrimary)&&u(f),ue(f)},o));const d=f=>{if(!this.#i||this.#i===f.pointerId){u(f);return}ue(f)};window.addEventListener("pointerup",d,{signal:a}),window.addEventListener("blur",d,{signal:a})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.#y=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,n){t.changeParent(this),this.x=e,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,n=this.rotation){const r=this.parentScale,[a,o]=this.pageDimensions,[u,d]=this.pageTranslation,f=t/r,p=e/r,m=this.x*a,y=this.y*o,v=this.width*a,_=this.height*o;switch(n){case 0:return[m+f+u,o-y-p-_+d,m+f+v+u,o-y-p+d];case 90:return[m+p+u,o-y+f+d,m+p+_+u,o-y+f+v+d];case 180:return[m-f-v+u,o-y+p+d,m-f+u,o-y+p+_+d];case 270:return[m-p-_+u,o-y-f-v+d,m-p+u,o-y-f+d];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[n,r,a,o]=t,u=a-n,d=o-r;switch(this.rotation){case 0:return[n,e-o,u,d];case 90:return[n,e-r,d,u];case 180:return[a,e-r,u,d];case 270:return[a,e-o,d,u];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&gt._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#s?.onUpdatedColor()}getData(){const{comment:{text:t,color:e,date:n,opacity:r,deleted:a,richText:o},uid:u,pageIndex:d,creationDate:f,modificationDate:p}=this;return{id:u,pageIndex:d,rect:this.getPDFRect(),richText:o,contentsObj:{str:t},creationDate:f,modificationDate:n||p,popupRef:!a,color:e,opacity:r}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#b=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#b=!1,!0):!1}isInEditMode(){return this.#b}shouldGetKeyboardEvents(){return this.#v}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:n,right:r}=this.getClientDimensions(),{innerHeight:a,innerWidth:o}=window;return e<o&&r>0&&t<a&&n>0}#z(){if(this.#f||!this.div)return;this.#f=new AbortController;const t=this._uiManager.combinedSignal(this.#f);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#z()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(t,e,n){const r=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:n,annotationElementId:t.annotationElementId,creationDate:t.creationDate,modificationDate:t.modificationDate});r.rotation=t.rotation,r.#t=t.accessibilityData,r._isCopy=t.isCopy||!1;const[a,o]=r.pageDimensions,[u,d,f,p]=r.getRectInCurrentCoords(t.rect,o);return r.x=u/a,r.y=d/o,r.width=f/a,r.height=p/o,r}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#f?.abort(),this.#f=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),this.#y&&(clearTimeout(this.#y),this.#y=null),this.#P(),this.removeEditToolbar(),this.#_){for(const t of this.#_.values())clearTimeout(t);this.#_=null}this.parent=null,this.#C?.destroy(),this.#C=null,this.#h?.remove(),this.#h=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#B(),this.#c.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[t,e]}=this,[n,r,a,o]=this.getPDFRect();return[gt._round(n+(a-n)*t),gt._round(r+(o-r)*(1-e))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#s.commentPopupPositionInLayer}set commentPopupPosition(t){this.#s.commentPopupPositionInLayer=t}hasDefaultPopupPosition(){return this.#s.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#s.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(t){this.#s?.setCommentButtonStates(t)}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#c.children;if(!this.#e){this.#e=Array.from(e);const o=this.#X.bind(this),u=this.#V.bind(this),d=this._uiManager._signal;for(const f of this.#e){const p=f.getAttribute("data-resizer-name");f.setAttribute("role","spinbutton"),f.addEventListener("keydown",o,{signal:d}),f.addEventListener("blur",u,{signal:d}),f.addEventListener("focus",this.#Y.bind(this,p),{signal:d}),f.setAttribute("data-l10n-id",gt._l10nResizer[p])}}const n=this.#e[0];let r=0;for(const o of e){if(o===n)break;r++}const a=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(a!==r){if(a<r)for(let u=0;u<r-a;u++)this.#c.append(this.#c.firstElementChild);else if(a>r)for(let u=0;u<a-r;u++)this.#c.firstElementChild.before(this.#c.lastElementChild);let o=0;for(const u of e){const f=this.#e[o++].getAttribute("data-resizer-name");u.setAttribute("data-l10n-id",gt._l10nResizer[f])}}this.#H(0),this.#v=!0,this.#c.firstElementChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#X(t){gt._resizerKeyboardManager.exec(this,t)}#V(t){this.#v&&t.relatedTarget?.parentNode!==this.#c&&this.#P()}#Y(t){this.#m=this.#v?t:""}#H(t){if(this.#e)for(const e of this.#e)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#v&&this.#L(this.#m,{deltaX:t,deltaY:e,fromKeyboard:!0})}#P(){this.#v=!1,this.#H(-1),this.#I()}_stopResizingWithKeyboard(){this.#P(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#n?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#c?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#n?.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){t.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(t){this.#p=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#_||=new Map;const{action:n}=t;let r=this.#_.get(n);r&&clearTimeout(r),r=setTimeout(()=>{this._reportTelemetry(t),this.#_.delete(n),this.#_.size===0&&(this.#_=null)},gt._telemetryTimeout),this.#_.set(n,r);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#r=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#r=!0}updateFakeAnnotationElement(t){if(!this.#h&&!this.deleted){this.#h=t.addFakeAnnotation(this);return}if(this.deleted){this.#h.remove(),this.#h=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#h.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const n=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),n.before(e)}return e}resetAnnotationElement(t){const{firstElementChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}}class KE extends gt{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Xb=3285377520,Os=4294901760,Js=65535;class Gv{constructor(t){this.h1=t?t&4294967295:Xb,this.h2=t?t&4294967295:Xb}update(t){let e,n;if(typeof t=="string"){e=new Uint8Array(t.length*2),n=0;for(let w=0,S=t.length;w<S;w++){const E=t.charCodeAt(w);E<=255?e[n++]=E:(e[n++]=E>>>8,e[n++]=E&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),n=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const r=n>>2,a=n-r*4,o=new Uint32Array(e.buffer,0,r);let u=0,d=0,f=this.h1,p=this.h2;const m=3432918353,y=461845907,v=m&Js,_=y&Js;for(let w=0;w<r;w++)w&1?(u=o[w],u=u*m&Os|u*v&Js,u=u<<15|u>>>17,u=u*y&Os|u*_&Js,f^=u,f=f<<13|f>>>19,f=f*5+3864292196):(d=o[w],d=d*m&Os|d*v&Js,d=d<<15|d>>>17,d=d*y&Os|d*_&Js,p^=d,p=p<<13|p>>>19,p=p*5+3864292196);switch(u=0,a){case 3:u^=e[r*4+2]<<16;case 2:u^=e[r*4+1]<<8;case 1:u^=e[r*4],u=u*m&Os|u*v&Js,u=u<<15|u>>>17,u=u*y&Os|u*_&Js,r&1?f^=u:p^=u}this.h1=f,this.h2=p}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&Os|t*36045&Js,e=e*4283543511&Os|((e<<16|t>>>16)*2950163797&Os)>>>16,t^=e>>>1,t=t*444984403&Os|t*60499&Js,e=e*3301882366&Os|((e<<16|t>>>16)*3120437893&Os)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const yf=Object.freeze({map:null,hash:"",transfer:void 0});class qf{#t=!1;#e=null;#n=null;#s=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const n=this.#s.get(t);return n===void 0?e:Object.assign(e,n)}getRawValue(t){return this.#s.get(t)}remove(t){const e=this.#s.get(t);if(e!==void 0&&(e instanceof gt&&this.#n.delete(e.annotationElementId),this.#s.delete(t),this.#s.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const n of this.#s.values())if(n instanceof gt)return;this.onAnnotationEditor(null)}}setValue(t,e){const n=this.#s.get(t);let r=!1;if(n!==void 0)for(const[a,o]of Object.entries(e))n[a]!==o&&(r=!0,n[a]=o);else r=!0,this.#s.set(t,e);r&&this.#a(),e instanceof gt&&((this.#n||=new Map).set(e.annotationElementId,e),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type))}has(t){return this.#s.has(t)}get size(){return this.#s.size}#a(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Vv(this)}get serializable(){if(this.#s.size===0)return yf;const t=new Map,e=new Gv,n=[],r=Object.create(null);let a=!1;for(const[o,u]of this.#s){const d=u instanceof gt?u.serialize(!1,r):u;d&&(t.set(o,d),e.update(`${o}:${JSON.stringify(d)}`),a||=!!d.bitmap)}if(a)for(const o of t.values())o.bitmap&&n.push(o.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:n}:yf}get editorStats(){let t=null;const e=new Map;let n=0,r=0;for(const a of this.#s.values()){if(!(a instanceof gt)){a.popup&&(a.popup.deleted?r+=1:n+=1);continue}a.isCommentDeleted?r+=1:a.hasEditedComment&&(n+=1);const o=a.telemetryFinalData;if(!o)continue;const{type:u}=o;e.has(u)||e.set(u,Object.getPrototypeOf(a).constructor),t||=Object.create(null);const d=t[u]||=new Map;for(const[f,p]of Object.entries(o)){if(f==="type")continue;let m=d.get(f);m||(m=new Map,d.set(f,m));const y=m.get(p)??0;m.set(p,y+1)}}if((r>0||n>0)&&(t||=Object.create(null),t.comments={deleted:r,edited:n}),!t)return null;for(const[a,o]of e)t[a]=o.computeTelemetryFinalData(t[a]);return t}resetModifiedIds(){this.#e=null}updateEditor(t,e){const n=this.#n?.get(t);return n?(n.updateFromAnnotationLayer(e),!0):!1}getEditor(t){return this.#n?.get(t)||null}get modifiedIds(){if(this.#e)return this.#e;const t=[];if(this.#n)for(const e of this.#n.values())e.serialize()&&t.push(e.annotationElementId);return this.#e={ids:new Set(t),hash:t.join(",")}}[Symbol.iterator](){return this.#s.entries()}}class Vv extends qf{#t;constructor(t){super();const{map:e,hash:n,transfer:r}=t.serializable,a=structuredClone(e,r?{transfer:r}:null);this.#t={map:a,hash:n,transfer:r}}get print(){Qt("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return Et(this,"modifiedIds",{ids:new Set,hash:""})}}class WE{#t=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:n}){if(!(!t||this.#t.has(t.loadedName))){if(Pt(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:r,src:a,style:o}=t,u=new FontFace(r,a,o);this.addNativeFontFace(u);try{await u.load(),this.#t.add(r),n?.(t)}catch{xt(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(u)}return}Qt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const n=t.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(r){throw xt(`Failed to load font '${n.family}': '${r}'.`),t.disableFontFace=!0,r}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const r=this._queueLoadingCallback(n);this._prepareFontLoadEvent(t,r)})}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return Et(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return Et(this,"isSyncFontLoadingSupported",Xe||Ue.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(Pt(!r.done,"completeRequest() cannot be called twice."),r.done=!0;n.length>0&&n[0].done;){const a=n.shift();setTimeout(a.callback,0)}}const{loadingRequests:n}=this,r={done:!1,complete:e,callback:t};return n.push(r),r}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Et(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function n(O,N){return O.charCodeAt(N)<<24|O.charCodeAt(N+1)<<16|O.charCodeAt(N+2)<<8|O.charCodeAt(N+3)&255}function r(O,N,k,M){const I=O.substring(0,N),X=O.substring(N+k);return I+M+X}let a,o;const u=this._document.createElement("canvas");u.width=1,u.height=1;const d=u.getContext("2d");let f=0;function p(O,N){if(++f>30){xt("Load test font never loaded."),N();return}if(d.font="30px "+O,d.fillText(".",0,20),d.getImageData(0,0,1,1).data[3]>0){N();return}setTimeout(p.bind(null,O,N))}const m=`lt${Date.now()}${this.loadTestFontId++}`;let y=this._loadTestFont;y=r(y,976,m.length,m);const _=16,w=1482184792;let S=n(y,_);for(a=0,o=m.length-3;a<o;a+=4)S=S-w+n(m,a)|0;a<m.length&&(S=S-w+n(m+"XXX",a)|0),y=r(y,_,4,NE(S));const E=`url(data:font/opentype;base64,${btoa(y)});`,R=`@font-face {font-family:"${m}";src:${E}}`;this.insertRule(R);const T=this._document.createElement("div");T.style.visibility="hidden",T.style.width=T.style.height="10px",T.style.position="absolute",T.style.top=T.style.left="0px";for(const O of[t.loadedName,m]){const N=this._document.createElement("span");N.textContent="Hi",N.style.fontFamily=O,T.append(N)}this._document.body.append(T),p(m,()=>{T.remove(),e.complete()})}}class QE{#t;constructor(t,e=null,n,r){this.compiledGlyphs=Object.create(null),this.#t=t,this._inspectFont=e,n&&Object.assign(this,n),r&&(this.charProcOperatorList=r)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${Fv(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let n=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(n+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${n}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const n=this.loadedName+"_path_"+e;let r;try{r=t.get(n)}catch(o){xt(`getPathGenerator - ignoring character: "${o}".`)}const a=$v(r);return this.fontExtraProperties||t.delete(n),this.compiledGlyphs[e]=a}get black(){return this.#t.black}get bold(){return this.#t.bold}get disableFontFace(){return this.#t.disableFontFace??!1}set disableFontFace(t){Et(this,"disableFontFace",!!t)}get fontExtraProperties(){return this.#t.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#t.isInvalidPDFjsFont}get isType3Font(){return this.#t.isType3Font}get italic(){return this.#t.italic}get missingFile(){return this.#t.missingFile}get remeasure(){return this.#t.remeasure}get vertical(){return this.#t.vertical}get ascent(){return this.#t.ascent}get defaultWidth(){return this.#t.defaultWidth}get descent(){return this.#t.descent}get bbox(){return this.#t.bbox}set bbox(t){Et(this,"bbox",t)}get fontMatrix(){return this.#t.fontMatrix}get fallbackName(){return this.#t.fallbackName}get loadedName(){return this.#t.loadedName}get mimetype(){return this.#t.mimetype}get name(){return this.#t.name}get data(){return this.#t.data}clearData(){this.#t.clearData()}get cssFontInfo(){return this.#t.cssFontInfo}get systemFontInfo(){return this.#t.systemFontInfo}get defaultVMetrics(){return this.#t.defaultVMetrics}}class Qr{#t;#e;#n;static strings=["fontFamily","fontWeight","italicAngle"];static write(t){const e=new TextEncoder,n={};let r=0;for(const f of Qr.strings){const p=e.encode(t[f]);n[f]=p,r+=4+p.length}const a=new ArrayBuffer(r),o=new Uint8Array(a),u=new DataView(a);let d=0;for(const f of Qr.strings){const p=n[f],m=p.length;u.setUint32(d,m),o.set(p,d+4),d+=4+m}return Pt(d===a.byteLength,"CssFontInfo.write: Buffer overflow"),a}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#n=new TextDecoder}#s(t){Pt(t<Qr.strings.length,"Invalid string index");let e=0;for(let r=0;r<t;r++)e+=this.#e.getUint32(e)+4;const n=this.#e.getUint32(e);return this.#n.decode(new Uint8Array(this.#t,e+4,n))}get fontFamily(){return this.#s(0)}get fontWeight(){return this.#s(1)}get italicAngle(){return this.#s(2)}}class Jr{#t;#e;#n;static strings=["css","loadedName","baseFontName","src"];static write(t){const e=new TextEncoder,n={};let r=0;for(const y of Jr.strings){const v=e.encode(t[y]);n[y]=v,r+=4+v.length}r+=4;let a,o,u=1+r;t.style&&(a=e.encode(t.style.style),o=e.encode(t.style.weight),u+=4+a.length+4+o.length);const d=new ArrayBuffer(u),f=new Uint8Array(d),p=new DataView(d);let m=0;p.setUint8(m++,t.guessFallback?1:0),p.setUint32(m,0),m+=4,r=0;for(const y of Jr.strings){const v=n[y],_=v.length;r+=4+_,p.setUint32(m,_),f.set(v,m+4),m+=4+_}return p.setUint32(m-r-4,r),t.style&&(p.setUint32(m,a.length),f.set(a,m+4),m+=4+a.length,p.setUint32(m,o.length),f.set(o,m+4),m+=4+o.length),Pt(m<=d.byteLength,"SubstitionInfo.write: Buffer overflow"),d.transferToFixedLength(m)}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#n=new TextDecoder}get guessFallback(){return this.#e.getUint8(0)!==0}#s(t){Pt(t<Jr.strings.length,"Invalid string index");let e=5;for(let r=0;r<t;r++)e+=this.#e.getUint32(e)+4;const n=this.#e.getUint32(e);return this.#n.decode(new Uint8Array(this.#t,e+4,n))}get css(){return this.#s(0)}get loadedName(){return this.#s(1)}get baseFontName(){return this.#s(2)}get src(){return this.#s(3)}get style(){let t=1;t+=4+this.#e.getUint32(t);const e=this.#e.getUint32(t),n=this.#n.decode(new Uint8Array(this.#t,t+4,e));t+=4+e;const r=this.#e.getUint32(t),a=this.#n.decode(new Uint8Array(this.#t,t+4,r));return{style:n,weight:a}}}class Kt{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#t=Math.ceil(this.bools.length*2/8);static#e=this.#t+this.numbers.length*8;static#n=this.#e+1+8;static#s=this.#n+1+48;static#a=this.#s+1+6;#r;#i;#o;constructor({data:t,extra:e}){this.#r=t,this.#i=new TextDecoder,this.#o=new DataView(this.#r),e&&Object.assign(this,e)}#c(t){Pt(t<Kt.bools.length,"Invalid boolean index");const e=Math.floor(t/4),n=t*2%8,r=this.#o.getUint8(e)>>n&3;return r===0?void 0:r===2}get black(){return this.#c(0)}get bold(){return this.#c(1)}get disableFontFace(){return this.#c(2)}get fontExtraProperties(){return this.#c(3)}get isInvalidPDFjsFont(){return this.#c(4)}get isType3Font(){return this.#c(5)}get italic(){return this.#c(6)}get missingFile(){return this.#c(7)}get remeasure(){return this.#c(8)}get vertical(){return this.#c(9)}#l(t){return Pt(t<Kt.numbers.length,"Invalid number index"),this.#o.getFloat64(Kt.#t+t*8)}get ascent(){return this.#l(0)}get defaultWidth(){return this.#l(1)}get descent(){return this.#l(2)}get bbox(){let t=Kt.#e;if(this.#o.getUint8(t)===0)return;t+=1;const n=[];for(let r=0;r<4;r++)n.push(this.#o.getInt16(t,!0)),t+=2;return n}get fontMatrix(){let t=Kt.#n;if(this.#o.getUint8(t)===0)return;t+=1;const n=[];for(let r=0;r<6;r++)n.push(this.#o.getFloat64(t,!0)),t+=8;return n}get defaultVMetrics(){let t=Kt.#s;if(this.#o.getUint8(t)===0)return;t+=1;const n=[];for(let r=0;r<3;r++)n.push(this.#o.getInt16(t,!0)),t+=2;return n}#d(t){Pt(t<Kt.strings.length,"Invalid string index");let e=Kt.#a+4;for(let a=0;a<t;a++)e+=this.#o.getUint32(e)+4;const n=this.#o.getUint32(e),r=new Uint8Array(n);return r.set(new Uint8Array(this.#r,e+4,n)),this.#i.decode(r)}get fallbackName(){return this.#d(0)}get loadedName(){return this.#d(1)}get mimetype(){return this.#d(2)}get name(){return this.#d(3)}get data(){let t=Kt.#a;const e=this.#o.getUint32(t);t+=4+e;const n=this.#o.getUint32(t);t+=4+n;const r=this.#o.getUint32(t);t+=4+r;const a=this.#o.getUint32(t);if(a!==0)return new Uint8Array(this.#r,t+4,a)}clearData(){let t=Kt.#a;const e=this.#o.getUint32(t);t+=4+e;const n=this.#o.getUint32(t);t+=4+n;const r=this.#o.getUint32(t);t+=4+r;const a=this.#o.getUint32(t);new Uint8Array(this.#r,t+4,a).fill(0),this.#o.setUint32(t,0)}get cssFontInfo(){let t=Kt.#a;const e=this.#o.getUint32(t);t+=4+e;const n=this.#o.getUint32(t);t+=4+n;const r=this.#o.getUint32(t);if(r===0)return null;const a=new Uint8Array(r);return a.set(new Uint8Array(this.#r,t+4,r)),new Qr(a.buffer)}get systemFontInfo(){let t=Kt.#a;const e=this.#o.getUint32(t);t+=4+e;const n=this.#o.getUint32(t);if(n===0)return null;const r=new Uint8Array(n);return r.set(new Uint8Array(this.#r,t+4,n)),new Jr(r.buffer)}static write(t){const e=t.systemFontInfo?Jr.write(t.systemFontInfo):null,n=t.cssFontInfo?Qr.write(t.cssFontInfo):null,r=new TextEncoder,a={};let o=0;for(const w of Kt.strings)a[w]=r.encode(t[w]),o+=4+a[w].length;const u=Kt.#a+4+o+4+(e?e.byteLength:0)+4+(n?n.byteLength:0)+4+(t.data?t.data.length:0),d=new ArrayBuffer(u),f=new Uint8Array(d),p=new DataView(d);let m=0;const y=Kt.bools.length;let v=0,_=0;for(let w=0;w<y;w++){const S=t[Kt.bools[w]];v|=(S===void 0?0:S?2:1)<<_,_+=2,(_===8||w===y-1)&&(p.setUint8(m++,v),v=0,_=0)}Pt(m===Kt.#t,"FontInfo.write: Boolean properties offset mismatch");for(const w of Kt.numbers)p.setFloat64(m,t[w]),m+=8;if(Pt(m===Kt.#e,"FontInfo.write: Number properties offset mismatch"),t.bbox){p.setUint8(m++,4);for(const w of t.bbox)p.setInt16(m,w,!0),m+=2}else p.setUint8(m++,0),m+=8;if(Pt(m===Kt.#n,"FontInfo.write: BBox properties offset mismatch"),t.fontMatrix){p.setUint8(m++,6);for(const w of t.fontMatrix)p.setFloat64(m,w,!0),m+=8}else p.setUint8(m++,0),m+=48;if(Pt(m===Kt.#s,"FontInfo.write: FontMatrix properties offset mismatch"),t.defaultVMetrics){p.setUint8(m++,1);for(const w of t.defaultVMetrics)p.setInt16(m,w,!0),m+=2}else p.setUint8(m++,0),m+=6;Pt(m===Kt.#a,"FontInfo.write: DefaultVMetrics properties offset mismatch"),p.setUint32(Kt.#a,0),m+=4;for(const w of Kt.strings){const S=a[w],E=S.length;p.setUint32(m,E),f.set(S,m+4),m+=4+E}if(p.setUint32(Kt.#a,m-Kt.#a-4),!e)p.setUint32(m,0),m+=4;else{const w=e.byteLength;p.setUint32(m,w),Pt(m+4+w<=d.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),f.set(new Uint8Array(e),m+4),m+=4+w}if(!n)p.setUint32(m,0),m+=4;else{const w=n.byteLength;p.setUint32(m,w),Pt(m+4+w<=d.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),f.set(new Uint8Array(n),m+4),m+=4+w}return t.data===void 0?(p.setUint32(m,0),m+=4):(p.setUint32(m,t.data.length),f.set(t.data,m+4),m+=4+t.data.length),Pt(m<=d.byteLength,"FontInfo.write: Buffer overflow"),d.transferToFixedLength(m)}}class Ee{static#t=0;static#e=1;static#n=2;static#s=3;static#a=4;static#r=8;static#i=12;static#o=16;constructor(t){this.buffer=t,this.view=new DataView(t),this.data=new Uint8Array(t)}static write(t){let e,n=null,r=[],a=[],o=[],u=[],d=null,f=null;switch(t[0]){case"RadialAxial":e=t[1]==="axial"?1:2,n=t[2],o=t[3],e===1?r.push(...t[4],...t[5]):r.push(t[4][0],t[4][1],t[6],t[5][0],t[5][1],t[7]);break;case"Mesh":e=3,d=t[1],r=t[2],a=t[3],u=t[4]||[],n=t[6],f=t[7];break;default:throw new Error(`Unsupported pattern type: ${t[0]}`)}const p=Math.floor(r.length/2),m=Math.floor(a.length/3),y=o.length,v=u.length;let _=0;for(const N of u)_+=1,_=Math.ceil(_/4)*4,_+=4+N.coords.length*4,_+=4+N.colors.length*4,N.verticesPerRow!==void 0&&(_+=4);const w=20+p*8+m*3+y*8+(n?16:0)+(f?3:0)+_,S=new ArrayBuffer(w),E=new DataView(S),R=new Uint8Array(S);E.setUint8(Ee.#t,e),E.setUint8(Ee.#e,n?1:0),E.setUint8(Ee.#n,f?1:0),E.setUint8(Ee.#s,d),E.setUint32(Ee.#a,p,!0),E.setUint32(Ee.#r,m,!0),E.setUint32(Ee.#i,y,!0),E.setUint32(Ee.#o,v,!0);let T=20;new Float32Array(S,T,p*2).set(r),T+=p*8,R.set(a,T),T+=m*3;for(const[N,k]of o)E.setFloat32(T,N,!0),T+=4,E.setUint32(T,parseInt(k.slice(1),16),!0),T+=4;if(n)for(const N of n)E.setFloat32(T,N,!0),T+=4;f&&(R.set(f,T),T+=3);for(let N=0;N<u.length;N++){const k=u[N];E.setUint8(T,k.type),T+=1,T=Math.ceil(T/4)*4,E.setUint32(T,k.coords.length,!0),T+=4,new Int32Array(S,T,k.coords.length).set(k.coords),T+=k.coords.length*4,E.setUint32(T,k.colors.length,!0),T+=4,new Int32Array(S,T,k.colors.length).set(k.colors),T+=k.colors.length*4,k.verticesPerRow!==void 0&&(E.setUint32(T,k.verticesPerRow,!0),T+=4)}return S}getIR(){const t=this.view,e=this.data[Ee.#t],n=!!this.data[Ee.#e],r=!!this.data[Ee.#n],a=t.getUint32(Ee.#a,!0),o=t.getUint32(Ee.#r,!0),u=t.getUint32(Ee.#i,!0),d=t.getUint32(Ee.#o,!0);let f=20;const p=new Float32Array(this.buffer,f,a*2);f+=a*8;const m=new Uint8Array(this.buffer,f,o*3);f+=o*3;const y=[];for(let S=0;S<u;++S){const E=t.getFloat32(f,!0);f+=4;const R=t.getUint32(f,!0);f+=4,y.push([E,`#${R.toString(16).padStart(6,"0")}`])}let v=null;if(n){v=[];for(let S=0;S<4;++S)v.push(t.getFloat32(f,!0)),f+=4}let _=null;r&&(_=new Uint8Array(this.buffer,f,3),f+=3);const w=[];for(let S=0;S<d;++S){const E=t.getUint8(f);f+=1,f=Math.ceil(f/4)*4;const R=t.getUint32(f,!0);f+=4;const T=new Int32Array(this.buffer,f,R);f+=R*4;const O=t.getUint32(f,!0);f+=4;const N=new Int32Array(this.buffer,f,O);f+=O*4;const k={type:E,coords:T,colors:N};E===ff.LATTICE&&(k.verticesPerRow=t.getUint32(f,!0),f+=4),w.push(k)}if(e===1)return["RadialAxial","axial",v,y,Array.from(p.slice(0,2)),Array.from(p.slice(2,4)),null,null];if(e===2)return["RadialAxial","radial",v,y,[p[0],p[1]],[p[3],p[4]],p[2],p[5]];if(e===3){const S=this.data[Ee.#s];let E=null;if(p.length>0){let R=p[0],T=p[0],O=p[1],N=p[1];for(let k=0;k<p.length;k+=2){const M=p[k],I=p[k+1];R=R>M?M:R,O=O>I?I:O,T=T<M?M:T,N=N<I?I:N}E=[R,O,T,N]}return["Mesh",S,p,m,w,E,v,_]}throw new Error(`Unsupported pattern kind: ${e}`)}}function JE(c){if(c instanceof URL)return c.href;if(typeof c=="string"){if(Xe)return c;const t=URL.parse(c,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function ZE(c){if(Xe&&typeof Buffer<"u"&&c instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(c instanceof Uint8Array&&c.byteLength===c.buffer.byteLength)return c;if(typeof c=="string")return ko(c);if(c instanceof ArrayBuffer||ArrayBuffer.isView(c)||typeof c=="object"&&!isNaN(c?.length))return new Uint8Array(c);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function gc(c){if(typeof c!="string")return null;if(c.endsWith("/"))return c;throw new Error(`Invalid factory url: "${c}" must include trailing slash.`)}const vf=c=>typeof c=="object"&&Number.isInteger(c?.num)&&c.num>=0&&Number.isInteger(c?.gen)&&c.gen>=0,t1=c=>typeof c=="object"&&typeof c?.name=="string",e1=LE.bind(null,vf,t1);class s1{#t=new Map;#e=Promise.resolve();postMessage(t,e){const n={data:structuredClone(t,e?{transfer:e}:null)};this.#e.then(()=>{for(const[r]of this.#t)r.call(this,n)})}addEventListener(t,e,n=null){let r=null;if(n?.signal instanceof AbortSignal){const{signal:a}=n;if(a.aborted){xt("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(t,e);r=()=>a.removeEventListener("abort",o),a.addEventListener("abort",o)}this.#t.set(e,r)}removeEventListener(t,e){this.#t.get(e)?.(),this.#t.delete(e)}terminate(){for(const[,t]of this.#t)t?.();this.#t.clear()}}const mc={DATA:1,ERROR:2},ye={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Yb(){}function rs(c){if(c instanceof ri||c instanceof pf||c instanceof Fb||c instanceof Fc||c instanceof Md)return c;switch(c instanceof Error||typeof c=="object"&&c!==null||Qt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),c.name){case"AbortException":return new ri(c.message);case"InvalidPDFException":return new pf(c.message);case"PasswordException":return new Fb(c.message,c.code);case"ResponseException":return new Fc(c.message,c.status,c.missing);case"UnknownErrorException":return new Md(c.message,c.details)}return new Md(c.message,c.toString())}class po{#t=new AbortController;constructor(t,e,n){this.sourceName=t,this.targetName=e,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#s(t);return}if(t.callback){const n=t.callbackId,r=this.callbackCapabilities[n];if(!r)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],t.callback===mc.DATA)r.resolve(t.data);else if(t.callback===mc.ERROR)r.reject(rs(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const n=this.sourceName,r=t.sourceName,a=this.comObj;Promise.try(e,t.data).then(function(o){a.postMessage({sourceName:n,targetName:r,callback:mc.DATA,callbackId:t.callbackId,data:o})},function(o){a.postMessage({sourceName:n,targetName:r,callback:mc.ERROR,callbackId:t.callbackId,reason:rs(o)})});return}if(t.streamId){this.#n(t);return}e(t.data)}on(t,e){const n=this.actionHandler;if(n[t])throw new Error(`There is already an actionName called "${t}"`);n[t]=e}send(t,e,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},n)}sendWithPromise(t,e,n){const r=this.callbackId++,a=Promise.withResolvers();this.callbackCapabilities[r]=a;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:r,data:e},n)}catch(o){a.reject(o)}return a.promise}sendWithStream(t,e,n,r){const a=this.streamId++,o=this.sourceName,u=this.targetName,d=this.comObj;return new ReadableStream({start:f=>{const p=Promise.withResolvers();return this.streamControllers[a]={controller:f,startCall:p,pullCall:null,cancelCall:null,isClosed:!1},d.postMessage({sourceName:o,targetName:u,action:t,streamId:a,data:e,desiredSize:f.desiredSize},r),p.promise},pull:f=>{const p=Promise.withResolvers();return this.streamControllers[a].pullCall=p,d.postMessage({sourceName:o,targetName:u,stream:ye.PULL,streamId:a,desiredSize:f.desiredSize}),p.promise},cancel:f=>{Pt(f instanceof Error,"cancel must have a valid reason");const p=Promise.withResolvers();return this.streamControllers[a].cancelCall=p,this.streamControllers[a].isClosed=!0,d.postMessage({sourceName:o,targetName:u,stream:ye.CANCEL,streamId:a,reason:rs(f)}),p.promise}},n)}#n(t){const e=t.streamId,n=this.sourceName,r=t.sourceName,a=this.comObj,o=this,u=this.actionHandler[t.action],d={enqueue(f,p=1,m){if(this.isCancelled)return;const y=this.desiredSize;this.desiredSize-=p,y>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),a.postMessage({sourceName:n,targetName:r,stream:ye.ENQUEUE,streamId:e,chunk:f},m)},close(){this.isCancelled||(this.isCancelled=!0,a.postMessage({sourceName:n,targetName:r,stream:ye.CLOSE,streamId:e}),delete o.streamSinks[e])},error(f){Pt(f instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,a.postMessage({sourceName:n,targetName:r,stream:ye.ERROR,streamId:e,reason:rs(f)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[e]=d,Promise.try(u,t.data,d).then(function(){a.postMessage({sourceName:n,targetName:r,stream:ye.START_COMPLETE,streamId:e,success:!0})},function(f){a.postMessage({sourceName:n,targetName:r,stream:ye.START_COMPLETE,streamId:e,reason:rs(f)})})}#s(t){const e=t.streamId,n=this.sourceName,r=t.sourceName,a=this.comObj,o=this.streamControllers[e],u=this.streamSinks[e];switch(t.stream){case ye.START_COMPLETE:t.success?o.startCall.resolve():o.startCall.reject(rs(t.reason));break;case ye.PULL_COMPLETE:t.success?o.pullCall.resolve():o.pullCall.reject(rs(t.reason));break;case ye.PULL:if(!u){a.postMessage({sourceName:n,targetName:r,stream:ye.PULL_COMPLETE,streamId:e,success:!0});break}u.desiredSize<=0&&t.desiredSize>0&&u.sinkCapability.resolve(),u.desiredSize=t.desiredSize,Promise.try(u.onPull||Yb).then(function(){a.postMessage({sourceName:n,targetName:r,stream:ye.PULL_COMPLETE,streamId:e,success:!0})},function(f){a.postMessage({sourceName:n,targetName:r,stream:ye.PULL_COMPLETE,streamId:e,reason:rs(f)})});break;case ye.ENQUEUE:if(Pt(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(t.chunk);break;case ye.CLOSE:if(Pt(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),this.#a(o,e);break;case ye.ERROR:Pt(o,"error should have stream controller"),o.controller.error(rs(t.reason)),this.#a(o,e);break;case ye.CANCEL_COMPLETE:t.success?o.cancelCall.resolve():o.cancelCall.reject(rs(t.reason)),this.#a(o,e);break;case ye.CANCEL:if(!u)break;const d=rs(t.reason);Promise.try(u.onCancel||Yb,d).then(function(){a.postMessage({sourceName:n,targetName:r,stream:ye.CANCEL_COMPLETE,streamId:e,success:!0})},function(f){a.postMessage({sourceName:n,targetName:r,stream:ye.CANCEL_COMPLETE,streamId:e,reason:rs(f)})}),u.sinkCapability.reject(d),u.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#a(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#t?.abort(),this.#t=null}}class Xv{#t=!1;constructor({enableHWA:t=!1}){this.#t=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(t,e);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!this.#t})}}reset(t,e,n){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||n<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=n}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){Qt("Abstract method `_createCanvas` called.")}}class n1 extends Xv{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const n=this._document.createElement("canvas");return n.width=t,n.height=e,n}}class Yv{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){Qt("Abstract method `_fetch` called.")}}class Kb extends Yv{async _fetch(t){const e=await Do(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):ko(e)}}class Kv{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,n,r,a){return"none"}destroy(t=!1){}}class i1 extends Kv{#t;#e;#n;#s;#a;#r;#i=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#s=t,this.#a=e}get#o(){return this.#e||=new Map}get#c(){return this.#r||=new Map}get#l(){if(!this.#n){const t=this.#a.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const n=this.#a.createElementNS(Cn,"svg");n.setAttribute("width",0),n.setAttribute("height",0),this.#n=this.#a.createElementNS(Cn,"defs"),t.append(n),n.append(this.#n),this.#a.body.append(t)}return this.#n}#d(t){if(t.length===1){const d=t[0],f=new Array(256);for(let m=0;m<256;m++)f[m]=d[m]/255;const p=f.join(",");return[p,p,p]}const[e,n,r]=t,a=new Array(256),o=new Array(256),u=new Array(256);for(let d=0;d<256;d++)a[d]=e[d]/255,o[d]=n[d]/255,u[d]=r[d]/255;return[a.join(","),o.join(","),u.join(",")]}#h(t){if(this.#t===void 0){this.#t="";const e=this.#a.URL;e!==this.#a.baseURI&&(Qc(e)?xt('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=Bv(e,""))}return`url(${this.#t}#${t})`}addFilter(t){if(!t)return"none";let e=this.#o.get(t);if(e)return e;const[n,r,a]=this.#d(t),o=t.length===1?n:`${n}${r}${a}`;if(e=this.#o.get(o),e)return this.#o.set(t,e),e;const u=`g_${this.#s}_transfer_map_${this.#i++}`,d=this.#h(u);this.#o.set(t,d),this.#o.set(o,d);const f=this.#g(u);return this.#p(n,r,a,f),d}addHCMFilter(t,e){const n=`${t}-${e}`,r="base";let a=this.#c.get(r);if(a?.key===n||(a?(a.filter?.remove(),a.key=n,a.url="none",a.filter=null):(a={key:n,url:"none",filter:null},this.#c.set(r,a)),!t||!e))return a.url;const o=this.#v(t);t=at.makeHexColor(...o);const u=this.#v(e);if(e=at.makeHexColor(...u),this.#l.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return a.url;const d=new Array(256);for(let v=0;v<=255;v++){const _=v/255;d[v]=_<=.03928?_/12.92:((_+.055)/1.055)**2.4}const f=d.join(","),p=`g_${this.#s}_hcm_filter`,m=a.filter=this.#g(p);this.#p(f,f,f,m),this.#m(m);const y=(v,_)=>{const w=o[v]/255,S=u[v]/255,E=new Array(_+1);for(let R=0;R<=_;R++)E[R]=w+R/_*(S-w);return E.join(",")};return this.#p(y(0,5),y(1,5),y(2,5),m),a.url=this.#h(p),a.url}addAlphaFilter(t){let e=this.#o.get(t);if(e)return e;const[n]=this.#d([t]),r=`alpha_${n}`;if(e=this.#o.get(r),e)return this.#o.set(t,e),e;const a=`g_${this.#s}_alpha_map_${this.#i++}`,o=this.#h(a);this.#o.set(t,o),this.#o.set(r,o);const u=this.#g(a);return this.#b(n,u),o}addLuminosityFilter(t){let e=this.#o.get(t||"luminosity");if(e)return e;let n,r;if(t?([n]=this.#d([t]),r=`luminosity_${n}`):r="luminosity",e=this.#o.get(r),e)return this.#o.set(t,e),e;const a=`g_${this.#s}_luminosity_map_${this.#i++}`,o=this.#h(a);this.#o.set(t,o),this.#o.set(r,o);const u=this.#g(a);return this.#f(u),t&&this.#b(n,u),o}addHighlightHCMFilter(t,e,n,r,a){const o=`${e}-${n}-${r}-${a}`;let u=this.#c.get(t);if(u?.key===o||(u?(u.filter?.remove(),u.key=o,u.url="none",u.filter=null):(u={key:o,url:"none",filter:null},this.#c.set(t,u)),!e||!n))return u.url;const[d,f]=[e,n].map(this.#v.bind(this));let p=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),m=Math.round(.2126*f[0]+.7152*f[1]+.0722*f[2]),[y,v]=[r,a].map(this.#v.bind(this));m<p&&([p,m,y,v]=[m,p,v,y]),this.#l.style.color="";const _=(E,R,T)=>{const O=new Array(256),N=(m-p)/T,k=E/255,M=(R-E)/(255*T);let I=0;for(let X=0;X<=T;X++){const Q=Math.round(p+X*N),Z=k+X*M;for(let st=I;st<=Q;st++)O[st]=Z;I=Q+1}for(let X=I;X<256;X++)O[X]=O[I-1];return O.join(",")},w=`g_${this.#s}_hcm_${t}_filter`,S=u.filter=this.#g(w);return this.#m(S),this.#p(_(y[0],v[0],5),_(y[1],v[1],5),_(y[2],v[2],5),S),u.url=this.#h(w),u.url}destroy(t=!1){t&&this.#r?.size||(this.#n?.parentNode.parentNode.remove(),this.#n=null,this.#e?.clear(),this.#e=null,this.#r?.clear(),this.#r=null,this.#i=0)}#f(t){const e=this.#a.createElementNS(Cn,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#m(t){const e=this.#a.createElementNS(Cn,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#g(t){const e=this.#a.createElementNS(Cn,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#l.append(e),e}#u(t,e,n){const r=this.#a.createElementNS(Cn,e);r.setAttribute("type","discrete"),r.setAttribute("tableValues",n),t.append(r)}#p(t,e,n,r){const a=this.#a.createElementNS(Cn,"feComponentTransfer");r.append(a),this.#u(a,"feFuncR",t),this.#u(a,"feFuncG",e),this.#u(a,"feFuncB",n)}#b(t,e){const n=this.#a.createElementNS(Cn,"feComponentTransfer");e.append(n),this.#u(n,"feFuncA",t)}#v(t){return this.#l.style.color=t,jo(getComputedStyle(this.#l).getPropertyValue("color"))}}class Wv{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(n=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){Qt("Abstract method `_fetch` called.")}}class Wb extends Wv{async _fetch(t){const e=await Do(t,"arraybuffer");return new Uint8Array(e)}}class Qv{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(n=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){Qt("Abstract method `_fetch` called.")}}class Qb extends Qv{async _fetch(t){const e=await Do(t,"arraybuffer");return new Uint8Array(e)}}Xe&&xt("Please use the `legacy` build in Node.js environments.");async function Gf(c){const e=await process.getBuiltinModule("fs").promises.readFile(c);return new Uint8Array(e)}class r1 extends Kv{}class a1 extends Xv{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class o1 extends Yv{async _fetch(t){return Gf(t)}}class l1 extends Wv{async _fetch(t){return Gf(t)}}class c1 extends Qv{async _fetch(t){return Gf(t)}}const Fr="__forcedDependency",{floor:Jb,ceil:Zb}=Math;function bc(c,t,e,n,r,a){c[t*4+0]=Math.min(c[t*4+0],e),c[t*4+1]=Math.min(c[t*4+1],n),c[t*4+2]=Math.max(c[t*4+2],r),c[t*4+3]=Math.max(c[t*4+3],a)}const wf=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class u1{#t;#e;constructor(t,e){this.#t=t,this.#e=e}get length(){return this.#t.length}isEmpty(t){return this.#t[t]===wf}minX(t){return this.#e[t*4+0]/256}minY(t){return this.#e[t*4+1]/256}maxX(t){return(this.#e[t*4+2]+1)/256}maxY(t){return(this.#e[t*4+3]+1)/256}}const yc=(c,t)=>{if(!c)return;let e=c.get(t);return e||(e={dependencies:new Set,isRenderingOperation:!1},c.set(t,e)),e};class h1{#t={__proto__:null};#e={__proto__:null,transform:[],moveText:[],sameLineText:[],[Fr]:[]};#n=new Map;#s=[];#a=[];#r=[[1,0,0,1,0,0]];#i=[-1/0,-1/0,1/0,1/0];#o=new Float64Array([1/0,1/0,-1/0,-1/0]);#c=-1;#l=new Set;#d=new Map;#h=new Map;#f;#m;#g;#u;#p;constructor(t,e,n=!1){this.#f=t.width,this.#m=t.height,this.#b(e),n&&(this.#p=new Map)}growOperationsCount(t){t>=this.#u.length&&this.#b(t,this.#u)}#b(t,e){const n=new ArrayBuffer(t*4);this.#g=new Uint8ClampedArray(n),this.#u=new Uint32Array(n),e&&e.length>0?(this.#u.set(e),this.#u.fill(wf,e.length)):this.#u.fill(wf)}save(t){return this.#t={__proto__:this.#t},this.#e={__proto__:this.#e,transform:{__proto__:this.#e.transform},moveText:{__proto__:this.#e.moveText},sameLineText:{__proto__:this.#e.sameLineText},[Fr]:{__proto__:this.#e[Fr]}},this.#i={__proto__:this.#i},this.#s.push(t),this}restore(t){const e=Object.getPrototypeOf(this.#t);if(e===null)return this;this.#t=e,this.#e=Object.getPrototypeOf(this.#e),this.#i=Object.getPrototypeOf(this.#i);const n=this.#s.pop();return n!==void 0&&(yc(this.#p,t)?.dependencies.add(n),this.#u[t]=this.#u[n]),this}recordOpenMarker(t){return this.#s.push(t),this}getOpenMarker(){return this.#s.length===0?null:this.#s.at(-1)}recordCloseMarker(t){const e=this.#s.pop();return e!==void 0&&(yc(this.#p,t)?.dependencies.add(e),this.#u[t]=this.#u[e]),this}beginMarkedContent(t){return this.#a.push(t),this}endMarkedContent(t){const e=this.#a.pop();return e!==void 0&&(yc(this.#p,t)?.dependencies.add(e),this.#u[t]=this.#u[e]),this}pushBaseTransform(t){return this.#r.push(at.multiplyByDOMMatrix(this.#r.at(-1),t.getTransform())),this}popBaseTransform(){return this.#r.length>1&&this.#r.pop(),this}recordSimpleData(t,e){return this.#t[t]=e,this}recordIncrementalData(t,e){return this.#e[t].push(e),this}resetIncrementalData(t,e){return this.#e[t].length=0,this}recordNamedData(t,e){return this.#n.set(t,e),this}recordSimpleDataFromNamed(t,e,n){this.#t[t]=this.#n.get(e)??n}recordFutureForcedDependency(t,e){return this.recordIncrementalData(Fr,e),this}inheritSimpleDataAsFutureForcedDependencies(t){for(const e of t)e in this.#t&&this.recordFutureForcedDependency(e,this.#t[e]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const t of this.#l)this.recordFutureForcedDependency(Fr,t);return this}resetBBox(t){return this.#c!==t&&(this.#c=t,this.#o[0]=1/0,this.#o[1]=1/0,this.#o[2]=-1/0,this.#o[3]=-1/0),this}recordClipBox(t,e,n,r,a,o){const u=at.multiplyByDOMMatrix(this.#r.at(-1),e.getTransform()),d=[1/0,1/0,-1/0,-1/0];at.axialAlignedBoundingBox([n,a,r,o],u,d);const f=at.intersect(this.#i,d);return f?(this.#i[0]=f[0],this.#i[1]=f[1],this.#i[2]=f[2],this.#i[3]=f[3]):(this.#i[0]=this.#i[1]=1/0,this.#i[2]=this.#i[3]=-1/0),this}recordBBox(t,e,n,r,a,o){const u=this.#i;if(u[0]===1/0)return this;const d=at.multiplyByDOMMatrix(this.#r.at(-1),e.getTransform());if(u[0]===-1/0)return at.axialAlignedBoundingBox([n,a,r,o],d,this.#o),this;const f=[1/0,1/0,-1/0,-1/0];return at.axialAlignedBoundingBox([n,a,r,o],d,f),this.#o[0]=Math.min(this.#o[0],Math.max(f[0],u[0])),this.#o[1]=Math.min(this.#o[1],Math.max(f[1],u[1])),this.#o[2]=Math.max(this.#o[2],Math.min(f[2],u[2])),this.#o[3]=Math.max(this.#o[3],Math.min(f[3],u[3])),this}recordCharacterBBox(t,e,n,r=1,a=0,o=0,u){const d=n.bbox;let f,p;if(d&&(f=d[2]!==d[0]&&d[3]!==d[1]&&this.#h.get(n),f!==!1&&(p=[0,0,0,0],at.axialAlignedBoundingBox(d,n.fontMatrix,p),(r!==1||a!==0||o!==0)&&at.scaleMinMax([r,0,0,-r,a,o],p),f)))return this.recordBBox(t,e,p[0],p[2],p[1],p[3]);if(!u)return this.recordFullPageBBox(t);const m=u();return d&&p&&f===void 0&&(f=p[0]<=a-m.actualBoundingBoxLeft&&p[2]>=a+m.actualBoundingBoxRight&&p[1]<=o-m.actualBoundingBoxAscent&&p[3]>=o+m.actualBoundingBoxDescent,this.#h.set(n,f),f)?this.recordBBox(t,e,p[0],p[2],p[1],p[3]):this.recordBBox(t,e,a-m.actualBoundingBoxLeft,a+m.actualBoundingBoxRight,o-m.actualBoundingBoxAscent,o+m.actualBoundingBoxDescent)}recordFullPageBBox(t){return this.#o[0]=Math.max(0,this.#i[0]),this.#o[1]=Math.max(0,this.#i[1]),this.#o[2]=Math.min(this.#f,this.#i[2]),this.#o[3]=Math.min(this.#m,this.#i[3]),this}getSimpleIndex(t){return this.#t[t]}recordDependencies(t,e){const n=this.#l,r=this.#t,a=this.#e;for(const o of e)o in this.#t?n.add(r[o]):o in a&&a[o].forEach(n.add,n);return this}recordNamedDependency(t,e){return this.#n.has(e)&&this.#l.add(this.#n.get(e)),this}recordOperation(t,e=!1){if(this.recordDependencies(t,[Fr]),this.#p){const n=yc(this.#p,t),{dependencies:r}=n;this.#l.forEach(r.add,r),this.#s.forEach(r.add,r),this.#a.forEach(r.add,r),r.delete(t),n.isRenderingOperation=!0}if(this.#c===t){const n=Jb(this.#o[0]*256/this.#f),r=Jb(this.#o[1]*256/this.#m),a=Zb(this.#o[2]*256/this.#f),o=Zb(this.#o[3]*256/this.#m);bc(this.#g,t,n,r,a,o);for(const u of this.#l)u!==t&&bc(this.#g,u,n,r,a,o);for(const u of this.#s)u!==t&&bc(this.#g,u,n,r,a,o);for(const u of this.#a)u!==t&&bc(this.#g,u,n,r,a,o);e||(this.#l.clear(),this.#c=-1)}return this}recordShowTextOperation(t,e=!1){const n=Array.from(this.#l);this.recordOperation(t,e),this.recordIncrementalData("sameLineText",t);for(const r of n)this.recordIncrementalData("sameLineText",r);return this}bboxToClipBoxDropOperation(t,e=!1){return this.#c===t&&(this.#c=-1,this.#i[0]=Math.max(this.#i[0],this.#o[0]),this.#i[1]=Math.max(this.#i[1],this.#o[1]),this.#i[2]=Math.min(this.#i[2],this.#o[2]),this.#i[3]=Math.min(this.#i[3],this.#o[3]),e||this.#l.clear()),this}_takePendingDependencies(){const t=this.#l;return this.#l=new Set,t}_extractOperation(t){const e=this.#d.get(t);return this.#d.delete(t),e}_pushPendingDependencies(t){for(const e of t)this.#l.add(e)}take(){return this.#h.clear(),new u1(this.#u,this.#g)}takeDebugMetadata(){return this.#p}}class zc{#t;#e;#n;#s=0;#a=0;constructor(t,e,n){if(t instanceof zc&&t.#n===!!n)return t;this.#t=t,this.#e=e,this.#n=!!n}growOperationsCount(){throw new Error("Unreachable")}save(t){return this.#a++,this.#t.save(this.#e),this}restore(t){return this.#a>0&&(this.#t.restore(this.#e),this.#a--),this}recordOpenMarker(t){return this.#s++,this}getOpenMarker(){return this.#s>0?this.#e:this.#t.getOpenMarker()}recordCloseMarker(t){return this.#s--,this}beginMarkedContent(t){return this}endMarkedContent(t){return this}pushBaseTransform(t){return this.#t.pushBaseTransform(t),this}popBaseTransform(){return this.#t.popBaseTransform(),this}recordSimpleData(t,e){return this.#t.recordSimpleData(t,this.#e),this}recordIncrementalData(t,e){return this.#t.recordIncrementalData(t,this.#e),this}resetIncrementalData(t,e){return this.#t.resetIncrementalData(t,this.#e),this}recordNamedData(t,e){return this}recordSimpleDataFromNamed(t,e,n){return this.#t.recordSimpleDataFromNamed(t,e,this.#e),this}recordFutureForcedDependency(t,e){return this.#t.recordFutureForcedDependency(t,this.#e),this}inheritSimpleDataAsFutureForcedDependencies(t){return this.#t.inheritSimpleDataAsFutureForcedDependencies(t),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#t.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(t){return this.#n||this.#t.resetBBox(this.#e),this}recordClipBox(t,e,n,r,a,o){return this.#n||this.#t.recordClipBox(this.#e,e,n,r,a,o),this}recordBBox(t,e,n,r,a,o){return this.#n||this.#t.recordBBox(this.#e,e,n,r,a,o),this}recordCharacterBBox(t,e,n,r,a,o,u){return this.#n||this.#t.recordCharacterBBox(this.#e,e,n,r,a,o,u),this}recordFullPageBBox(t){return this.#n||this.#t.recordFullPageBBox(this.#e),this}getSimpleIndex(t){return this.#t.getSimpleIndex(t)}recordDependencies(t,e){return this.#t.recordDependencies(this.#e,e),this}recordNamedDependency(t,e){return this.#t.recordNamedDependency(this.#e,e),this}recordOperation(t){return this.#t.recordOperation(this.#e,!0),this}recordShowTextOperation(t){return this.#t.recordShowTextOperation(this.#e,!0),this}bboxToClipBoxDropOperation(t){return this.#n||this.#t.bboxToClipBoxDropOperation(this.#e,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const Ns={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},Be={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function _f(c,t){if(!t)return;const e=t[2]-t[0],n=t[3]-t[1],r=new Path2D;r.rect(t[0],t[1],e,n),c.clip(r)}class Vf{isModifyingCurrentTransform(){return!1}getPattern(){Qt("Abstract method `getPattern` called.")}}class d1 extends Vf{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)e.addColorStop(n[0],n[1]);return e}getPattern(t,e,n,r){let a;if(r===Be.STROKE||r===Be.FILL){const o=e.current.getClippedPathBoundingBox(r,ae(t))||[0,0,0,0],u=Math.ceil(o[2]-o[0])||1,d=Math.ceil(o[3]-o[1])||1,f=e.cachedCanvases.getCanvas("pattern",u,d),p=f.context;p.clearRect(0,0,p.canvas.width,p.canvas.height),p.beginPath(),p.rect(0,0,p.canvas.width,p.canvas.height),p.translate(-o[0],-o[1]),n=at.transform(n,[1,0,0,1,o[0],o[1]]),p.transform(...e.baseTransform),this.matrix&&p.transform(...this.matrix),_f(p,this._bbox),p.fillStyle=this._createGradient(p),p.fill(),a=t.createPattern(f.canvas,"no-repeat");const m=new DOMMatrix(n);a.setTransform(m)}else _f(t,this._bbox),a=this._createGradient(t);return a}}function Pd(c,t,e,n,r,a,o,u){const d=t.coords,f=t.colors,p=c.data,m=c.width*4;let y;d[e+1]>d[n+1]&&(y=e,e=n,n=y,y=a,a=o,o=y),d[n+1]>d[r+1]&&(y=n,n=r,r=y,y=o,o=u,u=y),d[e+1]>d[n+1]&&(y=e,e=n,n=y,y=a,a=o,o=y);const v=(d[e]+t.offsetX)*t.scaleX,_=(d[e+1]+t.offsetY)*t.scaleY,w=(d[n]+t.offsetX)*t.scaleX,S=(d[n+1]+t.offsetY)*t.scaleY,E=(d[r]+t.offsetX)*t.scaleX,R=(d[r+1]+t.offsetY)*t.scaleY;if(_>=R)return;const T=f[a],O=f[a+1],N=f[a+2],k=f[o],M=f[o+1],I=f[o+2],X=f[u],Q=f[u+1],Z=f[u+2],st=Math.round(_),ht=Math.round(R);let wt,_t,P,$,tt,At,Ot,j;for(let G=st;G<=ht;G++){if(G<S){const ft=G<_?0:(_-G)/(_-S);wt=v-(v-w)*ft,_t=T-(T-k)*ft,P=O-(O-M)*ft,$=N-(N-I)*ft}else{let ft;G>R?ft=1:S===R?ft=0:ft=(S-G)/(S-R),wt=w-(w-E)*ft,_t=k-(k-X)*ft,P=M-(M-Q)*ft,$=I-(I-Z)*ft}let J;G<_?J=0:G>R?J=1:J=(_-G)/(_-R),tt=v-(v-E)*J,At=T-(T-X)*J,Ot=O-(O-Q)*J,j=N-(N-Z)*J;const et=Math.round(Math.min(wt,tt)),mt=Math.round(Math.max(wt,tt));let bt=m*G+et*4;for(let ft=et;ft<=mt;ft++)J=(wt-ft)/(wt-tt),J<0?J=0:J>1&&(J=1),p[bt++]=_t-(_t-At)*J|0,p[bt++]=P-(P-Ot)*J|0,p[bt++]=$-($-j)*J|0,p[bt++]=255}}function f1(c,t,e){const n=t.coords,r=t.colors;let a,o;switch(t.type){case ff.LATTICE:const u=t.verticesPerRow,d=Math.floor(n.length/u)-1,f=u-1;for(a=0;a<d;a++){let p=a*u;for(let m=0;m<f;m++,p++)Pd(c,e,n[p],n[p+1],n[p+u],r[p],r[p+1],r[p+u]),Pd(c,e,n[p+u+1],n[p+1],n[p+u],r[p+u+1],r[p+1],r[p+u])}break;case ff.TRIANGLES:for(a=0,o=n.length;a<o;a+=3)Pd(c,e,n[a],n[a+1],n[a+2],r[a],r[a+1],r[a+2]);break;default:throw new Error("illegal figure")}}class p1 extends Vf{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,n){const u=Math.floor(this._bounds[0]),d=Math.floor(this._bounds[1]),f=Math.ceil(this._bounds[2])-u,p=Math.ceil(this._bounds[3])-d,m=Math.min(Math.ceil(Math.abs(f*t[0]*1.1)),3e3),y=Math.min(Math.ceil(Math.abs(p*t[1]*1.1)),3e3),v=f/m,_=p/y,w={coords:this._coords,colors:this._colors,offsetX:-u,offsetY:-d,scaleX:1/v,scaleY:1/_},S=m+4,E=y+4,R=n.getCanvas("mesh",S,E),T=R.context,O=T.createImageData(m,y);if(e){const k=O.data;for(let M=0,I=k.length;M<I;M+=4)k[M]=e[0],k[M+1]=e[1],k[M+2]=e[2],k[M+3]=255}for(const k of this._figures)f1(O,k,w);return T.putImageData(O,2,2),{canvas:R.canvas,offsetX:u-2*v,offsetY:d-2*_,scaleX:v,scaleY:_}}isModifyingCurrentTransform(){return!0}getPattern(t,e,n,r){_f(t,this._bbox);const a=new Float32Array(2);if(r===Be.SHADING)at.singularValueDecompose2dScale(ae(t),a);else if(this.matrix){at.singularValueDecompose2dScale(this.matrix,a);const[u,d]=a;at.singularValueDecompose2dScale(e.baseTransform,a),a[0]*=u,a[1]*=d}else at.singularValueDecompose2dScale(e.baseTransform,a);const o=this._createMeshCanvas(a,r===Be.SHADING?null:this._background,e.cachedCanvases);return r!==Be.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(o.offsetX,o.offsetY),t.scale(o.scaleX,o.scaleY),t.createPattern(o.canvas,"no-repeat")}}class g1 extends Vf{getPattern(){return"hotpink"}}function m1(c){switch(c[0]){case"RadialAxial":return new d1(c);case"Mesh":return new p1(c);case"Dummy":return new g1}throw new Error(`Unknown IR type: ${c[0]}`)}const ty={COLORED:1,UNCOLORED:2};class Xf{static MAX_PATTERN_SIZE=3e3;constructor(t,e,n,r){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=n,this.baseTransform=r}createPatternCanvas(t,e){const{bbox:n,operatorList:r,paintType:a,tilingType:o,color:u,canvasGraphicsFactory:d}=this;let{xstep:f,ystep:p}=this;f=Math.abs(f),p=Math.abs(p),Wc("TilingType: "+o);const m=n[0],y=n[1],v=n[2],_=n[3],w=v-m,S=_-y,E=new Float32Array(2);at.singularValueDecompose2dScale(this.matrix,E);const[R,T]=E;at.singularValueDecompose2dScale(this.baseTransform,E);const O=R*E[0],N=T*E[1];let k=w,M=S,I=!1,X=!1;const Q=Math.ceil(f*O),Z=Math.ceil(p*N),st=Math.ceil(w*O),ht=Math.ceil(S*N);Q>=st?k=f:I=!0,Z>=ht?M=p:X=!0;const wt=this.getSizeAndScale(k,this.ctx.canvas.width,O),_t=this.getSizeAndScale(M,this.ctx.canvas.height,N),P=t.cachedCanvases.getCanvas("pattern",wt.size,_t.size),$=P.context,tt=d.createCanvasGraphics($,e);if(tt.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(tt,a,u),$.translate(-wt.scale*m,-_t.scale*y),tt.transform(0,wt.scale,0,0,_t.scale,0,0),$.save(),tt.dependencyTracker?.save(),this.clipBbox(tt,m,y,v,_),tt.baseTransform=ae(tt.ctx),tt.executeOperatorList(r),tt.endDrawing(),tt.dependencyTracker?.restore(),$.restore(),I||X){const At=P.canvas;I&&(k=f),X&&(M=p);const Ot=this.getSizeAndScale(k,this.ctx.canvas.width,O),j=this.getSizeAndScale(M,this.ctx.canvas.height,N),G=Ot.size,J=j.size,et=t.cachedCanvases.getCanvas("pattern-workaround",G,J),mt=et.context,bt=I?Math.floor(w/f):0,ft=X?Math.floor(S/p):0;for(let Jt=0;Jt<=bt;Jt++)for(let $t=0;$t<=ft;$t++)mt.drawImage(At,G*Jt,J*$t,G,J,0,0,G,J);return{canvas:et.canvas,scaleX:Ot.scale,scaleY:j.scale,offsetX:m,offsetY:y}}return{canvas:P.canvas,scaleX:wt.scale,scaleY:_t.scale,offsetX:m,offsetY:y}}getSizeAndScale(t,e,n){const r=Math.max(Xf.MAX_PATTERN_SIZE,e);let a=Math.ceil(t*n);return a>=r?a=r:n=a/t,{scale:n,size:a}}clipBbox(t,e,n,r,a){const o=r-e,u=a-n;t.ctx.rect(e,n,o,u),at.axialAlignedBoundingBox([e,n,r,a],ae(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,n){const r=t.ctx,a=t.current;switch(e){case ty.COLORED:const{fillStyle:o,strokeStyle:u}=this.ctx;r.fillStyle=a.fillColor=o,r.strokeStyle=a.strokeColor=u;break;case ty.UNCOLORED:r.fillStyle=r.strokeStyle=n,a.fillColor=a.strokeColor=n;break;default:throw new OE(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,n,r,a){let o=n;r!==Be.SHADING&&(o=at.transform(o,e.baseTransform),this.matrix&&(o=at.transform(o,this.matrix)));const u=this.createPatternCanvas(e,a);let d=new DOMMatrix(o);d=d.translate(u.offsetX,u.offsetY),d=d.scale(1/u.scaleX,1/u.scaleY);const f=t.createPattern(u.canvas,"repeat");return f.setTransform(d),f}}function b1({src:c,srcPos:t=0,dest:e,width:n,height:r,nonBlackColor:a=4294967295,inverseDecode:o=!1}){const u=Ue.isLittleEndian?4278190080:255,[d,f]=o?[a,u]:[u,a],p=n>>3,m=n&7,y=c.length;e=new Uint32Array(e.buffer);let v=0;for(let _=0;_<r;_++){for(const S=t+p;t<S;t++){const E=t<y?c[t]:255;e[v++]=E&128?f:d,e[v++]=E&64?f:d,e[v++]=E&32?f:d,e[v++]=E&16?f:d,e[v++]=E&8?f:d,e[v++]=E&4?f:d,e[v++]=E&2?f:d,e[v++]=E&1?f:d}if(m===0)continue;const w=t<y?c[t++]:255;for(let S=0;S<m;S++)e[v++]=w&1<<7-S?f:d}return{srcPos:t,destPos:v}}const ey=16,sy=100,y1=15,ny=10,as=16,Bd=new DOMMatrix,ms=new Float32Array(2),Xr=new Float32Array([1/0,1/0,-1/0,-1/0]);function v1(c,t){if(c._removeMirroring)throw new Error("Context is already forwarding operations.");c.__originalSave=c.save,c.__originalRestore=c.restore,c.__originalRotate=c.rotate,c.__originalScale=c.scale,c.__originalTranslate=c.translate,c.__originalTransform=c.transform,c.__originalSetTransform=c.setTransform,c.__originalResetTransform=c.resetTransform,c.__originalClip=c.clip,c.__originalMoveTo=c.moveTo,c.__originalLineTo=c.lineTo,c.__originalBezierCurveTo=c.bezierCurveTo,c.__originalRect=c.rect,c.__originalClosePath=c.closePath,c.__originalBeginPath=c.beginPath,c._removeMirroring=()=>{c.save=c.__originalSave,c.restore=c.__originalRestore,c.rotate=c.__originalRotate,c.scale=c.__originalScale,c.translate=c.__originalTranslate,c.transform=c.__originalTransform,c.setTransform=c.__originalSetTransform,c.resetTransform=c.__originalResetTransform,c.clip=c.__originalClip,c.moveTo=c.__originalMoveTo,c.lineTo=c.__originalLineTo,c.bezierCurveTo=c.__originalBezierCurveTo,c.rect=c.__originalRect,c.closePath=c.__originalClosePath,c.beginPath=c.__originalBeginPath,delete c._removeMirroring},c.save=function(){t.save(),this.__originalSave()},c.restore=function(){t.restore(),this.__originalRestore()},c.translate=function(e,n){t.translate(e,n),this.__originalTranslate(e,n)},c.scale=function(e,n){t.scale(e,n),this.__originalScale(e,n)},c.transform=function(e,n,r,a,o,u){t.transform(e,n,r,a,o,u),this.__originalTransform(e,n,r,a,o,u)},c.setTransform=function(e,n,r,a,o,u){t.setTransform(e,n,r,a,o,u),this.__originalSetTransform(e,n,r,a,o,u)},c.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},c.rotate=function(e){t.rotate(e),this.__originalRotate(e)},c.clip=function(e){t.clip(e),this.__originalClip(e)},c.moveTo=function(e,n){t.moveTo(e,n),this.__originalMoveTo(e,n)},c.lineTo=function(e,n){t.lineTo(e,n),this.__originalLineTo(e,n)},c.bezierCurveTo=function(e,n,r,a,o,u){t.bezierCurveTo(e,n,r,a,o,u),this.__originalBezierCurveTo(e,n,r,a,o,u)},c.rect=function(e,n,r,a){t.rect(e,n,r,a),this.__originalRect(e,n,r,a)},c.closePath=function(){t.closePath(),this.__originalClosePath()},c.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class w1{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,n){let r;return this.cache[t]!==void 0?(r=this.cache[t],this.canvasFactory.reset(r,e,n)):(r=this.canvasFactory.create(e,n),this.cache[t]=r),r}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function vc(c,t,e,n,r,a,o,u,d,f){const[p,m,y,v,_,w]=ae(c);if(m===0&&y===0){const R=o*p+_,T=Math.round(R),O=u*v+w,N=Math.round(O),k=(o+d)*p+_,M=Math.abs(Math.round(k)-T)||1,I=(u+f)*v+w,X=Math.abs(Math.round(I)-N)||1;return c.setTransform(Math.sign(p),0,0,Math.sign(v),T,N),c.drawImage(t,e,n,r,a,0,0,M,X),c.setTransform(p,m,y,v,_,w),[M,X]}if(p===0&&v===0){const R=u*y+_,T=Math.round(R),O=o*m+w,N=Math.round(O),k=(u+f)*y+_,M=Math.abs(Math.round(k)-T)||1,I=(o+d)*m+w,X=Math.abs(Math.round(I)-N)||1;return c.setTransform(0,Math.sign(m),Math.sign(y),0,T,N),c.drawImage(t,e,n,r,a,0,0,X,M),c.setTransform(p,m,y,v,_,w),[X,M]}c.drawImage(t,e,n,r,a,o,u,d,f);const S=Math.hypot(p,m),E=Math.hypot(y,v);return[S*d,E*f]}class iy{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=df;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=Me.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(t,e,n){n?.(this),this.clipBox=new Float32Array([0,0,t,e]),this.minMax=Xr.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=Be.FILL,e=null){const n=this.minMax.slice();if(t===Be.STROKE){e||Qt("Stroke bounding box must include transform."),at.singularValueDecompose2dScale(e,ms);const r=ms[0]*this.lineWidth/2,a=ms[1]*this.lineWidth/2;n[0]-=r,n[1]-=a,n[2]+=r,n[3]+=a}return n}updateClipFromPath(){const t=at.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(Xr,0)}getClippedPathBoundingBox(t=Be.FILL,e=null){return at.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function ry(c,t){if(t instanceof ImageData){c.putImageData(t,0,0);return}const e=t.height,n=t.width,r=e%as,a=(e-r)/as,o=r===0?a:a+1,u=c.createImageData(n,as);let d=0,f;const p=t.data,m=u.data;let y,v,_,w;if(t.kind===Rc.GRAYSCALE_1BPP){const S=p.byteLength,E=new Uint32Array(m.buffer,0,m.byteLength>>2),R=E.length,T=n+7>>3,O=4294967295,N=Ue.isLittleEndian?4278190080:255;for(y=0;y<o;y++){for(_=y<a?as:r,f=0,v=0;v<_;v++){const k=S-d;let M=0;const I=k>T?n:k*8-7,X=I&-8;let Q=0,Z=0;for(;M<X;M+=8)Z=p[d++],E[f++]=Z&128?O:N,E[f++]=Z&64?O:N,E[f++]=Z&32?O:N,E[f++]=Z&16?O:N,E[f++]=Z&8?O:N,E[f++]=Z&4?O:N,E[f++]=Z&2?O:N,E[f++]=Z&1?O:N;for(;M<I;M++)Q===0&&(Z=p[d++],Q=128),E[f++]=Z&Q?O:N,Q>>=1}for(;f<R;)E[f++]=0;c.putImageData(u,0,y*as)}}else if(t.kind===Rc.RGBA_32BPP){for(v=0,w=n*as*4,y=0;y<a;y++)m.set(p.subarray(d,d+w)),d+=w,c.putImageData(u,0,v),v+=as;y<o&&(w=n*r*4,m.set(p.subarray(d,d+w)),c.putImageData(u,0,v))}else if(t.kind===Rc.RGB_24BPP)for(_=as,w=n*_,y=0;y<o;y++){for(y>=a&&(_=r,w=n*_),f=0,v=w;v--;)m[f++]=p[d++],m[f++]=p[d++],m[f++]=p[d++],m[f++]=255;c.putImageData(u,0,y*as)}else throw new Error(`bad image kind: ${t.kind}`)}function ay(c,t){if(t.bitmap){c.drawImage(t.bitmap,0,0);return}const e=t.height,n=t.width,r=e%as,a=(e-r)/as,o=r===0?a:a+1,u=c.createImageData(n,as);let d=0;const f=t.data,p=u.data;for(let m=0;m<o;m++){const y=m<a?as:r;({srcPos:d}=b1({src:f,srcPos:d,dest:p,width:n,height:y,nonBlackColor:0})),c.putImageData(u,0,m*as)}}function io(c,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const n of e)c[n]!==void 0&&(t[n]=c[n]);c.setLineDash!==void 0&&(t.setLineDash(c.getLineDash()),t.lineDashOffset=c.lineDashOffset)}function wc(c){c.strokeStyle=c.fillStyle="#000000",c.fillRule="nonzero",c.globalAlpha=1,c.lineWidth=1,c.lineCap="butt",c.lineJoin="miter",c.miterLimit=10,c.globalCompositeOperation="source-over",c.font="10px sans-serif",c.setLineDash!==void 0&&(c.setLineDash([]),c.lineDashOffset=0);const{filter:t}=c;t!=="none"&&t!==""&&(c.filter="none")}function oy(c,t){if(t)return!0;at.singularValueDecompose2dScale(c,ms);const e=Math.fround(sn.pixelRatio*na.PDF_TO_CSS_UNITS);return ms[0]<=e&&ms[1]<=e}const _1=["butt","round","square"],A1=["miter","round","bevel"],S1={},ly={};class Zr{constructor(t,e,n,r,a,{optionalContentConfig:o,markedContentStack:u=null},d,f,p){this.ctx=t,this.current=new iy(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=n,this.canvasFactory=r,this.filterFactory=a,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=u||[],this.optionalContentConfig=o,this.cachedCanvases=new w1(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=d,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=f,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=p??null}getObject(t,e,n=null){return typeof e=="string"?(this.dependencyTracker?.recordNamedDependency(t,e),e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e)):n}beginDrawing({transform:t,viewport:e,transparency:n=!1,background:r=null}){const a=this.ctx.canvas.width,o=this.ctx.canvas.height,u=this.ctx.fillStyle;if(this.ctx.fillStyle=r||"#ffffff",this.ctx.fillRect(0,0,a,o),this.ctx.fillStyle=u,n){const d=this.cachedCanvases.getCanvas("transparent",a,o);this.compositeCtx=this.ctx,this.transparentCanvas=d.canvas,this.ctx=d.context,this.ctx.save(),this.ctx.transform(...ae(this.compositeCtx))}this.ctx.save(),wc(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=ae(this.ctx)}executeOperatorList(t,e,n,r,a){const o=t.argsArray,u=t.fnArray;let d=e||0;const f=o.length;if(f===d)return d;const p=f-d>ny&&typeof n=="function",m=p?Date.now()+y1:0;let y=0;const v=this.commonObjs,_=this.objs;let w,S;for(;;){if(r!==void 0&&d===r.nextBreakPoint)return r.breakIt(d,n),d;if(!a||a(d))if(w=u[d],S=o[d]??null,w!==xo.dependency)S===null?this[w](d):this[w](d,...S);else for(const E of S){this.dependencyTracker?.recordNamedData(E,d);const R=E.startsWith("g_")?v:_;if(!R.has(E))return R.get(E,n),d}if(d++,d===f)return d;if(p&&++y>ny){if(Date.now()>m)return n(),d;y=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const n=t.width??t.displayWidth,r=t.height??t.displayHeight;let a=Math.max(Math.hypot(e[0],e[1]),1),o=Math.max(Math.hypot(e[2],e[3]),1),u=n,d=r,f="prescale1",p,m;for(;a>2&&u>1||o>2&&d>1;){let y=u,v=d;a>2&&u>1&&(y=u>=16384?Math.floor(u/2)-1||1:Math.ceil(u/2),a/=u/y),o>2&&d>1&&(v=d>=16384?Math.floor(d/2)-1||1:Math.ceil(d)/2,o/=d/v),p=this.cachedCanvases.getCanvas(f,y,v),m=p.context,m.clearRect(0,0,y,v),m.drawImage(t,0,0,u,d,0,0,y,v),t=p.canvas,u=y,d=v,f=f==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:u,paintHeight:d}}_createMaskCanvas(t,e){const n=this.ctx,{width:r,height:a}=e,o=this.current.fillColor,u=this.current.patternFill,d=ae(n);let f,p,m,y;if((e.bitmap||e.data)&&e.count>1){const Q=e.bitmap||e.data.buffer;p=JSON.stringify(u?d:[d.slice(0,4),o]),f=this._cachedBitmapsMap.get(Q),f||(f=new Map,this._cachedBitmapsMap.set(Q,f));const Z=f.get(p);if(Z&&!u){const st=Math.round(Math.min(d[0],d[2])+d[4]),ht=Math.round(Math.min(d[1],d[3])+d[5]);return this.dependencyTracker?.recordDependencies(t,Ns.transformAndFill),{canvas:Z,offsetX:st,offsetY:ht}}m=Z}m||(y=this.cachedCanvases.getCanvas("maskCanvas",r,a),ay(y.context,e));let v=at.transform(d,[1/r,0,0,-1/a,0,0]);v=at.transform(v,[1,0,0,1,0,-a]);const _=Xr.slice();at.axialAlignedBoundingBox([0,0,r,a],v,_);const[w,S,E,R]=_,T=Math.round(E-w)||1,O=Math.round(R-S)||1,N=this.cachedCanvases.getCanvas("fillCanvas",T,O),k=N.context,M=w,I=S;k.translate(-M,-I),k.transform(...v),m||(m=this._scaleImage(y.canvas,Qs(k)),m=m.img,f&&u&&f.set(p,m)),k.imageSmoothingEnabled=oy(ae(k),e.interpolate),vc(k,m,0,0,m.width,m.height,0,0,r,a),k.globalCompositeOperation="source-in";const X=at.transform(Qs(k),[1,0,0,1,-M,-I]);return k.fillStyle=u?o.getPattern(n,this,X,Be.FILL,t):o,k.fillRect(0,0,r,a),f&&!u&&(this.cachedCanvases.delete("fillCanvas"),f.set(p,N.canvas)),this.dependencyTracker?.recordDependencies(t,Ns.transformAndFill),{canvas:N.canvas,offsetX:Math.round(M),offsetY:Math.round(I)}}setLineWidth(t,e){this.dependencyTracker?.recordSimpleData("lineWidth",t),e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(t,e){this.dependencyTracker?.recordSimpleData("lineCap",t),this.ctx.lineCap=_1[e]}setLineJoin(t,e){this.dependencyTracker?.recordSimpleData("lineJoin",t),this.ctx.lineJoin=A1[e]}setMiterLimit(t,e){this.dependencyTracker?.recordSimpleData("miterLimit",t),this.ctx.miterLimit=e}setDash(t,e,n){this.dependencyTracker?.recordSimpleData("dash",t);const r=this.ctx;r.setLineDash!==void 0&&(r.setLineDash(e),r.lineDashOffset=n)}setRenderingIntent(t,e){}setFlatness(t,e){}setGState(t,e){for(const[n,r]of e)switch(n){case"LW":this.setLineWidth(t,r);break;case"LC":this.setLineCap(t,r);break;case"LJ":this.setLineJoin(t,r);break;case"ML":this.setMiterLimit(t,r);break;case"D":this.setDash(t,r[0],r[1]);break;case"RI":this.setRenderingIntent(t,r);break;case"FL":this.setFlatness(t,r);break;case"Font":this.setFont(t,r[0],r[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",t),this.current.strokeAlpha=r;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",t),this.ctx.globalAlpha=this.current.fillAlpha=r;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",t),this.ctx.globalCompositeOperation=r;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",t),this.current.activeSMask=r?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",t),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(r);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(t){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,n=this.ctx.canvas.height,r="smaskGroupAt"+this.groupLevel,a=this.cachedCanvases.getCanvas(r,e,n);this.suspendedCtx=this.ctx;const o=this.ctx=a.context;o.setTransform(this.suspendedCtx.getTransform()),io(this.suspendedCtx,o),v1(o,this.suspendedCtx),this.setGState(t,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),io(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,n,r){const a=r[0],o=r[1],u=r[2]-a,d=r[3]-o;u===0||d===0||(this.genericComposeSMask(e.context,n,u,d,e.subtype,e.backdrop,e.transferMap,a,o,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(n.canvas,0,0),t.restore())}genericComposeSMask(t,e,n,r,a,o,u,d,f,p,m){let y=t.canvas,v=d-p,_=f-m;if(o)if(v<0||_<0||v+n>y.width||_+r>y.height){const S=this.cachedCanvases.getCanvas("maskExtension",n,r),E=S.context;E.drawImage(y,-v,-_),E.globalCompositeOperation="destination-atop",E.fillStyle=o,E.fillRect(0,0,n,r),E.globalCompositeOperation="source-over",y=S.canvas,v=_=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const S=new Path2D;S.rect(v,_,n,r),t.clip(S),t.globalCompositeOperation="destination-atop",t.fillStyle=o,t.fillRect(v,_,n,r),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),a==="Alpha"&&u?e.filter=this.filterFactory.addAlphaFilter(u):a==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(u));const w=new Path2D;w.rect(d,f,n,r),e.clip(w),e.globalCompositeOperation="destination-in",e.drawImage(y,v,_,n,r,d,f,n,r),e.restore()}save(t){this.inSMaskMode&&io(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone(),this.dependencyTracker?.save(t)}restore(t){if(this.dependencyTracker?.restore(t),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&io(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,n,r,a,o,u){this.dependencyTracker?.recordIncrementalData("transform",t),this.ctx.transform(e,n,r,a,o,u),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,n,r){let[a]=n;if(!r){a||=n[0]=new Path2D,this[e](t,a);return}if(this.dependencyTracker!==null){const o=e===xo.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(t).recordBBox(t,this.ctx,r[0]-o,r[2]+o,r[1]-o,r[3]+o).recordDependencies(t,["transform"])}a instanceof Path2D||(a=n[0]=$v(a)),at.axialAlignedBoundingBox(r,ae(this.ctx),this.current.minMax),this[e](t,a),this._pathStartIdx=t}closePath(t){this.ctx.closePath()}stroke(t,e,n=!0){const r=this.ctx,a=this.current.strokeColor;if(r.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof a=="object"&&a?.getPattern){const o=a.isModifyingCurrentTransform()?r.getTransform():null;if(r.save(),r.strokeStyle=a.getPattern(r,this,Qs(r),Be.STROKE,t),o){const u=new Path2D;u.addPath(e,r.getTransform().invertSelf().multiplySelf(o)),e=u}this.rescaleAndStroke(e,!1),r.restore()}else this.rescaleAndStroke(e,!0);this.dependencyTracker?.recordDependencies(t,Ns.stroke),n&&this.consumePath(t,e,this.current.getClippedPathBoundingBox(Be.STROKE,ae(this.ctx))),r.globalAlpha=this.current.fillAlpha}closeStroke(t,e){this.stroke(t,e)}fill(t,e,n=!0){const r=this.ctx,a=this.current.fillColor,o=this.current.patternFill;let u=!1;if(o){const f=a.isModifyingCurrentTransform()?r.getTransform():null;if(this.dependencyTracker?.save(t),r.save(),r.fillStyle=a.getPattern(r,this,Qs(r),Be.FILL,t),f){const p=new Path2D;p.addPath(e,r.getTransform().invertSelf().multiplySelf(f)),e=p}u=!0}const d=this.current.getClippedPathBoundingBox();this.contentVisible&&d!==null&&(this.pendingEOFill?(r.fill(e,"evenodd"),this.pendingEOFill=!1):r.fill(e)),this.dependencyTracker?.recordDependencies(t,Ns.fill),u&&(r.restore(),this.dependencyTracker?.restore(t)),n&&this.consumePath(t,e,d)}eoFill(t,e){this.pendingEOFill=!0,this.fill(t,e)}fillStroke(t,e){this.fill(t,e,!1),this.stroke(t,e,!1),this.consumePath(t,e)}eoFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}closeFillStroke(t,e){this.fillStroke(t,e)}closeEOFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}endPath(t,e){this.consumePath(t,e)}rawFillPath(t,e){this.ctx.fill(e),this.dependencyTracker?.recordDependencies(t,Ns.rawFillPath).recordOperation(t)}clip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=S1}eoClip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=ly}beginText(t){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(t).resetIncrementalData("sameLineText").resetIncrementalData("moveText",t)}endText(t){const e=this.pendingTextPaths,n=this.ctx;if(this.dependencyTracker){const{dependencyTracker:r}=this;e!==void 0&&r.recordFutureForcedDependency("textClip",r.getOpenMarker()).recordFutureForcedDependency("textClip",t),r.recordCloseMarker(t)}if(e!==void 0){const r=new Path2D,a=n.getTransform().invertSelf();for(const{transform:o,x:u,y:d,fontSize:f,path:p}of e)p&&r.addPath(p,new DOMMatrix(o).preMultiplySelf(a).translate(u,d).scale(f,-f));n.clip(r)}delete this.pendingTextPaths}setCharSpacing(t,e){this.dependencyTracker?.recordSimpleData("charSpacing",t),this.current.charSpacing=e}setWordSpacing(t,e){this.dependencyTracker?.recordSimpleData("wordSpacing",t),this.current.wordSpacing=e}setHScale(t,e){this.dependencyTracker?.recordSimpleData("hScale",t),this.current.textHScale=e/100}setLeading(t,e){this.dependencyTracker?.recordSimpleData("leading",t),this.current.leading=-e}setFont(t,e,n){this.dependencyTracker?.recordSimpleData("font",t).recordSimpleDataFromNamed("fontObj",e,t);const r=this.commonObjs.get(e),a=this.current;if(!r)throw new Error(`Can't find font for ${e}`);if(a.fontMatrix=r.fontMatrix||df,(a.fontMatrix[0]===0||a.fontMatrix[3]===0)&&xt("Invalid font matrix for font "+e),n<0?(n=-n,a.fontDirection=-1):a.fontDirection=1,this.current.font=r,this.current.fontSize=n,r.isType3Font)return;const o=r.loadedName||"sans-serif",u=r.systemFontInfo?.css||`"${o}", ${r.fallbackName}`;let d="normal";r.black?d="900":r.bold&&(d="bold");const f=r.italic?"italic":"normal";let p=n;n<ey?p=ey:n>sy&&(p=sy),this.current.fontSizeScale=n/p,this.ctx.font=`${f} ${d} ${p}px ${u}`}setTextRenderingMode(t,e){this.dependencyTracker?.recordSimpleData("textRenderingMode",t),this.current.textRenderingMode=e}setTextRise(t,e){this.dependencyTracker?.recordSimpleData("textRise",t),this.current.textRise=e}moveText(t,e,n){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",t),this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=n}setLeadingMoveText(t,e,n){this.setLeading(t,-n),this.moveText(t,e,n)}setTextMatrix(t,e){this.dependencyTracker?.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",t);const{current:n}=this;n.textMatrix=e,n.textMatrixScale=Math.hypot(e[0],e[1]),n.x=n.lineX=0,n.y=n.lineY=0}nextLine(t){this.moveText(t,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??t)}#n(t,e,n){const r=new Path2D;return r.addPath(t,new DOMMatrix(n).invertSelf().multiplySelf(e)),r}paintChar(t,e,n,r,a,o){const u=this.ctx,d=this.current,f=d.font,p=d.textRenderingMode,m=d.fontSize/d.fontSizeScale,y=p&Me.FILL_STROKE_MASK,v=!!(p&Me.ADD_TO_PATH_FLAG),_=d.patternFill&&!f.missingFile,w=d.patternStroke&&!f.missingFile;let S;if((f.disableFontFace||v||_||w)&&!f.missingFile&&(S=f.getPathGenerator(this.commonObjs,e)),S&&(f.disableFontFace||_||w)){u.save(),u.translate(n,r),u.scale(m,-m),this.dependencyTracker?.recordCharacterBBox(t,u,f);let E;if(y===Me.FILL||y===Me.FILL_STROKE)if(a){E=u.getTransform(),u.setTransform(...a);const R=this.#n(S,E,a);u.fill(R)}else u.fill(S);if(y===Me.STROKE||y===Me.FILL_STROKE)if(o){E||=u.getTransform(),u.setTransform(...o);const{a:R,b:T,c:O,d:N}=E,k=at.inverseTransform(o),M=at.transform([R,T,O,N,0,0],k);at.singularValueDecompose2dScale(M,ms),u.lineWidth*=Math.max(ms[0],ms[1])/m,u.stroke(this.#n(S,E,o))}else u.lineWidth/=m,u.stroke(S);u.restore()}else(y===Me.FILL||y===Me.FILL_STROKE)&&(u.fillText(e,n,r),this.dependencyTracker?.recordCharacterBBox(t,u,f,m,n,r,()=>u.measureText(e))),(y===Me.STROKE||y===Me.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(t,u,f,m,n,r,()=>u.measureText(e)).recordDependencies(t,Ns.stroke),u.strokeText(e,n,r));v&&((this.pendingTextPaths||=[]).push({transform:ae(u),x:n,y:r,fontSize:m,path:S}),this.dependencyTracker?.recordCharacterBBox(t,u,f,m,n,r))}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let n=!1;for(let r=3;r<e.length;r+=4)if(e[r]>0&&e[r]<255){n=!0;break}return Et(this,"isFontSubpixelAAEnabled",n)}showText(t,e){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(t,Ns.showText).resetBBox(t),this.current.textRenderingMode&Me.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",t).inheritPendingDependenciesAsFutureForcedDependencies());const n=this.current,r=n.font;if(r.isType3Font){this.showType3Text(t,e),this.dependencyTracker?.recordShowTextOperation(t);return}const a=n.fontSize;if(a===0){this.dependencyTracker?.recordOperation(t);return}const o=this.ctx,u=n.fontSizeScale,d=n.charSpacing,f=n.wordSpacing,p=n.fontDirection,m=n.textHScale*p,y=e.length,v=r.vertical,_=v?1:-1,w=r.defaultVMetrics,S=a*n.fontMatrix[0],E=n.textRenderingMode===Me.FILL&&!r.disableFontFace&&!n.patternFill;o.save(),n.textMatrix&&o.transform(...n.textMatrix),o.translate(n.x,n.y+n.textRise),p>0?o.scale(m,-1):o.scale(m,1);let R,T;if(n.patternFill){o.save();const I=n.fillColor.getPattern(o,this,Qs(o),Be.FILL,t);R=ae(o),o.restore(),o.fillStyle=I}if(n.patternStroke){o.save();const I=n.strokeColor.getPattern(o,this,Qs(o),Be.STROKE,t);T=ae(o),o.restore(),o.strokeStyle=I}let O=n.lineWidth;const N=n.textMatrixScale;if(N===0||O===0){const I=n.textRenderingMode&Me.FILL_STROKE_MASK;(I===Me.STROKE||I===Me.FILL_STROKE)&&(O=this.getSinglePixelWidth())}else O/=N;if(u!==1&&(o.scale(u,u),O/=u),o.lineWidth=O,r.isInvalidPDFjsFont){const I=[];let X=0;for(const Z of e)I.push(Z.unicode),X+=Z.width;const Q=I.join("");if(o.fillText(Q,0,0),this.dependencyTracker!==null){const Z=o.measureText(Q);this.dependencyTracker.recordBBox(t,this.ctx,-Z.actualBoundingBoxLeft,Z.actualBoundingBoxRight,-Z.actualBoundingBoxAscent,Z.actualBoundingBoxDescent).recordShowTextOperation(t)}n.x+=X*S*m,o.restore(),this.compose();return}let k=0,M;for(M=0;M<y;++M){const I=e[M];if(typeof I=="number"){k+=_*I*a/1e3;continue}let X=!1;const Q=(I.isSpace?f:0)+d,Z=I.fontChar,st=I.accent;let ht,wt,_t=I.width;if(v){const tt=I.vmetric||w,At=-(I.vmetric?tt[1]:_t*.5)*S,Ot=tt[2]*S;_t=tt?-tt[0]:_t,ht=At/u,wt=(k+Ot)/u}else ht=k/u,wt=0;let P;if(r.remeasure&&_t>0){P=o.measureText(Z);const tt=P.width*1e3/a*u;if(_t<tt&&this.isFontSubpixelAAEnabled){const At=_t/tt;X=!0,o.save(),o.scale(At,1),ht/=At}else _t!==tt&&(ht+=(_t-tt)/2e3*a/u)}if(this.contentVisible&&(I.isInFont||r.missingFile)){if(E&&!st)o.fillText(Z,ht,wt),this.dependencyTracker?.recordCharacterBBox(t,o,P?{bbox:null}:r,a/u,ht,wt,()=>P??o.measureText(Z));else if(this.paintChar(t,Z,ht,wt,R,T),st){const tt=ht+a*st.offset.x/u,At=wt-a*st.offset.y/u;this.paintChar(t,st.fontChar,tt,At,R,T)}}const $=v?_t*S-Q*p:_t*S+Q*p;k+=$,X&&o.restore()}v?n.y-=k:n.x+=k*m,o.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(t)}showType3Text(t,e){const n=this.ctx,r=this.current,a=r.font,o=r.fontSize,u=r.fontDirection,d=a.vertical?1:-1,f=r.charSpacing,p=r.wordSpacing,m=r.textHScale*u,y=r.fontMatrix||df,v=e.length,_=r.textRenderingMode===Me.INVISIBLE;let w,S,E,R;if(_||o===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),r.textMatrix&&n.transform(...r.textMatrix),n.translate(r.x,r.y+r.textRise),n.scale(m,u);const T=this.dependencyTracker;for(this.dependencyTracker=T?new zc(T,t):null,w=0;w<v;++w){if(S=e[w],typeof S=="number"){R=d*S*o/1e3,this.ctx.translate(R,0),r.x+=R*m;continue}const O=(S.isSpace?p:0)+f,N=a.charProcOperatorList[S.operatorListId];N?this.contentVisible&&(this.save(),n.scale(o,o),n.transform(...y),this.executeOperatorList(N),this.restore()):xt(`Type3 character "${S.operatorListId}" is not available.`);const k=[S.width,0];at.applyTransform(k,y),E=k[0]*o+O,n.translate(E,0),r.x+=E*m}n.restore(),T&&(this.dependencyTracker=T)}setCharWidth(t,e,n){}setCharWidthAndBounds(t,e,n,r,a,o,u){const d=new Path2D;d.rect(r,a,o-r,u-a),this.ctx.clip(d),this.dependencyTracker?.recordBBox(t,this.ctx,r,o,a,u).recordClipBox(t,this.ctx,r,o,a,u),this.endPath(t)}getColorN_Pattern(t,e){let n;if(e[0]==="TilingPattern"){const r=this.baseTransform||ae(this.ctx),a={createCanvasGraphics:(o,u)=>new Zr(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new zc(this.dependencyTracker,u,!0):null)};n=new Xf(e,this.ctx,a,r)}else n=this._getPattern(t,e[1],e[2]);return n}setStrokeColorN(t,...e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.current.strokeColor=this.getColorN_Pattern(t,e),this.current.patternStroke=!0}setFillColorN(t,...e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.current.fillColor=this.getColorN_Pattern(t,e),this.current.patternFill=!0}setStrokeRGBColor(t,e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(t){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(t){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e,n=null){let r;return this.cachedPatterns.has(e)?r=this.cachedPatterns.get(e):(r=m1(this.getObject(t,e)),this.cachedPatterns.set(e,r)),n&&(r.matrix=n),r}shadingFill(t,e){if(!this.contentVisible)return;const n=this.ctx;this.save(t);const r=this._getPattern(t,e);n.fillStyle=r.getPattern(n,this,Qs(n),Be.SHADING,t);const a=Qs(n);if(a){const{width:o,height:u}=n.canvas,d=Xr.slice();at.axialAlignedBoundingBox([0,0,o,u],a,d);const[f,p,m,y]=d;this.ctx.fillRect(f,p,m-f,y-p)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(t).recordFullPageBBox(t).recordDependencies(t,Ns.transform).recordDependencies(t,Ns.fill).recordOperation(t),this.compose(this.current.getClippedPathBoundingBox()),this.restore(t)}beginInlineImage(){Qt("Should not call beginInlineImage")}beginImageData(){Qt("Should not call beginImageData")}paintFormXObjectBegin(t,e,n){if(this.contentVisible&&(this.save(t),this.baseTransformStack.push(this.baseTransform),e&&this.transform(t,...e),this.baseTransform=ae(this.ctx),n)){at.axialAlignedBoundingBox(n,this.baseTransform,this.current.minMax);const[r,a,o,u]=n,d=new Path2D;d.rect(r,a,o-r,u-a),this.ctx.clip(d),this.dependencyTracker?.recordClipBox(t,this.ctx,r,o,a,u),this.endPath(t)}}paintFormXObjectEnd(t){this.contentVisible&&(this.restore(t),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t,e){if(!this.contentVisible)return;this.save(t),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;e.isolated||Wc("TODO: Support non-isolated groups."),e.knockout&&xt("Knockout groups not supported.");const r=ae(n);if(e.matrix&&n.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let a=Xr.slice();at.axialAlignedBoundingBox(e.bbox,ae(n),a);const o=[0,0,n.canvas.width,n.canvas.height];a=at.intersect(a,o)||[0,0,0,0];const u=Math.floor(a[0]),d=Math.floor(a[1]),f=Math.max(Math.ceil(a[2])-u,1),p=Math.max(Math.ceil(a[3])-d,1);this.current.startNewPathAndClipBox([0,0,f,p]);let m="groupAt"+this.groupLevel;e.smask&&(m+="_smask_"+this.smaskCounter++%2);const y=this.cachedCanvases.getCanvas(m,f,p),v=y.context;v.translate(-u,-d),v.transform(...r);let _=new Path2D;const[w,S,E,R]=e.bbox;if(_.rect(w,S,E-w,R-S),e.matrix){const T=new Path2D;T.addPath(_,new DOMMatrix(e.matrix)),_=T}v.clip(_),e.smask&&this.smaskStack.push({canvas:y.canvas,context:v,offsetX:u,offsetY:d,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}),(!e.smask||this.dependencyTracker)&&(n.setTransform(1,0,0,1,0,0),n.translate(u,d),n.save()),io(n,v),this.ctx=v,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(n),this.setGState(t,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(t,e){if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,r=this.groupStack.pop();if(this.ctx=r,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),e.smask)this.tempSMask=this.smaskStack.pop(),this.restore(t),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const a=ae(this.ctx);this.restore(t),this.ctx.save(),this.ctx.setTransform(...a);const o=Xr.slice();at.axialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],a,o),this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(o)}}beginAnnotation(t,e,n,r,a,o){if(this.#t(),wc(this.ctx),this.ctx.save(),this.save(t),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),n){const u=n[2]-n[0],d=n[3]-n[1];if(o&&this.annotationCanvasMap){r=r.slice(),r[4]-=n[0],r[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=u,n[3]=d,at.singularValueDecompose2dScale(ae(this.ctx),ms);const{viewportScale:f}=this,p=Math.ceil(u*this.outputScaleX*f),m=Math.ceil(d*this.outputScaleY*f);this.annotationCanvas=this.canvasFactory.create(p,m);const{canvas:y,context:v}=this.annotationCanvas;this.annotationCanvasMap.set(e,y),this.annotationCanvas.savedCtx=this.ctx,this.ctx=v,this.ctx.save(),this.ctx.setTransform(ms[0],0,0,-ms[1],0,d*ms[1]),wc(this.ctx)}else{wc(this.ctx),this.endPath(t);const f=new Path2D;f.rect(n[0],n[1],u,d),this.ctx.clip(f)}}this.current=new iy(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(t,...r),this.transform(t,...a)}endAnnotation(t){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t,e){if(!this.contentVisible)return;const n=e.count;e=this.getObject(t,e.data,e),e.count=n;const r=this.ctx,a=this._createMaskCanvas(t,e),o=a.canvas;r.save(),r.setTransform(1,0,0,1,0,0),r.drawImage(o,a.offsetX,a.offsetY),this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,a.offsetX,a.offsetX+o.width,a.offsetY,a.offsetY+o.height).recordOperation(t),r.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,n,r=0,a=0,o,u){if(!this.contentVisible)return;e=this.getObject(t,e.data,e);const d=this.ctx;d.save();const f=ae(d);d.transform(n,r,a,o,0,0);const p=this._createMaskCanvas(t,e);d.setTransform(1,0,0,1,p.offsetX-f[4],p.offsetY-f[5]),this.dependencyTracker?.resetBBox(t);for(let m=0,y=u.length;m<y;m+=2){const v=at.transform(f,[n,r,a,o,u[m],u[m+1]]);d.drawImage(p.canvas,v[4],v[5]),this.dependencyTracker?.recordBBox(t,this.ctx,v[4],v[4]+p.canvas.width,v[5],v[5]+p.canvas.height)}d.restore(),this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageMaskXObjectGroup(t,e){if(!this.contentVisible)return;const n=this.ctx,r=this.current.fillColor,a=this.current.patternFill;this.dependencyTracker?.resetBBox(t).recordDependencies(t,Ns.transformAndFill);for(const o of e){const{data:u,width:d,height:f,transform:p}=o,m=this.cachedCanvases.getCanvas("maskCanvas",d,f),y=m.context;y.save();const v=this.getObject(t,u,o);ay(y,v),y.globalCompositeOperation="source-in",y.fillStyle=a?r.getPattern(y,this,Qs(n),Be.FILL,t):r,y.fillRect(0,0,d,f),y.restore(),n.save(),n.transform(...p),n.scale(1,-1),vc(n,m.canvas,0,0,d,f,0,-1,1,1),this.dependencyTracker?.recordBBox(t,n,0,d,0,f),n.restore()}this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageXObject(t,e){if(!this.contentVisible)return;const n=this.getObject(t,e);if(!n){xt("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t,n)}paintImageXObjectRepeat(t,e,n,r,a){if(!this.contentVisible)return;const o=this.getObject(t,e);if(!o){xt("Dependent image isn't ready yet");return}const u=o.width,d=o.height,f=[];for(let p=0,m=a.length;p<m;p+=2)f.push({transform:[n,0,0,r,a[p],a[p+1]],x:0,y:0,w:u,h:d});this.paintInlineImageXObjectGroup(t,o,f)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:n,height:r}=t,a=this.cachedCanvases.getCanvas("inlineImage",n,r),o=a.context;return o.filter=this.current.transferMaps,o.drawImage(e,0,0),o.filter="none",a.canvas}paintInlineImageXObject(t,e){if(!this.contentVisible)return;const n=e.width,r=e.height,a=this.ctx;this.save(t);const{filter:o}=a;o!=="none"&&o!==""&&(a.filter="none"),a.scale(1/n,-1/r);let u;if(e.bitmap)u=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)u=e;else{const p=this.cachedCanvases.getCanvas("inlineImage",n,r).context;ry(p,e),u=this.applyTransferMapsToCanvas(p)}const d=this._scaleImage(u,Qs(a));a.imageSmoothingEnabled=oy(ae(a),e.interpolate),this.dependencyTracker?.resetBBox(t).recordBBox(t,a,0,n,-r,0).recordDependencies(t,Ns.imageXObject).recordOperation(t),vc(a,d.img,0,0,d.paintWidth,d.paintHeight,0,-r,n,r),this.compose(),this.restore(t)}paintInlineImageXObjectGroup(t,e,n){if(!this.contentVisible)return;const r=this.ctx;let a;if(e.bitmap)a=e.bitmap;else{const o=e.width,u=e.height,f=this.cachedCanvases.getCanvas("inlineImage",o,u).context;ry(f,e),a=this.applyTransferMapsToCanvas(f)}this.dependencyTracker?.resetBBox(t);for(const o of n)r.save(),r.transform(...o.transform),r.scale(1,-1),vc(r,a,o.x,o.y,o.w,o.h,0,-1,1,1),this.dependencyTracker?.recordBBox(t,r,0,1,-1,0),r.restore();this.dependencyTracker?.recordOperation(t),this.compose()}paintSolidColorImageMask(t){this.contentVisible&&(this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,0,1,0,1).recordDependencies(t,Ns.fill).recordOperation(t),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t,e){}markPointProps(t,e,n){}beginMarkedContent(t,e){this.dependencyTracker?.beginMarkedContent(t),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e,n){this.dependencyTracker?.beginMarkedContent(t),e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(t){this.dependencyTracker?.endMarkedContent(t),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(t){}endCompat(t){}consumePath(t,e,n){const r=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(n);const a=this.ctx;this.pendingClip?(r||(this.pendingClip===ly?a.clip(e,"evenodd"):a.clip(e)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(t).recordFutureForcedDependency("clipPath",t)):this.dependencyTracker?.recordOperation(t),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=ae(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),n=Math.hypot(t[0],t[2]),r=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(n,r)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:n,c:r,d:a}=this.ctx.getTransform();let o,u;if(n===0&&r===0){const d=Math.abs(e),f=Math.abs(a);if(d===f)if(t===0)o=u=1/d;else{const p=d*t;o=u=p<1?1/p:1}else if(t===0)o=1/d,u=1/f;else{const p=d*t,m=f*t;o=p<1?1/p:1,u=m<1?1/m:1}}else{const d=Math.abs(e*a-n*r),f=Math.hypot(e,n),p=Math.hypot(r,a);if(t===0)o=p/d,u=f/d;else{const m=t*d;o=p>m?p/m:1,u=f>m?f/m:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=u}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:n,current:{lineWidth:r}}=this,[a,o]=this.getScaleForStroking();if(a===o){n.lineWidth=(r||1)*a,n.stroke(t);return}const u=n.getLineDash();e&&n.save(),n.scale(a,o),Bd.a=1/a,Bd.d=1/o;const d=new Path2D;if(d.addPath(t,Bd),u.length>0){const f=Math.max(a,o);n.setLineDash(u.map(p=>p/f)),n.lineDashOffset/=f}n.lineWidth=r||1,n.stroke(d),e&&n.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const c in xo)Zr.prototype[c]!==void 0&&(Zr.prototype[xo[c]]=Zr.prototype[c]);class zi{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#t=t}static get workerSrc(){return this.#e}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#e=t}}class x1{#t;#e;constructor({parsedData:t,rawData:e}){this.#t=t,this.#e=e}getRaw(){return this.#e}get(t){return this.#t.get(t)??null}[Symbol.iterator](){return this.#t.entries()}}const qr=Symbol("INTERNAL");class E1{#t=!1;#e=!1;#n=!1;#s=!0;constructor(t,{name:e,intent:n,usage:r,rbGroups:a}){this.#t=!!(t&gs.DISPLAY),this.#e=!!(t&gs.PRINT),this.name=e,this.intent=n,this.usage=r,this.rbGroups=a}get visible(){if(this.#n)return this.#s;if(!this.#s)return!1;const{print:t,view:e}=this.usage;return this.#t?e?.viewState!=="OFF":this.#e?t?.printState!=="OFF":!0}_setVisible(t,e,n=!1){t!==qr&&Qt("Internal method `_setVisible` called."),this.#n=n,this.#s=e}}class T1{#t=null;#e=new Map;#n=null;#s=null;constructor(t,e=gs.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#s=t.order;for(const n of t.groups)this.#e.set(n.id,new E1(e,n));if(t.baseState==="OFF")for(const n of this.#e.values())n._setVisible(qr,!1);for(const n of t.on)this.#e.get(n)._setVisible(qr,!0);for(const n of t.off)this.#e.get(n)._setVisible(qr,!1);this.#n=this.getHash()}}#a(t){const e=t.length;if(e<2)return!0;const n=t[0];for(let r=1;r<e;r++){const a=t[r];let o;if(Array.isArray(a))o=this.#a(a);else if(this.#e.has(a))o=this.#e.get(a).visible;else return xt(`Optional content group not found: ${a}`),!0;switch(n){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return n==="And"}isVisible(t){if(this.#e.size===0)return!0;if(!t)return Wc("Optional content group not defined."),!0;if(t.type==="OCG")return this.#e.has(t.id)?this.#e.get(t.id).visible:(xt(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#a(t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!this.#e.has(e))return xt(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!this.#e.has(e))return xt(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!this.#e.has(e))return xt(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!this.#e.has(e))return xt(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!1}return!0}return xt(`Unknown optional content policy ${t.policy}.`),!0}return xt(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,n=!0){const r=this.#e.get(t);if(!r){xt(`Optional content group not found: ${t}`);return}if(n&&e&&r.rbGroups.length)for(const a of r.rbGroups)for(const o of a)o!==t&&this.#e.get(o)?._setVisible(qr,!1,!0);r._setVisible(qr,!!e,!0),this.#t=null}setOCGState({state:t,preserveRB:e}){let n;for(const r of t){switch(r){case"ON":case"OFF":case"Toggle":n=r;continue}const a=this.#e.get(r);if(a)switch(n){case"ON":this.setVisibility(r,!0,e);break;case"OFF":this.setVisibility(r,!1,e);break;case"Toggle":this.setVisibility(r,!a.visible,e);break}}this.#t=null}get hasInitialVisibility(){return this.#n===null||this.getHash()===this.#n}getOrder(){return this.#e.size?this.#s?this.#s.slice():[...this.#e.keys()]:null}getGroup(t){return this.#e.get(t)||null}getHash(){if(this.#t!==null)return this.#t;const t=new Gv;for(const[e,n]of this.#e)t.update(`${e}:${n.visible}`);return this.#t=t.hexdigest()}[Symbol.iterator](){return this.#e.entries()}}class C1{constructor(t,{disableRange:e=!1,disableStream:n=!1}){Pt(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:r,initialData:a,progressiveDone:o,contentDispositionFilename:u}=t;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=u,a?.length>0){const d=a instanceof Uint8Array&&a.byteLength===a.buffer.byteLength?a.buffer:new Uint8Array(a).buffer;this._queuedChunks.push(d)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!n,this._isRangeSupported=!e,this._contentLength=r,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((d,f)=>{this._onReceiveData({begin:d,chunk:f})}),t.addProgressListener((d,f)=>{this._onProgress({loaded:d,total:f})}),t.addProgressiveReadListener(d=>{this._onReceiveData({chunk:d})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const n=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{const r=this._rangeReaders.some(function(a){return a._begin!==t?!1:(a._enqueue(n),!0)});Pt(r,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){t.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){Pt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new R1(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new O1(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class R1{constructor(t,e,n=!1,r=null){this._stream=t,this._done=n||!1,this._filename=zf(r)?r:null,this._queuedChunks=e||[],this._loaded=0;for(const a of this._queuedChunks)this._loaded+=a.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class O1{constructor(t,e,n){this._stream=t,this._begin=e,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function N1(c){let t=!0,e=n("filename\\*","i").exec(c);if(e){e=e[1];let p=u(e);return p=unescape(p),p=d(p),p=f(p),a(p)}if(e=o(c),e){const p=f(e);return a(p)}if(e=n("filename","i").exec(c),e){e=e[1];let p=u(e);return p=f(p),a(p)}function n(p,m){return new RegExp("(?:^|;)\\s*"+p+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',m)}function r(p,m){if(p){if(!/^[\x00-\xFF]+$/.test(m))return m;try{const y=new TextDecoder(p,{fatal:!0}),v=ko(m);m=y.decode(v),t=!1}catch{}}return m}function a(p){return t&&/[\x80-\xff]/.test(p)&&(p=r("utf-8",p),t&&(p=r("iso-8859-1",p))),p}function o(p){const m=[];let y;const v=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(y=v.exec(p))!==null;){let[,w,S,E]=y;if(w=parseInt(w,10),w in m){if(w===0)break;continue}m[w]=[S,E]}const _=[];for(let w=0;w<m.length&&w in m;++w){let[S,E]=m[w];E=u(E),S&&(E=unescape(E),w===0&&(E=d(E))),_.push(E)}return _.join("")}function u(p){if(p.startsWith('"')){const m=p.slice(1).split('\\"');for(let y=0;y<m.length;++y){const v=m[y].indexOf('"');v!==-1&&(m[y]=m[y].slice(0,v),m.length=y+1),m[y]=m[y].replaceAll(/\\(.)/g,"$1")}p=m.join('"')}return p}function d(p){const m=p.indexOf("'");if(m===-1)return p;const y=p.slice(0,m),_=p.slice(m+1).replace(/^[^']*'/,"");return r(y,_)}function f(p){return!p.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(p)?p:p.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(m,y,v,_){if(v==="q"||v==="Q")return _=_.replaceAll("_"," "),_=_.replaceAll(/=([0-9a-fA-F]{2})/g,function(w,S){return String.fromCharCode(parseInt(S,16))}),r(y,_);try{_=atob(_)}catch{}return r(y,_)})}return""}function Jv(c,t){const e=new Headers;if(!c||!t||typeof t!="object")return e;for(const n in t){const r=t[n];r!==void 0&&e.append(n,r)}return e}function Zc(c){return URL.parse(c)?.origin??null}function Zv({responseHeaders:c,isHttp:t,rangeChunkSize:e,disableRange:n}){const r={allowRangeRequests:!1,suggestedLength:void 0},a=parseInt(c.get("Content-Length"),10);return!Number.isInteger(a)||(r.suggestedLength=a,a<=2*e)||n||!t||c.get("Accept-Ranges")!=="bytes"||(c.get("Content-Encoding")||"identity")!=="identity"||(r.allowRangeRequests=!0),r}function tw(c){const t=c.get("Content-Disposition");if(t){let e=N1(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(zf(e))return e}return null}function Po(c,t){return new Fc(`Unexpected server response (${c}) while retrieving PDF "${t}".`,c,c===404||c===0&&t.startsWith("file:"))}function ew(c){return c===200||c===206}function sw(c,t,e){return{method:"GET",headers:c,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function nw(c){return c instanceof Uint8Array?c.buffer:c instanceof ArrayBuffer?c:(xt(`getArrayBuffer - unexpected data format: ${c}`),new Uint8Array(c).buffer)}class k1{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=Jv(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Pt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new D1(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new M1(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class D1{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const n=new Headers(t.headers),r=e.url;fetch(r,sw(n,this._withCredentials,this._abortController)).then(a=>{if(t._responseOrigin=Zc(a.url),!ew(a.status))throw Po(a.status,r);this._reader=a.body.getReader(),this._headersCapability.resolve();const o=a.headers,{allowRangeRequests:u,suggestedLength:d}=Zv({responseHeaders:o,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=u,this._contentLength=d||this._contentLength,this._filename=tw(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new ri("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:nw(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class M1{constructor(t,e,n){this._stream=t,this._reader=null,this._loaded=0;const r=t.source;this._withCredentials=r.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!r.disableStream,this._abortController=new AbortController;const a=new Headers(t.headers);a.append("Range",`bytes=${e}-${n-1}`);const o=r.url;fetch(o,sw(a,this._withCredentials,this._abortController)).then(u=>{const d=Zc(u.url);if(d!==t._responseOrigin)throw new Error(`Expected range response-origin "${d}" to match "${t._responseOrigin}".`);if(!ew(u.status))throw Po(u.status,o);this._readCapability.resolve(),this._reader=u.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:nw(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}const Id=200,Ud=206;function j1(c){const t=c.response;return typeof t!="string"?t:ko(t).buffer}class L1{_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:n}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=Jv(this.isHttp,e),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,n=this.currXhrId++,r=this.pendingRequests[n]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[a,o]of this.headers)e.setRequestHeader(a,o);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),r.expectedStatus=Ud):r.expectedStatus=Id,e.responseType="arraybuffer",Pt(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,n),e.onprogress=this.onProgress.bind(this,n),r.onHeadersReceived=t.onHeadersReceived,r.onDone=t.onDone,r.onError=t.onError,r.onProgress=t.onProgress,e.send(null),n}onProgress(t,e){const n=this.pendingRequests[t];n&&n.onProgress?.(e)}onStateChange(t,e){const n=this.pendingRequests[t];if(!n)return;const r=n.xhr;if(r.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),r.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],r.status===0&&this.isHttp){n.onError(r.status);return}const a=r.status||Id;if(!(a===Id&&n.expectedStatus===Ud)&&a!==n.expectedStatus){n.onError(r.status);return}const u=j1(r);if(a===Ud){const d=r.getResponseHeader("Content-Range"),f=/bytes (\d+)-(\d+)\/(\d+)/.exec(d);f?n.onDone({begin:parseInt(f[1],10),chunk:u}):(xt('Missing or invalid "Content-Range" header.'),n.onError(0))}else u?n.onDone({begin:0,chunk:u}):n.onError(r.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class P1{constructor(t){this._source=t,this._manager=new L1(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return Pt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new B1(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const n=new I1(this._manager,t,e);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class B1{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=Zc(e.responseURL);const n=e.getAllResponseHeaders(),r=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(u=>{const[d,...f]=u.split(": ");return[d,f.join(": ")]}):[]),{allowRangeRequests:a,suggestedLength:o}=Zv({responseHeaders:r,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});a&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=tw(r),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=Po(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class I1{constructor(t,e,n){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const t=Zc(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=Po(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const U1=/^[a-z][a-z0-9\-+.]+:/i;function F1(c){if(U1.test(c))return new URL(c);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(c))}class z1{constructor(t){this.source=t,this.url=F1(t.url),Pt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Pt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new H1(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new $1(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class H1{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(r=>{this._contentLength=r.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},r=>{r.code==="ENOENT"&&(r=Po(0,this._url.href)),this._storedError=r,this._headersCapability.reject(r)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new ri("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class $1{constructor(t,e,n){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const r=t.source;this._isStreamingSupported=!r.disableStream;const a=process.getBuiltinModule("fs");this._setReadableStream(a.createReadStream(this._url,{start:e,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const ro=Symbol("INITIAL_DATA");class iw{#t=Object.create(null);#e(t){return this.#t[t]||={...Promise.withResolvers(),data:ro}}get(t,e=null){if(e){const r=this.#e(t);return r.promise.then(()=>e(r.data)),null}const n=this.#t[t];if(!n||n.data===ro)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return n.data}has(t){const e=this.#t[t];return!!e&&e.data!==ro}delete(t){const e=this.#t[t];return!e||e.data===ro?!1:(delete this.#t[t],!0)}resolve(t,e=null){const n=this.#e(t);n.data=e,n.resolve()}clear(){for(const t in this.#t){const{data:e}=this.#t[t];e?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const t in this.#t){const{data:e}=this.#t[t];e!==ro&&(yield[t,e])}}}const q1=1e5,cy=30;class Ve{#t=Promise.withResolvers();#e=null;#n=!1;#s=!!globalThis.FontInspector?.enabled;#a=null;#r=null;#i=0;#o=0;#c=null;#l=null;#d=0;#h=0;#f=Object.create(null);#m=[];#g=null;#u=[];#p=new WeakMap;#b=null;static#v=new Map;static#y=new Map;static#E=new WeakMap;static#S=null;static#_=new Set;constructor({textContentSource:t,container:e,viewport:n}){if(t instanceof ReadableStream)this.#g=t;else if(typeof t=="object")this.#g=new ReadableStream({start(d){d.enqueue(t),d.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#l=e,this.#h=n.scale*sn.pixelRatio,this.#d=n.rotation,this.#r={div:null,properties:null,ctx:null};const{pageWidth:r,pageHeight:a,pageX:o,pageY:u}=n.rawDims;this.#b=[1,0,0,-1,-o,u+a],this.#o=r,this.#i=a,Ve.#O(),Hi(e,n),this.#t.promise.finally(()=>{Ve.#_.delete(this),this.#r=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=Ue.platform;return Et(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#c.read().then(({value:e,done:n})=>{if(n){this.#t.resolve();return}this.#a??=e.lang,Object.assign(this.#f,e.styles),this.#C(e.items),t()},this.#t.reject)};return this.#c=this.#g.getReader(),Ve.#_.add(this),t(),this.#t.promise}update({viewport:t,onBefore:e=null}){const n=t.scale*sn.pixelRatio,r=t.rotation;if(r!==this.#d&&(e?.(),this.#d=r,Hi(this.#l,{rotation:r})),n!==this.#h){e?.(),this.#h=n;const a={div:null,properties:null,ctx:Ve.#N(this.#a)};for(const o of this.#u)a.properties=this.#p.get(o),a.div=o,this.#x(a)}}cancel(){const t=new ri("TextLayer task cancelled.");this.#c?.cancel(t).catch(()=>{}),this.#c=null,this.#t.reject(t)}get textDivs(){return this.#u}get textContentItemsStr(){return this.#m}#C(t){if(this.#n)return;this.#r.ctx??=Ve.#N(this.#a);const e=this.#u,n=this.#m;for(const r of t){if(e.length>q1){xt("Ignoring additional textDivs for performance reasons."),this.#n=!0;return}if(r.str===void 0){if(r.type==="beginMarkedContentProps"||r.type==="beginMarkedContent"){const a=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),r.id&&this.#e.setAttribute("id",`${r.id}`),a.append(this.#e)}else r.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}n.push(r.str),this.#w(r)}}#w(t){const e=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#u.push(e);const r=at.transform(this.#b,t.transform);let a=Math.atan2(r[1],r[0]);const o=this.#f[t.fontName];o.vertical&&(a+=Math.PI/2);let u=this.#s&&o.fontSubstitution||o.fontFamily;u=Ve.fontFamilyMap.get(u)||u;const d=Math.hypot(r[2],r[3]),f=d*Ve.#B(u,o,this.#a);let p,m;a===0?(p=r[4],m=r[5]-f):(p=r[4]+f*Math.sin(a),m=r[5]-f*Math.cos(a));const y="calc(var(--total-scale-factor) *",v=e.style;this.#e===this.#l?(v.left=`${(100*p/this.#o).toFixed(2)}%`,v.top=`${(100*m/this.#i).toFixed(2)}%`):(v.left=`${y}${p.toFixed(2)}px)`,v.top=`${y}${m.toFixed(2)}px)`),v.fontSize=`${y}${(Ve.#S*d).toFixed(2)}px)`,v.fontFamily=u,n.fontSize=d,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#s&&(e.dataset.fontName=o.fontSubstitutionLoadedName||t.fontName),a!==0&&(n.angle=a*(180/Math.PI));let _=!1;if(t.str.length>1)_=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const w=Math.abs(t.transform[0]),S=Math.abs(t.transform[3]);w!==S&&Math.max(w,S)/Math.min(w,S)>1.5&&(_=!0)}if(_&&(n.canvasWidth=o.vertical?t.height:t.width),this.#p.set(e,n),this.#r.div=e,this.#r.properties=n,this.#x(this.#r),n.hasText&&this.#e.append(e),n.hasEOL){const w=document.createElement("br");w.setAttribute("role","presentation"),this.#e.append(w)}}#x(t){const{div:e,properties:n,ctx:r}=t,{style:a}=e;let o="";if(Ve.#S>1&&(o=`scale(${1/Ve.#S})`),n.canvasWidth!==0&&n.hasText){const{fontFamily:u}=a,{canvasWidth:d,fontSize:f}=n;Ve.#R(r,f*this.#h,u);const{width:p}=r.measureText(e.textContent);p>0&&(o=`scaleX(${d*this.#h/p}) ${o}`)}n.angle!==0&&(o=`rotate(${n.angle}deg) ${o}`),o.length>0&&(a.transform=o)}static cleanup(){if(!(this.#_.size>0)){this.#v.clear();for(const{canvas:t}of this.#y.values())t.remove();this.#y.clear()}}static#N(t=null){let e=this.#y.get(t||="");if(!e){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=t,document.body.append(n),e=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#y.set(t,e),this.#E.set(e,{size:0,family:""})}return e}static#R(t,e,n){const r=this.#E.get(t);e===r.size&&n===r.family||(t.font=`${e}px ${n}`,r.size=e,r.family=n)}static#O(){if(this.#S!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#S=t.getBoundingClientRect().height,t.remove()}static#B(t,e,n){const r=this.#v.get(t);if(r)return r;const a=this.#N(n);a.canvas.width=a.canvas.height=cy,this.#R(a,cy,t);const o=a.measureText(""),u=o.fontBoundingBoxAscent,d=Math.abs(o.fontBoundingBoxDescent);a.canvas.width=a.canvas.height=0;let f=.8;return u?f=u/(u+d):(Ue.platform.isFirefox&&xt("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?f=e.ascent:e.descent&&(f=1+e.descent)),this.#v.set(t,f),f}}const G1=100;function rw(c={}){typeof c=="string"||c instanceof URL?c={url:c}:(c instanceof ArrayBuffer||ArrayBuffer.isView(c))&&(c={data:c});const t=new Yf,{docId:e}=t,n=c.url?JE(c.url):null,r=c.data?ZE(c.data):null,a=c.httpHeaders||null,o=c.withCredentials===!0,u=c.password??null,d=c.range instanceof aw?c.range:null,f=Number.isInteger(c.rangeChunkSize)&&c.rangeChunkSize>0?c.rangeChunkSize:2**16;let p=c.worker instanceof To?c.worker:null;const m=c.verbosity,y=typeof c.docBaseUrl=="string"&&!Qc(c.docBaseUrl)?c.docBaseUrl:null,v=gc(c.cMapUrl),_=c.cMapPacked!==!1,w=c.CMapReaderFactory||(Xe?o1:Kb),S=gc(c.iccUrl),E=gc(c.standardFontDataUrl),R=c.StandardFontDataFactory||(Xe?l1:Wb),T=gc(c.wasmUrl),O=c.WasmFactory||(Xe?c1:Qb),N=c.stopAtErrors!==!0,k=Number.isInteger(c.maxImageSize)&&c.maxImageSize>-1?c.maxImageSize:-1,M=c.isEvalSupported!==!1,I=typeof c.isOffscreenCanvasSupported=="boolean"?c.isOffscreenCanvasSupported:!Xe,X=typeof c.isImageDecoderSupported=="boolean"?c.isImageDecoderSupported:!Xe&&(Ue.platform.isFirefox||!globalThis.chrome),Q=Number.isInteger(c.canvasMaxAreaInBytes)?c.canvasMaxAreaInBytes:-1,Z=typeof c.disableFontFace=="boolean"?c.disableFontFace:Xe,st=c.fontExtraProperties===!0,ht=c.enableXfa===!0,wt=c.ownerDocument||globalThis.document,_t=c.disableRange===!0,P=c.disableStream===!0,$=c.disableAutoFetch===!0,tt=c.pdfBug===!0,At=c.CanvasFactory||(Xe?a1:n1),Ot=c.FilterFactory||(Xe?r1:i1),j=c.enableHWA===!0,G=c.useWasm!==!1,J=d?d.length:c.length??NaN,et=typeof c.useSystemFonts=="boolean"?c.useSystemFonts:!Xe&&!Z,mt=typeof c.useWorkerFetch=="boolean"?c.useWorkerFetch:!!(w===Kb&&R===Wb&&O===Qb&&v&&E&&T&&fo(v,document.baseURI)&&fo(E,document.baseURI)&&fo(T,document.baseURI)),bt=null;TE(m);const ft={canvasFactory:new At({ownerDocument:wt,enableHWA:j}),filterFactory:new Ot({docId:e,ownerDocument:wt}),cMapReaderFactory:mt?null:new w({baseUrl:v,isCompressed:_}),standardFontDataFactory:mt?null:new R({baseUrl:E}),wasmFactory:mt?null:new O({baseUrl:T})};p||(p=To.create({verbosity:m,port:zi.workerPort}),t._worker=p);const Jt={docId:e,apiVersion:"5.4.449",data:r,password:u,disableAutoFetch:$,rangeChunkSize:f,length:J,docBaseUrl:y,enableXfa:ht,evaluatorOptions:{maxImageSize:k,disableFontFace:Z,ignoreErrors:N,isEvalSupported:M,isOffscreenCanvasSupported:I,isImageDecoderSupported:X,canvasMaxAreaInBytes:Q,fontExtraProperties:st,useSystemFonts:et,useWasm:G,useWorkerFetch:mt,cMapUrl:v,iccUrl:S,standardFontDataUrl:E,wasmUrl:T}},$t={ownerDocument:wt,pdfBug:tt,styleElement:bt,loadingParams:{disableAutoFetch:$,enableXfa:ht}};return p.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(p.destroyed)throw new Error("Worker was destroyed");const nn=p.messageHandler.sendWithPromise("GetDocRequest",Jt,r?[r.buffer]:null);let ys;if(d)ys=new C1(d,{disableRange:_t,disableStream:P});else if(!r){if(!n)throw new Error("getDocument - no `url` parameter provided.");const Ms=fo(n)?k1:Xe?z1:P1;ys=new Ms({url:n,length:J,httpHeaders:a,withCredentials:o,rangeChunkSize:f,disableRange:_t,disableStream:P})}return nn.then(Ms=>{if(t.destroyed)throw new Error("Loading aborted");if(p.destroyed)throw new Error("Worker was destroyed");const rn=new po(e,Ms,p.port),js=new Y1(rn,t,ys,$t,ft,j);t._transport=js,rn.send("Ready",null)})}).catch(t._capability.reject),t}class Yf{static#t=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${Yf.#t++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class aw{#t=Promise.withResolvers();#e=[];#n=[];#s=[];#a=[];constructor(t,e,n=!1,r=null){this.length=t,this.initialData=e,this.progressiveDone=n,this.contentDispositionFilename=r}addRangeListener(t){this.#a.push(t)}addProgressListener(t){this.#s.push(t)}addProgressiveReadListener(t){this.#n.push(t)}addProgressiveDoneListener(t){this.#e.push(t)}onDataRange(t,e){for(const n of this.#a)n(t,e)}onDataProgress(t,e){this.#t.promise.then(()=>{for(const n of this.#s)n(t,e)})}onDataProgressiveRead(t){this.#t.promise.then(()=>{for(const e of this.#n)e(t)})}onDataProgressiveDone(){this.#t.promise.then(()=>{for(const t of this.#e)t()})}transportReady(){this.#t.resolve()}requestDataRange(t,e){Qt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class V1{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Et(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(t,e){return this._transport.getAnnotationsByType(t,e)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}extractPages(t){return this._transport.extractPages(t)}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class X1{#t=!1;constructor(t,e,n,r=!1){this._pageIndex=t,this._pageInfo=e,this._transport=n,this._stats=r?new Hb:null,this._pdfBug=r,this.commonObjs=n.commonObjs,this.objs=new iw,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:n=0,offsetY:r=0,dontFlip:a=!1}={}){return new Mo({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:r,dontFlip:a})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Et(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,canvas:e=t.canvas,viewport:n,intent:r="display",annotationMode:a=ni.ENABLE,transform:o=null,background:u=null,optionalContentConfigPromise:d=null,annotationCanvasMap:f=null,pageColors:p=null,printAnnotationStorage:m=null,isEditing:y=!1,recordOperations:v=!1,operationsFilter:_=null}){this._stats?.time("Overall");const w=this._transport.getRenderingIntent(r,a,m,y),{renderingIntent:S,cacheKey:E}=w;this.#t=!1,d||=this._transport.getOptionalContentConfig(S);let R=this._intentStates.get(E);R||(R=Object.create(null),this._intentStates.set(E,R)),R.streamReaderCancelTimeout&&(clearTimeout(R.streamReaderCancelTimeout),R.streamReaderCancelTimeout=null);const T=!!(S&gs.PRINT);R.displayReadyCapability||(R.displayReadyCapability=Promise.withResolvers(),R.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(w));const O=!!(this._pdfBug&&globalThis.StepperManager?.enabled),N=!this.recordedBBoxes&&(v||O),k=X=>{if(R.renderTasks.delete(M),N){const Q=M.gfx?.dependencyTracker.take();Q&&(M.stepper&&M.stepper.setOperatorBBoxes(Q,M.gfx.dependencyTracker.takeDebugMetadata()),v&&(this.recordedBBoxes=Q))}T&&(this.#t=!0),this.#e(),X?(M.capability.reject(X),this._abortOperatorList({intentState:R,reason:X instanceof Error?X:new Error(X)})):M.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},M=new Yr({callback:k,params:{canvas:e,canvasContext:t,dependencyTracker:N?new h1(e,R.operatorList.length,O):null,viewport:n,transform:o,background:u},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:f,operatorList:R.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!T,pdfBug:this._pdfBug,pageColors:p,enableHWA:this._transport.enableHWA,operationsFilter:_});(R.renderTasks||=new Set).add(M);const I=M.task;return Promise.all([R.displayReadyCapability.promise,d]).then(([X,Q])=>{if(this.destroyed){k();return}if(this._stats?.time("Rendering"),!(Q.renderingIntent&S))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");M.initializeGraphics({transparency:X,optionalContentConfig:Q}),M.operatorListChanged()}).catch(k),I}getOperatorList({intent:t="display",annotationMode:e=ni.ENABLE,printAnnotationStorage:n=null,isEditing:r=!1}={}){function a(){u.operatorList.lastChunk&&(u.opListReadCapability.resolve(u.operatorList),u.renderTasks.delete(d))}const o=this._transport.getRenderingIntent(t,e,n,r,!0);let u=this._intentStates.get(o.cacheKey);u||(u=Object.create(null),this._intentStates.set(o.cacheKey,u));let d;return u.opListReadCapability||(d=Object.create(null),d.operatorListChanged=a,u.opListReadCapability=Promise.withResolvers(),(u.renderTasks||=new Set).add(d),u.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(o)),u.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(r){return r.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>Eo.textContent(n));const e=this.streamTextContent(t);return new Promise(function(n,r){function a(){o.read().then(function({value:d,done:f}){if(f){n(u);return}u.lang??=d.lang,Object.assign(u.styles,d.styles),u.items.push(...d.items),a()},r)}const o=e.getReader(),u={items:[],styles:Object.create(null),lang:null};a()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const n of e.renderTasks)t.push(n.completed),n.cancel();return this.objs.clear(),this.#t=!1,Promise.all(t)}cleanup(t=!1){this.#t=!0;const e=this.#e();return t&&e&&(this._stats&&=new Hb),e}#e(){if(!this.#t||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}_startRenderPage(t,e){const n=this._intentStates.get(e);n&&(this._stats?.timeEnd("Page Request"),n.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let n=0,r=t.length;n<r;n++)e.operatorList.fnArray.push(t.fnArray[n]),e.operatorList.argsArray.push(t.argsArray[n]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const n of e.renderTasks)n.operatorListChanged();t.lastChunk&&this.#e()}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:n,modifiedIds:r}){const{map:a,transfer:o}=n,d=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:a,modifiedIds:r},o).getReader(),f=this._intentStates.get(e);f.streamReader=d;const p=()=>{d.read().then(({value:m,done:y})=>{if(y){f.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(m,f),p())},m=>{if(f.streamReader=null,!this._transport.destroyed){if(f.operatorList){f.operatorList.lastChunk=!0;for(const y of f.renderTasks)y.operatorListChanged();this.#e()}if(f.displayReadyCapability)f.displayReadyCapability.reject(m);else if(f.opListReadCapability)f.opListReadCapability.reject(m);else throw m}})};p()}_abortOperatorList({intentState:t,reason:e,force:n=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!n){if(t.renderTasks.size>0)return;if(e instanceof Ff){let r=G1;e.extraDelay>0&&e.extraDelay<1e3&&(r+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},r);return}}if(t.streamReader.cancel(new ri(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[r,a]of this._intentStates)if(a===t){this._intentStates.delete(r);break}this.cleanup()}}}get stats(){return this._stats}}var ii,Hs,On,Ii,$c,Ui,Fi,Ke,Oc,ow,lw,go,ta,Nc;const ie=class ie{constructor({name:t=null,port:e=null,verbosity:n=CE()}={}){Ks(this,Ke);Ks(this,ii,Promise.withResolvers());Ks(this,Hs,null);Ks(this,On,null);Ks(this,Ii,null);if(this.name=t,this.destroyed=!1,this.verbosity=n,e){if(ne(ie,Fi).has(e))throw new Error("Cannot use more than one PDFWorker per port.");ne(ie,Fi).set(e,this),Ws(this,Ke,ow).call(this,e)}else Ws(this,Ke,lw).call(this)}get promise(){return ne(this,ii).promise}get port(){return ne(this,On)}get messageHandler(){return ne(this,Hs)}destroy(){this.destroyed=!0,ne(this,Ii)?.terminate(),ns(this,Ii,null),ne(ie,Fi).delete(ne(this,On)),ns(this,On,null),ne(this,Hs)?.destroy(),ns(this,Hs,null)}static create(t){const e=ne(this,Fi).get(t?.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new ie(t)}static get workerSrc(){if(zi.workerSrc)return zi.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Et(this,"_setupFakeWorkerGlobal",(async()=>ne(this,ta,Nc)?ne(this,ta,Nc):(await import(this.workerSrc)).WorkerMessageHandler)())}};ii=new WeakMap,Hs=new WeakMap,On=new WeakMap,Ii=new WeakMap,$c=new WeakMap,Ui=new WeakMap,Fi=new WeakMap,Ke=new WeakSet,Oc=function(){ne(this,ii).resolve(),ne(this,Hs).send("configure",{verbosity:this.verbosity})},ow=function(t){ns(this,On,t),ns(this,Hs,new po("main","worker",t)),ne(this,Hs).on("ready",()=>{}),Ws(this,Ke,Oc).call(this)},lw=function(){if(ne(ie,Ui)||ne(ie,ta,Nc)){Ws(this,Ke,go).call(this);return}let{workerSrc:t}=ie;try{ie._isSameOrigin(window.location,t)||(t=ie._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),n=new po("main","worker",e),r=()=>{a.abort(),n.destroy(),e.terminate(),this.destroyed?ne(this,ii).reject(new Error("Worker was destroyed")):Ws(this,Ke,go).call(this)},a=new AbortController;e.addEventListener("error",()=>{ne(this,Ii)||r()},{signal:a.signal}),n.on("test",u=>{if(a.abort(),this.destroyed||!u){r();return}ns(this,Hs,n),ns(this,On,e),ns(this,Ii,e),Ws(this,Ke,Oc).call(this)}),n.on("ready",u=>{if(a.abort(),this.destroyed){r();return}try{o()}catch{Ws(this,Ke,go).call(this)}});const o=()=>{const u=new Uint8Array;n.send("test",u,[u.buffer])};o();return}catch{Wc("The worker has been disabled.")}Ws(this,Ke,go).call(this)},go=function(){ne(ie,Ui)||(xt("Setting up fake worker."),ns(ie,Ui,!0)),ie._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){ne(this,ii).reject(new Error("Worker was destroyed"));return}const e=new s1;ns(this,On,e);const n=`fake${J0(ie,$c)._++}`,r=new po(n+"_worker",n,e);t.setup(r,e),ns(this,Hs,new po(n,n+"_worker",e)),Ws(this,Ke,Oc).call(this)}).catch(t=>{ne(this,ii).reject(new Error(`Setting up fake worker failed: "${t.message}".`))})},ta=new WeakSet,Nc=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},Ks(ie,ta),Ks(ie,$c,0),Ks(ie,Ui,!1),Ks(ie,Fi,new WeakMap),Xe&&(ns(ie,Ui,!0),zi.workerSrc||="./pdf.worker.mjs"),ie._isSameOrigin=(t,e)=>{const n=URL.parse(t);if(!n?.origin||n.origin==="null")return!1;const r=new URL(e,n);return n.origin===r.origin},ie._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},ie.fromPort=t=>{if(UE("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return ie.create(t)};let To=ie;class Y1{#t=new Map;#e=new Map;#n=new Map;#s=new Map;#a=null;constructor(t,e,n,r,a,o){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new iw,this.fontLoader=new WE({ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this.loadingParams=r.loadingParams,this._params=r,this.canvasFactory=a.canvasFactory,this.filterFactory=a.filterFactory,this.cMapReaderFactory=a.cMapReaderFactory,this.standardFontDataFactory=a.standardFontDataFactory,this.wasmFactory=a.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=o,this.setupMessageHandler()}#r(t,e=null){const n=this.#t.get(t);if(n)return n;const r=this.messageHandler.sendWithPromise(t,e);return this.#t.set(t,r),r}get annotationStorage(){return Et(this,"annotationStorage",new qf)}getRenderingIntent(t,e=ni.ENABLE,n=null,r=!1,a=!1){let o=gs.DISPLAY,u=yf;switch(t){case"any":o=gs.ANY;break;case"display":break;case"print":o=gs.PRINT;break;default:xt(`getRenderingIntent - invalid intent: ${t}`)}const d=o&gs.PRINT&&n instanceof Vv?n:this.annotationStorage;switch(e){case ni.DISABLE:o+=gs.ANNOTATIONS_DISABLE;break;case ni.ENABLE:break;case ni.ENABLE_FORMS:o+=gs.ANNOTATIONS_FORMS;break;case ni.ENABLE_STORAGE:o+=gs.ANNOTATIONS_STORAGE,u=d.serializable;break;default:xt(`getRenderingIntent - invalid annotationMode: ${e}`)}r&&(o+=gs.IS_EDITING),a&&(o+=gs.OPLIST);const{ids:f,hash:p}=d.modifiedIds,m=[o,u.hash,p];return{renderingIntent:o,cacheKey:m.join("_"),annotationStorageSerializable:u,modifiedIds:f}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#a?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const n of this.#e.values())t.push(n._destroy());this.#e.clear(),this.#n.clear(),this.#s.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),Ve.cleanup(),this._networkStream?.cancelAllRequests(new ri("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(n,r)=>{Pt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=a=>{this._lastProgress={loaded:a.loaded,total:a.total}},r.onPull=()=>{this._fullReader.read().then(function({value:a,done:o}){if(o){r.close();return}Pt(a instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{r.error(a)})},r.onCancel=a=>{this._fullReader.cancel(a),r.ready.catch(o=>{if(!this.destroyed)throw o})}}),t.on("ReaderHeadersReady",async n=>{await this._fullReader.headersReady;const{isStreamingSupported:r,isRangeSupported:a,contentLength:o}=this._fullReader;return(!r||!a)&&(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=u=>{e.onProgress?.({loaded:u.loaded,total:u.total})}),{isStreamingSupported:r,isRangeSupported:a,contentLength:o}}),t.on("GetRangeReader",(n,r)=>{Pt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const a=this._networkStream.getRangeReader(n.begin,n.end);if(!a){r.close();return}r.onPull=()=>{a.read().then(function({value:o,done:u}){if(u){r.close();return}Pt(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{r.error(o)})},r.onCancel=o=>{a.cancel(o),r.ready.catch(u=>{if(!this.destroyed)throw u})}}),t.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,e._capability.resolve(new V1(n,this))}),t.on("DocException",n=>{e._capability.reject(rs(n))}),t.on("PasswordRequest",n=>{this.#a=Promise.withResolvers();try{if(!e.onPassword)throw rs(n);const r=a=>{a instanceof Error?this.#a.reject(a):this.#a.resolve({password:a})};e.onPassword(r,n.code)}catch(r){this.#a.reject(r)}return this.#a.promise}),t.on("DataLoaded",n=>{e.onProgress?.({loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),t.on("StartRenderPage",n=>{if(this.destroyed)return;this.#e.get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),t.on("commonobj",([n,r,a])=>{if(this.destroyed||this.commonObjs.has(n))return null;switch(r){case"Font":if("error"in a){const m=a.error;xt(`Error during font loading: ${m}`),this.commonObjs.resolve(n,m);break}const o=new Kt(a),u=this._params.pdfBug&&globalThis.FontInspector?.enabled?(m,y)=>globalThis.FontInspector.fontAdded(m,y):null,d=new QE(o,u,a.extra,a.charProcOperatorList);this.fontLoader.bind(d).catch(()=>t.sendWithPromise("FontFallback",{id:n})).finally(()=>{!d.fontExtraProperties&&d.data&&d.clearData(),this.commonObjs.resolve(n,d)});break;case"CopyLocalImage":const{imageRef:f}=a;Pt(f,"The imageRef must be defined.");for(const m of this.#e.values())for(const[,y]of m.objs)if(y?.ref===f)return y.dataLen?(this.commonObjs.resolve(n,structuredClone(y)),y.dataLen):null;break;case"FontPath":case"Image":this.commonObjs.resolve(n,a);break;case"Pattern":const p=new Ee(a);this.commonObjs.resolve(n,p.getIR());break;default:throw new Error(`Got unknown common object type ${r}`)}return null}),t.on("obj",([n,r,a,o])=>{if(this.destroyed)return;const u=this.#e.get(r);if(!u.objs.has(n)){if(u._intentStates.size===0){o?.bitmap?.close();return}switch(a){case"Image":case"Pattern":u.objs.resolve(n,o);break;default:throw new Error(`Got unknown object type ${a}`)}}}),t.on("DocProgress",n=>{this.destroyed||e.onProgress?.({loaded:n.loaded,total:n.total})}),t.on("FetchBinaryData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");const r=this[n.type];if(!r)throw new Error(`${n.type} not initialized, see the \`useWorkerFetch\` parameter.`);return r.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&xt("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}extractPages(t){return this.messageHandler.sendWithPromise("ExtractPages",{pageInfos:t})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,n=this.#n.get(e);if(n)return n;const r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(a=>{if(this.destroyed)throw new Error("Transport destroyed");a.refStr&&this.#s.set(a.refStr,t);const o=new X1(e,a,this,this._params.pdfBug);return this.#e.set(e,o),o});return this.#n.set(e,r),r}getPageIndex(t){return vf(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#r("GetFieldObjects")}hasJSActions(){return this.#r("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(t,e){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:t,pageIndexesToSkip:e})}getDocJSActions(){return this.#r("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#r("GetOptionalContentConfig").then(e=>new T1(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#t.get(t);if(e)return e;const n=this.messageHandler.sendWithPromise(t,null).then(r=>({info:r[0],metadata:r[1]?new x1(r[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null,hasStructTree:r[2]}));return this.#t.set(t,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#e.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),Ve.cleanup()}}cachedPageNumber(t){if(!vf(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#s.get(e)??null}}class K1{#t=null;onContinue=null;onError=null;constructor(t){this.#t=t}get promise(){return this.#t.capability.promise}cancel(t=0){this.#t.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#t.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this.#t;return t.form||t.canvas&&e?.size>0}}class Yr{#t=null;static#e=new WeakSet;constructor({callback:t,params:e,objs:n,commonObjs:r,annotationCanvasMap:a,operatorList:o,pageIndex:u,canvasFactory:d,filterFactory:f,useRequestAnimationFrame:p=!1,pdfBug:m=!1,pageColors:y=null,enableHWA:v=!1,operationsFilter:_=null}){this.callback=t,this.params=e,this.objs=n,this.commonObjs=r,this.annotationCanvasMap=a,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=u,this.canvasFactory=d,this.filterFactory=f,this._pdfBug=m,this.pageColors=y,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=p===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new K1(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=v,this._dependencyTracker=e.dependencyTracker,this._operationsFilter=_}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(Yr.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Yr.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:n,transform:r,background:a,dependencyTracker:o}=this.params,u=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Zr(u,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors,o),this.gfx.beginDrawing({transform:r,viewport:n,transparency:t,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),Yr.#e.delete(this._canvas),t||=new Ff(`Rendering cancelled, page ${this._pageIndex+1}`,e),this.callback(t),this.task.onError?.(t)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Yr.#e.delete(this._canvas),this.callback())))}}const W1="5.4.449",Q1="f44e5f0e6";class ks{#t=null;#e=null;#n;#s=null;#a=!1;#r=!1;#i=null;#o;#c=null;#l=null;static#d=null;static get _keyboardManager(){return Et(this,"_keyboardManager",new Lo([[["Escape","mac+Escape"],ks.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],ks.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],ks.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],ks.prototype._moveToPrevious],[["Home","mac+Home"],ks.prototype._moveToBeginning],[["End","mac+End"],ks.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#r=!1,this.#i=t):this.#r=!0,this.#l=t?._uiManager||e,this.#o=this.#l._eventBus,this.#n=t?.color?.toUpperCase()||this.#l?.highlightColors.values().next().value||"#FFFF98",ks.#d||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#t=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",this.#i&&(t.ariaControls=`${this.#i.id}_colorpicker_dropdown`);const e=this.#l._signal;t.addEventListener("click",this.#g.bind(this),{signal:e}),t.addEventListener("keydown",this.#m.bind(this),{signal:e});const n=this.#e=document.createElement("span");return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=this.#n,t.append(n),t}renderMainDropdown(){const t=this.#s=this.#h();return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}#h(){const t=document.createElement("div"),e=this.#l._signal;t.addEventListener("contextmenu",Ds,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#i&&(t.id=`${this.#i.id}_colorpicker_dropdown`);for(const[n,r]of this.#l.highlightColors){const a=document.createElement("button");a.tabIndex="0",a.role="option",a.setAttribute("data-color",r),a.title=n,a.setAttribute("data-l10n-id",ks.#d[n]);const o=document.createElement("span");a.append(o),o.className="swatch",o.style.backgroundColor=r,a.ariaSelected=r===this.#n,a.addEventListener("click",this.#f.bind(this,r),{signal:e}),t.append(a)}return t.addEventListener("keydown",this.#m.bind(this),{signal:e}),t}#f(t,e){e.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:Lt.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)}_colorSelectFromKeyboard(t){if(t.target===this.#t){this.#g(t);return}const e=t.target.getAttribute("data-color");e&&this.#f(e,t)}_moveToNext(t){if(!this.#p){this.#g(t);return}if(t.target===this.#t){this.#s.firstElementChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#s?.firstElementChild||t.target===this.#t){this.#p&&this._hideDropdownFromKeyboard();return}this.#p||this.#g(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#p){this.#g(t);return}this.#s.firstElementChild?.focus()}_moveToEnd(t){if(!this.#p){this.#g(t);return}this.#s.lastElementChild?.focus()}#m(t){ks._keyboardManager.exec(this,t)}#g(t){if(this.#p){this.hideDropdown();return}if(this.#a=t.detail===0,this.#c||(this.#c=new AbortController,window.addEventListener("pointerdown",this.#u.bind(this),{signal:this.#l.combinedSignal(this.#c)})),this.#t.ariaExpanded="true",this.#s){this.#s.classList.remove("hidden");return}const e=this.#s=this.#h();this.#t.append(e)}#u(t){this.#s?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#s?.classList.add("hidden"),this.#t.ariaExpanded="false",this.#c?.abort(),this.#c=null}get#p(){return this.#s&&!this.#s.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#r){if(!this.#p){this.#i?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#a})}}updateColor(t){if(this.#e&&(this.#e.style.backgroundColor=t),!this.#s)return;const e=this.#l.highlightColors.values();for(const n of this.#s.children)n.ariaSelected=e.next().value===t.toUpperCase()}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#s?.remove(),this.#s=null}}class Co{#t=null;#e=null;#n=null;static#s=null;constructor(t){this.#e=t,this.#n=t._uiManager,Co.#s||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#t)return this.#t;const{editorType:t,colorType:e,color:n}=this.#e,r=this.#t=document.createElement("input");return r.type="color",r.value=n||"#000000",r.className="basicColorPicker",r.tabIndex=0,r.setAttribute("data-l10n-id",Co.#s[t]),r.addEventListener("input",()=>{this.#n.updateParams(e,r.value)},{signal:this.#n._signal}),r}update(t){this.#t&&(this.#t.value=t)}destroy(){this.#t?.remove(),this.#t=null}hideDropdown(){}}function uy(c){return Math.floor(Math.max(0,Math.min(1,c))*255).toString(16).padStart(2,"0")}function ao(c){return Math.max(0,Math.min(255,255*c))}class hy{static CMYK_G([t,e,n,r]){return["G",1-Math.min(1,.3*t+.59*n+.11*e+r)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=ao(t),[t,t,t]}static G_HTML([t]){const e=uy(t);return`#${e}${e}${e}`}static RGB_G([t,e,n]){return["G",.3*t+.59*e+.11*n]}static RGB_rgb(t){return t.map(ao)}static RGB_HTML(t){return`#${t.map(uy).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,n,r]){return["RGB",1-Math.min(1,t+r),1-Math.min(1,n+r),1-Math.min(1,e+r)]}static CMYK_rgb([t,e,n,r]){return[ao(1-Math.min(1,t+r)),ao(1-Math.min(1,n+r)),ao(1-Math.min(1,e+r))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,n]){const r=1-t,a=1-e,o=1-n,u=Math.min(r,a,o);return["CMYK",r,a,o,u]}}class J1{create(t,e,n=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const r=this._createSVG("svg:svg");return r.setAttribute("version","1.1"),n||(r.setAttribute("width",`${t}px`),r.setAttribute("height",`${e}px`)),r.setAttribute("preserveAspectRatio","none"),r.setAttribute("viewBox",`0 0 ${t} ${e}`),r}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){Qt("Abstract method `_createSVG` called.")}}class Hc extends J1{_createSVG(t){return document.createElementNS(Cn,t)}}const Z1=9,$i=new WeakSet,tT=new Date().getTimezoneOffset()*60*1e3;class Fd{static create(t){switch(t.data.annotationType){case ve.LINK:return new Kf(t);case ve.TEXT:return new sT(t);case ve.WIDGET:switch(t.data.fieldType){case"Tx":return new nT(t);case"Btn":return t.data.radioButton?new cw(t):t.data.checkBox?new rT(t):new aT(t);case"Ch":return new oT(t);case"Sig":return new iT(t)}return new Gi(t);case ve.POPUP:return new Af(t);case ve.FREETEXT:return new uw(t);case ve.LINE:return new cT(t);case ve.SQUARE:return new uT(t);case ve.CIRCLE:return new hT(t);case ve.POLYLINE:return new hw(t);case ve.CARET:return new fT(t);case ve.INK:return new Wf(t);case ve.POLYGON:return new dT(t);case ve.HIGHLIGHT:return new dw(t);case ve.UNDERLINE:return new pT(t);case ve.SQUIGGLY:return new gT(t);case ve.STRIKEOUT:return new mT(t);case ve.STAMP:return new fw(t);case ve.FILEATTACHMENT:return new bT(t);default:return new oe(t)}}}class oe{#t=null;#e=!1;#n=null;constructor(t,{isRenderable:e=!1,ignoreBorder:n=!1,createQuadrilaterals:r=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableComment=t.enableComment,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,this.hasOwnCommentButton=!1,e&&(this.contentElement=this.container=this._createContainer(n)),r&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t?.str||e?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return oe._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:t}=this,e=this.annotationStorage?.getEditor(t.id);return e?e.getData():t}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const t=this.annotationStorage?.getEditor(this.data.id);if(t)return t.commentButtonPositionInPage;const{quadPoints:e,inkLists:n,rect:r}=this.data;let a=-1/0,o=-1/0;if(e?.length>=8){for(let u=0;u<e.length;u+=8)e[u+1]>o?(o=e[u+1],a=e[u+2]):e[u+1]===o&&(a=Math.max(a,e[u+2]));return[a,o]}if(n?.length>=1){for(const u of n)for(let d=0,f=u.length;d<f;d+=2)u[d+1]>o?(o=u[d+1],a=u[d]):u[d+1]===o&&(a=Math.max(a,u[d]));if(a!==1/0)return[a,o]}return r?[r[2],r[3]]:null}_normalizePoint(t){const{page:{view:e},viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:a,pageY:o}}}=this.parent;return t[1]=e[3]-t[1]+e[1],t[0]=100*(t[0]-a)/n,t[1]=100*(t[1]-o)/r,t}get commentText(){const{data:t}=this;return this.annotationStorage.getRawValue(`${So}${t.id}`)?.popup?.contents||t.contentsObj?.str||""}set commentText(t){const{data:e}=this,n={deleted:!t,contents:t||""};this.annotationStorage.updateEditor(e.id,{popup:n})||this.annotationStorage.setValue(`${So}${e.id}`,{id:e.id,annotationType:e.annotationType,pageIndex:this.parent.page._pageIndex,popup:n,popupRef:e.popupRef,modificationDate:new Date}),t||this.removePopup()}removePopup(){(this.#n?.popup||this.popup)?.remove(),this.#n=this.popup=null}updateEdited(t){if(!this.container)return;t.rect&&(this.#t||={rect:this.data.rect.slice(0)});const{rect:e,popup:n}=t;e&&this.#s(e);let r=this.#n?.popup||this.popup;!r&&n?.text&&(this._createPopup(n),r=this.#n.popup),r&&(r.updateEdited(t),n?.deleted&&(r.remove(),this.#n=null,this.popup=null))}resetEdited(){this.#t&&(this.#s(this.#t.rect),this.#n?.popup.resetEdited(),this.#t=null)}#s(t){const{container:{style:e},data:{rect:n,rotation:r},parent:{viewport:{rawDims:{pageWidth:a,pageHeight:o,pageX:u,pageY:d}}}}=this;n?.splice(0,4,...t),e.left=`${100*(t[0]-u)/a}%`,e.top=`${100*(o-t[3]+d)/o}%`,r===0?(e.width=`${100*(t[2]-t[0])/a}%`,e.height=`${100*(t[3]-t[1])/o}%`):this.setRotation(r)}_createContainer(t){const{data:e,parent:{page:n,viewport:r}}=this,a=document.createElement("section");a.setAttribute("data-annotation-id",e.id),!(this instanceof Gi)&&!(this instanceof Kf)&&(a.tabIndex=0);const{style:o}=a;if(o.zIndex=this.parent.zIndex,this.parent.zIndex+=2,e.alternativeText&&(a.title=e.alternativeText),e.noRotate&&a.classList.add("norotate"),!e.rect||this instanceof Af){const{rotation:w}=e;return!e.hasOwnCanvas&&w!==0&&this.setRotation(w,a),a}const{width:u,height:d}=this;if(!t&&e.borderStyle.width>0){o.borderWidth=`${e.borderStyle.width}px`;const w=e.borderStyle.horizontalCornerRadius,S=e.borderStyle.verticalCornerRadius;if(w>0||S>0){const R=`calc(${w}px * var(--total-scale-factor)) / calc(${S}px * var(--total-scale-factor))`;o.borderRadius=R}else if(this instanceof cw){const R=`calc(${u}px * var(--total-scale-factor)) / calc(${d}px * var(--total-scale-factor))`;o.borderRadius=R}switch(e.borderStyle.style){case $r.SOLID:o.borderStyle="solid";break;case $r.DASHED:o.borderStyle="dashed";break;case $r.BEVELED:xt("Unimplemented border style: beveled");break;case $r.INSET:xt("Unimplemented border style: inset");break;case $r.UNDERLINE:o.borderBottomStyle="solid";break}const E=e.borderColor||null;E?(this.#e=!0,o.borderColor=at.makeHexColor(E[0]|0,E[1]|0,E[2]|0)):o.borderWidth=0}const f=at.normalizeRect([e.rect[0],n.view[3]-e.rect[1]+n.view[1],e.rect[2],n.view[3]-e.rect[3]+n.view[1]]),{pageWidth:p,pageHeight:m,pageX:y,pageY:v}=r.rawDims;o.left=`${100*(f[0]-y)/p}%`,o.top=`${100*(f[1]-v)/m}%`;const{rotation:_}=e;return e.hasOwnCanvas||_===0?(o.width=`${100*u/p}%`,o.height=`${100*d/m}%`):this.setRotation(_,a),a}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:r}=this.parent.viewport.rawDims;let{width:a,height:o}=this;t%180!==0&&([a,o]=[o,a]),e.style.width=`${100*a/n}%`,e.style.height=`${100*o/r}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,n,r)=>{const a=r.detail[e],o=a[0],u=a.slice(1);r.target.style[n]=hy[`${o}_HTML`](u),this.annotationStorage.setValue(this.data.id,{[n]:hy[`${o}_rgb`](u)})};return Et(this,"_commonActions",{display:e=>{const{display:n}=e.detail,r=n%2===1;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:r,noPrint:n===1||n===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:n}=e.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const n=e.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(t,e){const n=this._commonActions;for(const r of Object.keys(e.detail))(t[r]||n[r])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const n=this._commonActions;for(const[r,a]of Object.entries(e)){const o=n[r];if(o){const u={detail:{[r]:a},target:t};o(u),delete e[r]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,n,r,a]=this.data.rect.map(w=>Math.fround(w));if(t.length===8){const[w,S,E,R]=t.subarray(2,6);if(r===w&&a===S&&e===E&&n===R)return}const{style:o}=this.container;let u;if(this.#e){const{borderColor:w,borderWidth:S}=o;o.borderWidth=0,u=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${w}" stroke-width="${S}">`],this.container.classList.add("hasBorder")}const d=r-e,f=a-n,{svgFactory:p}=this,m=p.createElement("svg");m.classList.add("quadrilateralsContainer"),m.setAttribute("width",0),m.setAttribute("height",0),m.role="none";const y=p.createElement("defs");m.append(y);const v=p.createElement("clipPath"),_=`clippath_${this.data.id}`;v.setAttribute("id",_),v.setAttribute("clipPathUnits","objectBoundingBox"),y.append(v);for(let w=2,S=t.length;w<S;w+=8){const E=t[w],R=t[w+1],T=t[w+2],O=t[w+3],N=p.createElement("rect"),k=(T-e)/d,M=(a-R)/f,I=(E-T)/d,X=(R-O)/f;N.setAttribute("x",k),N.setAttribute("y",M),N.setAttribute("width",I),N.setAttribute("height",X),v.append(N),u?.push(`<rect vector-effect="non-scaling-stroke" x="${k}" y="${M}" width="${I}" height="${X}"/>`)}this.#e&&(u.push("</g></svg>')"),o.backgroundImage=u.join("")),this.container.append(m),this.container.style.clipPath=`url(#${_})`}_createPopup(t=null){const{data:e}=this;let n,r;t?(n={str:t.text},r=t.date):(n=e.contentsObj,r=e.modificationDate),this.#n=new Af({data:{color:e.color,titleObj:e.titleObj,modificationDate:r,contentsObj:n,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]})}get hasPopupElement(){return!!(this.#n||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#n}render(){Qt("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const n=[];if(this._fieldObjects){const r=this._fieldObjects[t];if(r)for(const{page:a,id:o,exportValues:u}of r){if(a===-1||o===e)continue;const d=typeof u=="string"?u:null,f=document.querySelector(`[data-element-id="${o}"]`);if(f&&!$i.has(f)){xt(`_getElementsByName - element not allowed: ${o}`);continue}n.push({id:o,exportValue:d,domElement:f})}return n}for(const r of document.getElementsByName(t)){const{exportValue:a}=r,o=r.getAttribute("data-element-id");o!==e&&$i.has(r)&&n.push({id:o,exportValue:a,domElement:r})}return n}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class eT extends oe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.editor=t.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:t}=this;t.hasComment&&this._createPopup(t.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(t){this.editor.comment=t,t||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}class Kf extends oe{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,n=document.createElement("a");n.setAttribute("data-element-id",t.id);let r=!1;return t.url?(e.addLinkAttributes(n,t.url,t.newWindow),r=!0):t.action?(this._bindNamedAction(n,t.action,t.overlaidText),r=!0):t.attachment?(this.#e(n,t.attachment,t.overlaidText,t.attachmentDest),r=!0):t.setOCGState?(this.#n(n,t.setOCGState,t.overlaidText),r=!0):t.dest?(this._bindLink(n,t.dest,t.overlaidText),r=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,t),r=!0),t.resetForm?(this._bindResetFormAction(n,t.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(n,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&(this.contentElement=n,this.container.append(n)),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e,n=""){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#t(),n&&(t.title=n)}_bindNamedAction(t,e,n=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),n&&(t.title=n),this.#t()}#e(t,e,n="",r=null){t.href=this.linkService.getAnchorUrl(""),e.description?t.title=e.description:n&&(t.title=n),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,r),!1),this.#t()}#n(t,e,n=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),n&&(t.title=n),this.#t()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(e.actions)){const a=n.get(r);a&&(t[a]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:r}}),!1))}e.overlaidText&&(t.title=e.overlaidText),t.onclick||(t.onclick=()=>!1),this.#t()}_bindResetFormAction(t,e){const n=t.onclick;if(n||(t.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){xt('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),n||(t.onclick=()=>!1);return}t.onclick=()=>{n?.();const{fields:r,refs:a,include:o}=e,u=[];if(r.length!==0||a.length!==0){const p=new Set(a);for(const m of r){const y=this._fieldObjects[m]||[];for(const{id:v}of y)p.add(v)}for(const m of Object.values(this._fieldObjects))for(const y of m)p.has(y.id)===o&&u.push(y)}else for(const p of Object.values(this._fieldObjects))u.push(...p);const d=this.annotationStorage,f=[];for(const p of u){const{id:m}=p;switch(f.push(m),p.type){case"text":{const v=p.defaultValue||"";d.setValue(m,{value:v});break}case"checkbox":case"radiobutton":{const v=p.defaultValue===p.exportValues;d.setValue(m,{value:v});break}case"combobox":case"listbox":{const v=p.defaultValue||"";d.setValue(m,{value:v});break}default:continue}const y=document.querySelector(`[data-element-id="${m}"]`);if(y){if(!$i.has(y)){xt(`_bindResetFormAction - element not allowed: ${m}`);continue}}else continue;y.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:f,name:"ResetForm"}}),!1}}}class sT extends oe{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(t),this.container}}class Gi extends oe{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return Ue.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,n,r,a){n.includes("mouse")?t.addEventListener(n,o=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:a(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):t.addEventListener(n,o=>{if(n==="blur"){if(!e.focused||!o.relatedTarget)return;e.focused=!1}else if(n==="focus"){if(e.focused)return;e.focused=!0}a&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:a(o)}})})}_setEventListeners(t,e,n,r){for(const[a,o]of n)(o==="Action"||this.data.actions?.[o])&&((o==="Focus"||o==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,a,o,r),o==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):o==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":at.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,r=this.data.defaultAppearanceData.fontSize||Z1,a=t.style;let o;const u=2,d=f=>Math.round(10*f)/10;if(this.data.multiLine){const f=Math.abs(this.data.rect[3]-this.data.rect[1]-u),p=Math.round(f/(Dd*r))||1,m=f/p;o=Math.min(r,d(m/Dd))}else{const f=Math.abs(this.data.rect[3]-this.data.rect[1]-u);o=Math.min(r,d(f/Dd))}a.fontSize=`calc(${o}px * var(--total-scale-factor))`,a.color=at.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(a.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class nT extends Gi{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,n,r){const a=this.annotationStorage;for(const o of this._getElementsByName(t.name,t.id))o.domElement&&(o.domElement[e]=n),a.setValue(o.id,{[r]:n})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const r=t.getValue(e,{value:this.data.fieldValue});let a=r.value||"";const o=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;o&&a.length>o&&(a=a.slice(0,o));let u=r.formattedValue||this.data.textContent?.join(`
`)||null;u&&this.data.comb&&(u=u.replaceAll(/\s+/g,""));const d={userValue:a,formattedValue:u,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=u??a,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",u??a),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),$i.add(n),this.contentElement=n,n.setAttribute("data-element-id",e),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const{datetimeFormat:f,datetimeType:p,timeStep:m}=this.data,y=!!p&&this.enableScripting;f&&(n.title=f),this._setRequired(n,this.data.required),o&&(n.maxLength=o),n.addEventListener("input",_=>{t.setValue(e,{value:_.target.value}),this.setPropertyOnSiblings(n,"value",_.target.value,"value"),d.formattedValue=null}),n.addEventListener("resetform",_=>{const w=this.data.defaultFieldValue??"";n.value=d.userValue=w,d.formattedValue=null});let v=_=>{const{formattedValue:w}=d;w!=null&&(_.target.value=w),_.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",w=>{if(d.focused)return;const{target:S}=w;if(y&&(S.type=p,m&&(S.step=m)),d.userValue){const E=d.userValue;if(y)if(p==="time"){const R=new Date(E),T=[R.getHours(),R.getMinutes(),R.getSeconds()];S.value=T.map(O=>O.toString().padStart(2,"0")).join(":")}else S.value=new Date(E-tT).toISOString().split(p==="date"?"T":".",1)[0];else S.value=E}d.lastCommittedValue=S.value,d.commitKey=1,this.data.actions?.Focus||(d.focused=!0)}),n.addEventListener("updatefromsandbox",w=>{this.showElementAndHideCanvas(w.target);const S={value(E){d.userValue=E.detail.value??"",y||t.setValue(e,{value:d.userValue.toString()}),E.target.value=d.userValue},formattedValue(E){const{formattedValue:R}=E.detail;d.formattedValue=R,R!=null&&E.target!==document.activeElement&&(E.target.value=R);const T={formattedValue:R};y&&(T.value=R),t.setValue(e,T)},selRange(E){E.target.setSelectionRange(...E.detail.selRange)},charLimit:E=>{const{charLimit:R}=E.detail,{target:T}=E;if(R===0){T.removeAttribute("maxLength");return}T.setAttribute("maxLength",R);let O=d.userValue;!O||O.length<=R||(O=O.slice(0,R),T.value=d.userValue=O,t.setValue(e,{value:O}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:O,willCommit:!0,commitKey:1,selStart:T.selectionStart,selEnd:T.selectionEnd}}))}};this._dispatchEventFromSandbox(S,w)}),n.addEventListener("keydown",w=>{d.commitKey=1;let S=-1;if(w.key==="Escape"?S=0:w.key==="Enter"&&!this.data.multiLine?S=2:w.key==="Tab"&&(d.commitKey=3),S===-1)return;const{value:E}=w.target;d.lastCommittedValue!==E&&(d.lastCommittedValue=E,d.userValue=E,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:E,willCommit:!0,commitKey:S,selStart:w.target.selectionStart,selEnd:w.target.selectionEnd}}))});const _=v;v=null,n.addEventListener("blur",w=>{if(!d.focused||!w.relatedTarget)return;this.data.actions?.Blur||(d.focused=!1);const{target:S}=w;let{value:E}=S;if(y){if(E&&p==="time"){const R=E.split(":").map(T=>parseInt(T,10));E=new Date(2e3,0,1,R[0],R[1],R[2]||0).valueOf(),S.step=""}else E.includes("T")||(E=`${E}T00:00`),E=new Date(E).valueOf();S.type="text"}d.userValue=E,d.lastCommittedValue!==E&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:E,willCommit:!0,commitKey:d.commitKey,selStart:w.target.selectionStart,selEnd:w.target.selectionEnd}}),_(w)}),this.data.actions?.Keystroke&&n.addEventListener("beforeinput",w=>{d.lastCommittedValue=null;const{data:S,target:E}=w,{value:R,selectionStart:T,selectionEnd:O}=E;let N=T,k=O;switch(w.inputType){case"deleteWordBackward":{const M=R.substring(0,T).match(/\w*[^\w]*$/);M&&(N-=M[0].length);break}case"deleteWordForward":{const M=R.substring(T).match(/^[^\w]*\w*/);M&&(k+=M[0].length);break}case"deleteContentBackward":T===O&&(N-=1);break;case"deleteContentForward":T===O&&(k+=1);break}w.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:R,change:S||"",willCommit:!1,selStart:N,selEnd:k}})}),this._setEventListeners(n,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],w=>w.target.value)}if(v&&n.addEventListener("blur",v),this.data.comb){const w=(this.data.rect[2]-this.data.rect[0])/o;n.classList.add("comb"),n.style.letterSpacing=`calc(${w}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class iT extends Gi{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class rT extends Gi{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,n=e.id;let r=t.getValue(n,{value:e.exportValue===e.fieldValue}).value;typeof r=="string"&&(r=r!=="Off",t.setValue(n,{value:r})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const a=document.createElement("input");return $i.add(a),a.setAttribute("data-element-id",n),a.disabled=e.readOnly,this._setRequired(a,this.data.required),a.type="checkbox",a.name=e.fieldName,r&&a.setAttribute("checked",!0),a.setAttribute("exportValue",e.exportValue),a.tabIndex=0,a.addEventListener("change",o=>{const{name:u,checked:d}=o.target;for(const f of this._getElementsByName(u,n)){const p=d&&f.exportValue===e.exportValue;f.domElement&&(f.domElement.checked=p),t.setValue(f.id,{value:p})}t.setValue(n,{value:d})}),a.addEventListener("resetform",o=>{const u=e.defaultFieldValue||"Off";o.target.checked=u===e.exportValue}),this.enableScripting&&this.hasJSActions&&(a.addEventListener("updatefromsandbox",o=>{const u={value(d){d.target.checked=d.detail.value!=="Off",t.setValue(n,{value:d.target.checked})}};this._dispatchEventFromSandbox(u,o)}),this._setEventListeners(a,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}class cw extends Gi{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,n=e.id;let r=t.getValue(n,{value:e.fieldValue===e.buttonValue}).value;if(typeof r=="string"&&(r=r!==e.buttonValue,t.setValue(n,{value:r})),r)for(const o of this._getElementsByName(e.fieldName,n))t.setValue(o.id,{value:!1});const a=document.createElement("input");if($i.add(a),a.setAttribute("data-element-id",n),a.disabled=e.readOnly,this._setRequired(a,this.data.required),a.type="radio",a.name=e.fieldName,r&&a.setAttribute("checked",!0),a.tabIndex=0,a.addEventListener("change",o=>{const{name:u,checked:d}=o.target;for(const f of this._getElementsByName(u,n))t.setValue(f.id,{value:!1});t.setValue(n,{value:d})}),a.addEventListener("resetform",o=>{const u=e.defaultFieldValue;o.target.checked=u!=null&&u===e.buttonValue}),this.enableScripting&&this.hasJSActions){const o=e.buttonValue;a.addEventListener("updatefromsandbox",u=>{const d={value:f=>{const p=o===f.detail.value;for(const m of this._getElementsByName(f.target.name)){const y=p&&m.id===n;m.domElement&&(m.domElement.checked=y),t.setValue(m.id,{value:y})}}};this._dispatchEventFromSandbox(d,u)}),this._setEventListeners(a,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],u=>u.target.checked)}return this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}class aT extends Kf{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),t}}class oT extends Gi{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,n=t.getValue(e,{value:this.data.fieldValue}),r=document.createElement("select");$i.add(r),r.setAttribute("data-element-id",e),r.disabled=this.data.readOnly,this._setRequired(r,this.data.required),r.name=this.data.fieldName,r.tabIndex=0;let a=this.data.combo&&this.data.options.length>0;this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0)),r.addEventListener("resetform",p=>{const m=this.data.defaultFieldValue;for(const y of r.options)y.selected=y.value===m});for(const p of this.data.options){const m=document.createElement("option");m.textContent=p.displayValue,m.value=p.exportValue,n.value.includes(p.exportValue)&&(m.setAttribute("selected",!0),a=!1),r.append(m)}let o=null;if(a){const p=document.createElement("option");p.value=" ",p.setAttribute("hidden",!0),p.setAttribute("selected",!0),r.prepend(p),o=()=>{p.remove(),r.removeEventListener("input",o),o=null},r.addEventListener("input",o)}const u=p=>{const m=p?"value":"textContent",{options:y,multiple:v}=r;return v?Array.prototype.filter.call(y,_=>_.selected).map(_=>_[m]):y.selectedIndex===-1?null:y[y.selectedIndex][m]};let d=u(!1);const f=p=>{const m=p.target.options;return Array.prototype.map.call(m,y=>({displayValue:y.textContent,exportValue:y.value}))};return this.enableScripting&&this.hasJSActions?(r.addEventListener("updatefromsandbox",p=>{const m={value(y){o?.();const v=y.detail.value,_=new Set(Array.isArray(v)?v:[v]);for(const w of r.options)w.selected=_.has(w.value);t.setValue(e,{value:u(!0)}),d=u(!1)},multipleSelection(y){r.multiple=!0},remove(y){const v=r.options,_=y.detail.remove;v[_].selected=!1,r.remove(_),v.length>0&&Array.prototype.findIndex.call(v,S=>S.selected)===-1&&(v[0].selected=!0),t.setValue(e,{value:u(!0),items:f(y)}),d=u(!1)},clear(y){for(;r.length!==0;)r.remove(0);t.setValue(e,{value:null,items:[]}),d=u(!1)},insert(y){const{index:v,displayValue:_,exportValue:w}=y.detail.insert,S=r.children[v],E=document.createElement("option");E.textContent=_,E.value=w,S?S.before(E):r.append(E),t.setValue(e,{value:u(!0),items:f(y)}),d=u(!1)},items(y){const{items:v}=y.detail;for(;r.length!==0;)r.remove(0);for(const _ of v){const{displayValue:w,exportValue:S}=_,E=document.createElement("option");E.textContent=w,E.value=S,r.append(E)}r.options.length>0&&(r.options[0].selected=!0),t.setValue(e,{value:u(!0),items:f(y)}),d=u(!1)},indices(y){const v=new Set(y.detail.indices);for(const _ of y.target.options)_.selected=v.has(_.index);t.setValue(e,{value:u(!0)}),d=u(!1)},editable(y){y.target.disabled=!y.detail.editable}};this._dispatchEventFromSandbox(m,p)}),r.addEventListener("input",p=>{const m=u(!0),y=u(!1);t.setValue(e,{value:m}),p.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:d,change:y,changeEx:m,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(r,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],p=>p.target.value)):r.addEventListener("input",function(p){t.setValue(e,{value:u(!0)})}),this.data.combo&&this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class Af extends oe{constructor(t){const{data:e,elements:n,parent:r}=t,a=!!r._commentManager;if(super(t,{isRenderable:!a&&oe._hasPopupData(e)}),this.elements=n,a&&oe._hasPopupData(e)){const o=this.popup=this.#t();for(const u of n)u.popup=o}else this.popup=null}#t(){return new lT({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=this.#t(),n=[];for(const r of this.elements)r.popup=e,r.container.ariaHasPopup="dialog",n.push(r.data.id),r.addHighlightArea();return this.container.setAttribute("aria-controls",n.map(r=>`${Vr}${r}`).join(",")),this.container}}class lT{#t=null;#e=this.#q.bind(this);#n=this.#U.bind(this);#s=this.#M.bind(this);#a=this.#A.bind(this);#r=null;#i=null;#o=null;#c=null;#l=null;#d=null;#h=null;#f=!1;#m=null;#g=null;#u=null;#p=null;#b=null;#v=null;#y=null;#E=null;#S=null;#_=null;#C=!1;#w=null;#x=null;constructor({container:t,color:e,elements:n,titleObj:r,modificationDate:a,contentsObj:o,richText:u,parent:d,rect:f,parentRect:p,open:m,commentManager:y=null}){this.#i=t,this.#S=r,this.#o=o,this.#E=u,this.#d=d,this.#r=e,this.#y=f,this.#h=p,this.#l=n,this.#t=y,this.#w=n[0],this.#c=gf.toDateObject(a),this.trigger=n.flatMap(v=>v.getElementsToTriggerPopup()),y||(this.#N(),this.#i.hidden=!0,m&&this.#A())}#N(){if(this.#g)return;this.#g=new AbortController;const{signal:t}=this.#g;for(const e of this.trigger)e.addEventListener("click",this.#a,{signal:t}),e.addEventListener("pointerenter",this.#s,{signal:t}),e.addEventListener("pointerleave",this.#n,{signal:t}),e.classList.add("popupTriggerArea");for(const e of this.#l)e.container?.addEventListener("keydown",this.#e,{signal:t})}#R(){const t=this.#l.find(e=>e.hasCommentButton);t&&(this.#b=t._normalizePoint(t.commentButtonPosition))}renderCommentButton(){if(this.#p){this.#p.parentNode||this.#w.container.after(this.#p);return}if(this.#b||this.#R(),!this.#b)return;const{signal:t}=this.#g=new AbortController,e=this.#w.hasOwnCommentButton,n=()=>{this.#t.toggleCommentPopup(this,!0,void 0,!e)},r=()=>{this.#t.toggleCommentPopup(this,!1,!0,!e)},a=()=>{this.#t.toggleCommentPopup(this,!1,!1)};if(e){this.#p=this.#w.container;for(const o of this.trigger)o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.addEventListener("keydown",this.#e,{signal:t}),o.addEventListener("click",n,{signal:t}),o.addEventListener("pointerenter",r,{signal:t}),o.addEventListener("pointerleave",a,{signal:t}),o.classList.add("popupTriggerArea")}else{const o=this.#p=document.createElement("button");o.className="annotationCommentButton";const u=this.#w.container;o.style.zIndex=u.style.zIndex+1,o.tabIndex=0,o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#B(),this.#O(),o.addEventListener("keydown",this.#e,{signal:t}),o.addEventListener("click",n,{signal:t}),o.addEventListener("pointerenter",r,{signal:t}),o.addEventListener("pointerleave",a,{signal:t}),u.after(o)}}#O(){if(this.#w.extraPopupElement&&!this.#w.editor)return;this.#p||this.renderCommentButton();const[t,e]=this.#b,{style:n}=this.#p;n.left=`calc(${t}%)`,n.top=`calc(${e}% - var(--comment-button-dim))`}#B(){this.#w.extraPopupElement||(this.#p||this.renderCommentButton(),this.#p.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:t,opacity:e}=this.#w.commentData;return t?this.#d._commentManager.makeCommentColor(t,e):null}focusCommentButton(){setTimeout(()=>{this.#p?.focus()},0)}getData(){const{richText:t,color:e,opacity:n,creationDate:r,modificationDate:a}=this.#w.commentData;return{contentsObj:{str:this.comment},richText:t,color:e,opacity:n,creationDate:r,modificationDate:a}}get elementBeforePopup(){return this.#p}get comment(){return this.#x||=this.#w.commentText,this.#x}set comment(t){t!==this.comment&&(this.#w.commentText=this.#x=t)}focus(){this.#w.container?.focus()}get parentBoundingClientRect(){return this.#w.layer.getBoundingClientRect()}setCommentButtonStates({selected:t,hasPopup:e}){this.#p&&(this.#p.classList.toggle("selected",t),this.#p.ariaExpanded=e)}setSelectedCommentButton(t){this.#p.classList.toggle("selected",t)}get commentPopupPosition(){if(this.#v)return this.#v;const{x:t,y:e,height:n}=this.#p.getBoundingClientRect(),{x:r,y:a,width:o,height:u}=this.#w.layer.getBoundingClientRect();return[(t-r)/o,(e+n-a)/u]}set commentPopupPosition(t){this.#v=t}hasDefaultPopupPosition(){return this.#v===null}get commentButtonPosition(){return this.#b}get commentButtonWidth(){return this.#p.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(t){const[e,n]=this.#v||this.commentButtonPosition.map(f=>f/100),r=this.parentBoundingClientRect,{x:a,y:o,width:u,height:d}=r;this.#t.showDialog(null,this,a+e*u,o+n*d,{...t,parentDimensions:r})}render(){if(this.#m)return;const t=this.#m=document.createElement("div");if(t.className="popup",this.#r){const n=t.style.outlineColor=at.makeHexColor(...this.#r);t.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`}const e=document.createElement("span");if(e.className="header",this.#S?.str){const n=document.createElement("span");n.className="title",e.append(n),{dir:n.dir,str:n.textContent}=this.#S}if(t.append(e),this.#c){const n=document.createElement("time");n.className="popupDate",n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#c.valueOf()})),n.dateTime=this.#c.toISOString(),e.append(n)}Hv({html:this.#D||this.#o.str,dir:this.#o?.dir,className:"popupContent"},t),this.#i.append(t)}get#D(){const t=this.#E,e=this.#o;return t?.str&&(!e?.str||e.str===t.str)&&this.#E.html||null}get#j(){return this.#D?.attributes?.style?.fontSize||0}get#I(){return this.#D?.attributes?.style?.color||null}#L(t){const e=[],n={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},r={style:{color:this.#I,fontSize:this.#j?`calc(${this.#j}px * var(--total-scale-factor))`:""}};for(const a of t.split(`
`))e.push({name:"span",value:a,attributes:r});return n}#q(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#f)&&this.#A()}updateEdited({rect:t,popup:e,deleted:n}){if(this.#t){n?(this.remove(),this.#x=null):e&&(e.deleted?this.remove():(this.#B(),this.#x=e.text)),t&&(this.#b=null,this.#R(),this.#O());return}if(n||e?.deleted){this.remove();return}this.#N(),this.#_||={contentsObj:this.#o,richText:this.#E},t&&(this.#u=null),e&&e.text&&(this.#E=this.#L(e.text),this.#c=gf.toDateObject(e.date),this.#o=null),this.#m?.remove(),this.#m=null}resetEdited(){this.#_&&({contentsObj:this.#o,richText:this.#E}=this.#_,this.#_=null,this.#m?.remove(),this.#m=null,this.#u=null)}remove(){if(this.#g?.abort(),this.#g=null,this.#m?.remove(),this.#m=null,this.#C=!1,this.#f=!1,this.#p?.remove(),this.#p=null,this.trigger)for(const t of this.trigger)t.classList.remove("popupTriggerArea")}#T(){if(this.#u!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:n,pageX:r,pageY:a}}}=this.#d;let o=!!this.#h,u=o?this.#h:this.#y;for(const _ of this.#l)if(!u||at.intersect(_.data.rect,u)!==null){u=_.data.rect,o=!0;break}const d=at.normalizeRect([u[0],t[3]-u[1]+t[1],u[2],t[3]-u[3]+t[1]]),p=o?u[2]-u[0]+5:0,m=d[0]+p,y=d[1];this.#u=[100*(m-r)/e,100*(y-a)/n];const{style:v}=this.#i;v.left=`${this.#u[0]}%`,v.top=`${this.#u[1]}%`}#A(){if(this.#t){this.#t.toggleCommentPopup(this,!1);return}this.#f=!this.#f,this.#f?(this.#M(),this.#i.addEventListener("click",this.#a),this.#i.addEventListener("keydown",this.#e)):(this.#U(),this.#i.removeEventListener("click",this.#a),this.#i.removeEventListener("keydown",this.#e))}#M(){this.#m||this.render(),this.isVisible?this.#f&&this.#i.classList.add("focused"):(this.#T(),this.#i.hidden=!1,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)+1e3)}#U(){this.#i.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#i.hidden=!0,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)-1e3)}forceHide(){this.#C=this.isVisible,this.#C&&(this.#i.hidden=!0)}maybeShow(){this.#t||(this.#N(),this.#C&&(this.#m||this.#M(),this.#C=!1,this.#i.hidden=!1))}get isVisible(){return this.#t?!1:this.#i.hidden===!1}}class uw extends oe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=Tt.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=this.contentElement=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const n=document.createElement("span");n.textContent=e,t.append(n)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class cT extends oe{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:t,width:e,height:n}=this,r=this.svgFactory.create(e,n,!0),a=this.#t=this.svgFactory.createElement("svg:line");return a.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),a.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),a.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),a.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),a.setAttribute("stroke-width",t.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class uT extends oe{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:t,width:e,height:n}=this,r=this.svgFactory.create(e,n,!0),a=t.borderStyle.width,o=this.#t=this.svgFactory.createElement("svg:rect");return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",e-a),o.setAttribute("height",n-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class hT extends oe{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:t,width:e,height:n}=this,r=this.svgFactory.create(e,n,!0),a=t.borderStyle.width,o=this.#t=this.svgFactory.createElement("svg:ellipse");return o.setAttribute("cx",e/2),o.setAttribute("cy",n/2),o.setAttribute("rx",e/2-a/2),o.setAttribute("ry",n/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class hw extends oe{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:n,popupRef:r},width:a,height:o}=this;if(!e)return this.container;const u=this.svgFactory.create(a,o,!0);let d=[];for(let p=0,m=e.length;p<m;p+=2){const y=e[p]-t[0],v=t[3]-e[p+1];d.push(`${y},${v}`)}d=d.join(" ");const f=this.#t=this.svgFactory.createElement(this.svgElementName);return f.setAttribute("points",d),f.setAttribute("stroke-width",n.width||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),u.append(f),this.container.append(u),!r&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class dT extends hw{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class fT extends oe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}class Wf extends oe{#t=null;#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Tt.HIGHLIGHT:Tt.INK}#n(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:n,borderStyle:r,popupRef:a}}=this,{transform:o,width:u,height:d}=this.#n(e,t),f=this.svgFactory.create(u,d,!0),p=this.#t=this.svgFactory.createElement("svg:g");f.append(p),p.setAttribute("stroke-width",r.width||1),p.setAttribute("stroke-linecap","round"),p.setAttribute("stroke-linejoin","round"),p.setAttribute("stroke-miterlimit",10),p.setAttribute("stroke","transparent"),p.setAttribute("fill","transparent"),p.setAttribute("transform",o);for(let m=0,y=n.length;m<y;m++){const v=this.svgFactory.createElement(this.svgElementName);this.#e.push(v),v.setAttribute("points",n[m].join(",")),p.append(v)}return!a&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(f),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:n,rect:r}=t,a=this.#t;if(e>=0&&a.setAttribute("stroke-width",e||1),n)for(let o=0,u=this.#e.length;o<u;o++)this.#e[o].setAttribute("points",n[o].join(","));if(r){const{transform:o,width:u,height:d}=this.#n(this.data.rotation,r);a.parentElement.setAttribute("viewBox",`0 0 ${u} ${d}`),a.setAttribute("transform",o)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class dw extends oe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Tt.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const n=document.createElement("mark");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class pT extends oe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),t){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class gT extends oe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),t){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class mT extends oe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),t){const n=document.createElement("s");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class fw extends oe{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Tt.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class bT extends oe{#t=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let n;e.hasAppearance||e.fillAlpha===0?n=document.createElement("div"):(n=document.createElement("img"),n.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(n.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),n.addEventListener("dblclick",this.#e.bind(this)),this.#t=n;const{isMac:r}=Ue.platform;return t.addEventListener("keydown",a=>{a.key==="Enter"&&(r?a.metaKey:a.ctrlKey)&&this.#e()}),!e.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):n.classList.add("popupTriggerArea"),t.append(n),t}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class Qf{#t=null;#e=null;#n=null;#s=new Map;#a=null;#r=null;#i=[];#o=!1;constructor({div:t,accessibilityManager:e,annotationCanvasMap:n,annotationEditorUIManager:r,page:a,viewport:o,structTreeLayer:u,commentManager:d,linkService:f,annotationStorage:p}){this.div=t,this.#t=e,this.#e=n,this.#a=u||null,this.#r=f||null,this.#n=p||new qf,this.page=a,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=r,this._commentManager=d||null}hasEditableAnnotations(){return this.#s.size>0}async render(t){const{annotations:e}=t,n=this.div;Hi(n,this.viewport);const r=new Map,a=[],o={data:null,layer:n,linkService:this.#r,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new Hc,annotationStorage:this.#n,enableComment:t.enableComment===!0,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const u of e){if(u.noHTML)continue;const d=u.annotationType===ve.POPUP;if(d){const m=r.get(u.id);if(!m)continue;if(!this._commentManager){a.push(u);continue}o.elements=m}else if(u.rect[2]===u.rect[0]||u.rect[3]===u.rect[1])continue;o.data=u;const f=Fd.create(o);if(!f.isRenderable)continue;if(!d&&(this.#i.push(f),u.popupRef)){const m=r.get(u.popupRef);m?m.push(f):r.set(u.popupRef,[f])}const p=f.render();u.hidden&&(p.style.visibility="hidden"),f._isEditable&&(this.#s.set(f.data.id,f),this._annotationEditorUIManager?.renderAnnotationElement(f))}await this.#c();for(const u of a){const d=o.elements=r.get(u.id);o.data=u;const f=Fd.create(o);if(!f.isRenderable)continue;const p=f.render();f.contentElement.id=`${Vr}${u.id}`,u.hidden&&(p.style.visibility="hidden"),d.at(-1).container.after(p)}this.#l()}async#c(){if(this.#i.length===0)return;this.div.replaceChildren();const t=[];if(!this.#o){this.#o=!0;for(const{contentElement:n,data:{id:r}}of this.#i){const a=n.id=`${Vr}${r}`;t.push(this.#a?.getAriaAttributes(a).then(o=>{if(o)for(const[u,d]of o)n.setAttribute(u,d)}))}}this.#i.sort(({data:{rect:[n,r,a,o]}},{data:{rect:[u,d,f,p]}})=>{if(n===a&&r===o)return 1;if(u===f&&d===p)return-1;const m=o,y=r,v=(r+o)/2,_=p,w=d,S=(d+p)/2;if(v>=_&&S<=y)return-1;if(S>=m&&v<=w)return 1;const E=(n+a)/2,R=(u+f)/2;return E-R});const e=document.createDocumentFragment();for(const n of this.#i)e.append(n.container),this._commentManager?(n.extraPopupElement?.popup||n.popup)?.renderCommentButton():n.extraPopupElement&&e.append(n.extraPopupElement.render());if(this.div.append(e),await Promise.all(t),this.#t)for(const n of this.#i)this.#t.addPointerInTextLayer(n.contentElement,!1)}async addLinkAnnotations(t){const e={data:null,layer:this.div,linkService:this.#r,svgFactory:new Hc,parent:this};for(const n of t){n.borderStyle||=Qf._defaultBorderStyle,e.data=n;const r=Fd.create(e);r.isRenderable&&(r.render(),r.contentElement.id=`${Vr}${n.id}`,this.#i.push(r))}await this.#c()}update({viewport:t}){const e=this.div;this.viewport=t,Hi(e,{rotation:t.rotation}),this.#l(),e.hidden=!1}#l(){if(!this.#e)return;const t=this.div;for(const[e,n]of this.#e){const r=t.querySelector(`[data-annotation-id="${e}"]`);if(!r)continue;n.className="annotationContent";const{firstChild:a}=r;a?a.nodeName==="CANVAS"?a.replaceWith(n):a.classList.contains("annotationContent")?a.after(n):a.before(n):r.append(n);const o=this.#s.get(e);o&&(o._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(e,r.id,n),o._hasNoCanvas=!1):o.canvas=n)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#s.values())}getEditableAnnotation(t){return this.#s.get(t)}addFakeAnnotation(t){const{div:e}=this,{id:n,rotation:r}=t,a=new eT({data:{id:n,rect:t.getPDFRect(),rotation:r},editor:t,layer:e,parent:this,enableComment:!!this._commentManager,linkService:this.#r,annotationStorage:this.#n});return a.render(),a.contentElement.id=`${Vr}${n}`,a.createOrUpdatePopup(),this.#i.push(a),a}removeAnnotation(t){const e=this.#i.findIndex(r=>r.data.id===t);if(e<0)return;const[n]=this.#i.splice(e,1);this.#t?.removePointerInTextLayer(n.contentElement)}updateFakeAnnotations(t){if(t.length!==0){for(const e of t)e.updateFakeAnnotationElement(this);this.#c()}}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}static get _defaultBorderStyle(){return Et(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:$r.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const _c=/\r\n?|\n/g;class Te extends gt{#t="";#e=`${this.id}-editor`;#n=null;#s;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=Te.prototype,e=a=>a.isEmpty(),n=ai.TRANSLATE_SMALL,r=ai.TRANSLATE_BIG;return Et(this,"_keyboardManager",new Lo([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-n,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[n,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[r,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-n],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,n],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,r],checker:e}]]))}static _type="freetext";static _editorType=Tt.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.color=t.color||Te._defaultColor||gt._defaultLineColor,this.#s=t.fontSize||Te._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static initialize(t,e){gt.initialize(t,e);const n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case Lt.FREETEXT_SIZE:Te._defaultFontSize=e;break;case Lt.FREETEXT_COLOR:Te._defaultColor=e;break}}updateParams(t,e){switch(t){case Lt.FREETEXT_SIZE:this.#a(e);break;case Lt.FREETEXT_COLOR:this.#r(e);break}}static get defaultPropertiesToUpdate(){return[[Lt.FREETEXT_SIZE,Te._defaultFontSize],[Lt.FREETEXT_COLOR,Te._defaultColor||gt._defaultLineColor]]}get propertiesToUpdate(){return[[Lt.FREETEXT_SIZE,this.#s],[Lt.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new Co(this),[["colorPicker",this._colorPicker]]}get colorType(){return Lt.FREETEXT_COLOR}#a(t){const e=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--total-scale-factor))`,this.translate(0,-(r-this.#s)*this.parentScale),this.#s=r,this.#o()},n=this.#s;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Lt.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#r(t){const e=r=>{this.color=r,this.onUpdatedColor()},n=this.color;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Lt.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-Te._internalPadding*t,-(Te._internalPadding+this.#s)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#n=new AbortController;const t=this._uiManager.combinedSignal(this.#n);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#e),this._isDraggable=!0,this.#n?.abort(),this.#n=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#i(){const t=[];this.editorDiv.normalize();let e=null;for(const n of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&n.nodeName==="BR"||(t.push(Te.#c(n)),e=n);return t.join(`
`)}#o(){const[t,e]=this.parentDimensions;let n;if(this.isAttachedToDOM)n=this.div.getBoundingClientRect();else{const{currentLayer:r,div:a}=this,o=a.style.display,u=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",r.div.append(this.div),n=a.getBoundingClientRect(),a.remove(),a.style.display=o,a.classList.toggle("hidden",u)}this.rotation%180===this.parentRotation%180?(this.width=n.width/t,this.height=n.height/e):(this.width=n.height/t,this.height=n.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#t,e=this.#t=this.#i().trimEnd();if(t===e)return;const n=r=>{if(this.#t=r,!r){this.remove();return}this.#l(),this._uiManager.rebuild(this),this.#o()};this.addCommands({cmd:()=>{n(e)},undo:()=>{n(t)},mustExec:!1}),this.#o()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Te._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,e;(this._isCopy||this.annotationElementId)&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#e),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:n}=this.editorDiv;if(n.fontSize=`calc(${this.#s}px * var(--total-scale-factor))`,n.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[r,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[u,d]=this.getInitialTranslation();[u,d]=this.pageTranslationToScreen(u,d);const[f,p]=this.pageDimensions,[m,y]=this.pageTranslation;let v,_;switch(this.rotation){case 0:v=t+(o[0]-m)/f,_=e+this.height-(o[1]-y)/p;break;case 90:v=t+(o[0]-m)/f,_=e-(o[1]-y)/p,[u,d]=[d,-u];break;case 180:v=t-this.width+(o[0]-m)/f,_=e-(o[1]-y)/p,[u,d]=[-u,-d];break;case 270:v=t+(o[0]-m-this.height*p)/f,_=e+(o[1]-y-this.width*f)/p,[u,d]=[-d,u];break}this.setAt(v*r,_*a,u,d)}else this._moveAfterPaste(t,e);this.#l(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(_c,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:n}=e;if(n.length===1&&n[0]==="text/plain")return;t.preventDefault();const r=Te.#h(e.getData("text")||"").replaceAll(_c,`
`);if(!r)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();const o=a.getRangeAt(0);if(!r.includes(`
`)){o.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),a.collapseToStart();return}const{startContainer:u,startOffset:d}=o,f=[],p=[];if(u.nodeType===Node.TEXT_NODE){const v=u.parentElement;if(p.push(u.nodeValue.slice(d).replaceAll(_c,"")),v!==this.editorDiv){let _=f;for(const w of this.editorDiv.childNodes){if(w===v){_=p;continue}_.push(Te.#c(w))}}f.push(u.nodeValue.slice(0,d).replaceAll(_c,""))}else if(u===this.editorDiv){let v=f,_=0;for(const w of this.editorDiv.childNodes)_++===d&&(v=p),v.push(Te.#c(w))}this.#t=`${f.join(`
`)}${r}${p.join(`
`)}`,this.#l();const m=new Range;let y=Math.sumPrecise(f.map(v=>v.length));for(const{firstChild:v}of this.editorDiv.childNodes)if(v.nodeType===Node.TEXT_NODE){const _=v.nodeValue.length;if(y<=_){m.setStart(v,y),m.setEnd(v,y);break}y-=_}a.removeAllRanges(),a.addRange(m)}#l(){if(this.editorDiv.replaceChildren(),!!this.#t)for(const t of this.#t.split(`
`)){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#d(){return this.#t.replaceAll(""," ")}static#h(t){return t.replaceAll(" ","")}get contentDiv(){return this.editorDiv}getPDFRect(){const t=Te._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,e,n){let r=null;if(t instanceof uw){const{data:{defaultAppearanceData:{fontSize:o,fontColor:u},rect:d,rotation:f,id:p,popupRef:m,richText:y,contentsObj:v,creationDate:_,modificationDate:w},textContent:S,textPosition:E,parent:{page:{pageNumber:R}}}=t;if(!S||S.length===0)return null;r=t={annotationType:Tt.FREETEXT,color:Array.from(u),fontSize:o,value:S.join(`
`),position:E,pageIndex:R-1,rect:d.slice(0),rotation:f,annotationElementId:p,id:p,deleted:!1,popupRef:m,comment:v?.str||null,richText:y,creationDate:_,modificationDate:w}}const a=await super.deserialize(t,e,n);return a.#s=t.fontSize,a.color=at.makeHexColor(...t.color),a.#t=Te.#h(t.value),a._initialData=r,t.comment&&a.setCommentData(t),a}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=gt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),n=Object.assign(super.serialize(t),{color:e,fontSize:this.#s,value:this.#d()});return this.addComment(n),t?(n.isCopy=!0,n):this.annotationElementId&&!this.#f(n)?null:(n.id=this.annotationElementId,n)}#f(t){const{value:e,fontSize:n,color:r,pageIndex:a}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==e||t.fontSize!==n||t.color.some((o,u)=>o!==r[u])||t.pageIndex!==a}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(!e)return null;const{style:n}=e;n.fontSize=`calc(${this.#s}px * var(--total-scale-factor))`,n.color=this.color,e.replaceChildren();for(const r of this.#t.split(`
`)){const a=document.createElement("div");a.append(r?document.createTextNode(r):document.createElement("br")),e.append(a)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#t}}),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class nt{static PRECISION=1e-4;toSVGPath(){Qt("Abstract method `toSVGPath` must be implemented.")}get box(){Qt("Abstract getter `box` must be implemented.")}serialize(t,e){Qt("Abstract method `serialize` must be implemented.")}static _rescale(t,e,n,r,a,o){o||=new Float32Array(t.length);for(let u=0,d=t.length;u<d;u+=2)o[u]=e+t[u]*r,o[u+1]=n+t[u+1]*a;return o}static _rescaleAndSwap(t,e,n,r,a,o){o||=new Float32Array(t.length);for(let u=0,d=t.length;u<d;u+=2)o[u]=e+t[u+1]*r,o[u+1]=n+t[u]*a;return o}static _translate(t,e,n,r){r||=new Float32Array(t.length);for(let a=0,o=t.length;a<o;a+=2)r[a]=e+t[a],r[a+1]=n+t[a+1];return r}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,n,r,a){switch(a){case 90:return[1-e/n,t/r];case 180:return[1-t/n,1-e/r];case 270:return[e/n,1-t/r];default:return[t/n,e/r]}}static _normalizePagePoint(t,e,n){switch(n){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,n,r,a,o){return[(t+5*n)/6,(e+5*r)/6,(5*n+a)/6,(5*r+o)/6,(n+a)/2,(r+o)/2]}}class Bi{#t;#e=[];#n;#s;#a=[];#r=new Float32Array(18);#i;#o;#c;#l;#d;#h;#f=[];static#m=8;static#g=2;static#u=Bi.#m+Bi.#g;constructor({x:t,y:e},n,r,a,o,u=0){this.#t=n,this.#h=a*r,this.#s=o,this.#r.set([NaN,NaN,NaN,NaN,t,e],6),this.#n=u,this.#l=Bi.#m*r,this.#c=Bi.#u*r,this.#d=r,this.#f.push(t,e)}isEmpty(){return isNaN(this.#r[8])}#p(){const t=this.#r.subarray(4,6),e=this.#r.subarray(16,18),[n,r,a,o]=this.#t;return[(this.#i+(t[0]-e[0])/2-n)/a,(this.#o+(t[1]-e[1])/2-r)/o,(this.#i+(e[0]-t[0])/2-n)/a,(this.#o+(e[1]-t[1])/2-r)/o]}add({x:t,y:e}){this.#i=t,this.#o=e;const[n,r,a,o]=this.#t;let[u,d,f,p]=this.#r.subarray(8,12);const m=t-f,y=e-p,v=Math.hypot(m,y);if(v<this.#c)return!1;const _=v-this.#l,w=_/v,S=w*m,E=w*y;let R=u,T=d;u=f,d=p,f+=S,p+=E,this.#f?.push(t,e);const O=-E/_,N=S/_,k=O*this.#h,M=N*this.#h;return this.#r.set(this.#r.subarray(2,8),0),this.#r.set([f+k,p+M],4),this.#r.set(this.#r.subarray(14,18),12),this.#r.set([f-k,p-M],16),isNaN(this.#r[6])?(this.#a.length===0&&(this.#r.set([u+k,d+M],2),this.#a.push(NaN,NaN,NaN,NaN,(u+k-n)/a,(d+M-r)/o),this.#r.set([u-k,d-M],14),this.#e.push(NaN,NaN,NaN,NaN,(u-k-n)/a,(d-M-r)/o)),this.#r.set([R,T,u,d,f,p],6),!this.isEmpty()):(this.#r.set([R,T,u,d,f,p],6),Math.abs(Math.atan2(T-d,R-u)-Math.atan2(E,S))<Math.PI/2?([u,d,f,p]=this.#r.subarray(2,6),this.#a.push(NaN,NaN,NaN,NaN,((u+f)/2-n)/a,((d+p)/2-r)/o),[u,d,R,T]=this.#r.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((R+u)/2-n)/a,((T+d)/2-r)/o),!0):([R,T,u,d,f,p]=this.#r.subarray(0,6),this.#a.push(((R+5*u)/6-n)/a,((T+5*d)/6-r)/o,((5*u+f)/6-n)/a,((5*d+p)/6-r)/o,((u+f)/2-n)/a,((d+p)/2-r)/o),[f,p,u,d,R,T]=this.#r.subarray(12,18),this.#e.push(((R+5*u)/6-n)/a,((T+5*d)/6-r)/o,((5*u+f)/6-n)/a,((5*d+p)/6-r)/o,((u+f)/2-n)/a,((d+p)/2-r)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const t=this.#a,e=this.#e;if(isNaN(this.#r[6])&&!this.isEmpty())return this.#b();const n=[];n.push(`M${t[4]} ${t[5]}`);for(let r=6;r<t.length;r+=6)isNaN(t[r])?n.push(`L${t[r+4]} ${t[r+5]}`):n.push(`C${t[r]} ${t[r+1]} ${t[r+2]} ${t[r+3]} ${t[r+4]} ${t[r+5]}`);this.#y(n);for(let r=e.length-6;r>=6;r-=6)isNaN(e[r])?n.push(`L${e[r+4]} ${e[r+5]}`):n.push(`C${e[r]} ${e[r+1]} ${e[r+2]} ${e[r+3]} ${e[r+4]} ${e[r+5]}`);return this.#v(n),n.join(" ")}#b(){const[t,e,n,r]=this.#t,[a,o,u,d]=this.#p();return`M${(this.#r[2]-t)/n} ${(this.#r[3]-e)/r} L${(this.#r[4]-t)/n} ${(this.#r[5]-e)/r} L${a} ${o} L${u} ${d} L${(this.#r[16]-t)/n} ${(this.#r[17]-e)/r} L${(this.#r[14]-t)/n} ${(this.#r[15]-e)/r} Z`}#v(t){const e=this.#e;t.push(`L${e[4]} ${e[5]} Z`)}#y(t){const[e,n,r,a]=this.#t,o=this.#r.subarray(4,6),u=this.#r.subarray(16,18),[d,f,p,m]=this.#p();t.push(`L${(o[0]-e)/r} ${(o[1]-n)/a} L${d} ${f} L${p} ${m} L${(u[0]-e)/r} ${(u[1]-n)/a}`)}newFreeDrawOutline(t,e,n,r,a,o){return new pw(t,e,n,r,a,o)}getOutlines(){const t=this.#a,e=this.#e,n=this.#r,[r,a,o,u]=this.#t,d=new Float32Array((this.#f?.length??0)+2);for(let m=0,y=d.length-2;m<y;m+=2)d[m]=(this.#f[m]-r)/o,d[m+1]=(this.#f[m+1]-a)/u;if(d[d.length-2]=(this.#i-r)/o,d[d.length-1]=(this.#o-a)/u,isNaN(n[6])&&!this.isEmpty())return this.#E(d);const f=new Float32Array(this.#a.length+24+this.#e.length);let p=t.length;for(let m=0;m<p;m+=2){if(isNaN(t[m])){f[m]=f[m+1]=NaN;continue}f[m]=t[m],f[m+1]=t[m+1]}p=this.#_(f,p);for(let m=e.length-6;m>=6;m-=6)for(let y=0;y<6;y+=2){if(isNaN(e[m+y])){f[p]=f[p+1]=NaN,p+=2;continue}f[p]=e[m+y],f[p+1]=e[m+y+1],p+=2}return this.#S(f,p),this.newFreeDrawOutline(f,d,this.#t,this.#d,this.#n,this.#s)}#E(t){const e=this.#r,[n,r,a,o]=this.#t,[u,d,f,p]=this.#p(),m=new Float32Array(36);return m.set([NaN,NaN,NaN,NaN,(e[2]-n)/a,(e[3]-r)/o,NaN,NaN,NaN,NaN,(e[4]-n)/a,(e[5]-r)/o,NaN,NaN,NaN,NaN,u,d,NaN,NaN,NaN,NaN,f,p,NaN,NaN,NaN,NaN,(e[16]-n)/a,(e[17]-r)/o,NaN,NaN,NaN,NaN,(e[14]-n)/a,(e[15]-r)/o],0),this.newFreeDrawOutline(m,t,this.#t,this.#d,this.#n,this.#s)}#S(t,e){const n=this.#e;return t.set([NaN,NaN,NaN,NaN,n[4],n[5]],e),e+=6}#_(t,e){const n=this.#r.subarray(4,6),r=this.#r.subarray(16,18),[a,o,u,d]=this.#t,[f,p,m,y]=this.#p();return t.set([NaN,NaN,NaN,NaN,(n[0]-a)/u,(n[1]-o)/d,NaN,NaN,NaN,NaN,f,p,NaN,NaN,NaN,NaN,m,y,NaN,NaN,NaN,NaN,(r[0]-a)/u,(r[1]-o)/d],e),e+=24}}class pw extends nt{#t;#e=new Float32Array(4);#n;#s;#a;#r;#i;constructor(t,e,n,r,a,o){super(),this.#i=t,this.#a=e,this.#t=n,this.#r=r,this.#n=a,this.#s=o,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#o(o);const[u,d,f,p]=this.#e;for(let m=0,y=t.length;m<y;m+=2)t[m]=(t[m]-u)/f,t[m+1]=(t[m+1]-d)/p;for(let m=0,y=e.length;m<y;m+=2)e[m]=(e[m]-u)/f,e[m+1]=(e[m+1]-d)/p}toSVGPath(){const t=[`M${this.#i[4]} ${this.#i[5]}`];for(let e=6,n=this.#i.length;e<n;e+=6){if(isNaN(this.#i[e])){t.push(`L${this.#i[e+4]} ${this.#i[e+5]}`);continue}t.push(`C${this.#i[e]} ${this.#i[e+1]} ${this.#i[e+2]} ${this.#i[e+3]} ${this.#i[e+4]} ${this.#i[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,n,r],a){const o=n-t,u=r-e;let d,f;switch(a){case 0:d=nt._rescale(this.#i,t,r,o,-u),f=nt._rescale(this.#a,t,r,o,-u);break;case 90:d=nt._rescaleAndSwap(this.#i,t,e,o,u),f=nt._rescaleAndSwap(this.#a,t,e,o,u);break;case 180:d=nt._rescale(this.#i,n,e,-o,u),f=nt._rescale(this.#a,n,e,-o,u);break;case 270:d=nt._rescaleAndSwap(this.#i,n,r,-o,-u),f=nt._rescaleAndSwap(this.#a,n,r,-o,-u);break}return{outline:Array.from(d),points:[Array.from(f)]}}#o(t){const e=this.#i;let n=e[4],r=e[5];const a=[n,r,n,r];let o=n,u=r,d=n,f=r;const p=t?Math.max:Math.min,m=new Float32Array(4);for(let v=6,_=e.length;v<_;v+=6){const w=e[v+4],S=e[v+5];isNaN(e[v])?(at.pointBoundingBox(w,S,a),u>S?(o=w,u=S):u===S&&(o=p(o,w)),f<S?(d=w,f=S):f===S&&(d=p(d,w))):(m[0]=m[1]=1/0,m[2]=m[3]=-1/0,at.bezierBoundingBox(n,r,...e.slice(v,v+6),m),at.rectBoundingBox(m[0],m[1],m[2],m[3],a),u>m[1]?(o=m[0],u=m[1]):u===m[1]&&(o=p(o,m[0])),f<m[3]?(d=m[2],f=m[3]):f===m[3]&&(d=p(d,m[2]))),n=w,r=S}const y=this.#e;y[0]=a[0]-this.#n,y[1]=a[1]-this.#n,y[2]=a[2]-a[0]+2*this.#n,y[3]=a[3]-a[1]+2*this.#n,this.firstPoint=[o,u],this.lastPoint=[d,f]}get box(){return this.#e}newOutliner(t,e,n,r,a,o=0){return new Bi(t,e,n,r,a,o)}getNewOutline(t,e){const[n,r,a,o]=this.#e,[u,d,f,p]=this.#t,m=a*f,y=o*p,v=n*f+u,_=r*p+d,w=this.newOutliner({x:this.#a[0]*m+v,y:this.#a[1]*y+_},this.#t,this.#r,t,this.#s,e??this.#n);for(let S=2;S<this.#a.length;S+=2)w.add({x:this.#a[S]*m+v,y:this.#a[S+1]*y+_});return w.getOutlines()}}class Sf{#t;#e;#n;#s=[];#a=[];constructor(t,e=0,n=0,r=!0){const a=[1/0,1/0,-1/0,-1/0],o=10**-4;for(const{x:w,y:S,width:E,height:R}of t){const T=Math.floor((w-e)/o)*o,O=Math.ceil((w+E+e)/o)*o,N=Math.floor((S-e)/o)*o,k=Math.ceil((S+R+e)/o)*o,M=[T,N,k,!0],I=[O,N,k,!1];this.#s.push(M,I),at.rectBoundingBox(T,N,O,k,a)}const u=a[2]-a[0]+2*n,d=a[3]-a[1]+2*n,f=a[0]-n,p=a[1]-n;let m=r?-1/0:1/0,y=1/0;const v=this.#s.at(r?-1:-2),_=[v[0],v[2]];for(const w of this.#s){const[S,E,R,T]=w;!T&&r?E<y?(y=E,m=S):E===y&&(m=Math.max(m,S)):T&&!r&&(E<y?(y=E,m=S):E===y&&(m=Math.min(m,S))),w[0]=(S-f)/u,w[1]=(E-p)/d,w[2]=(R-p)/d}this.#t=new Float32Array([f,p,u,d]),this.#e=[m,y],this.#n=_}getOutlines(){this.#s.sort((e,n)=>e[0]-n[0]||e[1]-n[1]||e[2]-n[2]);const t=[];for(const e of this.#s)e[3]?(t.push(...this.#l(e)),this.#o(e)):(this.#c(e),t.push(...this.#l(e)));return this.#r(t)}#r(t){const e=[],n=new Set;for(const o of t){const[u,d,f]=o;e.push([u,d,o],[u,f,o])}e.sort((o,u)=>o[1]-u[1]||o[0]-u[0]);for(let o=0,u=e.length;o<u;o+=2){const d=e[o][2],f=e[o+1][2];d.push(f),f.push(d),n.add(d),n.add(f)}const r=[];let a;for(;n.size>0;){const o=n.values().next().value;let[u,d,f,p,m]=o;n.delete(o);let y=u,v=d;for(a=[u,f],r.push(a);;){let _;if(n.has(p))_=p;else if(n.has(m))_=m;else break;n.delete(_),[u,d,f,p,m]=_,y!==u&&(a.push(y,v,u,v===d?d:f),y=u),v=v===d?f:d}a.push(y,v)}return new yT(r,this.#t,this.#e,this.#n)}#i(t){const e=this.#a;let n=0,r=e.length-1;for(;n<=r;){const a=n+r>>1,o=e[a][0];if(o===t)return a;o<t?n=a+1:r=a-1}return r+1}#o([,t,e]){const n=this.#i(t);this.#a.splice(n,0,[t,e])}#c([,t,e]){const n=this.#i(t);for(let r=n;r<this.#a.length;r++){const[a,o]=this.#a[r];if(a!==t)break;if(a===t&&o===e){this.#a.splice(r,1);return}}for(let r=n-1;r>=0;r--){const[a,o]=this.#a[r];if(a!==t)break;if(a===t&&o===e){this.#a.splice(r,1);return}}}#l(t){const[e,n,r]=t,a=[[e,n,r]],o=this.#i(r);for(let u=0;u<o;u++){const[d,f]=this.#a[u];for(let p=0,m=a.length;p<m;p++){const[,y,v]=a[p];if(!(f<=y||v<=d)){if(y>=d){if(v>f)a[p][1]=f;else{if(m===1)return[];a.splice(p,1),p--,m--}continue}a[p][2]=d,v>f&&a.push([e,f,v])}}}return a}}class yT extends nt{#t;#e;constructor(t,e,n,r){super(),this.#e=t,this.#t=e,this.firstPoint=n,this.lastPoint=r}toSVGPath(){const t=[];for(const e of this.#e){let[n,r]=e;t.push(`M${n} ${r}`);for(let a=2;a<e.length;a+=2){const o=e[a],u=e[a+1];o===n?(t.push(`V${u}`),r=u):u===r&&(t.push(`H${o}`),n=o)}t.push("Z")}return t.join(" ")}serialize([t,e,n,r],a){const o=[],u=n-t,d=r-e;for(const f of this.#e){const p=new Array(f.length);for(let m=0;m<f.length;m+=2)p[m]=t+f[m]*u,p[m+1]=r-f[m+1]*d;o.push(p)}return o}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}}class xf extends Bi{newFreeDrawOutline(t,e,n,r,a,o){return new vT(t,e,n,r,a,o)}}class vT extends pw{newOutliner(t,e,n,r,a,o=0){return new xf(t,e,n,r,a,o)}}class fe extends gt{#t=null;#e=0;#n;#s=null;#a=null;#r=null;#i=null;#o=0;#c=null;#l=null;#d=null;#h=!1;#f=null;#m=null;#g=null;#u="";#p;#b="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=Tt.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=fe.prototype;return Et(this,"_keyboardManager",new Lo([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||fe._defaultColor,this.#p=t.thickness||fe._defaultThickness,this.opacity=t.opacity||fe._defaultOpacity,this.#n=t.boxes||null,this.#b=t.methodOfCreation||"",this.#u=t.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(this.#h=!0,this.#y(t),this.#w()):this.#n&&(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#i=t.focusNode,this.#o=t.focusOffset,this.#v(),this.#w(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#h?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#p,methodOfCreation:this.#b}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#v(){const t=new Sf(this.#n,.001);this.#l=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#l.box;const e=new Sf(this.#n,.0025,.001,this._uiManager.direction==="ltr");this.#r=e.getOutlines();const{firstPoint:n}=this.#l;this.#f=[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height];const{lastPoint:r}=this.#r;this.#m=[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height]}#y({highlightOutlines:t,highlightId:e,clipPathId:n}){this.#l=t;const r=1.5;if(this.#r=t.getNewOutline(this.#p/2+r,.0025),e>=0)this.#d=e,this.#s=n,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#g=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#r.box,path:{d:this.#r.toSVGPath()}},!0);else if(this.parent){const m=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#d,{bbox:fe.#x(this.#l.box,(m-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#g,{bbox:fe.#x(this.#r.box,m),path:{d:this.#r.toSVGPath()}})}const[a,o,u,d]=t.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=u,this.height=d;break;case 90:{const[m,y]=this.parentDimensions;this.x=o,this.y=1-a,this.width=u*y/m,this.height=d*m/y;break}case 180:this.x=1-a,this.y=1-o,this.width=u,this.height=d;break;case 270:{const[m,y]=this.parentDimensions;this.x=1-o,this.y=a,this.width=u*y/m,this.height=d*m/y;break}}const{firstPoint:f}=t;this.#f=[(f[0]-a)/u,(f[1]-o)/d];const{lastPoint:p}=this.#r;this.#m=[(p[0]-a)/u,(p[1]-o)/d]}static initialize(t,e){gt.initialize(t,e),fe._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case Lt.HIGHLIGHT_COLOR:fe._defaultColor=e;break;case Lt.HIGHLIGHT_THICKNESS:fe._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#m}get commentButtonPosition(){return this.#f}updateParams(t,e){switch(t){case Lt.HIGHLIGHT_COLOR:this.#E(e);break;case Lt.HIGHLIGHT_THICKNESS:this.#S(e);break}}static get defaultPropertiesToUpdate(){return[[Lt.HIGHLIGHT_COLOR,fe._defaultColor],[Lt.HIGHLIGHT_THICKNESS,fe._defaultThickness]]}get propertiesToUpdate(){return[[Lt.HIGHLIGHT_COLOR,this.color||fe._defaultColor],[Lt.HIGHLIGHT_THICKNESS,this.#p||fe._defaultThickness],[Lt.HIGHLIGHT_FREE,this.#h]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#d,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#a?.updateColor(this.color),super.onUpdatedColor()}#E(t){const e=(a,o)=>{this.color=a,this.opacity=o,this.onUpdatedColor()},n=this.color,r=this.opacity;this.addCommands({cmd:e.bind(this,t,fe._defaultOpacity),undo:e.bind(this,n,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Lt.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)}#S(t){const e=this.#p,n=r=>{this.#p=r,this.#_(r)};this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Lt.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#a=new ks({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#O())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#O())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#C(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#w(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#C():t&&(this.#w(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#_(t){this.#h&&(this.#y({highlightOutlines:this.#l.getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims())}#C(){this.#d===null||!this.parent||(this.parent.drawLayer.remove(this.#d),this.#d=null,this.parent.drawLayer.remove(this.#g),this.#g=null)}#w(t=this.parent){this.#d===null&&({id:this.#d,clipPathId:this.#s}=t.drawLayer.draw({bbox:this.#l.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#h},path:{d:this.#l.toSVGPath()}},!1,!0),this.#g=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#h},bbox:this.#r.box,path:{d:this.#r.toSVGPath()}},this.#h),this.#c&&(this.#c.style.clipPath=this.#s))}static#x([t,e,n,r],a){switch(a){case 90:return[1-e-r,t,r,n];case 180:return[1-t-n,1-e-r,n,r];case 270:return[e,1-t-n,r,n]}return[t,e,n,r]}rotate(t){const{drawLayer:e}=this.parent;let n;this.#h?(t=(t-this.rotation+360)%360,n=fe.#x(this.#l.box,t)):n=fe.#x([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#d,{bbox:n,root:{"data-main-rotation":t}}),e.updateProperties(this.#g,{bbox:fe.#x(this.#r.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();this.#u&&(t.setAttribute("aria-label",this.#u),t.setAttribute("role","mark")),this.#h?t.classList.add("free"):this.div.addEventListener("keydown",this.#N.bind(this),{signal:this._uiManager._signal});const e=this.#c=document.createElement("div");return t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#s,this.setDims(),qv(this,this.#c,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!1}})}#N(t){fe._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#R(!0);break;case 1:case 3:this.#R(!1);break}}#R(t){if(!this.#t)return;const e=window.getSelection();t?e.setPosition(this.#t,this.#e):e.setPosition(this.#i,this.#o)}select(){super.select(),this.#g&&this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#g&&(this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{selected:!1}}),this.#h||this.#R(!1))}get _mustFixPosition(){return!this.#h}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#d,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#g,{rootClass:{hidden:!t}}))}#O(){return this.#h?this.rotation:0}#B(){if(this.#h)return null;const[t,e]=this.pageDimensions,[n,r]=this.pageTranslation,a=this.#n,o=new Float32Array(a.length*8);let u=0;for(const{x:d,y:f,width:p,height:m}of a){const y=d*t+n,v=(1-f)*e+r;o[u]=o[u+4]=y,o[u+1]=o[u+3]=v,o[u+2]=o[u+6]=y+p*t,o[u+5]=o[u+7]=v-m*e,u+=8}return o}#D(t){return this.#l.serialize(t,this.#O())}static startHighlighting(t,e,{target:n,x:r,y:a}){const{x:o,y:u,width:d,height:f}=n.getBoundingClientRect(),p=new AbortController,m=t.combinedSignal(p),y=v=>{p.abort(),this.#I(t,v)};window.addEventListener("blur",y,{signal:m}),window.addEventListener("pointerup",y,{signal:m}),window.addEventListener("pointerdown",ue,{capture:!0,passive:!1,signal:m}),window.addEventListener("contextmenu",Ds,{signal:m}),n.addEventListener("pointermove",this.#j.bind(this,t),{signal:m}),this._freeHighlight=new xf({x:r,y:a},[o,u,d,f],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#j(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#I(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,n){let r=null;if(t instanceof dw){const{data:{quadPoints:_,rect:w,rotation:S,id:E,color:R,opacity:T,popupRef:O,richText:N,contentsObj:k,creationDate:M,modificationDate:I},parent:{page:{pageNumber:X}}}=t;r=t={annotationType:Tt.HIGHLIGHT,color:Array.from(R),opacity:T,quadPoints:_,boxes:null,pageIndex:X-1,rect:w.slice(0),rotation:S,annotationElementId:E,id:E,deleted:!1,popupRef:O,richText:N,comment:k?.str||null,creationDate:M,modificationDate:I}}else if(t instanceof Wf){const{data:{inkLists:_,rect:w,rotation:S,id:E,color:R,borderStyle:{rawWidth:T},popupRef:O,richText:N,contentsObj:k,creationDate:M,modificationDate:I},parent:{page:{pageNumber:X}}}=t;r=t={annotationType:Tt.HIGHLIGHT,color:Array.from(R),thickness:T,inkLists:_,boxes:null,pageIndex:X-1,rect:w.slice(0),rotation:S,annotationElementId:E,id:E,deleted:!1,popupRef:O,richText:N,comment:k?.str||null,creationDate:M,modificationDate:I}}const{color:a,quadPoints:o,inkLists:u,opacity:d}=t,f=await super.deserialize(t,e,n);f.color=at.makeHexColor(...a),f.opacity=d||1,u&&(f.#p=t.thickness),f._initialData=r,t.comment&&f.setCommentData(t);const[p,m]=f.pageDimensions,[y,v]=f.pageTranslation;if(o){const _=f.#n=[];for(let w=0;w<o.length;w+=8)_.push({x:(o[w]-y)/p,y:1-(o[w+1]-v)/m,width:(o[w+2]-o[w])/p,height:(o[w+1]-o[w+5])/m});f.#v(),f.#w(),f.rotate(f.rotation)}else if(u){f.#h=!0;const _=u[0],w={x:_[0]-y,y:m-(_[1]-v)},S=new xf(w,[0,0,p,m],1,f.#p/2,!0,.001);for(let T=0,O=_.length;T<O;T+=2)w.x=_[T]-y,w.y=m-(_[T+1]-v),S.add(w);const{id:E,clipPathId:R}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:f.color,"fill-opacity":f._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:S.toSVGPath()}},!0,!0);f.#y({highlightOutlines:S.getOutlines(),highlightId:E,clipPathId:R}),f.#w(),f.rotate(f.parentRotation)}return f}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=gt._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),n=super.serialize(t);return Object.assign(n,{color:e,opacity:this.opacity,thickness:this.#p,quadPoints:this.#B(),outlines:this.#D(n.rect)}),this.addComment(n),this.annotationElementId&&!this.#L(n)?null:(n.id=this.annotationElementId,n)}#L(t){const{color:e}=this._initialData;return this.hasEditedComment||t.color.some((n,r)=>n!==e[r])}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class gw{#t=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,n]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,n)}updateSVGProperty(t,e){this.#t[t]=e}toSVGProperties(){const t=this.#t;return this.#t=Object.create(null),{root:t}}reset(){this.#t=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){Qt("Not implemented")}}class zt extends gt{#t=null;#e;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#n=null;static#s=null;static#a=null;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,this._addOutlines(t)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(this.#r(t),this.#c())}#r({drawOutlines:t,drawId:e,drawingOptions:n}){this.#t=t,this._drawingOptions||=n,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),e>=0?(this._drawId=e,this.parent.drawLayer.finalizeDraw(e,t.defaultProperties)):this._drawId=this.#i(t,this.parent),this.#h(t.box)}#i(t,e){const{id:n}=e.drawLayer.draw(zt._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return n}static _mergeSVGProperties(t,e){const n=new Set(Object.keys(t));for(const[r,a]of Object.entries(e))n.has(r)?Object.assign(t[r],a):t[r]=a;return t}static getDefaultDrawingOptions(t){Qt("Not implemented")}static get typesMap(){Qt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const n=this.typesMap.get(t);n&&this._defaultDrawingOptions.updateProperty(n,e),this._currentParent&&(zt.#n.updateProperty(n,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const n=this.constructor.typesMap.get(t);n&&this._updateProperty(t,n,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[n,r]of this.typesMap)t.push([n,e[r]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[n,r]of this.constructor.typesMap)t.push([n,e[r]]);return t}_updateProperty(t,e,n){const r=this._drawingOptions,a=r[e],o=u=>{r.updateProperty(e,u);const d=this.#t.updateProperty(e,u);d&&this.#h(d),this.parent?.drawLayer.updateProperties(this._drawId,r.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:o.bind(this,n),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,zt._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#d()),{bbox:this.#f()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,zt._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#d()),{bbox:this.#f()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#f()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,zt._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#d(),this.parentDimensions),{bbox:this.#f()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#o(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#c(),this.#h(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#o()):t&&(this._uiManager.addShouldRescale(this),this.#c(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#o(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#c(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#i(this.#t,t)}}#l([t,e,n,r]){const{parentDimensions:[a,o],rotation:u}=this;switch(u){case 90:return[e,1-t,n*(o/a),r*(a/o)];case 180:return[1-t,1-e,n,r];case 270:return[1-e,t,n*(o/a),r*(a/o)];default:return[t,e,n,r]}}#d(){const{x:t,y:e,width:n,height:r,parentDimensions:[a,o],rotation:u}=this;switch(u){case 90:return[1-e,t,n*(a/o),r*(o/a)];case 180:return[1-t,1-e,n,r];case 270:return[e,1-t,n*(a/o),r*(o/a)];default:return[t,e,n,r]}}#h(t){[this.x,this.y,this.width,this.height]=this.#l(t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#f(){const{x:t,y:e,width:n,height:r,rotation:a,parentRotation:o,parentDimensions:[u,d]}=this;switch((a*4+o)/90){case 1:return[1-e-r,t,r,n];case 2:return[1-t-n,1-e-r,n,r];case 3:return[e,1-t-n,r,n];case 4:return[t,e-n*(u/d),r*(d/u),n*(u/d)];case 5:return[1-e,t,n*(u/d),r*(d/u)];case 6:return[1-t-r*(d/u),1-e,r*(d/u),n*(u/d)];case 7:return[e-n*(u/d),1-t-r*(d/u),n*(u/d),r*(d/u)];case 8:return[t-n,e-r,n,r];case 9:return[1-e,t-n,r,n];case 10:return[1-t,1-e,n,r];case 11:return[e-r,1-t,r,n];case 12:return[t-r*(d/u),e,r*(d/u),n*(u/d)];case 13:return[1-e-n*(u/d),t-r*(d/u),n*(u/d),r*(d/u)];case 14:return[1-t,1-e-n*(u/d),r*(d/u),n*(u/d)];case 15:return[e,1-t,n*(u/d),r*(d/u)];default:return[t,e,n,r]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,zt._mergeSVGProperties({bbox:this.#f()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#h(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,e;this._isCopy&&(t=this.x,e=this.y);const n=super.render();n.classList.add("draw");const r=document.createElement("div");return n.append(r),r.setAttribute("aria-hidden","true"),r.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,e),n}static createDrawerInstance(t,e,n,r,a){Qt("Not implemented")}static startDrawing(t,e,n,r){const{target:a,offsetX:o,offsetY:u,pointerId:d,pointerType:f}=r;if(Ht.isInitializedAndDifferentPointerType(f))return;const{viewport:{rotation:p}}=t,{width:m,height:y}=a.getBoundingClientRect(),v=zt.#s=new AbortController,_=t.combinedSignal(v);if(Ht.setPointer(f,d),window.addEventListener("pointerup",w=>{Ht.isSamePointerIdOrRemove(w.pointerId)&&this._endDraw(w)},{signal:_}),window.addEventListener("pointercancel",w=>{Ht.isSamePointerIdOrRemove(w.pointerId)&&this._currentParent.endDrawingSession()},{signal:_}),window.addEventListener("pointerdown",w=>{Ht.isSamePointerType(w.pointerType)&&(Ht.initializeAndAddPointerId(w.pointerId),zt.#n.isCancellable()&&(zt.#n.removeLastElement(),zt.#n.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:_}),window.addEventListener("contextmenu",Ds,{signal:_}),a.addEventListener("pointermove",this._drawMove.bind(this),{signal:_}),a.addEventListener("touchmove",w=>{Ht.isSameTimeStamp(w.timeStamp)&&ue(w)},{signal:_}),t.toggleDrawing(),e._editorUndoBar?.hide(),zt.#n){t.drawLayer.updateProperties(this._currentDrawId,zt.#n.startNew(o,u,m,y,p));return}e.updateUIForDefaultProperties(this),zt.#n=this.createDrawerInstance(o,u,m,y,p),zt.#a=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(zt.#a.toSVGProperties(),zt.#n.defaultSVGProperties),!0,!1)}static _drawMove(t){if(Ht.isSameTimeStamp(t.timeStamp),!zt.#n)return;const{offsetX:e,offsetY:n,pointerId:r}=t;if(Ht.isSamePointerId(r)){if(Ht.isUsingMultiplePointers()){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,zt.#n.add(e,n)),Ht.setTimeStamp(t.timeStamp),ue(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,zt.#n=null,zt.#a=null,Ht.clearPointerType(),Ht.clearTimeStamp()),zt.#s&&(zt.#s.abort(),zt.#s=null,Ht.clearPointerIds())}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),t?.target===e.div&&e.drawLayer.updateProperties(this._currentDrawId,zt.#n.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const n=zt.#n,r=this._currentDrawId,a=n.getLastElement();e.addCommands({cmd:()=>{e.drawLayer.updateProperties(r,n.setLastElement(a))},undo:()=>{e.drawLayer.updateProperties(r,n.removeLastElement())},mustExec:!1,type:Lt.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(Lt.DRAW_STEP),!zt.#n.isEmpty()){const{pageDimensions:[n,r],scale:a}=e,o=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:zt.#n.getOutlines(n*a,r*a,a,this._INNER_MARGIN),drawingOptions:zt.#a,mustBeCommitted:!t});return this._cleanup(!0),o}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,n,r,a,o){Qt("Not implemented")}static async deserialize(t,e,n){const{rawDims:{pageWidth:r,pageHeight:a,pageX:o,pageY:u}}=e.viewport,d=this.deserializeDraw(o,u,r,a,this._INNER_MARGIN,t),f=await super.deserialize(t,e,n);return f.createDrawingOptions(t),f.#r({drawOutlines:d}),f.#c(),f.onScaleChanging(),f.rotate(),f}serializeDraw(t){const[e,n]=this.pageTranslation,[r,a]=this.pageDimensions;return this.#t.serialize([e,n,r,a],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class wT{#t=new Float64Array(6);#e;#n;#s;#a;#r;#i="";#o=0;#c=new Bo;#l;#d;constructor(t,e,n,r,a,o){this.#l=n,this.#d=r,this.#s=a,this.#a=o,[t,e]=this.#h(t,e);const u=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#r=[t,e],this.#n=[{line:u,points:this.#r}],this.#t.set(u,0)}updateProperty(t,e){t==="stroke-width"&&(this.#a=e)}#h(t,e){return nt._normalizePoint(t,e,this.#l,this.#d,this.#s)}isEmpty(){return!this.#n||this.#n.length===0}isCancellable(){return this.#r.length<=10}add(t,e){[t,e]=this.#h(t,e);const[n,r,a,o]=this.#t.subarray(2,6),u=t-a,d=e-o;return Math.hypot(this.#l*u,this.#d*d)<=2?null:(this.#r.push(t,e),isNaN(n)?(this.#t.set([a,o,t,e],2),this.#e.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([n,r,a,o,t,e],0),this.#e.push(...nt.createBezierPoints(n,r,a,o,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const n=this.add(t,e);return n||(this.#r.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,n,r,a){this.#l=n,this.#d=r,this.#s=a,[t,e]=this.#h(t,e);const o=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#r=[t,e];const u=this.#n.at(-1);return u&&(u.line=new Float32Array(u.line),u.points=new Float32Array(u.points)),this.#n.push({line:o,points:this.#r}),this.#t.set(o,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#n.at(-1)}setLastElement(t){return this.#n?(this.#n.push(t),this.#e=t.line,this.#r=t.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#c.setLastElement(t)}removeLastElement(){if(!this.#n)return this.#c.removeLastElement();this.#n.pop(),this.#i="";for(let t=0,e=this.#n.length;t<e;t++){const{line:n,points:r}=this.#n[t];this.#e=n,this.#r=r,this.#o=0,this.toSVGPath()}return{path:{d:this.#i}}}toSVGPath(){const t=nt.svgRound(this.#e[4]),e=nt.svgRound(this.#e[5]);if(this.#r.length===2)return this.#i=`${this.#i} M ${t} ${e} Z`,this.#i;if(this.#r.length<=6){const r=this.#i.lastIndexOf("M");this.#i=`${this.#i.slice(0,r)} M ${t} ${e}`,this.#o=6}if(this.#r.length===4){const r=nt.svgRound(this.#e[10]),a=nt.svgRound(this.#e[11]);return this.#i=`${this.#i} L ${r} ${a}`,this.#o=12,this.#i}const n=[];this.#o===0&&(n.push(`M ${t} ${e}`),this.#o=6);for(let r=this.#o,a=this.#e.length;r<a;r+=6){const[o,u,d,f,p,m]=this.#e.slice(r,r+6).map(nt.svgRound);n.push(`C${o} ${u} ${d} ${f} ${p} ${m}`)}return this.#i+=n.join(" "),this.#o=this.#e.length,this.#i}getOutlines(t,e,n,r){const a=this.#n.at(-1);return a.line=new Float32Array(a.line),a.points=new Float32Array(a.points),this.#c.build(this.#n,t,e,n,this.#s,this.#a,r),this.#t=null,this.#e=null,this.#n=null,this.#i=null,this.#c}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class Bo extends nt{#t;#e=0;#n;#s;#a;#r;#i;#o;#c;build(t,e,n,r,a,o,u){this.#a=e,this.#r=n,this.#i=r,this.#o=a,this.#c=o,this.#n=u??0,this.#s=t,this.#h()}get thickness(){return this.#c}setLastElement(t){return this.#s.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#s.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#s){if(t.push(`M${nt.svgRound(e[4])} ${nt.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12&&isNaN(e[6])){t.push(`L${nt.svgRound(e[10])} ${nt.svgRound(e[11])}`);continue}for(let n=6,r=e.length;n<r;n+=6){const[a,o,u,d,f,p]=e.subarray(n,n+6).map(nt.svgRound);t.push(`C${a} ${o} ${u} ${d} ${f} ${p}`)}}return t.join("")}serialize([t,e,n,r],a){const o=[],u=[],[d,f,p,m]=this.#d();let y,v,_,w,S,E,R,T,O;switch(this.#o){case 0:O=nt._rescale,y=t,v=e+r,_=n,w=-r,S=t+d*n,E=e+(1-f-m)*r,R=t+(d+p)*n,T=e+(1-f)*r;break;case 90:O=nt._rescaleAndSwap,y=t,v=e,_=n,w=r,S=t+f*n,E=e+d*r,R=t+(f+m)*n,T=e+(d+p)*r;break;case 180:O=nt._rescale,y=t+n,v=e,_=-n,w=r,S=t+(1-d-p)*n,E=e+f*r,R=t+(1-d)*n,T=e+(f+m)*r;break;case 270:O=nt._rescaleAndSwap,y=t+n,v=e+r,_=-n,w=-r,S=t+(1-f-m)*n,E=e+(1-d-p)*r,R=t+(1-f)*n,T=e+(1-d)*r;break}for(const{line:N,points:k}of this.#s)o.push(O(N,y,v,_,w,a?new Array(N.length):null)),u.push(O(k,y,v,_,w,a?new Array(k.length):null));return{lines:o,points:u,rect:[S,E,R,T]}}static deserialize(t,e,n,r,a,{paths:{lines:o,points:u},rotation:d,thickness:f}){const p=[];let m,y,v,_,w;switch(d){case 0:w=nt._rescale,m=-t/n,y=e/r+1,v=1/n,_=-1/r;break;case 90:w=nt._rescaleAndSwap,m=-e/r,y=-t/n,v=1/r,_=1/n;break;case 180:w=nt._rescale,m=t/n+1,y=-e/r,v=-1/n,_=1/r;break;case 270:w=nt._rescaleAndSwap,m=e/r+1,y=t/n+1,v=-1/r,_=-1/n;break}if(!o){o=[];for(const E of u){const R=E.length;if(R===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,E[0],E[1]]));continue}if(R===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,E[0],E[1],NaN,NaN,NaN,NaN,E[2],E[3]]));continue}const T=new Float32Array(3*(R-2));o.push(T);let[O,N,k,M]=E.subarray(0,4);T.set([NaN,NaN,NaN,NaN,O,N],0);for(let I=4;I<R;I+=2){const X=E[I],Q=E[I+1];T.set(nt.createBezierPoints(O,N,k,M,X,Q),(I-2)*3),[O,N,k,M]=[k,M,X,Q]}}}for(let E=0,R=o.length;E<R;E++)p.push({line:w(o[E].map(T=>T??NaN),m,y,v,_),points:w(u[E].map(T=>T??NaN),m,y,v,_)});const S=new this.prototype.constructor;return S.build(p,n,r,1,d,f,a),S}#l(t=this.#c){const e=this.#n+t/2*this.#i;return this.#o%180===0?[e/this.#a,e/this.#r]:[e/this.#r,e/this.#a]}#d(){const[t,e,n,r]=this.#t,[a,o]=this.#l(0);return[t+a,e+o,n-2*a,r-2*o]}#h(){const t=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:r}of this.#s){if(r.length<=12){for(let u=4,d=r.length;u<d;u+=6)at.pointBoundingBox(r[u],r[u+1],t);continue}let a=r[4],o=r[5];for(let u=6,d=r.length;u<d;u+=6){const[f,p,m,y,v,_]=r.subarray(u,u+6);at.bezierBoundingBox(a,o,f,p,m,y,v,_,t),a=v,o=_}}const[e,n]=this.#l();t[0]=Ye(t[0]-e,0,1),t[1]=Ye(t[1]-n,0,1),t[2]=Ye(t[2]+e,0,1),t[3]=Ye(t[3]+n,0,1),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#t}updateProperty(t,e){return t==="stroke-width"?this.#f(e):null}#f(t){const[e,n]=this.#l();this.#c=t;const[r,a]=this.#l(),[o,u]=[r-e,a-n],d=this.#t;return d[0]-=o,d[1]-=u,d[2]+=2*o,d[3]+=2*u,d}updateParentDimensions([t,e],n){const[r,a]=this.#l();this.#a=t,this.#r=e,this.#i=n;const[o,u]=this.#l(),d=o-r,f=u-a,p=this.#t;return p[0]-=d,p[1]-=f,p[2]+=2*d,p[3]+=2*f,p}updateRotation(t){return this.#e=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(nt.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${nt.svgRound(t)} ${nt.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#t;let n=0,r=0,a=0,o=0,u=0,d=0;switch(this.#e){case 90:r=e/t,a=-t/e,u=t;break;case 180:n=-1,o=-1,u=t,d=e;break;case 270:r=-e/t,a=t/e,d=e;break;default:return""}return`matrix(${n} ${r} ${a} ${o} ${nt.svgRound(u)} ${nt.svgRound(d)})`}getPathResizingSVGProperties([t,e,n,r]){const[a,o]=this.#l(),[u,d,f,p]=this.#t;if(Math.abs(f-a)<=nt.PRECISION||Math.abs(p-o)<=nt.PRECISION){const w=t+n/2-(u+f/2),S=e+r/2-(d+p/2);return{path:{"transform-origin":`${nt.svgRound(t)} ${nt.svgRound(e)}`,transform:`${this.rotationTransform} translate(${w} ${S})`}}}const m=(n-2*a)/(f-2*a),y=(r-2*o)/(p-2*o),v=f/n,_=p/r;return{path:{"transform-origin":`${nt.svgRound(u)} ${nt.svgRound(d)}`,transform:`${this.rotationTransform} scale(${v} ${_}) translate(${nt.svgRound(a)} ${nt.svgRound(o)}) scale(${m} ${y}) translate(${nt.svgRound(-a)} ${nt.svgRound(-o)})`}}}getPathResizedSVGProperties([t,e,n,r]){const[a,o]=this.#l(),u=this.#t,[d,f,p,m]=u;if(u[0]=t,u[1]=e,u[2]=n,u[3]=r,Math.abs(p-a)<=nt.PRECISION||Math.abs(m-o)<=nt.PRECISION){const S=t+n/2-(d+p/2),E=e+r/2-(f+m/2);for(const{line:R,points:T}of this.#s)nt._translate(R,S,E,R),nt._translate(T,S,E,T);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${nt.svgRound(t)} ${nt.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const y=(n-2*a)/(p-2*a),v=(r-2*o)/(m-2*o),_=-y*(d+a)+t+a,w=-v*(f+o)+e+o;if(y!==1||v!==1||_!==0||w!==0)for(const{line:S,points:E}of this.#s)nt._rescale(S,_,w,y,v,S),nt._rescale(E,_,w,y,v,E);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${nt.svgRound(t)} ${nt.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],n){const[r,a]=n,o=this.#t,u=t-o[0],d=e-o[1];if(this.#a===r&&this.#r===a)for(const{line:f,points:p}of this.#s)nt._translate(f,u,d,f),nt._translate(p,u,d,p);else{const f=this.#a/r,p=this.#r/a;this.#a=r,this.#r=a;for(const{line:m,points:y}of this.#s)nt._rescale(m,u,d,f,p,m),nt._rescale(y,u,d,f,p,y);o[2]*=f,o[3]*=p}return o[0]=t,o[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${nt.svgRound(t)} ${nt.svgRound(e)}`}}}get defaultSVGProperties(){const t=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${nt.svgRound(t[0])} ${nt.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class tu extends gw{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:gt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??=this["stroke-width"],e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new tu(this._viewParameters);return t.updateAll(this),t}}class Jf extends zt{static _type="ink";static _editorType=Tt.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,e){gt.initialize(t,e),this._defaultDrawingOptions=new tu(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return Et(this,"typesMap",new Map([[Lt.INK_THICKNESS,"stroke-width"],[Lt.INK_COLOR,"stroke"],[Lt.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,n,r,a){return new wT(t,e,n,r,a,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,n,r,a,o){return Bo.deserialize(t,e,n,r,a,o)}static async deserialize(t,e,n){let r=null;if(t instanceof Wf){const{data:{inkLists:o,rect:u,rotation:d,id:f,color:p,opacity:m,borderStyle:{rawWidth:y},popupRef:v,richText:_,contentsObj:w,creationDate:S,modificationDate:E},parent:{page:{pageNumber:R}}}=t;r=t={annotationType:Tt.INK,color:Array.from(p),thickness:y,opacity:m,paths:{points:o},boxes:null,pageIndex:R-1,rect:u.slice(0),rotation:d,annotationElementId:f,id:f,deleted:!1,popupRef:v,richText:_,comment:w?.str||null,creationDate:S,modificationDate:E}}const a=await super.deserialize(t,e,n);return a._initialData=r,t.comment&&a.setCommentData(t),a}get toolbarButtons(){return this._colorPicker||=new Co(this),[["colorPicker",this._colorPicker]]}get colorType(){return Lt.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:n}=this;e.updateSVGProperty("stroke-width"),n.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:n}){this._drawingOptions=Jf.getDefaultDrawingOptions({stroke:at.makeHexColor(...t),"stroke-width":e,"stroke-opacity":n})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:n}=this.serializeDraw(t),{_drawingOptions:{stroke:r,"stroke-opacity":a,"stroke-width":o}}=this,u=Object.assign(super.serialize(t),{color:gt._colorManager.convert(r),opacity:a,thickness:o,paths:{lines:e,points:n}});return this.addComment(u),t?(u.isCopy=!0,u):this.annotationElementId&&!this.#t(u)?null:(u.id=this.annotationElementId,u)}#t(t){const{color:e,thickness:n,opacity:r,pageIndex:a}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((o,u)=>o!==e[u])||t.thickness!==n||t.opacity!==r||t.pageIndex!==a}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:e,rect:n}=this.serializeDraw(!1);return t.updateEdited({rect:n,thickness:this._drawingOptions["stroke-width"],points:e,popup:this.comment}),null}}class Ef extends Bo{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const Ac=8,oo=3;class Gr{static#t={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#e(t,e,n,r){return n-=t,r-=e,n===0?r>0?0:4:n===1?r+6:2-r}static#n=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#s(t,e,n,r,a,o,u){const d=this.#e(n,r,a,o);for(let f=0;f<8;f++){const p=(-f+d-u+16)%8,m=this.#n[2*p],y=this.#n[2*p+1];if(t[(n+m)*e+(r+y)]!==0)return p}return-1}static#a(t,e,n,r,a,o,u){const d=this.#e(n,r,a,o);for(let f=0;f<8;f++){const p=(f+d+u+16)%8,m=this.#n[2*p],y=this.#n[2*p+1];if(t[(n+m)*e+(r+y)]!==0)return p}return-1}static#r(t,e,n,r){const a=t.length,o=new Int32Array(a);for(let p=0;p<a;p++)o[p]=t[p]<=r?1:0;for(let p=1;p<n-1;p++)o[p*e]=o[p*e+e-1]=0;for(let p=0;p<e;p++)o[p]=o[e*n-1-p]=0;let u=1,d;const f=[];for(let p=1;p<n-1;p++){d=1;for(let m=1;m<e-1;m++){const y=p*e+m,v=o[y];if(v===0)continue;let _=p,w=m;if(v===1&&o[y-1]===0)u+=1,w-=1;else if(v>=1&&o[y+1]===0)u+=1,w+=1,v>1&&(d=v);else{v!==1&&(d=Math.abs(v));continue}const S=[m,p],E=w===m+1,R={isHole:E,points:S,id:u,parent:0};f.push(R);let T;for(const Z of f)if(Z.id===d){T=Z;break}T?T.isHole?R.parent=E?T.parent:d:R.parent=E?d:T.parent:R.parent=E?d:0;const O=this.#s(o,e,p,m,_,w,0);if(O===-1){o[y]=-u,o[y]!==1&&(d=Math.abs(o[y]));continue}let N=this.#n[2*O],k=this.#n[2*O+1];const M=p+N,I=m+k;_=M,w=I;let X=p,Q=m;for(;;){const Z=this.#a(o,e,X,Q,_,w,1);N=this.#n[2*Z],k=this.#n[2*Z+1];const st=X+N,ht=Q+k;S.push(ht,st);const wt=X*e+Q;if(o[wt+1]===0?o[wt]=-u:o[wt]===1&&(o[wt]=u),st===p&&ht===m&&X===M&&Q===I){o[y]!==1&&(d=Math.abs(o[y]));break}else _=X,w=Q,X=st,Q=ht}}}return f}static#i(t,e,n,r){if(n-e<=4){for(let M=e;M<n-2;M+=2)r.push(t[M],t[M+1]);return}const a=t[e],o=t[e+1],u=t[n-4]-a,d=t[n-3]-o,f=Math.hypot(u,d),p=u/f,m=d/f,y=p*o-m*a,v=d/u,_=1/f,w=Math.atan(v),S=Math.cos(w),E=Math.sin(w),R=_*(Math.abs(S)+Math.abs(E)),T=_*(1-R+R**2),O=Math.max(Math.atan(Math.abs(E+S)*T),Math.atan(Math.abs(E-S)*T));let N=0,k=e;for(let M=e+2;M<n-2;M+=2){const I=Math.abs(y-p*t[M+1]+m*t[M]);I>N&&(k=M,N=I)}N>(f*O)**2?(this.#i(t,e,k+2,r),this.#i(t,k,n,r)):r.push(a,o)}static#o(t){const e=[],n=t.length;return this.#i(t,0,n,e),e.push(t[n-2],t[n-1]),e.length<=4?null:e}static#c(t,e,n,r,a,o){const u=new Float32Array(o**2),d=-2*r**2,f=o>>1;for(let w=0;w<o;w++){const S=(w-f)**2;for(let E=0;E<o;E++)u[w*o+E]=Math.exp((S+(E-f)**2)/d)}const p=new Float32Array(256),m=-2*a**2;for(let w=0;w<256;w++)p[w]=Math.exp(w**2/m);const y=t.length,v=new Uint8Array(y),_=new Uint32Array(256);for(let w=0;w<n;w++)for(let S=0;S<e;S++){const E=w*e+S,R=t[E];let T=0,O=0;for(let k=0;k<o;k++){const M=w+k-f;if(!(M<0||M>=n))for(let I=0;I<o;I++){const X=S+I-f;if(X<0||X>=e)continue;const Q=t[M*e+X],Z=u[k*o+I]*p[Math.abs(Q-R)];T+=Q*Z,O+=Z}}const N=v[E]=Math.round(T/O);_[N]++}return[v,_]}static#l(t){const e=new Uint32Array(256);for(const n of t)e[n]++;return e}static#d(t){const e=t.length,n=new Uint8ClampedArray(e>>2);let r=-1/0,a=1/0;for(let u=0,d=n.length;u<d;u++){const f=n[u]=t[u<<2];r=Math.max(r,f),a=Math.min(a,f)}const o=255/(r-a);for(let u=0,d=n.length;u<d;u++)n[u]=(n[u]-a)*o;return n}static#h(t){let e,n=-1/0,r=-1/0;const a=t.findIndex(d=>d!==0);let o=a,u=a;for(e=a;e<256;e++){const d=t[e];d>n&&(e-o>r&&(r=e-o,u=e-1),n=d,o=e)}for(e=u-1;e>=0&&!(t[e]>t[e+1]);e--);return e}static#f(t){const e=t,{width:n,height:r}=t,{maxDim:a}=this.#t;let o=n,u=r;if(n>a||r>a){let y=n,v=r,_=Math.log2(Math.max(n,r)/a);const w=Math.floor(_);_=_===w?w-1:w;for(let E=0;E<_;E++){o=Math.ceil(y/2),u=Math.ceil(v/2);const R=new OffscreenCanvas(o,u);R.getContext("2d").drawImage(t,0,0,y,v,0,0,o,u),y=o,v=u,t!==e&&t.close(),t=R.transferToImageBitmap()}const S=Math.min(a/o,a/u);o=Math.round(o*S),u=Math.round(u*S)}const f=new OffscreenCanvas(o,u).getContext("2d",{willReadFrequently:!0});f.fillStyle="white",f.fillRect(0,0,o,u),f.filter="grayscale(1)",f.drawImage(t,0,0,t.width,t.height,0,0,o,u);const p=f.getImageData(0,0,o,u).data;return[this.#d(p),o,u]}static extractContoursFromText(t,{fontFamily:e,fontStyle:n,fontWeight:r},a,o,u,d){let f=new OffscreenCanvas(1,1),p=f.getContext("2d",{alpha:!1});const m=200,y=p.font=`${n} ${r} ${m}px ${e}`,{actualBoundingBoxLeft:v,actualBoundingBoxRight:_,actualBoundingBoxAscent:w,actualBoundingBoxDescent:S,fontBoundingBoxAscent:E,fontBoundingBoxDescent:R,width:T}=p.measureText(t),O=1.5,N=Math.ceil(Math.max(Math.abs(v)+Math.abs(_)||0,T)*O),k=Math.ceil(Math.max(Math.abs(w)+Math.abs(S)||m,Math.abs(E)+Math.abs(R)||m)*O);f=new OffscreenCanvas(N,k),p=f.getContext("2d",{alpha:!0,willReadFrequently:!0}),p.font=y,p.filter="grayscale(1)",p.fillStyle="white",p.fillRect(0,0,N,k),p.fillStyle="black",p.fillText(t,N*(O-1)/2,k*(3-O)/2);const M=this.#d(p.getImageData(0,0,N,k).data),I=this.#l(M),X=this.#h(I),Q=this.#r(M,N,k,X);return this.processDrawnLines({lines:{curves:Q,width:N,height:k},pageWidth:a,pageHeight:o,rotation:u,innerMargin:d,mustSmooth:!0,areContours:!0})}static process(t,e,n,r,a){const[o,u,d]=this.#f(t),[f,p]=this.#c(o,u,d,Math.hypot(u,d)*this.#t.sigmaSFactor,this.#t.sigmaR,this.#t.kernelSize),m=this.#h(p),y=this.#r(f,u,d,m);return this.processDrawnLines({lines:{curves:y,width:u,height:d},pageWidth:e,pageHeight:n,rotation:r,innerMargin:a,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:n,rotation:r,innerMargin:a,mustSmooth:o,areContours:u}){r%180!==0&&([e,n]=[n,e]);const{curves:d,width:f,height:p}=t,m=t.thickness??0,y=[],v=Math.min(e/f,n/p),_=v/e,w=v/n,S=[];for(const{points:R}of d){const T=o?this.#o(R):R;if(!T)continue;S.push(T);const O=T.length,N=new Float32Array(O),k=new Float32Array(3*(O===2?2:O-2));if(y.push({line:k,points:N}),O===2){N[0]=T[0]*_,N[1]=T[1]*w,k.set([NaN,NaN,NaN,NaN,N[0],N[1]],0);continue}let[M,I,X,Q]=T;M*=_,I*=w,X*=_,Q*=w,N.set([M,I,X,Q],0),k.set([NaN,NaN,NaN,NaN,M,I],0);for(let Z=4;Z<O;Z+=2){const st=N[Z]=T[Z]*_,ht=N[Z+1]=T[Z+1]*w;k.set(nt.createBezierPoints(M,I,X,Q,st,ht),(Z-2)*3),[M,I,X,Q]=[X,Q,st,ht]}}if(y.length===0)return null;const E=u?new Ef:new Bo;return E.build(y,e,n,1,r,u?0:m,a),{outline:E,newCurves:S,areContours:u,thickness:m,width:f,height:p}}static async compressSignature({outlines:t,areContours:e,thickness:n,width:r,height:a}){let o=1/0,u=-1/0,d=0;for(const T of t){d+=T.length;for(let O=2,N=T.length;O<N;O++){const k=T[O]-T[O-2];o=Math.min(o,k),u=Math.max(u,k)}}let f;o>=-128&&u<=127?f=Int8Array:o>=-32768&&u<=32767?f=Int16Array:f=Int32Array;const p=t.length,m=Ac+oo*p,y=new Uint32Array(m);let v=0;y[v++]=m*Uint32Array.BYTES_PER_ELEMENT+(d-2*p)*f.BYTES_PER_ELEMENT,y[v++]=0,y[v++]=r,y[v++]=a,y[v++]=e?0:1,y[v++]=Math.max(0,Math.floor(n??0)),y[v++]=p,y[v++]=f.BYTES_PER_ELEMENT;for(const T of t)y[v++]=T.length-2,y[v++]=T[0],y[v++]=T[1];const _=new CompressionStream("deflate-raw"),w=_.writable.getWriter();await w.ready,w.write(y);const S=f.prototype.constructor;for(const T of t){const O=new S(T.length-2);for(let N=2,k=T.length;N<k;N++)O[N-2]=T[N]-T[N-2];w.write(O)}w.close();const E=await new Response(_.readable).arrayBuffer(),R=new Uint8Array(E);return Fv(R)}static async decompressSignature(t){try{const e=PE(t),{readable:n,writable:r}=new DecompressionStream("deflate-raw"),a=r.getWriter();await a.ready,a.write(e).then(async()=>{await a.ready,await a.close()}).catch(()=>{});let o=null,u=0;for await(const T of n)o||=new Uint8Array(new Uint32Array(T.buffer,0,4)[0]),o.set(T,u),u+=T.length;const d=new Uint32Array(o.buffer,0,o.length>>2),f=d[1];if(f!==0)throw new Error(`Invalid version: ${f}`);const p=d[2],m=d[3],y=d[4]===0,v=d[5],_=d[6],w=d[7],S=[],E=(Ac+oo*_)*Uint32Array.BYTES_PER_ELEMENT;let R;switch(w){case Int8Array.BYTES_PER_ELEMENT:R=new Int8Array(o.buffer,E);break;case Int16Array.BYTES_PER_ELEMENT:R=new Int16Array(o.buffer,E);break;case Int32Array.BYTES_PER_ELEMENT:R=new Int32Array(o.buffer,E);break}u=0;for(let T=0;T<_;T++){const O=d[oo*T+Ac],N=new Float32Array(O+2);S.push(N);for(let k=0;k<oo-1;k++)N[k]=d[oo*T+Ac+k+1];for(let k=0;k<O;k++)N[k+2]=N[k]+R[u++]}return{areContours:y,thickness:v,outlines:S,width:p,height:m}}catch(e){return xt(`decompressSignature: ${e}`),null}}}class Zf extends gw{constructor(){super(),super.updateProperties({fill:gt._defaultLineColor,"stroke-width":0})}clone(){const t=new Zf;return t.updateAll(this),t}}class tp extends tu{constructor(t){super(t),super.updateProperties({stroke:gt._defaultLineColor,"stroke-width":1})}clone(){const t=new tp(this._viewParameters);return t.updateAll(this),t}}class Zs extends zt{#t=!1;#e=null;#n=null;#s=null;static _type="signature";static _editorType=Tt.SIGNATURE;static _defaultDrawingOptions=null;constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#n=t.signatureData||null,this.#e=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,e){gt.initialize(t,e),this._defaultDrawingOptions=new Zf,this._defaultDrawnSignatureOptions=new tp(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!1}static get typesMap(){return Et(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#e}}static computeTelemetryFinalData(t){const e=t.get("hasDescription");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,e;const{_isCopy:n}=this;if(n&&(this._isCopy=!1,t=this.x,e=this.y),super.render(),this._drawId===null)if(this.#n){const{lines:r,mustSmooth:a,areContours:o,description:u,uuid:d,heightInPage:f}=this.#n,{rawDims:{pageWidth:p,pageHeight:m},rotation:y}=this.parent.viewport,v=Gr.processDrawnLines({lines:r,pageWidth:p,pageHeight:m,rotation:y,innerMargin:Zs._INNER_MARGIN,mustSmooth:a,areContours:o});this.addSignature(v,f,u,d)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#e||""}));return n&&(this._isCopy=!0,this._moveAfterPaste(t,e)),this.div}setUuid(t){this.#s=t,this.addEditToolbar()}getUuid(){return this.#s}get description(){return this.#e}set description(t){this.#e=t,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(e=>{e?.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:e,thickness:n,width:r,height:a}=this.#n,o=Math.max(r,a),u=Gr.processDrawnLines({lines:{curves:t.map(d=>({points:d})),thickness:n,width:r,height:a},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:e});return{areContours:e,outline:u.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,e,n,r){const{x:a,y:o}=this,{outline:u}=this.#n=t;this.#t=u instanceof Ef,this.description=n;let d;this.#t?d=Zs.getDefaultDrawingOptions():(d=Zs._defaultDrawnSignatureOptions.clone(),d.updateProperties({"stroke-width":u.thickness})),this._addOutlines({drawOutlines:u,drawingOptions:d});const[,f]=this.pageDimensions;let p=e/f;p=p>=1?.5:p,this.width*=p/this.height,this.width>=1&&(p*=.9/this.width,this.width=.9),this.height=p,this.setDims(),this.x=a,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(r),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!r,hasDescription:!!n}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:e,pageHeight:n},rotation:r}=this.parent.viewport;return Gr.process(t,e,n,r,Zs._INNER_MARGIN)}getFromText(t,e){const{rawDims:{pageWidth:n,pageHeight:r},rotation:a}=this.parent.viewport;return Gr.extractContoursFromText(t,e,n,r,a,Zs._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:e,pageHeight:n},rotation:r}=this.parent.viewport;return Gr.processDrawnLines({lines:t,pageWidth:e,pageHeight:n,rotation:r,innerMargin:Zs._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:e}){t?this._drawingOptions=Zs.getDefaultDrawingOptions():(this._drawingOptions=Zs._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":e}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:e,points:n}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":r}}=this,a=Object.assign(super.serialize(t),{isSignature:!0,areContours:this.#t,color:[0,0,0],thickness:this.#t?0:r});return this.addComment(a),t?(a.paths={lines:e,points:n},a.uuid=this.#s,a.isCopy=!0):a.lines=e,this.#e&&(a.accessibilityData={type:"Figure",alt:this.#e}),a}static deserializeDraw(t,e,n,r,a,o){return o.areContours?Ef.deserialize(t,e,n,r,a,o):Bo.deserialize(t,e,n,r,a,o)}static async deserialize(t,e,n){const r=await super.deserialize(t,e,n);return r.#t=t.areContours,r.description=t.accessibilityData?.alt||"",r.#s=t.uuid,r}}class _T extends gt{#t=null;#e=null;#n=null;#s=null;#a=null;#r="";#i=null;#o=!1;#c=null;#l=!1;#d=!1;static _type="stamp";static _editorType=Tt.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#s=t.bitmapUrl,this.#a=t.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,e){gt.initialize(t,e)}static isHandlingMimeForPasting(t){return mf.includes(t)}static paste(t,e){e.pasteEditor({mode:Tt.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#h(t,e=!1){if(!t){this.remove();return}this.#t=t.bitmap,e||(this.#e=t.id,this.#l=t.isSvg),t.file&&(this.#r=t.file.name),this.#g()}#f(){if(this.#n=null,this._uiManager.enableWaiting(!1),!!this.#i){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:n}=this._uiManager;if(!n)throw new Error("No ML.");if(!await n.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:r,width:a,height:o}=t||this.copyCanvas(null,null,!0).imageData,u=await n.guess({name:"altText",request:{data:r,width:a,height:o,channels:r.length/(a*o)}});if(!u)throw new Error("No response from the AI service.");if(u.error)throw new Error("Error from the AI service.");if(u.cancel)return null;if(!u.output)throw new Error("No valid response from the AI service.");const d=u.output;return await this.setGuessedAltText(d),e&&!this.hasAltTextData()&&(this.altTextData={alt:d,decorative:!1}),d}#m(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(n=>this.#h(n,!0)).finally(()=>this.#f());return}if(this.#s){const n=this.#s;this.#s=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromUrl(n).then(r=>this.#h(r)).finally(()=>this.#f());return}if(this.#a){const n=this.#a;this.#a=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromFile(n).then(r=>this.#h(r)).finally(()=>this.#f());return}const t=document.createElement("input");t.type="file",t.accept=mf.join(",");const e=this._uiManager._signal;this.#n=new Promise(n=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#h(r)}n()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),n()},{signal:e})}).finally(()=>this.#f()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#i?.remove(),this.#i=null,this.#c&&(clearTimeout(this.#c),this.#c=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#m();return}super.rebuild(),this.div!==null&&(this.#e&&this.#i===null&&this.#m(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#n||this.#t||this.#s||this.#a||this.#e||this.#o)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;return this._isCopy&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#o||(this.#t?this.#g():this.#m()),this._isCopy&&this._moveAfterPaste(t,e),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,e){const{id:n,bitmap:r}=this._uiManager.imageManager.getFromCanvas(t,e);e.remove(),n&&this._uiManager.imageManager.isValidId(n)&&(this.#e=n,r&&(this.#t=r),this.#o=!1,this.#g())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#c!==null&&clearTimeout(this.#c);const t=200;this.#c=setTimeout(()=>{this.#c=null,this.#p()},t)}#g(){const{div:t}=this;let{width:e,height:n}=this.#t;const[r,a]=this.pageDimensions,o=.75;if(this.width)e=this.width*r,n=this.height*a;else if(e>o*r||n>o*a){const d=Math.min(o*r/e,o*a/n);e*=d,n*=d}this._uiManager.enableWaiting(!1);const u=this.#i=document.createElement("canvas");u.setAttribute("role","img"),this.addContainer(u),this.width=e/r,this.height=n/a,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#p(),this.#d||(this.parent.addUndoableEditor(this),this.#d=!0),this._reportTelemetry({action:"inserted_image"}),this.#r&&this.div.setAttribute("aria-description",this.#r),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(t,e,n=!1){t||(t=224);const{width:r,height:a}=this.#t,o=new sn;let u=this.#t,d=r,f=a,p=null;if(e){if(r>e||a>e){const k=Math.min(e/r,e/a);d=Math.floor(r*k),f=Math.floor(a*k)}p=document.createElement("canvas");const y=p.width=Math.ceil(d*o.sx),v=p.height=Math.ceil(f*o.sy);this.#l||(u=this.#u(y,v));const _=p.getContext("2d");_.filter=this._uiManager.hcmFilter;let w="white",S="#cfcfd8";this._uiManager.hcmFilter!=="none"?S="black":HE.isDarkMode&&(w="#8f8f9d",S="#42414d");const E=15,R=E*o.sx,T=E*o.sy,O=new OffscreenCanvas(R*2,T*2),N=O.getContext("2d");N.fillStyle=w,N.fillRect(0,0,R*2,T*2),N.fillStyle=S,N.fillRect(0,0,R,T),N.fillRect(R,T,R,T),_.fillStyle=_.createPattern(O,"repeat"),_.fillRect(0,0,y,v),_.drawImage(u,0,0,u.width,u.height,0,0,y,v)}let m=null;if(n){let y,v;if(o.symmetric&&u.width<t&&u.height<t)y=u.width,v=u.height;else if(u=this.#t,r>t||a>t){const S=Math.min(t/r,t/a);y=Math.floor(r*S),v=Math.floor(a*S),this.#l||(u=this.#u(y,v))}const w=new OffscreenCanvas(y,v).getContext("2d",{willReadFrequently:!0});w.drawImage(u,0,0,u.width,u.height,0,0,y,v),m={width:y,height:v,data:w.getImageData(0,0,y,v).data}}return{canvas:p,width:d,height:f,imageData:m}}#u(t,e){const{width:n,height:r}=this.#t;let a=n,o=r,u=this.#t;for(;a>2*t||o>2*e;){const d=a,f=o;a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2)),o>2*e&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const p=new OffscreenCanvas(a,o);p.getContext("2d").drawImage(u,0,0,d,f,0,0,a,o),u=p.transferToImageBitmap()}return u}#p(){const[t,e]=this.parentDimensions,{width:n,height:r}=this,a=new sn,o=Math.ceil(n*t*a.sx),u=Math.ceil(r*e*a.sy),d=this.#i;if(!d||d.width===o&&d.height===u)return;d.width=o,d.height=u;const f=this.#l?this.#t:this.#u(o,u),p=d.getContext("2d");p.filter=this._uiManager.hcmFilter,p.drawImage(f,0,0,f.width,f.height,0,0,o,u)}#b(t){if(t){if(this.#l){const r=this._uiManager.imageManager.getSvgUrl(this.#e);if(r)return r}const e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#t,e.getContext("2d").drawImage(this.#t,0,0),e.toDataURL()}if(this.#l){const[e,n]=this.pageDimensions,r=Math.round(this.width*e*na.PDF_TO_CSS_UNITS),a=Math.round(this.height*n*na.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(r,a);return o.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,r,a),o.transferToImageBitmap()}return structuredClone(this.#t)}static async deserialize(t,e,n){let r=null,a=!1;if(t instanceof fw){const{data:{rect:w,rotation:S,id:E,structParent:R,popupRef:T,richText:O,contentsObj:N,creationDate:k,modificationDate:M},container:I,parent:{page:{pageNumber:X}},canvas:Q}=t;let Z,st;Q?(delete t.canvas,{id:Z,bitmap:st}=n.imageManager.getFromCanvas(I.id,Q),Q.remove()):(a=!0,t._hasNoCanvas=!0);const ht=(await e._structTree.getAriaAttributes(`${Vr}${E}`))?.get("aria-label")||"";r=t={annotationType:Tt.STAMP,bitmapId:Z,bitmap:st,pageIndex:X-1,rect:w.slice(0),rotation:S,annotationElementId:E,id:E,deleted:!1,accessibilityData:{decorative:!1,altText:ht},isSvg:!1,structParent:R,popupRef:T,richText:O,comment:N?.str||null,creationDate:k,modificationDate:M}}const o=await super.deserialize(t,e,n),{rect:u,bitmap:d,bitmapUrl:f,bitmapId:p,isSvg:m,accessibilityData:y}=t;a?(n.addMissingCanvas(t.id,o),o.#o=!0):p&&n.imageManager.isValidId(p)?(o.#e=p,d&&(o.#t=d)):o.#s=f,o.#l=m;const[v,_]=o.pageDimensions;return o.width=(u[2]-u[0])/v,o.height=(u[3]-u[1])/_,y&&(o.altTextData=y),o._initialData=r,t.comment&&o.setCommentData(t),o.#d=!!r,o}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n=Object.assign(super.serialize(t),{bitmapId:this.#e,isSvg:this.#l});if(this.addComment(n),t)return n.bitmapUrl=this.#b(!0),n.accessibilityData=this.serializeAltText(!0),n.isCopy=!0,n;const{decorative:r,altText:a}=this.serializeAltText(!1);if(!r&&a&&(n.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const u=this.#v(n);return u.isSame?null:(u.isSameAltText?delete n.accessibilityData:n.accessibilityData.structParent=this._initialData.structParent??-1,n.id=this.annotationElementId,delete n.bitmapId,n)}if(e===null)return n;e.stamps||=new Map;const o=this.#l?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(!e.stamps.has(this.#e))e.stamps.set(this.#e,{area:o,serialized:n}),n.bitmap=this.#b(!1);else if(this.#l){const u=e.stamps.get(this.#e);o>u.area&&(u.area=o,u.serialized.bitmap.close(),u.serialized.bitmap=this.#b(!1))}return n}#v(t){const{pageIndex:e,accessibilityData:{altText:n}}=this._initialData,r=t.pageIndex===e,a=(t.accessibilityData?.alt||"")===n;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&r&&a,isSameAltText:a}}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class Rn{#t;#e=!1;#n=null;#s=null;#a=null;#r=new Map;#i=!1;#o=!1;#c=!1;#l=null;#d=null;#h=null;#f=null;#m=null;#g=-1;#u;static _initialized=!1;static#p=new Map([Te,Jf,_T,fe,Zs].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:n,structTreeLayer:r,accessibilityManager:a,annotationLayer:o,drawLayer:u,textLayer:d,viewport:f,l10n:p}){const m=[...Rn.#p.values()];if(!Rn._initialized){Rn._initialized=!0;for(const y of m)y.initialize(p,t)}t.registerEditorTypes(m),this.#u=t,this.pageIndex=e,this.div=n,this.#t=a,this.#n=o,this.viewport=f,this.#h=d,this.drawLayer=u,this._structTree=r,this.#u.addLayer(this)}get isEmpty(){return this.#r.size===0}get isInvisible(){return this.isEmpty&&this.#u.getMode()===Tt.NONE}updateToolbar(t){this.#u.updateToolbar(t)}updateMode(t=this.#u.getMode()){switch(this.#_(),t){case Tt.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Tt.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Tt.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;if(e.toggle("nonEditing",!1),t===Tt.POPUP)e.toggle("commentEditing",!0);else{e.toggle("commentEditing",!1);for(const n of Rn.#p.values())e.toggle(`${n._type}Editing`,t===n._editorType)}this.div.hidden=!1}hasTextLayer(t){return t===this.#h?.div}setEditingState(t){this.#u.setEditingState(t)}addCommands(t){this.#u.addCommands(t)}cleanUndoStack(t){this.#u.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#n?.togglePointerEvents(t)}get#b(){return this.#r.size!==0?this.#r.values():this.#u.getEditors(this.pageIndex)}async enable(){this.#c=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#m?.abort(),this.#m=null;const t=new Set;for(const n of this.#b)n.enableEditing(),n.show(!0),n.annotationElementId&&(this.#u.removeChangedExistingAnnotation(n),t.add(n.annotationElementId));const e=this.#n;if(e)for(const n of e.getEditableAnnotations()){if(n.hide(),this.#u.isDeletedAnnotationElement(n.data.id)||t.has(n.data.id))continue;const r=await this.deserialize(n);r&&(this.addOrRebuild(r),r.enableEditing())}this.#c=!1,this.#u._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#h&&!this.#m){this.#m=new AbortController;const r=this.#u.combinedSignal(this.#m);this.#h.div.addEventListener("pointerdown",a=>{const{clientX:u,clientY:d,timeStamp:f}=a,p=this.#g;if(f-p>500){this.#g=f;return}this.#g=-1;const{classList:m}=this.div;m.toggle("getElements",!0);const y=document.elementsFromPoint(u,d);if(m.toggle("getElements",!1),!this.div.contains(y[0]))return;let v;const _=new RegExp(`^${So}[0-9]+$`);for(const S of y)if(_.test(S.id)){v=S.id;break}if(!v)return;const w=this.#r.get(v);w?.annotationElementId===null&&(a.stopPropagation(),a.preventDefault(),w.dblclick(a))},{signal:r,capture:!0})}const t=this.#n,e=[];if(t){const r=new Map,a=new Map;for(const u of this.#b){if(u.disableEditing(),!u.annotationElementId){e.push(u);continue}if(u.serialize()!==null){r.set(u.annotationElementId,u);continue}else a.set(u.annotationElementId,u);this.getEditableAnnotation(u.annotationElementId)?.show(),u.remove()}const o=t.getEditableAnnotations();for(const u of o){const{id:d}=u.data;if(this.#u.isDeletedAnnotationElement(d)){u.updateEdited({deleted:!0});continue}let f=a.get(d);if(f){f.resetAnnotationElement(u),f.show(!1),u.show();continue}f=r.get(d),f&&(this.#u.addChangedExistingAnnotation(f),f.renderAnnotationElement(u)&&f.show(!1)),u.show()}}this.#_(),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const r of Rn.#p.values())n.remove(`${r._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),t?.updateFakeAnnotations(e),this.#o=!1}getEditableAnnotation(t){return this.#n?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#u.getActive()!==t&&this.#u.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#h?.div&&!this.#f){this.#f=new AbortController;const t=this.#u.combinedSignal(this.#f);this.#h.div.addEventListener("pointerdown",this.#v.bind(this),{signal:t}),this.#h.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#h?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#h.div.classList.remove("highlighting"))}#v(t){this.#u.unselectAll();const{target:e}=t;if(e===this.#h.div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&this.#h.div.contains(e)){const{isMac:n}=Ue.platform;if(t.button!==0||t.ctrlKey&&n)return;this.#u.showAllEditors("highlight",!0,!0),this.#h.div.classList.add("free"),this.toggleDrawing(),fe.startHighlighting(this,this.#u.direction==="ltr",{target:this.#h.div,x:t.x,y:t.y}),this.#h.div.addEventListener("pointerup",()=>{this.#h.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#u._signal}),t.preventDefault()}}enableClick(){if(this.#s)return;this.#s=new AbortController;const t=this.#u.combinedSignal(this.#s);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#s?.abort(),this.#s=null}attach(t){this.#r.set(t.id,t);const{annotationElementId:e}=t;e&&this.#u.isDeletedAnnotationElement(e)&&this.#u.removeDeletedAnnotationElement(t)}detach(t){this.#r.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#o&&t.annotationElementId&&this.#u.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#u.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#u.addDeletedAnnotationElement(t),gt.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#u.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#c),this.#u.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#a&&(t._focusEventsAllowed=!1,this.#a=setTimeout(()=>{this.#a=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#u._signal}),e.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),n=()=>{t.remove()};this.addCommands({cmd:e,undo:n,mustExec:!1})}getEditorByUID(t){for(const e of this.#r.values())if(e.uid===t)return e;return null}getNextId(){return this.#u.getId()}get#y(){return Rn.#p.get(this.#u.getMode())}combinedSignal(t){return this.#u.combinedSignal(t)}#E(t){const e=this.#y;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#y?.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await this.#u.updateMode(t.mode);const{offsetX:n,offsetY:r}=this.#S(),a=this.getNextId(),o=this.#E({parent:this,id:a,x:n,y:r,uiManager:this.#u,isCentered:!0,...e});o&&this.add(o)}async deserialize(t){return await Rn.#p.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#u)||null}createAndAddNewEditor(t,e,n={}){const r=this.getNextId(),a=this.#E({parent:this,id:r,x:t.offsetX,y:t.offsetY,uiManager:this.#u,isCentered:e,...n});return a&&this.add(a),a}get boundingClientRect(){return this.div.getBoundingClientRect()}#S(){const{x:t,y:e,width:n,height:r}=this.boundingClientRect,a=Math.max(0,t),o=Math.max(0,e),u=Math.min(window.innerWidth,t+n),d=Math.min(window.innerHeight,e+r),f=(a+u)/2-t,p=(o+d)/2-e,[m,y]=this.viewport.rotation%180===0?[f,p]:[p,f];return{offsetX:m,offsetY:y}}addNewEditor(t={}){this.createAndAddNewEditor(this.#S(),!0,t)}setSelected(t){this.#u.setSelected(t)}toggleSelected(t){this.#u.toggleSelected(t)}unselect(t){this.#u.unselect(t)}pointerup(t){const{isMac:e}=Ue.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!this.#i||(this.#i=!1,this.#y?.isDrawer&&this.#y.supportMultipleDrawings))return;if(!this.#e){this.#e=!0;return}const n=this.#u.getMode();if(n===Tt.STAMP||n===Tt.SIGNATURE){this.#u.unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){if(this.#u.getMode()===Tt.HIGHLIGHT&&this.enableTextSelection(),this.#i){this.#i=!1;return}const{isMac:e}=Ue.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(this.#i=!0,this.#y?.isDrawer){this.startDrawingSession(t);return}const n=this.#u.getActive();this.#e=!n||n.isEmpty()}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),this.#l){this.#y.startDrawing(this,this.#u,!1,t);return}this.#u.setCurrentDrawingSession(this),this.#l=new AbortController;const e=this.#u.combinedSignal(this.#l);this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(this.#d=null,this.commitOrRemove())},{signal:e}),this.#y.startDrawing(this,this.#u,!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&(this.#d=e);return}this.#d&&setTimeout(()=>{this.#d?.focus(),this.#d=null},0)}endDrawingSession(t=!1){return this.#l?(this.#u.setCurrentDrawingSession(null),this.#l.abort(),this.#l=null,this.#d=null,this.#y.endDrawing(t)):null}findNewParent(t,e,n){const r=this.#u.findParent(e,n);return r===null||r===this?!1:(r.changeParent(t),!0)}commitOrRemove(){return this.#l?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#l&&this.#y.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#u.getActive()?.parent===this&&(this.#u.commitOrRemove(),this.#u.setActiveEditor(null)),this.#a&&(clearTimeout(this.#a),this.#a=null);for(const t of this.#r.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#r.clear(),this.#u.removeLayer(this)}#_(){for(const t of this.#r.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,Hi(this.div,t);for(const e of this.#u.getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){this.#u.commitOrRemove(),this.#_();const e=this.viewport.rotation,n=t.rotation;if(this.viewport=t,Hi(this.div,{rotation:n}),e!==n)for(const r of this.#r.values())r.rotate(n)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#u.viewParameters.realScale}}class Le{#t=null;#e=new Map;#n=new Map;static#s=0;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#t){this.#t=t;return}if(this.#t!==t){if(this.#e.size>0)for(const e of this.#e.values())e.remove(),t.append(e);this.#t=t}}static get _svgFactory(){return Et(this,"_svgFactory",new Hc)}static#a(t,[e,n,r,a]){const{style:o}=t;o.top=`${100*n}%`,o.left=`${100*e}%`,o.width=`${100*r}%`,o.height=`${100*a}%`}#r(){const t=Le._svgFactory.create(1,1,!0);return this.#t.append(t),t.setAttribute("aria-hidden",!0),t}#i(t,e){const n=Le._svgFactory.createElement("clipPath");t.append(n);const r=`clip_${e}`;n.setAttribute("id",r),n.setAttribute("clipPathUnits","objectBoundingBox");const a=Le._svgFactory.createElement("use");return n.append(a),a.setAttribute("href",`#${e}`),a.classList.add("clip"),r}#o(t,e){for(const[n,r]of Object.entries(e))r===null?t.removeAttribute(n):t.setAttribute(n,r)}draw(t,e=!1,n=!1){const r=Le.#s++,a=this.#r(),o=Le._svgFactory.createElement("defs");a.append(o);const u=Le._svgFactory.createElement("path");o.append(u);const d=`path_p${this.pageIndex}_${r}`;u.setAttribute("id",d),u.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#n.set(r,u);const f=n?this.#i(o,d):null,p=Le._svgFactory.createElement("use");return a.append(p),p.setAttribute("href",`#${d}`),this.updateProperties(a,t),this.#e.set(r,a),{id:r,clipPathId:`url(#${f})`}}drawOutline(t,e){const n=Le.#s++,r=this.#r(),a=Le._svgFactory.createElement("defs");r.append(a);const o=Le._svgFactory.createElement("path");a.append(o);const u=`path_p${this.pageIndex}_${n}`;o.setAttribute("id",u),o.setAttribute("vector-effect","non-scaling-stroke");let d;if(e){const m=Le._svgFactory.createElement("mask");a.append(m),d=`mask_p${this.pageIndex}_${n}`,m.setAttribute("id",d),m.setAttribute("maskUnits","objectBoundingBox");const y=Le._svgFactory.createElement("rect");m.append(y),y.setAttribute("width","1"),y.setAttribute("height","1"),y.setAttribute("fill","white");const v=Le._svgFactory.createElement("use");m.append(v),v.setAttribute("href",`#${u}`),v.setAttribute("stroke","none"),v.setAttribute("fill","black"),v.setAttribute("fill-rule","nonzero"),v.classList.add("mask")}const f=Le._svgFactory.createElement("use");r.append(f),f.setAttribute("href",`#${u}`),d&&f.setAttribute("mask",`url(#${d})`);const p=f.cloneNode();return r.append(p),f.classList.add("mainOutline"),p.classList.add("secondaryOutline"),this.updateProperties(r,t),this.#e.set(n,r),n}finalizeDraw(t,e){this.#n.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;const{root:n,bbox:r,rootClass:a,path:o}=e,u=typeof t=="number"?this.#e.get(t):t;if(u){if(n&&this.#o(u,n),r&&Le.#a(u,r),a){const{classList:d}=u;for(const[f,p]of Object.entries(a))d.toggle(f,p)}if(o){const f=u.firstElementChild.firstElementChild;this.#o(f,o)}}}updateParent(t,e){if(e===this)return;const n=this.#e.get(t);n&&(e.#t.append(n),this.#e.delete(t),e.#e.set(t,n))}remove(t){this.#n.delete(t),this.#t!==null&&(this.#e.get(t).remove(),this.#e.delete(t))}destroy(){this.#t=null;for(const t of this.#e.values())t.remove();this.#e.clear(),this.#n.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:Sf};globalThis.pdfjsLib={AbortException:ri,AnnotationEditorLayer:Rn,AnnotationEditorParamsType:Lt,AnnotationEditorType:Tt,AnnotationEditorUIManager:ai,AnnotationLayer:Qf,AnnotationMode:ni,AnnotationType:ve,applyOpacity:qE,build:Q1,ColorPicker:ks,createValidAbsoluteUrl:Pv,CSSConstants:$E,DOMSVGFactory:Hc,DrawLayer:Le,FeatureTest:Ue,fetchData:Do,findContrastColor:GE,getDocument:rw,getFilenameFromUrl:BE,getPdfFilenameFromUrl:IE,getRGB:jo,getUuid:Uv,getXfaPageViewport:FE,GlobalWorkerOptions:zi,ImageKind:Rc,InvalidPDFException:pf,isDataScheme:Qc,isPdfFile:zf,isValidExplicitDest:e1,MathClamp:Ye,noContextMenu:Ds,normalizeUnicode:jE,OPS:xo,OutputScale:sn,PasswordResponses:EE,PDFDataRangeTransport:aw,PDFDateString:gf,PDFWorker:To,PermissionFlag:xE,PixelsPerInch:na,RenderingCancelledException:Ff,renderRichText:Hv,ResponseException:Fc,setLayerDimensions:Hi,shadow:Et,SignatureExtractor:Gr,stopEvent:ue,SupportedImageMimeTypes:mf,TextLayer:Ve,TouchManager:Jc,updateUrlHash:Bv,Util:at,VerbosityLevel:Yc,version:W1,XfaLayer:zv};const AT="/budget-app/assets/pdf.worker.min-CXgfMxHN.mjs";zi&&(zi.workerSrc=AT);async function ST(c){const t=typeof c.arrayBuffer=="function"?await c.arrayBuffer():c,e=await rw({data:t}).promise,n=[];for(let r=1;r<=e.numPages;r++){const u=(await(await e.getPage(r)).getTextContent()).items.map(d=>"str"in d?d.str:"").join(" ").replace(/\s+/g," ").trim();u&&n.push(u)}return n.join(`
`)}function xT(c=""){if(!c)return[];const t=c.split(/\r?\n/).map(r=>r.replace(/\s+/g," ").trim()).filter(Boolean),e=/^(\d{4}[\/-]\d{1,2}[\/-]\d{1,2}|\d{1,2}[\/-]\d{1,2}[\/-]\d{2,4})/,n=[];for(const r of t){const a=r.match(e);if(!a)continue;const o=r.match(/([-+]?\(?\$?\d[\d,]*(?:\.\d{2})?\)?)(?!.*[-+]?\(?\$?\d[\d,]*(?:\.\d{2})?\)?)/);if(!o)continue;const u=Uf(a[0]),d=yo(o[0]);if(!u||Number.isNaN(d))continue;const f=r.slice(a[0].length,r.lastIndexOf(o[0])).trim();n.push({date:u,description:f||"Transaction",amount:d,category:If(f,d)})}return n}async function ET(c){const t=await ST(c),e=xT(t);return{text:t,rows:e}}function TT({onTransactionsParsed:c=()=>{}}){const[t,e]=Pe.useState(""),[n,r]=Pe.useState(""),[a,o]=Pe.useState(""),[u,d]=Pe.useState(""),[f,p]=Pe.useState(""),[m,y]=Pe.useState([]),[v,_]=Pe.useState({date:"",description:"",amount:""}),[w,S]=Pe.useState([]);function E(){e(""),r(""),p(""),y([]),_({date:"",description:"",amount:""}),S([])}async function R(M){const I=M.target.files?.[0];if(!I)return;if(E(),o(I.name),r(""),(I.name||"").toLowerCase().endsWith(".pdf")||I.type==="application/pdf"){e("Extracting transactions from PDF...");try{const{text:st,rows:ht}=await ET(I);p(st);const wt=Ub(st,I.name||"");if(d(wt||""),!ht.length){S([]),e(""),r("We couldn't detect any transactions in that PDF. Try a different export or use CSV.");return}S(ht),e(`Parsed ${ht.length} transactions from PDF. Review the preview below, then import.`)}catch(st){console.error("PDF parse error:",st),e(""),r("We couldn't read this PDF. Try downloading it as a CSV or a different PDF format.")}return}e("Reading file...");const Z=new FileReader;Z.onload=st=>{try{const ht=String(st.target?.result||"");p(ht);const wt=Ub(ht,I.name||"");d(wt||"");const _t=AE(ht);if(y(_E(ht)),!_t.length){S([]),e("We couldn't automatically detect the right columns. Use the mapping controls below and click Re-parse.");return}S(_t),e(`Parsed ${_t.length} transactions. Review the preview below, tweak the mapping if needed, then import.`)}catch(ht){console.error("CSV parse error:",ht),r("We couldn't understand this CSV. Try a different export format."),e("")}},Z.onerror=()=>{r("Could not read the file."),e("")},Z.readAsText(I)}function T(){if(!f)return;const M={dateIndex:v.date===""?null:Number.parseInt(v.date,10),descIndex:v.description===""?null:Number.parseInt(v.description,10),amountIndex:v.amount===""?null:Number.parseInt(v.amount,10)},I=SE(f,M);if(!I.length){r("No rows were parsed with that mapping. Try different columns or reset to auto-detect."),S([]),e("");return}r(""),S(I),e(`Parsed ${I.length} transactions with your custom mapping. Review the preview, then import.`)}function O(){if(!w.length)return;const M=w,I=f,X=a;c(M,I),e(`Imported ${M.length} transactions${X?` from ${X}`:""}. View them under the target account.`),S([]),p(""),y([]),_({date:"",description:"",amount:""})}const N=Math.min(10,w.length),k=w.reduce((M,I)=>M+(typeof I.amount=="number"?I.amount:0),0);return x.jsxs("div",{className:"space-y-2 text-xs",children:[x.jsxs("p",{className:"text-slate-400",children:["Upload a"," ",x.jsx("span",{className:"text-cyan-300 font-semibold",children:".csv"})," or"," ",x.jsx("span",{className:"text-cyan-300 font-semibold",children:".pdf"})," bank statement. We'll parse basic fields like date, description, and amount, then route it into the right account."]}),x.jsxs("label",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md border border-cyan-400/70 text-cyan-200 bg-cyan-500/10 hover:bg-cyan-500/20 cursor-pointer transition",children:[x.jsx("span",{children:"Choose CSV file"}),x.jsx("input",{type:"file",accept:".csv,text/csv,application/pdf",className:"hidden",onChange:R})]}),a&&x.jsxs("p",{className:"text-[0.7rem] text-slate-500",children:["Selected: ",x.jsx("span",{className:"text-slate-300",children:a})]}),u&&x.jsxs("p",{className:"text-[0.7rem] text-slate-400",children:["Detected bank format:"," ",x.jsx("span",{className:"text-cyan-300 font-semibold",children:u})]}),t&&x.jsx("p",{className:"text-[0.7rem] text-slate-400",children:t}),n&&x.jsx("p",{className:"text-[0.7rem] text-rose-400",children:n}),f&&m.length>0&&x.jsxs("div",{className:"mt-2 border border-slate-700 rounded-md p-2 space-y-2",children:[x.jsx("p",{className:"text-[0.7rem] text-slate-400",children:"If dates/amounts look wrong, override the mapping:"}),x.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:["date","description","amount"].map(M=>x.jsxs("label",{className:"flex flex-col gap-1 text-[0.7rem]",children:[x.jsx("span",{className:"uppercase tracking-[0.16em] text-slate-500",children:M}),x.jsxs("select",{className:"bg-[#05060F] border border-slate-700 rounded px-2 py-1 text-slate-200",value:v[M]??"",onChange:I=>_(X=>({...X,[M]:I.target.value})),children:[x.jsx("option",{value:"",children:"Auto detect"}),m.map((I,X)=>x.jsxs("option",{value:X,children:[I," (column ",X+1,")"]},X))]})]},M))}),x.jsx("button",{type:"button",onClick:T,className:"mt-1 px-3 py-1.5 text-[0.7rem] rounded-md border border-cyan-400/70 text-cyan-100 bg-cyan-500/10 hover:bg-cyan-500/20 transition",children:"Re-parse with mapping"})]}),w.length>0&&x.jsxs("div",{className:"mt-2 border border-slate-700 rounded-md p-2 space-y-2",children:[x.jsxs("div",{className:"flex items-center justify-between text-[0.7rem] text-slate-400",children:[x.jsxs("span",{children:["Previewing ",N," of ",w.length," rows"]}),x.jsxs("span",{children:["Net amount:"," ",x.jsxs("span",{className:k<0?"text-rose-300":"text-emerald-300",children:[k<0?"-":"","$",Math.abs(k).toFixed(2)]})]})]}),x.jsx("div",{className:"max-h-40 overflow-auto text-[0.7rem]",children:x.jsxs("table",{className:"w-full text-left border-collapse",children:[x.jsx("thead",{className:"sticky top-0 bg-[#05060F]",children:x.jsxs("tr",{className:"border-b border-slate-700",children:[x.jsx("th",{className:"py-1 pr-2 font-semibold text-slate-300",children:"Date"}),x.jsx("th",{className:"py-1 pr-2 font-semibold text-slate-300",children:"Description"}),x.jsx("th",{className:"py-1 text-right font-semibold text-slate-300",children:"Amount"})]})}),x.jsx("tbody",{children:w.slice(0,N).map((M,I)=>x.jsxs("tr",{className:"border-b border-slate-800/60",children:[x.jsx("td",{className:"py-1 pr-2 text-slate-200",children:M.date}),x.jsx("td",{className:"py-1 pr-2 text-slate-300",children:M.description}),x.jsxs("td",{className:`py-1 text-right ${M.amount<0?"text-rose-300":"text-emerald-300"}`,children:[M.amount<0?"-":"","$",Math.abs(M.amount).toFixed(2)]})]},I))})]})}),x.jsxs("div",{className:"flex gap-2 mt-1",children:[x.jsx("button",{type:"button",onClick:O,className:"px-3 py-1.5 text-[0.7rem] rounded-md border border-emerald-400/70 text-emerald-100 bg-emerald-500/10 hover:bg-emerald-500/20 transition",children:"Import these transactions"}),x.jsx("button",{type:"button",onClick:E,className:"px-3 py-1.5 text-[0.7rem] rounded-md border border-slate-600 text-slate-200 hover:border-slate-400 transition",children:"Discard preview"})]})]}),x.jsx("p",{className:"text-[0.7rem] text-slate-500",children:"Tip: Most banks let you export recent transactions as CSV from their website."})]})}function Sc({label:c,value:t,accent:e}){return x.jsxs("div",{className:"flex flex-col",children:[x.jsx("span",{className:"text-[0.65rem] uppercase tracking-[0.22em] text-slate-500",children:c}),x.jsxs("span",{className:`text-base font-semibold ${e}`,children:["$",t.toFixed(2)]})]})}const CT=["monthOverview","accountSnapshot","goals","csvImport"];function RT({month:c="",income:t=0,fixed:e=0,variable:n=0,leftover:r=0,goals:a=[],transactions:o=[],accounts:u=[],currentAccountId:d,onChangeCurrentAccount:f=()=>{},onOpenGoal:p=()=>{},onCreateGoal:m=()=>{},onCsvImported:y=()=>{},currentAccountBalance:v=0,totalBalance:_=0,sectionsOrder:w}){const S=Number(t)||0,E=Number(e)||0,R=Number(n)||0,T=Number(r)||0,O=S>0?(S-T)/S*100:0,N=w&&w.length?w:CT,k=Array.isArray(o)&&o.length>0,[M,I]=Pe.useState(!1);return Pe.useEffect(()=>{I(!1)},[o]),x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("h1",{className:"text-lg font-semibold text-slate-100",children:c}),x.jsx("span",{className:"text-xs text-slate-400",children:"Overview of this month's money flow"})]}),N.map(X=>{switch(X){case"monthOverview":return x.jsxs(qs,{title:"MONTH OVERVIEW",children:[x.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[x.jsx(Sc,{label:"Income",value:S,accent:"text-emerald-300"}),x.jsx(Sc,{label:"Fixed",value:E,accent:"text-rose-300"}),x.jsx(Sc,{label:"Variable",value:R,accent:"text-amber-300"}),x.jsx(Sc,{label:"Leftover",value:T,accent:"text-cyan-300"})]}),x.jsxs("div",{className:"mt-4",children:[x.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Allocation this month"}),x.jsx(Bf,{value:O})]})]},"monthOverview");case"accountSnapshot":return x.jsxs(qs,{title:"ACCOUNT SNAPSHOT",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{className:"flex flex-col",children:[x.jsx("span",{className:"text-[0.65rem] uppercase tracking-[0.18em] text-slate-500",children:"Current account"}),x.jsx("select",{className:"mt-1 bg-[#05060F] border border-slate-700 rounded-md px-2 py-1 text-[0.75rem] text-slate-100",value:d,onChange:Q=>f(Q.target.value),children:(u||[]).map(Q=>x.jsx("option",{value:Q.id,children:Q.name},Q.id))})]}),x.jsxs("div",{className:"text-right",children:[x.jsx("div",{className:"text-[0.65rem] uppercase tracking-[0.18em] text-slate-500",children:"Balance"}),x.jsxs("div",{className:"text-2xl font-semibold text-cyan-300",children:["$",v.toFixed(2)]}),x.jsxs("div",{className:"text-[0.7rem] text-slate-500",children:["of $",_.toFixed(2)," total"]})]})]}),x.jsx("hr",{className:"my-3 border-slate-800"}),x.jsxs("div",{children:[x.jsx("div",{className:"text-[0.65rem] uppercase tracking-[0.2em] text-slate-500",children:"All accounts"}),x.jsxs("div",{className:"mt-1 text-xl font-semibold text-emerald-300",children:["$",_.toFixed(2)]}),x.jsx("p",{className:"mt-1 text-[0.7rem] text-slate-500",children:"Total estimated cash across all linked accounts."})]})]},"accountSnapshot");case"goals":return x.jsxs("div",{className:"space-y-3",children:[x.jsx("h2",{className:"text-xs tracking-[0.25em] text-slate-400 uppercase",children:"Goals"}),x.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:a.map(Q=>x.jsx(vE,{goal:Q,onClick:()=>p(Q.id)},Q.id))}),x.jsx("button",{type:"button",onClick:m,className:"mt-1 px-4 py-2 rounded-lg border border-cyan-400/70 text-xs text-cyan-200 bg-cyan-500/10 hover:bg-cyan-500/20 transition",children:"+ Add Goal"})]},"goals");case"csvImport":return x.jsxs(qs,{title:"BANK STATEMENT IMPORT (CSV)",children:[x.jsx(TT,{onTransactionsParsed:(Q,Z)=>{I(!1),y(Q,Z)}}),k&&x.jsxs("div",{className:"mt-4 space-y-2",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("h3",{className:"text-xs uppercase tracking-[0.18em] text-slate-400",children:"Current account transactions"}),x.jsx("button",{type:"button",className:"text-[0.7rem] px-2 py-1 rounded-md border border-slate-600 text-slate-200 hover:border-cyan-400 transition",onClick:()=>I(Q=>!Q),children:M?"Hide":"Show"})]}),M&&x.jsx("div",{className:"max-h-64 overflow-auto border border-slate-800 rounded-lg",children:x.jsxs("table",{className:"w-full text-xs text-left",children:[x.jsx("thead",{className:"bg-slate-900 text-slate-300",children:x.jsxs("tr",{children:[x.jsx("th",{className:"px-2 py-1",children:"Date"}),x.jsx("th",{className:"px-2 py-1",children:"Description"}),x.jsx("th",{className:"px-2 py-1",children:"Category"}),x.jsx("th",{className:"px-2 py-1 text-right",children:"Amount"})]})}),x.jsx("tbody",{className:"divide-y divide-slate-800",children:o.map((Q,Z)=>x.jsxs("tr",{className:"hover:bg-slate-900/70",children:[x.jsx("td",{className:"px-2 py-1 text-slate-300",children:Q.date||"-"}),x.jsx("td",{className:"px-2 py-1 text-slate-200",children:Q.description||"-"}),x.jsx("td",{className:"px-2 py-1 text-slate-300",children:Q.category||"Other"}),x.jsx("td",{className:`px-2 py-1 text-right ${typeof Q.amount=="number"&&Q.amount<0?"text-rose-300":"text-emerald-300"}`,children:typeof Q.amount!="number"||Number.isNaN(Q.amount)?"-":`$${Q.amount.toFixed(2)}`})]},Z))})]})})]})]},"csvImport");default:return null}})]})}function dy(c){return c.reduce((t,e)=>t+e.amount,0)}function mw(c){return(Array.isArray(c?.transactions)?c.transactions:[]).reduce((e,n)=>e+(typeof n.amount=="number"?n.amount:0),0)}function zd(c){return(c||[]).map(t=>({...t,startingBalance:typeof t.startingBalance=="number"?t.startingBalance:0}))}function OT(c,t){const e=a=>`${(a.date||"").trim()}|${(a.description||"").trim().toLowerCase()}|${isNaN(a.amount)?"NaN":a.amount}`,n=new Set(c.map(a=>e(a))),r=[...c];for(const a of t){const o=e(a);n.has(o)||(r.push(a),n.add(o))}return r}function fy(c=[]){const t=new Set;return(c||[]).forEach(e=>{const n=(e.description||"").trim().toLowerCase();n&&t.add(n)}),t}function NT(c=[]){if(!c.length)return"checking";let t=0,e=0;for(const r of c)typeof r.amount=="number"&&(r.amount<0?t++:r.amount>0&&e++);return t===0&&e===0?"checking":t/(t+e)>=.7?"credit":"checking"}function kT(c=[],t=""){const e=hf(t);if(e)for(const u of uf){const d=(u.key||u.match||"").toLowerCase();if(d&&e.includes(d))return`${u.label} Account`}if(c.length){const u=c.slice(0,20).map(f=>f.description||"").join(" "),d=hf(u);if(d)for(const f of uf){const p=(f.key||f.match||"").toLowerCase();if(p&&d.includes(p))return`${f.label} Account`}}if(!c.length)return"Imported Account";const n=(c[0].description||"").trim();if(!n)return"Imported Account";const r=n.split(/\s+/).filter(u=>u.length>3);if(!r.length)return"Imported Account";const o=r[0].replace(/[^a-z0-9]/gi," ").trim();return o?o.charAt(0).toUpperCase()+o.slice(1)+" Account":"Imported Account"}function DT(c=[],t,e=[]){const n=(c||[]).filter(d=>Array.isArray(d.transactions)&&d.transactions.length>0);if(!n.length)return null;const r=fy(e);if(!r.size)return t;let a=null,o=0;for(const d of n){const f=fy(d.transactions);if(!f.size)continue;let p=0;for(const m of r)f.has(m)&&p++;p>o&&(o=p,a=d.id)}const u=r.size>0?o/r.size:0;return a&&(o>=3||u>=.2)?a:null}function MT(c=[],t,e=[],n=""){const r=DT(c,t,e);if(r){const f=(c||[]).map(m=>m.id===r?{...m,transactions:OT(m.transactions||[],e)}:m),p=(c||[]).find(m=>m.id===r);return{targetAccountId:r,targetAccountName:p?.name||"Account",accounts:f,createdNew:!1}}const a=NT(e),o=kT(e,n),u=o.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")+"-"+Date.now(),d={id:u,name:o,type:a,startingBalance:0,transactions:e};return{targetAccountId:u,targetAccountName:o,accounts:[...c||[],d],createdNew:!0}}function jT({accounts:c=[],currentAccountId:t,onChangeCurrentAccount:e=()=>{},onCreateAccount:n=()=>{},onDeleteAccount:r=()=>{},onSetAccountBalance:a=()=>{},onRenameAccount:o=()=>{}}){const u=Array.isArray(c)&&c.length>0,[d,f]=ut.useState([]),p=m=>{f(y=>y.includes(m)?y.filter(v=>v!==m):[...y,m])};return x.jsxs("div",{className:"space-y-4",children:[x.jsxs("header",{className:"flex items-center justify-between",children:[x.jsx("h1",{className:"text-lg font-semibold text-slate-100",children:"Accounts"}),x.jsx("button",{type:"button",onClick:n,className:"px-2 py-1 rounded-md bg-emerald-500 hover:bg-emerald-400 text-xs font-medium text-slate-900",children:"+ New account"})]}),x.jsxs(qs,{title:"ALL ACCOUNTS",children:[!u&&x.jsx("p",{className:"text-xs text-slate-400",children:"No accounts yet. Create one to start tracking balances."}),u&&x.jsx("div",{className:"space-y-2",children:c.map(m=>{const y=Array.isArray(m.transactions)?m.transactions.length:0,v=mw(m),_=(typeof m.startingBalance=="number"?m.startingBalance:0)+v,w=Array.isArray(m.transactions)?m.transactions.slice().filter(R=>R&&typeof R=="object").sort((R,T)=>{const O=Date.parse(R.date),N=Date.parse(T.date),k=Number.isFinite(O),M=Number.isFinite(N);return!k&&!M?0:k?M?N-O:-1:1}):[],S=w.length>0,E=d.includes(m.id);return x.jsxs("div",{className:`space-y-2 rounded-md px-3 py-2 text-xs ${m.id===t?"bg-slate-800/70 border border-cyan-400/50":"bg-slate-900/60 border border-slate-700/70"}`,children:[x.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[x.jsxs("div",{className:"flex-1",children:[x.jsx("input",{className:"bg-transparent text-slate-100 font-medium text-xs w-full focus:outline-none",value:m.name,onChange:R=>o(m.id,R.target.value)}),x.jsxs("p",{className:"text-[11px] text-slate-400",children:["Type: ",m.type||"checking"]}),x.jsxs("p",{className:"text-[11px] text-slate-400",children:["Transactions:"," ",x.jsx("span",{className:"text-slate-200",children:y}),"  Net:"," ",x.jsxs("span",{className:_>=0?"text-emerald-300":"text-rose-300",children:["$",_.toFixed(2)]})]})]}),x.jsxs("div",{className:"flex flex-col items-end",children:[x.jsx("label",{className:"text-[11px] text-slate-400",children:"Starting balance"}),x.jsx("input",{type:"number",className:"w-24 bg-slate-900/80 border border-slate-700 rounded px-1 py-0.5 text-right text-xs font-mono text-slate-100 focus:outline-none focus:ring-1 focus:ring-cyan-400",value:m.startingBalance??0,onChange:R=>a(m.id,parseFloat(R.target.value||"0"))})]}),x.jsxs("div",{className:"flex flex-col items-end gap-1",children:[x.jsx("button",{type:"button",onClick:()=>{e(m.id),p(m.id)},className:"px-2 py-0.5 rounded text-[11px] border border-slate-500 hover:border-cyan-400",children:E?"Hide":"View"}),x.jsx("button",{type:"button",onClick:()=>r(m.id),className:"px-2 py-0.5 rounded text-[11px] text-red-300 hover:bg-red-500/10",children:"Delete"})]})]}),x.jsxs("div",{className:"border-t border-slate-800/70 pt-2",children:[!S&&x.jsx("p",{className:"mt-1 text-[0.65rem] text-slate-500",children:"No transactions imported yet."}),E&&S&&x.jsx("div",{className:"mt-2 max-h-72 overflow-auto rounded-md border border-slate-800/50",children:x.jsxs("table",{className:"w-full text-[0.7rem] text-left",children:[x.jsx("thead",{className:"bg-slate-900 text-slate-300 sticky top-0",children:x.jsxs("tr",{children:[x.jsx("th",{className:"px-2 py-1",children:"Date"}),x.jsx("th",{className:"px-2 py-1",children:"Description"}),x.jsx("th",{className:"px-2 py-1",children:"Category"}),x.jsx("th",{className:"px-2 py-1 text-right",children:"Amount"})]})}),x.jsx("tbody",{className:"divide-y divide-slate-800/70",children:w.map((R,T)=>{const O=Number(R.amount),N=Number.isFinite(O)?`$${O.toFixed(2)}`:"-";return x.jsxs("tr",{children:[x.jsx("td",{className:"px-2 py-1 text-slate-300",children:R.date||"-"}),x.jsx("td",{className:"px-2 py-1 text-slate-200",children:R.description||"Transaction"}),x.jsx("td",{className:"px-2 py-1 text-slate-400",children:R.category||"Other"}),x.jsx("td",{className:`px-2 py-1 text-right ${O<0?"text-rose-300":"text-emerald-300"}`,children:N})]},R.id||`${m.id}-full-${T}`)})})]})})]})]},m.id)})})]})]})}function LT({month:c,budget:t,totals:e,onBudgetChange:n}){const r=Number(t?.income??0),a=Array.isArray(t?.fixed)?t.fixed:[],o=Array.isArray(t?.variable)?t.variable:[];function u(){const p=window.prompt("Monthly income amount:",r.toString());if(p===null)return;const m=Number(p);if(!Number.isFinite(m)){window.alert("Enter a valid number for income.");return}n({...t,income:m})}function d(p){const m=window.prompt(`New ${p} item name:`);if(!m)return;const y=window.prompt(`Amount for "${m}" (numbers only):`),v=Number(y);if(!Number.isFinite(v)){window.alert("That didn't look like a valid number.");return}const _={id:`budget-${p}-${Date.now()}`,label:m,amount:v},S=[...p==="fixed"?a:o,_],E={...t,[p]:S};n(E)}function f(p,m){if(!window.confirm("Delete this item?"))return;const v=(p==="fixed"?a:o).filter((w,S)=>S!==m),_={...t,[p]:v};n(_)}return x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("h1",{className:"text-lg font-semibold text-slate-100",children:[c," Budget"]}),x.jsx("span",{className:"text-xs text-slate-400",children:"Income  Expenses  Goals"})]}),x.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[x.jsxs(qs,{title:"INCOME",children:[x.jsxs("div",{className:"text-3xl font-semibold text-emerald-300",children:["$",r.toFixed(2)]}),x.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Total take-home income for the active month."}),x.jsx("button",{className:"mt-3 px-3 py-1.5 text-xs rounded-md border border-emerald-400/70 text-emerald-200 bg-emerald-500/10 hover:bg-emerald-500/20 transition",onClick:u,children:"Edit Income"})]}),x.jsxs(qs,{title:"FIXED EXPENSES",children:[x.jsx(py,{items:a,total:e.fixedTotal,onDelete:p=>f("fixed",p)}),x.jsx("button",{className:"mt-3 px-3 py-1.5 text-xs rounded-md border border-rose-400/70 text-rose-200 bg-rose-500/10 hover:bg-rose-500/20 transition",onClick:()=>d("fixed"),children:"+ Add Fixed Expense"})]}),x.jsxs(qs,{title:"VARIABLE SPENDING",children:[x.jsx(py,{items:o,total:e.variableTotal,onDelete:p=>f("variable",p)}),x.jsx("button",{className:"mt-3 px-3 py-1.5 text-xs rounded-md border border-amber-400/70 text-amber-200 bg-amber-500/10 hover:bg-amber-500/20 transition",onClick:()=>d("variable"),children:"+ Add Variable Expense"})]}),x.jsxs(qs,{title:"REMAINING FOR GOALS",children:[x.jsxs("div",{className:"text-2xl font-semibold text-cyan-300",children:["$",e.leftover.toFixed(2)]}),x.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"This is what's left after income minus all listed expenses."})]})]})]})}function py({items:c=[],total:t=0,onDelete:e}){return x.jsxs("div",{className:"space-y-2 text-sm",children:[c.length===0&&x.jsx("p",{className:"text-xs text-slate-500",children:"No items yet."}),c.map((n,r)=>{const a=Number(n?.amount??0),o=n?.label||n?.name||`Item ${r+1}`;return x.jsxs("div",{className:"flex items-center justify-between text-slate-200 gap-2",children:[x.jsxs("div",{className:"flex-1 flex justify-between",children:[x.jsx("span",{children:o}),x.jsxs("span",{className:"text-slate-300",children:["$",a.toFixed(2)]})]}),e&&x.jsx("button",{className:"text-[0.65rem] text-slate-500 hover:text-rose-400",onClick:()=>e(r),children:""})]},(n?.id||o)+r)}),x.jsxs("div",{className:"mt-2 pt-2 border-t border-slate-700 flex items-center justify-between text-xs",children:[x.jsx("span",{className:"uppercase tracking-[0.18em] text-slate-500",children:"Total"}),x.jsxs("span",{className:"text-slate-100",children:["$",t.toFixed(2)]})]})]})}function PT({transactions:c=[],accountName:t="",onUpdateTransaction:e=()=>{},onDeleteTransaction:n=()=>{}}){const r=Array.isArray(c)&&c.length>0,[a,o]=ut.useState({query:"",minAmount:"",maxAmount:""}),[u,d]=ut.useState("date"),[f,p]=ut.useState("desc"),m=S=>E=>{o(R=>({...R,[S]:E.target.value}))},y=()=>{o({query:"",minAmount:"",maxAmount:""})},v=a.query||a.minAmount||a.maxAmount,_=()=>{p(S=>S==="asc"?"desc":"asc")},w=ut.useMemo(()=>r?[...c.map((T,O)=>({tx:T,index:O})).filter(({tx:T})=>{const O=a.query.trim().toLowerCase(),N=Number(T.amount);if(O&&![T.description||"",T.category||""].join(" ").toLowerCase().includes(O))return!1;if(a.minAmount!==""){const k=Number(a.minAmount);if(!Number.isNaN(k)&&!Number.isNaN(N)&&N<k)return!1}if(a.maxAmount!==""){const k=Number(a.maxAmount);if(!Number.isNaN(k)&&!Number.isNaN(N)&&N>k)return!1}return!0})].sort((T,O)=>{const N=T.tx,k=O.tx,M=f==="asc"?1:-1;if(u==="amount"){const Q=Number(N.amount)||0,Z=Number(k.amount)||0;return(Q-Z)*M}if(u==="description"||u==="category"){const Q=(N[u]||"").toLowerCase(),Z=(k[u]||"").toLowerCase();return Q.localeCompare(Z)*M}const I=Date.parse(N.date)||0,X=Date.parse(k.date)||0;return(I-X)*M}):[],[c,a,u,f,r]);return x.jsxs("div",{className:"space-y-4 w-full",children:[x.jsxs("header",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-lg font-semibold text-slate-100",children:"Transactions"}),x.jsx("span",{className:"text-xs text-slate-400",children:"Imported from your bank CSV files"}),x.jsxs("p",{className:"text-[0.65rem] text-slate-500",children:["Currently viewing: ",x.jsx("span",{className:"font-semibold text-cyan-200",children:t||"None"})]})]}),r&&x.jsxs("span",{className:"text-[0.65rem] text-slate-500",children:["Showing ",w.length," of ",c.length]})]}),x.jsxs(qs,{title:"ALL TRANSACTIONS",children:[!r&&x.jsx("p",{className:"text-xs text-slate-400",children:"No transactions yet. Import a CSV on the Dashboard to see them here."}),r&&x.jsxs(x.Fragment,{children:[x.jsxs("div",{className:"mb-3 flex flex-col gap-3 md:flex-row md:items-end md:justify-between",children:[x.jsxs("div",{className:"flex flex-col gap-1 w-full md:w-auto",children:[x.jsx("label",{className:"text-[0.65rem] uppercase tracking-[0.18em] text-slate-500",children:"Search"}),x.jsx("input",{type:"text",value:a.query,onChange:m("query"),placeholder:"Search description or category...",className:"h-8 w-full md:w-64 rounded-md bg-slate-900/70 px-2 text-[0.7rem] text-slate-100 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-cyan-500"})]}),x.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-end md:justify-end",children:[x.jsxs("div",{className:"flex gap-2",children:[x.jsxs("div",{className:"flex flex-col gap-1",children:[x.jsx("label",{className:"text-[0.65rem] uppercase tracking-[0.18em] text-slate-500",children:"Min Amount"}),x.jsx("input",{type:"number",value:a.minAmount,onChange:m("minAmount"),className:"h-8 w-24 rounded-md bg-slate-900/70 px-2 text-[0.7rem] text-slate-100 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-cyan-500"})]}),x.jsxs("div",{className:"flex flex-col gap-1",children:[x.jsx("label",{className:"text-[0.65rem] uppercase tracking-[0.18em] text-slate-500",children:"Max Amount"}),x.jsx("input",{type:"number",value:a.maxAmount,onChange:m("maxAmount"),className:"h-8 w-24 rounded-md bg-slate-900/70 px-2 text-[0.7rem] text-slate-100 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-cyan-500"})]})]}),x.jsx("button",{type:"button",onClick:y,disabled:!v,className:"h-8 px-3 rounded-md border text-[0.7rem] font-medium transition border-slate-600 text-slate-200 hover:border-cyan-400 hover:text-cyan-200 disabled:opacity-40 disabled:cursor-not-allowed",children:"Clear filters"})]})]}),x.jsx("div",{className:"mb-3 flex flex-col sm:flex-row sm:items-center sm:justify-end gap-2 text-[0.7rem]",children:x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"uppercase tracking-[0.18em] text-slate-500",children:"Sort by"}),x.jsxs("select",{value:u,onChange:S=>d(S.target.value),className:"h-8 rounded-md bg-slate-900/70 px-2 text-[0.7rem] text-slate-100 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-cyan-500",children:[x.jsx("option",{value:"date",children:"Date"}),x.jsx("option",{value:"amount",children:"Amount"}),x.jsx("option",{value:"description",children:"Description"}),x.jsx("option",{value:"category",children:"Category"})]}),x.jsx("button",{type:"button",onClick:_,className:"h-8 px-3 rounded-md border border-slate-600 text-slate-200 hover:border-cyan-400 hover:text-cyan-200 transition",children:f==="asc"?"Asc ":"Desc "})]})})]}),r&&w.length===0&&x.jsx("p",{className:"text-xs text-slate-400",children:"No transactions match your current filters."}),r&&w.length>0&&x.jsx("div",{className:"w-full overflow-x-auto",children:x.jsx("div",{className:"min-w-[640px] max-h-[65vh] overflow-y-auto border border-slate-800 rounded-lg",children:x.jsxs("table",{className:"w-full text-[0.7rem] sm:text-xs text-left",children:[x.jsx("thead",{className:"bg-slate-900 text-slate-300 sticky top-0",children:x.jsxs("tr",{children:[x.jsx("th",{className:"px-2 py-1",children:"Date"}),x.jsx("th",{className:"px-2 py-1",children:"Description"}),x.jsx("th",{className:"px-2 py-1",children:"Category"}),x.jsx("th",{className:"px-2 py-1 text-right",children:"Amount"}),x.jsx("th",{className:"px-2 py-1 text-right",children:"Actions"})]})}),x.jsx("tbody",{className:"divide-y divide-slate-800",children:w.map(({tx:S,index:E})=>x.jsxs("tr",{className:"hover:bg-slate-900/70",children:[x.jsx("td",{className:"px-2 py-1 text-slate-300 whitespace-nowrap",children:S.date||"-"}),x.jsx("td",{className:"px-2 py-1 text-slate-200",children:x.jsx("input",{className:"w-full bg-transparent border-b border-slate-700 focus:outline-none focus:border-cyan-400 text-[0.7rem] sm:text-xs",value:S.description||"",onChange:R=>e(E,{description:R.target.value})})}),x.jsx("td",{className:"px-2 py-1 text-slate-300",children:x.jsx("input",{className:"w-full bg-transparent border-b border-slate-700 focus:outline-none focus:border-cyan-400 text-[0.7rem] sm:text-xs",value:S.category||"",onChange:R=>e(E,{category:R.target.value})})}),x.jsx("td",{className:`px-2 py-1 text-right whitespace-nowrap ${S.amount<0?"text-rose-300":"text-emerald-300"}`,children:isNaN(S.amount)?"-":`$${S.amount.toFixed(2)}`}),x.jsx("td",{className:"px-2 py-1 text-right",children:x.jsx("button",{className:"text-[0.7rem] px-2 py-1 rounded-md border border-rose-500/60 text-rose-300 hover:bg-rose-400/10",onClick:()=>{window.confirm("Delete this transaction from this account?")&&n(E)},children:"Delete"})})]},E))})]})})})]})]})}function BT({onEdit:c,onDelete:t,onDuplicate:e,onExport:n}){const[r,a]=ut.useState(!1);function o(){a(!1),t?.()}return x.jsxs("div",{className:"relative",children:[x.jsx("button",{type:"button",className:"rounded-full border border-slate-600/70 px-3 py-1 text-xs text-slate-300 hover:border-cyan-400/60",onClick:()=>a(u=>!u),children:"Manage goal "}),x.jsxs("div",{className:`absolute right-0 mt-2 w-40 rounded-xl border border-slate-700/70 bg-[#05060F] text-xs shadow-lg transition-all duration-150 ${r?"opacity-100 translate-y-0 pointer-events-auto":"opacity-0 -translate-y-1 pointer-events-none"}`,children:[x.jsx("button",{type:"button",className:"block w-full px-3 py-2 text-left text-slate-200 hover:bg-slate-800/70",onClick:()=>{a(!1),c?.()},children:"Edit goal"}),x.jsx("button",{type:"button",className:"block w-full px-3 py-2 text-left text-slate-200 hover:bg-slate-800/70",onClick:()=>{a(!1),e?.()},children:"Duplicate goal"}),x.jsx("button",{type:"button",className:"block w-full px-3 py-2 text-left text-slate-200 hover:bg-slate-800/70",onClick:()=>{a(!1),n?.()},children:"Export progress"}),x.jsx("button",{type:"button",className:"block w-full px-3 py-2 text-left text-rose-300 hover:bg-slate-800/70",onClick:()=>{window.confirm("Delete this goal?")&&o()},children:"Delete goal"})]})]})}function IT({goal:c,onEditGoal:t=()=>{},onDeleteGoal:e=()=>{},onDuplicateGoal:n=()=>{},onExportGoal:r=()=>{},onAddContributionRequest:a=()=>{}}){const o=Number(c?.saved??c?.current??0),u=Number(c?.target??0),d=Number(c?.monthlyPlan??0),f=c?.icon||c?.emoji||"",p=c?.name||"Untitled Goal",m=u>0?Math.min(100,o/u*100):0;return x.jsxs("div",{className:"space-y-5",children:[x.jsxs("header",{className:"flex items-center justify-between gap-3",children:[x.jsx("div",{className:"space-y-1",children:x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"text-2xl",children:f}),x.jsxs("div",{children:[x.jsx("h1",{className:"text-xl font-semibold text-slate-100",children:p}),x.jsx("p",{className:"text-xs text-slate-400",children:"Personalized goal view  future: themed backgrounds & animations."})]})]})}),x.jsx(BT,{onEdit:()=>t(c?.id),onDelete:()=>{c?.id&&e(c.id)},onDuplicate:()=>n(c?.id),onExport:()=>r(c?.id)})]}),x.jsx(qs,{title:"PROGRESS",children:x.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[x.jsxs("span",{className:"text-slate-200",children:["$",o.toFixed(2)," / $",u.toFixed(2)]}),x.jsx(Bf,{value:m}),x.jsxs("span",{className:"text-xs text-slate-400",children:[m.toFixed(1),"% complete"]})]})}),x.jsxs(qs,{title:"PLAN",children:[x.jsxs("p",{className:"text-sm text-slate-200",children:["Recommended monthly contribution:",x.jsxs("span",{className:"ml-1 text-cyan-300 font-semibold",children:["$",d.toFixed(2)]})]}),x.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Later we'll calculate this based on your income, expenses and due date."}),x.jsx("div",{className:"mt-3 flex flex-wrap gap-2 text-xs",children:x.jsx("button",{className:"px-3 py-1.5 text-xs rounded-md border border-pink-400/70 text-pink-200 bg-pink-500/10 hover:bg-pink-500/20 transition",onClick:()=>a(c?.id),children:"Add Contribution"})})]})]})}const ep="budgetAppState_v1";function UT(){if(typeof window>"u")return null;try{const c=window.localStorage.getItem(ep);return c?JSON.parse(c):null}catch(c){return console.error("Failed to load stored state",c),null}}function FT(c){if(!(typeof window>"u"))try{window.localStorage.setItem(ep,JSON.stringify(c))}catch(t){console.error("Failed to save state",t)}}function zT(c){if(!c)return null;if(c.accounts&&Array.isArray(c.accounts))return c;const t={id:"main",name:"Main Account",type:"checking",transactions:Array.isArray(c.transactions)?c.transactions:[]};return{...c,accounts:[t],currentAccountId:c.currentAccountId||"main"}}const sp=[{key:"dashboard",label:"Dashboard"},{key:"balances",label:"Accounts"},{key:"budget",label:"Budget"},{key:"transactions",label:"Transactions"},{key:"goalDetail",label:"Goals"}],lo=sp.reduce((c,t)=>(c[t.key]=t.label,c),{}),Tf=["monthOverview","accountSnapshot","goals","csvImport"],bw={monthOverview:"Month Overview",accountSnapshot:"Account Snapshot",goals:"Goals",csvImport:"CSV Import"};function np(){const c=new Date,t=c.getFullYear(),e=String(c.getMonth()+1).padStart(2,"0");return`${t}-${e}`}function HT(){return{month:np(),income:5e3,fixed:[{id:"rent",label:"Rent / Mortgage",amount:1500},{id:"utilities",label:"Utilities & Internet",amount:250},{id:"insurance",label:"Insurance",amount:180}],variable:[{id:"groceries",label:"Groceries",amount:500},{id:"gas",label:"Gas & Transport",amount:250},{id:"fun",label:"Fun / Eating Out",amount:300}]}}function $T(){return{month:np(),income:0,fixed:[],variable:[]}}function qT(){return[{id:"emergency",name:"Emergency Fund",target:3e3,current:600,description:"36 months of core expenses to keep you safe."},{id:"debt",name:"Crush Debt",target:5e3,current:1200,description:"Throw extra at your highest interest debt."}]}function GT(){return[]}const yw="main";function vw(c={}){return{id:yw,name:"Main Checking",type:"checking",startingBalance:0,transactions:[],...c}}function VT(){return[vw({startingBalance:2500})]}function XT(){return[vw()]}function gy(c){const t=sp.map(r=>r.key);if(!Array.isArray(c)||!c.length)return t;const e=c.filter(r=>t.includes(r)),n=t.filter(r=>!e.includes(r));return[...e,...n]}function Hd(c){if(!Array.isArray(c)||!c.length)return Tf;const t=c.filter(n=>n in bw),e=Tf.filter(n=>!t.includes(n));return[...t,...e]}function YT(c){const t=dy(c.fixed||[]),e=dy(c.variable||[]),n=(c.income||0)-t-e;return{fixedTotal:t,variableTotal:e,leftover:n}}function KT(c){if(!c)return c;if(Array.isArray(c.transactions)&&c.transactions.length){const t={id:"main",name:"Main Checking",type:"checking",startingBalance:0,transactions:Array.isArray(c.transactions)?c.transactions:[]};return{...c,accounts:[t],currentAccountId:c.currentAccountId||"main"}}return c}const WT=[{match:"chase",label:"Chase"},{match:"capitalone",label:"Capital One"},{match:"wells",label:"Wells Fargo"},{match:"boa",label:"Bank of America"},{match:"navyfederal",label:"Navy Federal"},{match:"usaa",label:"USAA"},{match:"discover",label:"Discover"},{match:"amex",label:"American Express"}];function QT(c=""){const t=c.toLowerCase();for(const{match:e,label:n}of WT)if(t.includes(e))return n;return null}function JT(){const{user:c,authLoading:t,signInWithEmail:e,signUpWithEmail:n,signOut:r,resetPassword:a}=eE(),o=ut.useRef(!1),u=ut.useRef(null),d=ut.useRef(null);if(d.current===null){const H=UT(),W=KT(H);d.current=zT(W)}const f=d.current,[p,m]=ut.useState(f?.theme||"dark"),[y,v]=ut.useState(f?.budget||HT()),[_,w]=ut.useState(f?.goals||qT()),[S,E]=ut.useState(zd(f?.accounts||VT())),[R,T]=ut.useState(f?.currentAccountId||f?.accounts&&f.accounts[0]?.id||"main"),[O,N]=ut.useState(gy(f?.navOrder)),[k,M]=ut.useState(f?.homePage||"dashboard"),[I,X]=ut.useState(Hd(f?.dashboardSectionsOrder)),[Q,Z]=ut.useState(!1),[st,ht]=ut.useState(f?.homePage||"dashboard"),[wt,_t]=ut.useState(f?.selectedGoalId||(f?.goals?.[0]?.id??null)),[P,$]=ut.useState(null),[tt,At]=ut.useState(null),[Ot,j]=ut.useState(null),[G,J]=ut.useState(!1),[et,mt]=ut.useState({open:!1,mode:"create",goalId:null}),[bt,ft]=ut.useState({open:!1,goalId:null}),Jt=ut.useMemo(()=>YT(y),[y]),$t=ut.useMemo(()=>Lv(p),[p]),nn=ut.useMemo(()=>et.goalId&&_.find(H=>H.id===et.goalId)||null,[et.goalId,_]);ut.useEffect(()=>{typeof document<"u"&&(document.body.dataset.theme=p)},[p]);const ys=ut.useMemo(()=>{const H={};for(const W of S)H[W.id]=W;return H},[S]),Ms=ut.useMemo(()=>S.map(H=>{const W=typeof H.startingBalance=="number"?H.startingBalance:0,dt=mw(H),ct=W+dt;return{id:H.id,name:H.name,balance:ct}}),[S]),rn=ut.useMemo(()=>Ms.reduce((H,W)=>H+W.balance,0),[Ms]),js=Ms.find(H=>H.id===R)?.balance??0,oi=_.find(H=>H.id===wt)||_[0]||null,li=y.month||np();let Io=lo[st]||"Dashboard";st==="goalDetail"&&oi&&(Io=oi.name);function aa(H){if(H){o.current=!0;try{H.budget&&v(H.budget),H.goals&&w(H.goals),H.accounts&&E(zd(H.accounts||[])),H.currentAccountId&&T(H.currentAccountId),H.selectedGoalId&&_t(H.selectedGoalId),H.navOrder&&N(gy(H.navOrder)),H.homePage&&(M(H.homePage),ht(H.homePage)),H.dashboardSectionsOrder&&X(Hd(H.dashboardSectionsOrder)),H.theme&&m(H.theme)}catch(W){console.error("Failed to apply remote user state",W)}}}ut.useEffect(()=>{if(!c||!c.id)return;const H=Ie.channel(`user_state_realtime_${c.id}`).on("postgres_changes",{event:"*",schema:"public",table:"user_state",filter:`id=eq.${c.id}`},W=>{const dt=W.new?.state;dt&&aa(dt)}).subscribe();return()=>{Ie.removeChannel(H)}},[c?.id]),ut.useEffect(()=>{if(!c||!c.id){j(null),J(!1);return}let H=!1;return J(!0),rE(c).then(W=>{H||j(W)}).catch(W=>{H||console.error("Failed to load profile metadata:",W)}).finally(()=>{H||J(!1)}),()=>{H=!0}},[c?.id]),ut.useEffect(()=>{if(!c||!c.id)return;let H=!1;return(async()=>{try{const W=await nE(c.id);if(!W||H)return;aa(W)}catch(W){console.error("Failed to load remote user state",W)}})(),()=>{H=!0}},[c?.id]),ut.useEffect(()=>{const H={budget:y,goals:_,accounts:S,currentAccountId:R,selectedGoalId:wt,navOrder:O,homePage:k,dashboardSectionsOrder:I,theme:p};if(FT(H),!(!c||!c.id)){if(o.current){o.current=!1;return}return u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{sE(c.id,H).then(()=>{At(new Date().toLocaleTimeString())}).catch(W=>console.error("Failed to save user state to Supabase:",W))},600),()=>{u.current&&clearTimeout(u.current)}}},[c,y,_,S,R,wt,O,k,I,p]);async function oa(H){if(!c||!c.id)return!1;try{const W=await aE(c.id,H);return j(W),$({message:"Profile updated.",variant:"success"}),!0}catch(W){return console.error("Failed to update profile metadata:",W),$({message:"Couldn't update profile. Try again in a bit.",variant:"info"}),!1}}function Vi(H,W=null){mt({open:!0,mode:H,goalId:W})}function ci(){mt({open:!1,mode:"create",goalId:null})}function Uo(H,W=null){const dt=H?.name?.trim()||"Untitled Goal",ct=Math.max(0,Number(H?.current)||0),Bt=Math.max(0,Number(H?.target)||0),Ps=Math.max(0,Number(H?.monthlyPlan)||0);return{id:W||`goal-${Date.now()}`,name:dt,target:Bt,current:ct,saved:ct,monthlyPlan:Ps,emoji:H?.emoji&&H.emoji.trim()||"",dueDate:H?.dueDate||null,theme:H?.theme||"cyber",icon:H?.icon||"",background:H?.background||"default",animation:H?.animation||"pulse",description:H?.description?.trim()||""}}function eu(H){if(et.mode==="edit"&&et.goalId){const W=Uo(H,et.goalId);w(dt=>dt.map(ct=>ct.id===W.id?{...ct,...W}:ct)),$({message:`Updated goal "${W.name}".`,variant:"success"})}else{const W=Uo(H);w(dt=>[...dt,W]),_t(W.id),$({message:`Created goal "${W.name}".`,variant:"success"})}ci()}function Fe(H){if(!H)return;const W=_.filter(dt=>dt.id!==H);w(W),wt===H&&_t(W[0]?.id??null),ci(),$({message:"Goal deleted.",variant:"success"})}function su(){Vi("create",null)}function Fo(H){H&&Vi("edit",H)}function zo(H){const W=_.find(ct=>ct.id===H);if(!W)return;const dt={...W,id:`goal-${Date.now()}`,name:`${W.name||"Goal"} copy`};w(ct=>[...ct,dt]),_t(dt.id),ht("goalDetail"),$({message:`Duplicated goal "${W.name||"Goal"}".`,variant:"success"})}function Xi(H){const W=_.find(Bt=>Bt.id===H);if(!W){$({message:"Goal not found to export.",variant:"info"});return}const dt={name:W.name,target:W.target,saved:W.current??W.saved,monthlyPlan:W.monthlyPlan,description:W.description,progressPct:W.target>0?Number(((W.current??W.saved??0)/W.target*100).toFixed(2)):0,lastUpdated:new Date().toISOString()},ct=JSON.stringify(dt,null,2);navigator?.clipboard?.writeText?navigator.clipboard.writeText(ct).then(()=>{$({message:"Copied goal progress to clipboard.",variant:"success"})}).catch(()=>{$o(ct,W.name||"goal")}):$o(ct,W.name||"goal")}function nu(H){H&&ft({open:!0,goalId:H})}function Ho(H){if(!bt.goalId)return;const W=Math.max(0,Number(H)||0);w(dt=>dt.map(ct=>ct.id===bt.goalId?{...ct,current:(Number(ct.current??ct.saved??0)||0)+W,saved:(Number(ct.current??ct.saved??0)||0)+W}:ct)),$({message:`Added $${W.toFixed(2)} to your goal.`,variant:"success"}),ft({open:!1,goalId:null})}function $o(H,W){const dt=new Blob([H],{type:"application/json"}),ct=URL.createObjectURL(dt),Bt=document.createElement("a");Bt.href=ct,Bt.download=`${(W||"goal").toLowerCase().replace(/\s+/g,"-")}-progress.json`,document.body.appendChild(Bt),Bt.click(),document.body.removeChild(Bt),$({message:"Downloaded goal progress .json file.",variant:"success"})}function qo(H,W,dt){const ct=W+dt;if(ct<0||ct>=H.length)return H;const Bt=[...H],[Ps]=Bt.splice(W,1);return Bt.splice(ct,0,Ps),Bt}function ui(H){v(H)}function $e(H){M(H),ht(H),$({message:`Home page set to ${lo[H]||H}.`,variant:"success"})}function Ls(H,W){N(dt=>qo(dt,H,W))}function qe(H){X(Hd(H))}function Go(H,W){X(dt=>qo(dt,H,W))}function iu(H,W){const dt=(H||[]).filter(Ps=>typeof Ps.amount=="number"&&Ps.amount!==0);if(!dt.length){$({message:"No valid transactions found in this file.",variant:"info"});return}const ct=QT(W)||"",Bt=MT(S,R,dt,ct);E(zd(Bt.accounts)),T(Bt.targetAccountId),Bt.createdNew?$({message:`Created "${Bt.targetAccountName}" with ${dt.length} transactions.`,accountId:Bt.targetAccountId,variant:"success"}):$({message:`Imported ${dt.length} transactions into "${Bt.targetAccountName}".`,accountId:Bt.targetAccountId,variant:"success"})}function ru(H,W){E(dt=>dt.map(ct=>{if(ct.id!==R)return ct;const Ps=(Array.isArray(ct.transactions)?ct.transactions:[]).map((hi,Vo)=>Vo===H?{...hi,...W}:hi);return{...ct,transactions:Ps}}))}function Yi(H){E(W=>W.map(dt=>{if(dt.id!==R)return dt;const Bt=(Array.isArray(dt.transactions)?dt.transactions:[]).filter((Ps,hi)=>hi!==H);return{...dt,transactions:Bt}}))}function Ki(H,W){E(dt=>dt.map(ct=>ct.id===H?{...ct,startingBalance:W}:ct))}function Wi(H,W){E(dt=>dt.map(ct=>ct.id===H?{...ct,name:W}:ct))}function an(){const H=S.length+1,W=`acc-${Date.now()}`,dt={id:W,name:`Account ${H}`,type:"checking",startingBalance:0,transactions:[]};E(ct=>[...ct,dt]),T(W),$({message:`Created account "${dt.name}".`,accountId:W,variant:"success"})}async function Qi(){if(!window.confirm("This will reset your budget, goals, accounts, and transactions back to empty. Continue?"))return;let W=null;try{c?.id&&await Ie.from("user_state").delete().eq("id",c.id)}catch(dt){W=dt,console.error("Failed to reset remote data:",dt)}window.localStorage.removeItem(ep),v($T()),w(GT()),E(XT()),T(yw),_t(null),N(sp.map(dt=>dt.key)),M("dashboard"),X(Tf),ht("dashboard"),m("dark"),$({message:"All data reset successfully.",variant:"success"}),W&&window.alert("Remote reset failed, but local data was cleared. Try again later.")}return c?x.jsxs("div",{className:`min-h-screen flex flex-col ${$t.shellClass}`,children:[x.jsx("header",{className:`flex-none border-b backdrop-blur ${$t.headerClass}`,children:x.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-3 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[x.jsxs("div",{className:"flex flex-col",children:[x.jsx("span",{className:"text-xs tracking-[0.2em] text-cyan-300",children:"BUDGET CENTER"}),x.jsx("span",{className:"text-sm text-slate-400",children:"Dark cyber budgeting with themed goals"}),tt&&x.jsxs("span",{className:"text-[10px] text-slate-500 mt-1",children:["Last saved at ",tt]})]}),x.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2 text-xs",children:[O.map(H=>x.jsx(oE,{label:lo[H]||H,active:st===H,onClick:()=>ht(H)},H)),x.jsx(pE,{profile:Ot,email:c?.email,loading:G,onUpdateProfile:oa}),x.jsx(uE,{customizeMode:Q,setCustomizeMode:Z,onReset:Qi,onSignOut:r,themeValue:p,onChangeTheme:m})]})]})}),x.jsxs("main",{className:"flex-1 w-full max-w-5xl mx-auto px-4 py-4 space-y-3",children:[Q&&x.jsxs("div",{className:"border border-cyan-500/40 rounded-xl bg-cyan-500/5 p-4 space-y-4 shadow-lg",children:[x.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-sm font-semibold text-cyan-200",children:"Customize layout"}),x.jsx("p",{className:"text-xs text-slate-300",children:"Reorder your navigation tabs and dashboard sections. Changes are saved automatically."})]}),x.jsxs("div",{className:"flex gap-2 text-xs",children:[x.jsxs("span",{className:"px-2 py-1 rounded border border-cyan-400/50 text-cyan-200",children:["Home page: ",lo[k]||k]}),x.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-600/70 text-slate-200 hover:border-slate-400 transition",onClick:()=>Z(!1),children:"Done"})]})]}),x.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-xs",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{className:"uppercase tracking-[0.2em] text-slate-400",children:"Navigation order"}),x.jsx("ul",{className:"space-y-2",children:O.map((H,W)=>x.jsxs("li",{className:"flex items-center justify-between rounded-lg border border-slate-700/70 bg-black/30 px-3 py-2 text-slate-200",children:[x.jsxs("div",{className:"flex flex-col",children:[x.jsx("span",{className:"text-sm",children:lo[H]||H}),k===H&&x.jsx("span",{className:"text-[10px] text-cyan-300",children:"Home page"})]}),x.jsxs("div",{className:"flex items-center gap-1",children:[x.jsx("button",{type:"button",className:"px-2 py-1 border border-slate-600/70 rounded disabled:opacity-40",onClick:()=>Ls(W,-1),disabled:W===0,children:""}),x.jsx("button",{type:"button",className:"px-2 py-1 border border-slate-600/70 rounded disabled:opacity-40",onClick:()=>Ls(W,1),disabled:W===O.length-1,children:""}),x.jsx("button",{type:"button",className:"px-2 py-1 border border-cyan-500/50 rounded text-cyan-200",onClick:()=>$e(H),children:"Set home"})]})]},H))})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{className:"uppercase tracking-[0.2em] text-slate-400",children:"Dashboard sections"}),x.jsx("ul",{className:"space-y-2",children:I.map((H,W)=>x.jsxs("li",{className:"flex items-center justify-between rounded-lg border border-slate-700/70 bg-black/30 px-3 py-2 text-slate-200",children:[x.jsx("span",{className:"text-sm",children:bw[H]||H}),x.jsxs("div",{className:"flex items-center gap-1",children:[x.jsx("button",{type:"button",className:"px-2 py-1 border border-slate-600/70 rounded disabled:opacity-40",onClick:()=>Go(W,-1),disabled:W===0,children:""}),x.jsx("button",{type:"button",className:"px-2 py-1 border border-slate-600/70 rounded disabled:opacity-40",onClick:()=>Go(W,1),disabled:W===I.length-1,children:""})]})]},H))})]})]})]}),x.jsxs("div",{className:"flex items-center justify-between gap-3",children:[x.jsxs("div",{className:"flex flex-col",children:[x.jsx("h1",{className:"text-base font-semibold text-slate-50",children:Io}),x.jsxs("p",{className:"text-xs text-slate-400",children:[st==="dashboard"&&"Overview of your month, accounts, goals, and imports.",st==="balances"&&"View and edit your account balances and see net worth.",st==="budget"&&"Adjust your monthly budget categories and income.",st==="transactions"&&"Review, edit, and clean up imported transactions.",st==="goalDetail"&&"Drill into a single financial goal and its progress."]})]}),x.jsxs("div",{className:"flex flex-col items-end text-xs text-slate-400",children:[x.jsxs("span",{children:["Month:"," ",x.jsx("span",{className:"font-mono text-slate-100",children:li})]}),x.jsxs("span",{children:["Total Balance:"," ",x.jsxs("span",{className:"font-mono text-emerald-300",children:["$",(Number.isFinite(rn)?rn:0).toFixed(2)]})]})]})]}),st==="dashboard"&&x.jsx(RT,{month:li,income:y.income,fixed:Jt.fixedTotal,variable:Jt.variableTotal,leftover:Jt.leftover,goals:_,transactions:ys[R]?.transactions||[],accounts:S,currentAccountId:R,onChangeCurrentAccount:T,onOpenGoal:H=>{_t(H),ht("goalDetail")},onCreateGoal:su,currentAccountBalance:js,totalBalance:rn,sectionsOrder:I,onSectionsReorder:qe,customizeMode:Q,onCsvImported:iu}),st==="balances"&&x.jsx(jT,{accounts:S,currentAccountId:R,onChangeCurrentAccount:T,onCreateAccount:an,onDeleteAccount:H=>{if(S.length<=1){window.alert("You need at least one account. Create another one before deleting this.");return}if(window.confirm("Are you sure you want to delete this account? Its transactions will be lost.")&&(E(ct=>ct.filter(Bt=>Bt.id!==H)),R===H)){const ct=S.filter(Bt=>Bt.id!==H);ct.length?T(ct[0].id):T(null)}},onSetAccountBalance:Ki,onRenameAccount:Wi}),st==="budget"&&x.jsx(LT,{month:li,budget:y,totals:Jt,onBudgetChange:ui}),st==="transactions"&&x.jsx(PT,{transactions:ys[R]?.transactions||[],accountName:ys[R]?.name||"None",onUpdateTransaction:ru,onDeleteTransaction:Yi}),st==="goalDetail"&&x.jsx(IT,{goal:oi,onEditGoal:Fo,onDeleteGoal:Fe,onDuplicateGoal:zo,onExportGoal:Xi,onAddContributionRequest:nu})]}),P&&x.jsx(dE,{message:P.message,variant:P.variant,actionLabel:P.accountId?"View account":void 0,onAction:P.accountId?()=>{T(P.accountId),ht("balances"),$(null)}:void 0,onClose:()=>$(null)}),x.jsx(mE,{open:et.open,mode:et.mode,initialGoal:nn,onClose:ci,onSave:eu,onDelete:Fe}),x.jsx(bE,{open:bt.open,goal:_.find(H=>H.id===bt.goalId),onAdd:Ho,onClose:()=>ft({open:!1,goalId:null})})]}):x.jsx(hE,{loading:t,onSignIn:e,onSignUp:n,onResetPassword:a})}zA.createRoot(document.getElementById("root")).render(x.jsx(ut.StrictMode,{children:x.jsx(tE,{children:x.jsx(JT,{})})}));
